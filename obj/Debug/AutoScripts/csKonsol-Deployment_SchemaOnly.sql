CREATE USER [adew] FOR LOGIN [adew] WITH DEFAULT_SCHEMA=[dbo]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create FUNCTION [dbo].[HitungHari] (@tgl_awal datetime,@tgl_akhir datetime) RETURNS VARCHAR(100) AS BEGIN declare @BedaTahun Int declare @SisaBulan Int declare @Hari2 datetime declare @sisahari int declare @hasil VARCHAR(100) set @BedaTahun = DateDiff(month, @tgl_awal, @tgl_akhir) / 12 set @Hari2 = dateadd(month, DateDiff(month, @tgl_awal, @tgl_akhir), @tgl_awal) if @Hari2 > @tgl_akhir begin set @SisaBulan = (DateDiff(month, @tgl_awal, @tgl_akhir) % 12) - 1 set @Hari2 = dateadd(month, DateDiff(month, @tgl_awal, @tgl_akhir) - 1, @tgl_awal) end else begin set @SisaBulan = DateDiff(month, @tgl_awal, @tgl_akhir) % 12 set @Hari2 = dateadd(month, DateDiff(month, @tgl_awal, @tgl_akhir), @tgl_awal) end set @sisahari = DateDiff(day, @Hari2, @tgl_akhir) set @hasil = convert(nvarchar,@BedaTahun) + ' Tahun, ' + convert(nvarchar, @SisaBulan)  + ' Bulan, ' + convert(nvarchar, @sisahari) + ' Hari' RETURN @hasil END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Function [dbo].[Proper](@Data VarChar(8000)) Returns VarChar(8000) As Begin   Declare @Position Int   Select @Data = Stuff(Lower(@Data), 1, 1, Upper(Left(@Data, 1))), @Position = PatIndex('%[^a-zA-Z][a-z]%', @Data COLLATE Latin1_General_Bin) While @Position > 0 Select @Data = Stuff(@Data, @Position, 2, Upper(SubString(@Data, @Position, 2))), @Position = PatIndex('%[^a-zA-Z][a-z]%', @Data COLLATE Latin1_General_Bin) Return @Data End
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[SplitText] ( @string NVARCHAR(MAX), @delimiter CHAR(1) ) RETURNS @output TABLE(splitdata NVARCHAR(MAX) ) BEGIN DECLARE @start INT, @end INT SELECT @start = 1, @end = CHARINDEX(@delimiter, @string) WHILE @start < LEN(@string) + 1 BEGIN IF @end = 0  SET @end = LEN(@string) + 1 INSERT INTO @output (splitdata)  VALUES(SUBSTRING(@string, @start, @end - @start)) SET @start = @end + 1 SET @end = CHARINDEX(@delimiter, @string, @start) END RETURN END
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[__MigrationHistory](
	[MigrationId] [nvarchar](150) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[ContextKey] [nvarchar](300) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[Model] [varbinary](max) NOT NULL,
	[ProductVersion] [nvarchar](32) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
 CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY CLUSTERED 
(
	[MigrationId] ASC,
	[ContextKey] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AktivaMaster](
	[AktivaMasterID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tgltran] [datetime] NULL,
	[nobukti] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[noaktiva] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdbud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kelompok] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglbeli] [datetime] NULL,
	[nmaktiva] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kelompokaset] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tarifpct] [float] NULL,
	[jmlunit] [float] NULL,
	[satuan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sawalp] [float] NULL,
	[auditp] [float] NULL,
	[rcp] [float] NULL,
	[hapusp] [float] NULL,
	[rekp] [float] NULL,
	[kbnp] [float] NULL,
	[murnip] [float] NULL,
	[sawals] [float] NULL,
	[audits] [float] NULL,
	[rcs] [float] NULL,
	[hapuss] [float] NULL,
	[kbns] [float] NULL,
	[reks] [float] NULL,
	[murnis] [float] NULL,
	[stopr] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kondisi] [float] NULL,
 CONSTRAINT [PK_AktivaMaster] PRIMARY KEY CLUSTERED 
(
	[AktivaMasterID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AktivaRegistrasi](
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nourut] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdbud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[noaktiva] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[namaaktiva] [varchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kelompokaset] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[satuan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[statuspakai] [bit] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AktivaSaldo](
	[AktivaSaldoID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[noaktiva] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tarifpct] [float] NULL,
	[kdafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdbud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kelompok] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglbeli] [datetime] NULL,
	[nmaktiva] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kelompokaset] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jmlunit] [float] NULL,
	[satuan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nobukti] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[leveransir] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sawalp] [float] NULL,
	[auditp] [float] NULL,
	[rcp] [float] NULL,
	[hapusp] [float] NULL,
	[rekp] [float] NULL,
	[kbnp] [float] NULL,
	[murnip] [float] NULL,
	[sawals] [float] NULL,
	[audits] [float] NULL,
	[rcs] [float] NULL,
	[hapuss] [float] NULL,
	[reks] [float] NULL,
	[kbns] [float] NULL,
	[murnis] [float] NULL,
	[stopr] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_AktivaSaldo] PRIMARY KEY CLUSTERED 
(
	[AktivaSaldoID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AktivaTransaksi](
	[AktivaTransaksiID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[nourut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[noinput] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kelompok] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[noaktiva] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[noaktivab] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tarifpct] [float] NULL,
	[nmaktiva] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdbud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norekl] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglbeli] [datetime] NULL,
	[nobukti] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglbukti] [datetime] NULL,
	[leveransir] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jmlunit] [float] NULL,
	[jmlunit1] [float] NULL,
	[satuan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nilaiperolehan] [float] NULL,
	[nilaipenyusutan] [decimal](18, 0) NULL,
	[nilaipenyusutan_thl] [decimal](18, 0) NULL,
	[nilaipenyusutan_sbl] [decimal](18, 0) NULL,
	[nilaikoreksipenyusutan] [decimal](18, 0) NULL,
	[kelompokaset] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[statedit] [bit] NULL,
 CONSTRAINT [PK_AktivaTransaksi] PRIMARY KEY CLUSTERED 
(
	[AktivaTransaksiID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AkunKomentar](
	[AkunKomentarID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[kdtrans] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeolah] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodekom] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[uraian] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_AkunKomentar] PRIMARY KEY CLUSTERED 
(
	[AkunKomentarID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AkunMemorial](
	[AkunMemorialID] [uniqueidentifier] NOT NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[NoInput] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoBukti] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Keterangan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoUrut] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[uraian] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[unsur] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DK] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nilai] [float] NULL,
	[JmlFisik] [float] NULL,
	[NamaUser] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL,
	[KMK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK__AkunMemo__BD948253041093DD] PRIMARY KEY CLUSTERED 
(
	[AkunMemorialID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AkunMemorial6218](
	[AkunMemorialID] [uniqueidentifier] NOT NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[NoInput] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoBukti] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Keterangan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoUrut] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[uraian] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[unsur] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DK] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nilai] [float] NULL,
	[JmlFisik] [float] NULL,
	[NamaUser] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL,
	[KMK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AkunProduksiHP](
	[AkunProduksiHPID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[kodebud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeJenisOlah] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodegrade] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodevar] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodekbn] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[bi] [float] NULL,
	[rbi] [float] NULL,
	[pbi] [float] NULL,
 CONSTRAINT [PK_AkunProduksiHP] PRIMARY KEY CLUSTERED 
(
	[AkunProduksiHPID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AkunRKAP](
	[AkunRKAPID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[unsur] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebarang] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[qtyBrg_RKAP] [float] NULL,
	[qtyBrg_PMK] [float] NULL,
	[klsKary] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jmlHK_RKAP] [float] NULL,
	[jmlHsl_RKAP] [float] NULL,
	[jmlKary_RKAP] [float] NULL,
	[nilai_RKAP] [float] NULL,
	[jmlHK_PMK] [float] NULL,
	[jmlHsl_PMK] [float] NULL,
	[jmlKary_PMK] [float] NULL,
	[nilai_PMK] [float] NULL,
	[kodeblok] [nvarchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [nvarchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HaJelajah_RKAP] [float] NULL,
	[HaJelajah_PMK] [float] NULL,
	[KMK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_AkunRKAP] PRIMARY KEY CLUSTERED 
(
	[AkunRKAPID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AkunSaldoLL](
	[AkunSaldoLLID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdtrans] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdselisihRK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[uraian] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[rk] [float] NULL,
	[saldo_klas_a] [float] NULL,
	[saldo_klas_b] [float] NULL,
	[saldo_klas_c] [float] NULL,
	[saldo_bl_diseleksi] [float] NULL,
	[fisik_awal_tahun] [float] NULL,
	[biaya_awal_tahun] [float] NULL,
	[penambahan_bi] [float] NULL,
	[penambahan_sd_bl] [float] NULL,
	[ke_tti_bi] [float] NULL,
	[ke_tti_bl] [float] NULL,
	[ke_tbm_bi] [float] NULL,
	[ke_tbm_bl] [float] NULL,
	[ke_tm_bi] [float] NULL,
	[ke_tm_bl] [float] NULL,
	[ke_polybag_bi] [float] NULL,
	[ke_polybag_bl] [float] NULL,
	[dikirim_bi] [float] NULL,
	[dikirim_bl] [float] NULL,
	[dijual_bi] [float] NULL,
	[dijual_bl] [float] NULL,
	[mati_bi] [float] NULL,
	[mati_bl] [float] NULL,
	[HariKerja] [float] NULL,
	[BarangBahan] [float] NULL,
	[HasilKerja] [float] NULL,
	[HariKerjaKL] [float] NULL,
 CONSTRAINT [PK_AkunSaldoLL] PRIMARY KEY CLUSTERED 
(
	[AkunSaldoLLID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AkunSawal](
	[tanggal] [datetime] NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[unsur] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Debet] [float] NULL,
	[Kredit] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[CheckGajiKLM](
	[GajiAbsensiID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[kodeafd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodetrans] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regmdr] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sts] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeabs] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tkesulitan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdjnsupah] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdgrade] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdpanen] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[stpikul] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[grup] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jelajahHA] [float] NULL,
	[jmlkg] [float] NULL,
	[basic] [float] NULL,
	[hrgsatuan] [float] NULL,
	[hrglatex] [float] NULL,
	[hrglump] [float] NULL,
	[hslpanenTBS] [float] NULL,
	[hslpanen] [float] NULL,
	[hslpanenlump] [float] NULL,
	[hslpemel] [float] NULL,
	[hsllain2] [float] NULL,
	[satuan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sbrd] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nbrd] [float] NULL,
	[premipikul] [float] NULL,
	[selmkg] [float] NULL,
	[tpb] [float] NULL,
	[jmlupah] [float] NULL,
	[premi] [float] NULL,
	[jmlhadir] [float] NULL,
	[prekual] [float] NULL,
	[prekuan] [float] NULL,
	[kodekelas] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[stprestasi] [bit] NULL,
	[pct] [float] NULL,
	[CutiTahunan] [float] NULL,
	[CutiPanjang] [float] NULL,
	[CutiHamil] [float] NULL,
	[Sakit] [float] NULL,
	[Ijin] [float] NULL,
	[Mangkir] [float] NULL,
	[UserID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL,
	[KMK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[ms] [float] NULL,
	[pct1] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Contoh](
	[id] [uniqueidentifier] NOT NULL,
	[kebun] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[afd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Contoh] PRIMARY KEY CLUSTERED 
(
	[id] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DataTest](
	[NO_BUKTI] [nvarchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[URAIAN] [nvarchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NOREK] [nvarchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[DIK_KLM](
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Eap](
	[EapID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdtrans] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[noinput] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nourut] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nomor] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[pengemudi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[pembantu] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[namapemakai] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdafd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdbud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[asal] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tujuan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[waktukeluar] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[waktumasuk] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kmawal] [int] NULL,
	[kmakhir] [int] NULL,
	[jmlkm] [int] NULL,
	[jmlfisik] [float] NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nilai] [float] NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglmasuk] [datetime] NULL,
	[jmljam] [float] NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[krbb] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UserID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL,
	[KMK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Eap] PRIMARY KEY CLUSTERED 
(
	[EapID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[EvalAbsen](
	[Kebun] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[namaafdeling] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NAMA] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NAMA_JAB] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Sts] [varchar](5) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[Kerja] [float] NULL,
	[Libur] [float] NULL,
	[Sakit] [float] NULL,
	[CutiHamil] [float] NULL,
	[CutiTahunan] [float] NULL,
	[Ijin] [float] NULL,
	[Mangkir] [float] NULL,
	[CutiPanjang] [float] NULL,
	[CutiMBT] [float] NULL,
	[urut] [int] NOT NULL,
	[JmlHari] [float] NULL,
	[Bulan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GajiAbsensi](
	[GajiAbsensiID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[kodeafd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodetrans] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regmdr] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sts] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeabs] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tkesulitan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdjnsupah] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdgrade] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdpanen] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[stpikul] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[grup] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jelajahHA] [float] NULL,
	[jmlkg] [float] NULL,
	[basic] [float] NULL,
	[hrgsatuan] [float] NULL,
	[hrglatex] [float] NULL,
	[hrglump] [float] NULL,
	[hslpanenTBS] [float] NULL,
	[hslpanen] [float] NULL,
	[hslpanenlump] [float] NULL,
	[hslpemel] [float] NULL,
	[hsllain2] [float] NULL,
	[satuan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sbrd] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nbrd] [float] NULL,
	[premipikul] [float] NULL,
	[selmkg] [float] NULL,
	[tpb] [float] NULL,
	[jmlupah] [float] NULL,
	[premi] [float] NULL,
	[jmlhadir] [float] NULL,
	[prekual] [float] NULL,
	[prekuan] [float] NULL,
	[kodekelas] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[stprestasi] [bit] NULL,
	[pct] [float] NULL,
	[CutiTahunan] [float] NULL,
	[CutiPanjang] [float] NULL,
	[CutiHamil] [float] NULL,
	[Sakit] [float] NULL,
	[Ijin] [float] NULL,
	[Mangkir] [float] NULL,
	[UserID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL,
	[KMK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[ms] [float] NULL,
	[pct1] [float] NULL,
	[SAP_TargetAlokasi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SAP_WBS] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TBSLapangan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HKE] [float] NULL,
	[Libur] [float] NULL,
	[CutiMBT] [float] NULL,
	[IjinTidakDibayar] [float] NULL,
	[hslpanenScrap] [float] NULL,
	[pct2] [float] NULL,
	[HrgScrap] [float] NULL,
 CONSTRAINT [PK_GajiAbsensi] PRIMARY KEY CLUSTERED 
(
	[GajiAbsensiID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GajiJurnal](
	[GajiJurnalID] [uniqueidentifier] NOT NULL,
	[tanggal] [datetime] NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[grup] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nobukti] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[uraian] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DK] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nilai] [float] NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jmlfisik] [float] NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_GajiJurnal] PRIMARY KEY CLUSTERED 
(
	[GajiJurnalID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[gajiKLM](
	[kdunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GajiKulir](
	[GajiKulirID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[kodetrans] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regmdr] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sts] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[stb] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jmlhasil] [float] NULL,
	[nilai] [float] NULL,
	[KMK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[pct] [float] NULL,
	[SAP_TargetAlokasi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SAP_WBS] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[grup] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[LuasJelajah] [float] NULL,
	[TBS] [float] NULL,
	[jmlhasilLump] [float] NULL,
	[pct1] [float] NULL,
	[hrgsatuan] [float] NULL,
	[hrglatex] [float] NULL,
	[hrglump] [float] NULL,
	[Nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KgBrondol] [float] NULL,
	[jmlhasilScrap] [float] NULL,
	[pct2] [float] NULL,
	[HrgScrap] [float] NULL,
 CONSTRAINT [PK_GajiKulir] PRIMARY KEY CLUSTERED 
(
	[GajiKulirID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GajiLembur](
	[GajiLemburID] [uniqueidentifier] NOT NULL,
	[tanggal] [datetime] NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeAfd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regmdr] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nilai] [float] NULL,
	[SAP_TargetAlokasi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SAP_WBS] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sts] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_GajiLembur] PRIMARY KEY CLUSTERED 
(
	[GajiLemburID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GajiMaster](
	[GajiMasterID] [uniqueidentifier] NOT NULL,
	[kdunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[tanggal] [datetime] NOT NULL,
	[kodeafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regmdr] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[sts] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PDP] [float] NULL,
	[pdpth] [float] NULL,
	[Jab] [float] NULL,
	[Pen] [float] NULL,
	[Diri] [float] NULL,
	[GajiPokok] [float] NULL,
	[TTetap] [float] NULL,
	[TKhusus] [float] NULL,
	[TSansos] [float] NULL,
	[TStruktural] [float] NULL,
	[TJabatan] [float] NULL,
	[TJamSostek] [float] NULL,
	[TDapenbun] [float] NULL,
	[TPPIP] [float] NULL,
	[TKomunikasi] [float] NULL,
	[TPeralihan] [float] NULL,
	[TTransportasi] [float] NULL,
	[UpahHarian] [float] NULL,
	[UpahBorong] [float] NULL,
	[UpahRecovery] [float] NULL,
	[TPPH21] [float] NULL,
	[Rapel] [float] NULL,
	[Premi] [float] NULL,
	[PJamsostek] [float] NULL,
	[PDapenbun] [float] NULL,
	[PPPIP] [float] NULL,
	[PPPH21] [float] NULL,
	[PKebun] [float] NULL,
	[PKoperasi] [float] NULL,
	[JmlHasil] [float] NULL,
	[Kerja] [float] NULL,
	[Borong] [float] NULL,
	[Recovery] [float] NULL,
	[Libur] [float] NULL,
	[Sakit] [float] NULL,
	[PermisiDibayar] [float] NULL,
	[CutiHamil] [float] NULL,
	[CutiTahunan] [float] NULL,
	[IjinTdkDibayar] [float] NULL,
	[Mangkir] [float] NULL,
	[CutiPanjang] [float] NULL,
	[CutiMBT] [float] NULL,
	[TBPJS] [float] NULL,
	[PBPJS] [float] NULL,
	[TBPJSKes] [float] NULL,
	[PBPJSKes] [float] NULL,
	[TBPJS_JP] [float] NULL,
	[PBPJS_JP] [float] NULL,
	[TBPJS_JKK] [float] NULL,
	[PBPJS_JKK] [float] NULL,
	[TBPJS_JHT] [float] NULL,
	[PBPJS_JHT] [float] NULL,
	[TBPJS_JKM] [float] NULL,
	[PBPJS_JKM] [float] NULL,
	[PDHK] [float] NULL,
	[Lembur] [float] NULL,
	[Kulir] [float] NULL,
	[PBank] [float] NULL,
	[PSPBun] [float] NULL,
	[PIKBI] [float] NULL,
	[PSakitBkpj] [float] NULL,
	[PDenda] [float] NULL,
	[PHukuman] [float] NULL,
	[AdjustBPJSKes] [float] NULL,
	[Paguyuban] [float] NULL,
	[PremiBrondolan] [float] NULL,
	[Premi_Scrap] [float] NULL,
	[Premi_Pikul] [float] NULL,
 CONSTRAINT [PK_GajiMaster1] PRIMARY KEY CLUSTERED 
(
	[GajiMasterID] ASC,
	[kdunit] ASC,
	[tanggal] ASC,
	[register] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GajiPJTK](
	[GajiPJTKID] [uniqueidentifier] NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[NoSPK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nourut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodePJTK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[hrgsatuan] [float] NULL,
	[lain2] [float] NULL,
	[potongan] [float] NULL,
	[pph] [float] NULL,
	[jmlhasil] [float] NULL,
	[jmlhadir] [float] NULL,
	[pct] [float] NULL,
	[jmlupah] [float] NULL,
	[PPH2123] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tender] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SAP_TargetAlokasi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SAP_WBS] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoInput] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KgLatek] [float] NULL,
	[KgLump] [float] NULL,
	[JmlTBS] [float] NULL,
	[JmlBrondol] [float] NULL,
	[Pct1] [float] NULL,
	[PremiAnemer] [float] NULL,
	[KgTBS] [float] NULL,
	[jelajahHA] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GajiPotongan](
	[GajiPotonganID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[kodeafd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sts] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regmdr] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodetrans] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jnsptg] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nilai] [float] NULL,
	[potongan] [float] NULL,
	[keterangan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Uraian] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[IKBI] [float] NULL,
	[SPBUN] [float] NULL,
	[Sakit] [float] NULL,
	[Denda] [float] NULL,
	[Hukuman] [float] NULL,
 CONSTRAINT [PK_GajiPotongan] PRIMARY KEY CLUSTERED 
(
	[GajiPotonganID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GajiPPh21](
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[kodeafd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nilai] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GajiPremi](
	[GajiPremiID] [uniqueidentifier] NOT NULL,
	[tanggal] [datetime] NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodetrans] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeAfd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeAfd1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jnsprm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sts] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regmdr] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jmlfisik] [float] NULL,
	[nilai] [float] NULL,
	[KMK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SAP_TargetAlokasi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SAP_WBS] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_GajiPremi] PRIMARY KEY CLUSTERED 
(
	[GajiPremiID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GajiPremiPanen](
	[GajiPremiPanenID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodetrans] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[kodebud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sts] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regmdr] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tkesulitan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodepanen] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jmlhasil] [float] NULL,
	[basic] [float] NULL,
	[target] [float] NULL,
	[rerata] [float] NULL,
	[PCTRendement] [float] NULL,
	[jmlkary] [float] NULL,
	[jmlhk] [float] NULL,
	[ndxmutu] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[klas] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[rbt] [float] NULL,
	[pkualitas] [float] NULL,
	[pkuantitas] [float] NULL,
	[denda] [float] NULL,
	[PCTpmandor] [float] NULL,
	[jmlpremi] [float] NULL,
	[pmandor] [float] NULL,
	[KMK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_GajiPremiPanen] PRIMARY KEY CLUSTERED 
(
	[GajiPremiPanenID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GajiRapel](
	[GajiRapelID] [uniqueidentifier] NOT NULL,
	[tanggal] [datetime] NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeAfd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regmdr] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nilai] [float] NULL,
	[SAP_TargetAlokasi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SAP_WBS] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_GajiRapel] PRIMARY KEY CLUSTERED 
(
	[GajiRapelID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GajiSanksiSawit](
	[GajiSanksiSawitID] [uniqueidentifier] NULL,
	[tanggal] [datetime] NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodetrans] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeAfd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regmdr] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sts] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdJabatan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Keterangan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[BrondolanTidakDikutipBersih] [float] NULL,
	[BuahMatangTidakDipanen] [float] NULL,
	[BuahMatangTidakDiangkut] [float] NULL,
	[PelepahTidakDiSusun] [float] NULL,
	[BuahLewatMatang] [float] NULL,
	[PelepahTidakDiTurunkan] [float] NULL,
	[TangkaiPanjangTidakDiPotong] [float] NULL,
	[TBSTidakDiBeriNomor] [float] NULL,
	[TBSF5TidakDiBrondolkan] [float] NULL,
	[TBSTidakDiSusunDiTPH] [float] NULL,
	[PanenBuahSangatMentah] [float] NULL,
	[BuahMentahTerAngkutKePKS] [float] NULL,
	[BrondolanTerTinggalDiTPH] [float] NULL,
	[SelisihTBSDiPB25] [float] NULL,
	[DendaMandor] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GajiSPKHonor](
	[GajiSPKHonorID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodetrans] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[NoSPK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nourut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdjnsupah] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jmlhadir] [float] NULL,
	[hrgsatuan] [float] NULL,
	[lain2] [float] NULL,
	[potongan] [float] NULL,
	[pph] [float] NULL,
	[jmlhasil] [float] NULL,
	[jmlupah] [float] NULL,
	[PPH2123] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KMK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[pct] [float] NULL,
	[pct1] [float] NULL,
	[tender] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_GajiSPKHonor] PRIMARY KEY CLUSTERED 
(
	[GajiSPKHonorID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GajiTaksasi](
	[GajiTaksasiID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[kodeafd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodetrans] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regmdr] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sts] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeabs] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tkesulitan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdjnsupah] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdgrade] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdpanen] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[stpikul] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[grup] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jelajahHA] [float] NULL,
	[jmlkg] [float] NULL,
	[basic] [float] NULL,
	[hrgsatuan] [float] NULL,
	[hslpanenTBS] [float] NULL,
	[hslpanen] [float] NULL,
	[hslpemel] [float] NULL,
	[hsllain2] [float] NULL,
	[satuan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sbrd] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nbrd] [float] NULL,
	[premipikul] [float] NULL,
	[selmkg] [float] NULL,
	[tpb] [float] NULL,
	[jmlupah] [float] NULL,
	[premi] [float] NULL,
	[jmlhadir] [float] NULL,
	[prekual] [float] NULL,
	[prekuan] [float] NULL,
	[kodekelas] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[stprestasi] [bit] NULL,
	[pct] [float] NULL,
	[CutiTahunan] [float] NULL,
	[CutiPanjang] [float] NULL,
	[CutiHamil] [float] NULL,
	[Sakit] [float] NULL,
	[Ijin] [float] NULL,
	[Mangkir] [float] NULL,
	[UserID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL,
 CONSTRAINT [PK_GajiTaksasi] PRIMARY KEY CLUSTERED 
(
	[GajiTaksasiID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GajiZeroRijek](
	[GajiZeroRijekID] [uniqueidentifier] NULL,
	[tanggal] [datetime] NOT NULL,
	[kdbranded] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[rijek] [float] NULL,
	[leaf] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[pctleaf] [float] NULL,
	[indexpremi] [float] NULL,
	[KodeOlah] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DasarTarif] [float] NULL,
	[PremiKualitas] [float] NULL,
 CONSTRAINT [PK_GajiZeroRijek] PRIMARY KEY CLUSTERED 
(
	[tanggal] ASC,
	[kdbranded] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GJIHrgbrgll](
	[GJIHrgbrgllID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[kodeafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HrgLatex] [float] NULL,
	[HrgLump] [float] NULL,
 CONSTRAINT [PK_GJIHrgbrgll] PRIMARY KEY CLUSTERED 
(
	[GJIHrgbrgllID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[hanca](
	[kd_kbn] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[grperphn] [decimal](18, 2) NULL,
	[hanca] [decimal](18, 2) NULL,
	[populasi] [decimal](18, 2) NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[kartu](
	[KartuID] [uniqueidentifier] NOT NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Tanggal] [datetime] NULL,
	[NoBukti] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoInput] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeBudidaya] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeAfdeling] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeBarang] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeUnsur] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Uraian] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Jml_fisik] [float] NULL,
	[Debet] [float] NULL,
	[Kredit] [float] NULL,
	[Aplikasi] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Kartu29_0120](
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Tanggal] [datetime] NULL,
	[NoBukti] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoInput] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeBudidaya] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeAfdeling] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeBarang] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeUnsur] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Uraian] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Jml_fisik] [float] NULL,
	[Debet] [float] NULL,
	[Kredit] [float] NULL,
	[Aplikasi] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[kartu6218](
	[KartuID] [uniqueidentifier] NOT NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Tanggal] [datetime] NULL,
	[NoBukti] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoInput] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeBudidaya] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeAfdeling] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeBarang] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeUnsur] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Uraian] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Jml_fisik] [float] NULL,
	[Debet] [float] NULL,
	[Kredit] [float] NULL,
	[Aplikasi] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[kartu6219](
	[KartuID] [uniqueidentifier] NOT NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Tanggal] [datetime] NULL,
	[NoBukti] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoInput] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeBudidaya] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeAfdeling] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeBarang] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeUnsur] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Uraian] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Jml_fisik] [float] NULL,
	[Debet] [float] NULL,
	[Kredit] [float] NULL,
	[Aplikasi] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[KartuClipper](
	[KodeUnit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Bulan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[no_bukti] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kd_bud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kd_afd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[uraian] [varchar](1000) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[debet] [float] NULL,
	[kredit] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[KaryawanPengolahan](
	[Tahun] [int] NULL,
	[KodeKebun] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NamaKebun] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[StatusKaryawan] [varchar](10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Register] [varchar](14) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NamaKaryawan] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Budidaya] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NamaBudidaya] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[KasBank](
	[KasBankID] [uniqueidentifier] NOT NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KT] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Inisial] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoInput] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Tanggal] [datetime] NULL,
	[Nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Alamat] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Ket] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[RekKB] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoUrut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KdBud] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdAfd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Netral] [varchar](10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Uraian] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Nilai] [numeric](18, 0) NULL,
	[Jml_Fisik] [float] NULL,
	[KdArus] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglKom] [datetime] NULL,
	[namauser] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KMK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Waktu] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoFaktur] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[IDPembeli] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[BiayaBank] [float] NULL,
 CONSTRAINT [PK_KasBank] PRIMARY KEY CLUSTERED 
(
	[KasBankID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[KasBankv](
	[KasBankvID] [uniqueidentifier] NOT NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KT] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoBuku] [varchar](5) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[No_Ver] [varchar](16) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Tgl_Ver] [datetime] NULL,
	[NoInput] [varchar](15) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Tanggal] [datetime] NULL,
	[RekKB] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_KasBankv] PRIMARY KEY CLUSTERED 
(
	[KasBankvID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[KertaJaya](
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Tanggal] [datetime] NULL,
	[NoBukti] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoInput] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeBudidaya] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeAfdeling] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeBarang] [varchar](8) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Netral] [varchar](16) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeUnsur] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Uraian] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Jml_fisik] [float] NULL,
	[Debet] [float] NULL,
	[Kredit] [float] NULL,
	[Aplikasi] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[KertasKerjaPPH21](
	[KodeUnit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NAMA] [varchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NPWP] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[status] [varchar](257) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Gaji] [float] NULL,
	[Sansos] [float] NULL,
	[Jabatan] [float] NULL,
	[Struktural] [float] NULL,
	[Tetap] [float] NULL,
	[Jamsostek] [float] NULL,
	[Dapenbun] [float] NULL,
	[bonus] [float] NULL,
	[thr] [float] NULL,
	[tantiem] [float] NULL,
	[cuti] [float] NULL,
	[jubileum] [float] NULL,
	[Rapel] [float] NULL,
	[Premi] [float] NULL,
	[IuranPensiun] [float] NULL,
	[JHT] [float] NULL,
	[GajiSBI] [float] NULL,
	[SansosSBI] [float] NULL,
	[JabatanSBI] [float] NULL,
	[StrukturalSBI] [float] NULL,
	[TetapSBI] [float] NULL,
	[JamsostekSBI] [float] NULL,
	[DapenbunSBI] [float] NULL,
	[bonusSBI] [float] NULL,
	[thrSBI] [float] NULL,
	[tantiemSBI] [float] NULL,
	[cutiSBI] [float] NULL,
	[jubileumSBI] [float] NULL,
	[RapelSBI] [float] NULL,
	[PremiSBI] [float] NULL,
	[IuranPensiunSBI] [float] NULL,
	[JHTSBI] [float] NULL,
	[TunjanganPajak] [float] NULL,
	[TunjanganPajakSBI] [float] NULL,
	[Lain2] [float] NULL,
	[Lain2SBI] [float] NULL,
	[Tanggal] [datetime] NULL,
	[Kelamin] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PendapatanTidakTeratur](
	[tanggal] [datetime] NULL,
	[kodeunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd1] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodetrans] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regmdr] [varchar](14) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](14) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sts] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud1] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nilai] [float] NULL,
	[keterangan] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL,
	[UserID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PivotBB](
	[tanggal] [datetime] NULL,
	[namabarang] [varchar](300) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KB10] [float] NULL,
	[KB11] [float] NULL,
	[KB12] [float] NULL,
	[KB13] [float] NULL,
	[KB14] [float] NULL,
	[KB15] [float] NULL,
	[KB16] [float] NULL,
	[KB17] [float] NULL,
	[KB18] [float] NULL,
	[KB19] [float] NULL,
	[KB20] [float] NULL,
	[KB21] [float] NULL,
	[KB22] [float] NULL,
	[KB23] [float] NULL,
	[KB24] [float] NULL,
	[KB25] [float] NULL,
	[KB28] [float] NULL,
	[KB29] [float] NULL,
	[KB31] [float] NULL,
	[KB32] [float] NULL,
	[KB33] [float] NULL,
	[KB34] [float] NULL,
	[KB35] [float] NULL,
	[KB36] [float] NULL,
	[KB37] [float] NULL,
	[KB39] [float] NULL,
	[KB40] [float] NULL,
	[KB41] [float] NULL,
	[KB42] [float] NULL,
	[KB43] [float] NULL,
	[KB44] [float] NULL,
	[KB45] [float] NULL,
	[KB46] [float] NULL,
	[KB47] [float] NULL,
	[KB49] [float] NULL,
	[KB50] [float] NULL,
	[KB62] [float] NULL,
	[KB64] [float] NULL,
	[KB65] [float] NULL,
	[KB68] [float] NULL,
	[KB69] [float] NULL,
	[KB71] [float] NULL,
	[KB72] [float] NULL,
	[KB74] [float] NULL,
	[Jumlah] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PivotBBTemp](
	[NamaBarang] [varchar](300) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[69] [float] NULL,
	[74] [float] NULL,
	[17] [float] NULL,
	[37] [float] NULL,
	[46] [float] NULL,
	[43] [float] NULL,
	[68] [float] NULL,
	[28] [float] NULL,
	[49] [float] NULL,
	[36] [float] NULL,
	[12] [float] NULL,
	[50] [float] NULL,
	[21] [float] NULL,
	[29] [float] NULL,
	[72] [float] NULL,
	[19] [float] NULL,
	[22] [float] NULL,
	[71] [float] NULL,
	[14] [float] NULL,
	[47] [float] NULL,
	[16] [float] NULL,
	[41] [float] NULL,
	[11] [float] NULL,
	[23] [float] NULL,
	[13] [float] NULL,
	[35] [float] NULL,
	[42] [float] NULL,
	[10] [float] NULL,
	[44] [float] NULL,
	[24] [float] NULL,
	[34] [float] NULL,
	[62] [float] NULL,
	[32] [float] NULL,
	[18] [float] NULL,
	[25] [float] NULL,
	[65] [float] NULL,
	[31] [float] NULL,
	[33] [float] NULL,
	[40] [float] NULL,
	[15] [float] NULL,
	[39] [float] NULL,
	[20] [float] NULL,
	[64] [float] NULL,
	[45] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Pivotnilai](
	[NamaBarang] [varchar](300) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[69] [float] NULL,
	[74] [float] NULL,
	[17] [float] NULL,
	[37] [float] NULL,
	[46] [float] NULL,
	[43] [float] NULL,
	[68] [float] NULL,
	[28] [float] NULL,
	[49] [float] NULL,
	[36] [float] NULL,
	[12] [float] NULL,
	[50] [float] NULL,
	[21] [float] NULL,
	[29] [float] NULL,
	[72] [float] NULL,
	[19] [float] NULL,
	[22] [float] NULL,
	[71] [float] NULL,
	[14] [float] NULL,
	[47] [float] NULL,
	[16] [float] NULL,
	[41] [float] NULL,
	[11] [float] NULL,
	[23] [float] NULL,
	[13] [float] NULL,
	[35] [float] NULL,
	[42] [float] NULL,
	[10] [float] NULL,
	[44] [float] NULL,
	[24] [float] NULL,
	[34] [float] NULL,
	[62] [float] NULL,
	[32] [float] NULL,
	[18] [float] NULL,
	[25] [float] NULL,
	[65] [float] NULL,
	[31] [float] NULL,
	[33] [float] NULL,
	[40] [float] NULL,
	[15] [float] NULL,
	[39] [float] NULL,
	[20] [float] NULL,
	[64] [float] NULL,
	[45] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PotonganRemiseKebun](
	[kdunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[nmKebun] [varchar](63) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Bulan] [varchar](63) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nmGol] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Grup] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[kodeafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[Nama] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Gol] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Gol1] [varchar](53) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Gaji] [float] NULL,
	[UMK] [float] NULL,
	[JamPersh] [float] NULL,
	[JamPrib] [float] NULL,
	[JamTotal] [float] NULL,
	[JamPersh1] [float] NULL,
	[JamPrib1] [float] NULL,
	[JamTotal1] [float] NULL,
	[DapPersh] [float] NULL,
	[DapPrib] [float] NULL,
	[DapTotal] [float] NULL,
	[JpPersh] [float] NULL,
	[JpPrib] [float] NULL,
	[JpTotal] [float] NULL,
	[JpPersh1] [float] NULL,
	[JpPrib1] [float] NULL,
	[JpTotal1] [float] NULL,
	[KsPersh] [float] NULL,
	[KsPrib] [float] NULL,
	[KsTotal] [float] NULL,
	[JmlPersh] [float] NULL,
	[JmlPrib] [float] NULL,
	[Total] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PotonganRemiseKebunRekap](
	[kdunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[nmKebun] [varchar](63) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Bulan] [varchar](63) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Grup] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[nmGrup] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Gol] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Gol1] [varchar](65) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UMK] [float] NULL,
	[Gaji] [float] NULL,
	[JamPersh] [float] NULL,
	[JamPrib] [float] NULL,
	[JamTotal] [float] NULL,
	[JamPersh1] [float] NULL,
	[JamPrib1] [float] NULL,
	[JamTotal1] [float] NULL,
	[DapPersh] [float] NULL,
	[DapPrib] [float] NULL,
	[DapTotal] [float] NULL,
	[JpPersh] [float] NULL,
	[JpPrib] [float] NULL,
	[JpTotal] [float] NULL,
	[JpPersh1] [float] NULL,
	[JpPrib1] [float] NULL,
	[JpTotal1] [float] NULL,
	[KsPersh] [float] NULL,
	[KsPrib] [float] NULL,
	[KsTotal] [float] NULL,
	[JmlPersh] [float] NULL,
	[JmlPrib] [float] NULL,
	[Total] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PPH21](
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NAMA] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NPWP] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[status] [varchar](257) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Gaji] [float] NULL,
	[TunjanganPajak] [float] NULL,
	[Sansos] [float] NULL,
	[Jabatan] [float] NULL,
	[Struktural] [float] NULL,
	[Tetap] [float] NULL,
	[Jamsostek] [float] NULL,
	[Dapenbun] [float] NULL,
	[bonus] [float] NULL,
	[thr] [float] NULL,
	[tantiem] [float] NULL,
	[cuti] [float] NULL,
	[jubileum] [float] NULL,
	[Rapel] [float] NULL,
	[Premi] [float] NULL,
	[IuranPensiun] [float] NULL,
	[JHT] [float] NULL,
	[Lain2] [float] NULL,
	[Kelamin] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PPH21Bulanan](
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NAMA] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NPWP] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[status] [varchar](257) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Gaji] [float] NULL,
	[Sansos] [float] NULL,
	[Jabatan] [float] NULL,
	[Struktural] [float] NULL,
	[Tetap] [float] NULL,
	[Jamsostek] [float] NULL,
	[Dapenbun] [float] NULL,
	[bonus] [float] NULL,
	[thr] [float] NULL,
	[tantiem] [float] NULL,
	[cuti] [float] NULL,
	[jubileum] [float] NULL,
	[Rapel] [float] NULL,
	[Premi] [float] NULL,
	[IuranPensiun] [float] NULL,
	[JHT] [float] NULL,
	[GajiSBI] [float] NULL,
	[SansosSBI] [float] NULL,
	[JabatanSBI] [float] NULL,
	[StrukturalSBI] [float] NULL,
	[TetapSBI] [float] NULL,
	[JamsostekSBI] [float] NULL,
	[DapenbunSBI] [float] NULL,
	[bonusSBI] [float] NULL,
	[thrSBI] [float] NULL,
	[tantiemSBI] [float] NULL,
	[cutiSBI] [float] NULL,
	[jubileumSBI] [float] NULL,
	[RapelSBI] [float] NULL,
	[PremiSBI] [float] NULL,
	[IuranPensiunSBI] [float] NULL,
	[JHTSBI] [float] NULL,
	[TunjanganPajak] [float] NULL,
	[TunjanganPajakSBI] [float] NULL,
	[Lain2] [float] NULL,
	[Lain2SBI] [float] NULL,
	[Tanggal] [datetime] NULL,
	[Kelamin] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Produksi](
	[ProduksiID] [uniqueidentifier] NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[tanggal1] [datetime] NULL,
	[waktu] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nourut] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebln] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodetrans] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodemerk] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodemerk1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeJenisOlah] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeasal] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodekemasan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodegrade] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[namagrade] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodegrade1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[namagrade1] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodekbn] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodevar] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thchop] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nochop] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nopol] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[pengemudi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeterima] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeLE] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nosc] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodepembeli] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sack] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[JmlKg1] [float] NULL,
	[JmlKg2] [float] NULL,
	[Tarra] [float] NULL,
	[rbi] [float] NULL,
	[pbi] [float] NULL,
	[bbm] [float] NULL,
	[pct] [float] NULL,
	[pakang] [float] NULL,
	[nospa] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglspa] [datetime] NULL,
	[kodeangkutan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodegudang] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nottp] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[noppt] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[uraian] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[inisial] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[ED] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[QR] [image] NULL,
	[tglinput] [datetime] NULL,
	[userID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[BBM1] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[rbt](
	[kebun] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[afdeling] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[blok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kloon] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[luas] [decimal](18, 2) NULL,
	[populasi] [decimal](18, 2) NULL,
	[rbt] [decimal](18, 2) NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Afdeling](
	[Ref_AfdelingID] [uniqueidentifier] NOT NULL,
	[kodekebun] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafdeling] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[namaafdeling] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_Afdeling] PRIMARY KEY CLUSTERED 
(
	[Ref_AfdelingID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Areal](
	[Ref_ArealID] [uniqueidentifier] NOT NULL,
	[kodekebun] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebudidaya] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafdeling] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeblok] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[namablok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[status] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tahuntanam] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[luas] [decimal](18, 4) NULL,
	[kodekloon] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jmlpohon] [float] NULL,
	[tinggipohon] [float] NULL,
	[topologi] [float] NULL,
	[exareal] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeTopografi] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeKetinggian] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[mdpl] [float] NULL,
	[tanggal] [datetime] NULL,
	[jmlPatok] [float] NULL,
	[StatusAreal] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[StatusProses] [bit] NULL,
 CONSTRAINT [PK_Ref_Areal] PRIMARY KEY CLUSTERED 
(
	[Ref_ArealID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_AsalProd](
	[Ref_AsalProdID] [uniqueidentifier] NOT NULL,
	[kdasal] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[rekBasah] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[rekJadi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_AsalProd] PRIMARY KEY CLUSTERED 
(
	[Ref_AsalProdID] ASC,
	[kdasal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Barang](
	[Ref_BarangID] [uniqueidentifier] NOT NULL,
	[norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeBarang] [varchar](8) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NamaBarang] [varchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeSatuan] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NamaSatuan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[InitSatuan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[JenisBarang] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_Barang] PRIMARY KEY CLUSTERED 
(
	[Ref_BarangID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Basic](
	[Ref_BasicID] [uniqueidentifier] NOT NULL,
	[tanggal] [datetime] NULL,
	[kode] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regmdr] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sts] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdpanen] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[target] [float] NULL,
	[rkap] [float] NULL,
	[tkesulitan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[basicyld] [float] NULL,
	[basicyldbrd] [float] NULL,
	[basicjlj] [float] NULL,
	[jmlhari] [float] NULL,
	[jmlorg] [float] NULL,
	[premibrd] [float] NULL,
 CONSTRAINT [PK_Ref_Basic] PRIMARY KEY CLUSTERED 
(
	[Ref_BasicID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Budidaya](
	[Ref_BudidayaID] [uniqueidentifier] NOT NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[kd_bud] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[nm_bud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[inti] [bit] NULL,
 CONSTRAINT [PK_Ref_Budidaya_1] PRIMARY KEY CLUSTERED 
(
	[Ref_BudidayaID] ASC,
	[KodeUnit] ASC,
	[kd_bud] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Bulan](
	[tanggal] [int] NULL,
	[bulan] [int] NULL,
	[romawi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[namabulan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_BulanBuku](
	[BulanBuku] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_BulanTransaksi](
	[Aplikasi] [varchar](10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[bulan] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_DBHargaSatuan](
	[Tahun] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeBarang] [varchar](8) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NamaBarang] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Tr1] [decimal](18, 2) NULL,
	[Tr2] [decimal](18, 2) NULL,
	[Tr3] [decimal](18, 2) NULL,
	[Tr4] [decimal](18, 2) NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Dik](
	[Ref_DikID] [uniqueidentifier] NOT NULL,
	[TANGGAL] [datetime] NULL,
	[REG] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NAMA] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NM_PGL] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GLR_DPN] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GLR_BLK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TPT_LAHIR] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TGL_LAHIR] [datetime] NULL,
	[KELAMIN] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GOL_DARAH] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AGAMA] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[ALAMAT] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KOTA] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TINGGAL] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SIPIL] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[STAT_IS] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TGL_NIKAH] [datetime] NULL,
	[TGL_CERAI] [datetime] NULL,
	[KANDUNG] [float] NULL,
	[ANGKAT] [float] NULL,
	[TANGGUNG] [float] NULL,
	[TGG_PPH] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_PEND] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TGL_SK] [datetime] NULL,
	[NO_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_KELAS] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KLS_TMT] [datetime] NULL,
	[KLS_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GOL] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[MK] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GOL_TMT] [datetime] NULL,
	[GOL_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GPO] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_KBN] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_AFD] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_JAB] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NAMA_JAB] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_BUD] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[JAB_TMT] [datetime] NULL,
	[JAB_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[ASTEK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TASPEN] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SANSOS] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[STAT_DAP] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[MBT] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_Dik] PRIMARY KEY CLUSTERED 
(
	[Ref_DikID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_DikKLM](
	[Ref_DikKLMId] [uniqueidentifier] NOT NULL,
	[TANGGAL] [datetime] NULL,
	[REG] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NAMA] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TPT_LAHIR] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TGL_LAHIR] [datetime] NULL,
	[KELAMIN] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GOL_DARAH] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AGAMA] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[ALAMAT] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KOTA] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TINGGAL] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SIPIL] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TGL_NIKAH] [datetime] NULL,
	[TGL_CERAI] [datetime] NULL,
	[KANDUNG] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[ANGKAT] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TANGGUNG] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_PEND] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TGL_SK] [datetime] NULL,
	[NO_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_KELAS] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KLS_TMT] [datetime] NULL,
	[KLS_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GOL] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[MK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GOL_TMT] [datetime] NULL,
	[GOL_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GPO] [float] NULL,
	[KD_KBN] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_AFD] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_MB] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_MDR] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[STATUS_JAB] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_JAB] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NAMA_JAB] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_BUD] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[JAB_TMT] [datetime] NULL,
	[JAB_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[ASTEK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TASPEN] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[JUBILIUM] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TGLMK] [datetime] NULL,
PRIMARY KEY CLUSTERED 
(
	[Ref_DikKLMId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_DikKLMCheck](
	[Ref_DikKLMId] [uniqueidentifier] NOT NULL,
	[TANGGAL] [datetime] NULL,
	[REG] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NAMA] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TPT_LAHIR] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TGL_LAHIR] [datetime] NULL,
	[KELAMIN] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GOL_DARAH] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AGAMA] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[ALAMAT] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KOTA] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TINGGAL] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SIPIL] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TGL_NIKAH] [datetime] NULL,
	[TGL_CERAI] [datetime] NULL,
	[KANDUNG] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[ANGKAT] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TANGGUNG] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_PEND] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TGL_SK] [datetime] NULL,
	[NO_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_KELAS] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KLS_TMT] [datetime] NULL,
	[KLS_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GOL] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[MK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GOL_TMT] [datetime] NULL,
	[GOL_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GPO] [float] NULL,
	[KD_KBN] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_AFD] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_MB] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_MDR] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[STATUS_JAB] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_JAB] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NAMA_JAB] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_BUD] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[JAB_TMT] [datetime] NULL,
	[JAB_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[ASTEK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TASPEN] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[JUBILIUM] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TGLMK] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ref_dikklmx](
	[Ref_DikKLMId] [uniqueidentifier] NOT NULL,
	[TANGGAL] [datetime] NULL,
	[REG] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NAMA] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TPT_LAHIR] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TGL_LAHIR] [datetime] NULL,
	[KELAMIN] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GOL_DARAH] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[AGAMA] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[ALAMAT] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KOTA] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TINGGAL] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SIPIL] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TGL_NIKAH] [datetime] NULL,
	[TGL_CERAI] [datetime] NULL,
	[KANDUNG] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[ANGKAT] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TANGGUNG] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_PEND] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TGL_SK] [datetime] NULL,
	[NO_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_KELAS] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KLS_TMT] [datetime] NULL,
	[KLS_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GOL] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[MK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GOL_TMT] [datetime] NULL,
	[GOL_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GPO] [float] NULL,
	[KD_KBN] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_AFD] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_MB] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_MDR] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[STATUS_JAB] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_JAB] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NAMA_JAB] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KD_BUD] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[JAB_TMT] [datetime] NULL,
	[JAB_SK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[ASTEK] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TASPEN] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[JUBILIUM] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TGLMK] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Grade](
	[kd_bud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[kd_jnsprod] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[grup] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kd_grade] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[Uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[mutu] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[urut] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[std_berat] [float] NULL,
 CONSTRAINT [PK_Ref_Grade] PRIMARY KEY CLUSTERED 
(
	[kd_bud] ASC,
	[kd_jnsprod] ASC,
	[kd_grade] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_GradeIHT](
	[kd_bud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[kd_jnsprod] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[kd_grade] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kd_satuan] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[satuan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_GradeIHT] PRIMARY KEY CLUSTERED 
(
	[kd_bud] ASC,
	[kd_jnsprod] ASC,
	[kd_grade] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_IndexBobotKaret](
	[kode] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdmutuklas] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[score] [varchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[indexbobot] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_JenisOlah](
	[Ref_JenisOlahID] [uniqueidentifier] NOT NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeBudidaya] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeJenisOlah] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_JenisOlah] PRIMARY KEY CLUSTERED 
(
	[Ref_JenisOlahID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_JenisPesemaian](
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_JenisPesemaian] PRIMARY KEY CLUSTERED 
(
	[norek] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_JenisTunjangan](
	[JnsTunjangan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[kdjabatan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[nmjabatan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_JenisTunjangan] PRIMARY KEY CLUSTERED 
(
	[JnsTunjangan] ASC,
	[kdjabatan] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_JenisUpah](
	[kodebud] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[kodeupah] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_JenisUpah] PRIMARY KEY CLUSTERED 
(
	[kodebud] ASC,
	[kodeupah] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Kebun](
	[KodeKebun] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[NamaKebun] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Status] [bit] NULL,
 CONSTRAINT [PK_Ref_Kebun] PRIMARY KEY CLUSTERED 
(
	[KodeKebun] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_KebunBudidaya](
	[Ref_BudidayaID] [uniqueidentifier] NOT NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[kd_bud] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[nm_bud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[inti] [bit] NULL,
 CONSTRAINT [PK_Ref_Budidaya_2] PRIMARY KEY CLUSTERED 
(
	[Ref_BudidayaID] ASC,
	[KodeUnit] ASC,
	[kd_bud] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_KelompokAset](
	[kelompokAset] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_KelompokAset] PRIMARY KEY CLUSTERED 
(
	[kelompokAset] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_KelompokJurnalGaji](
	[kode] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[namajurnal] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Filtering] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_Jurnal] PRIMARY KEY CLUSTERED 
(
	[kode] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_KodeAbsen](
	[kodeabs] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jumlah] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_KodeArusKas](
	[kd_arus] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_KodeArusKas] PRIMARY KEY CLUSTERED 
(
	[kd_arus] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_KodeBank](
	[Ref_KodeBankID] [uniqueidentifier] NOT NULL,
	[KodeUnit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kode] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[namabank] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_KodeBank] PRIMARY KEY CLUSTERED 
(
	[Ref_KodeBankID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_KodeJabatan](
	[kdjabatan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[uraian] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_KodeKetinggianPohon](
	[kode] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[ketinggian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_KodeKetinggianPohon] PRIMARY KEY CLUSTERED 
(
	[kode] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_KodeLegalitas](
	[kode] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_KodeLegalitas] PRIMARY KEY CLUSTERED 
(
	[kode] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_KodePanen](
	[kodebudidaya] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[kodepanen] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_KodePanen] PRIMARY KEY CLUSTERED 
(
	[kodebudidaya] ASC,
	[kodepanen] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_KodePensiun](
	[kdpensiun] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_KodePos](
	[Propinsi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DT2] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KotaKabupaten] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Kecamatan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodePos] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_KodeProdukIHT](
	[Ref_KodeProdukIHTID] [uniqueidentifier] NOT NULL,
	[budidaya] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdkategori] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kategori] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[subkategori] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Uraian] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdgrade] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Varian] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Jenis] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Merk] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Kemasan] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Berat] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KonversiBerat] [float] NULL,
	[Ukuran] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NamaProduk] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_KodeProdukIHT] PRIMARY KEY CLUSTERED 
(
	[Ref_KodeProdukIHTID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_KomponenGaji1](
	[GOLBARU] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GOL] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KDGOL] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[MK] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[GPO] [float] NULL,
	[T_TETAP] [float] NULL,
	[B_PERSH] [float] NULL,
	[B_PRIB] [float] NULL,
	[A_PERSH] [float] NULL,
	[A_PRIB] [float] NULL,
	[PIP_PERS] [float] NULL,
	[PIP_PRIB] [float] NULL,
 CONSTRAINT [PK_Ref_KomponenGaji1] PRIMARY KEY CLUSTERED 
(
	[KDGOL] ASC,
	[MK] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_KomponenGaji2](
	[KODEPDP] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NETRAL] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NILAI1] [float] NULL,
	[NILAI2] [float] NULL,
	[KET] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_LM](
	[kodeunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kode] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[nmMenu] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdgrup] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[nmgrup] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[urut] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[uraian] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tampil] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Lokasi](
	[Lokasi] [varchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Propinsi] [varchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_MandorKaryawan](
	[KodeUnit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Tanggal] [datetime] NULL,
	[KodeAfd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Kodebud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Regmdr] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Grup] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sts] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Negara](
	[kd_negara] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nm_negara] [varchar](250) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Netral](
	[Ref_NetralID] [uniqueidentifier] NOT NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[Norek] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[Nomor] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[Uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Tahun] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[status] [bit] NULL,
	[BBM] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Pemilik] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Pengemudi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoChasis] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoMesin] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoBPKB] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Tonage] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UkuranBan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglBeli] [datetime] NULL,
	[Voltage] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[BebanRekening] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_Netral_1] PRIMARY KEY CLUSTERED 
(
	[Ref_NetralID] ASC,
	[KodeUnit] ASC,
	[Norek] ASC,
	[Nomor] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_NoBuktiJurnalGaji](
	[kodepdp] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[nourut] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[namapdp] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nobukti] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_NoBuktiJurnalGaji] PRIMARY KEY CLUSTERED 
(
	[kodepdp] ASC,
	[nourut] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_PctJamsostek](
	[pct_jamsos_persh] [float] NULL,
	[pct_jamsos_prib] [float] NULL,
	[pct_dapbun_persh] [float] NULL,
	[pct_dapbun_prib] [float] NULL,
	[LoopPPH] [float] NULL,
	[RekBiayaBank] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Pendidikan](
	[KD_PEND] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NM_PEND] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Propinsi](
	[Propinsi] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Ibukota] [varchar](250) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_R143](
	[Ref_R143ID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[gol] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_R143] PRIMARY KEY CLUSTERED 
(
	[Ref_R143ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Rekening](
	[Ref_RekeningID] [uniqueidentifier] NOT NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NamaRekening] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Netral] [bit] NULL,
	[vblok] [bit] NULL,
 CONSTRAINT [PK_Ref_Rekening] PRIMARY KEY CLUSTERED 
(
	[Ref_RekeningID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_RekeningInvestasi](
	[KRBB] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[Norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[NamaRekening] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_RekeningInvestasi] PRIMARY KEY CLUSTERED 
(
	[KRBB] ASC,
	[Norek] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_ResolusiLayar](
	[Resolusi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[Width] [int] NULL,
	[Height] [int] NULL,
	[Description] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_ResolusiLayar] PRIMARY KEY CLUSTERED 
(
	[Resolusi] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Satuan](
	[Ref_SatuanID] [uniqueidentifier] NULL,
	[KodeSatuan] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NamaSatuan] [varchar](20) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Inisial] [varchar](5) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_SatuanHasil](
	[Satuan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
 CONSTRAINT [PK_Ref_SatuanHasil] PRIMARY KEY CLUSTERED 
(
	[Satuan] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Signature](
	[kodeunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[namaafd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[administratur] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regadministratur] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabadministratur] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KepalaTanaman] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regKepalaTanaman] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabKepalaTanaman] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KepalaPabrik] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regKepalaPabrik] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabKepalaPabrik] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SinderTUK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regSinderTUK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabSinderTUK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PetugasUmum] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regPetugasUmum] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabPetugasUmum] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PetugasTabin] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regPetugasTabin] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabPetugasTabin] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PembantuTabin] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regPembantuTabin] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabPembantuTabin] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PetugasGudang] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regPetugasGudang] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabPetugasGudang] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PetugasKas] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regPetugasKas] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabPetugasKas] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KoordinatorPIK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regKoordinatorPIK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabKoordinatorPIK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PetugasTUP] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regPetugasTUP] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabPetugasTUP] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[register] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[SinderAFD] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Jabatan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Operator] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[sts] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PetugasAKT] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regPetugasAKT] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabPetugasAKT] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[PetugasEAP] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[regPetugasEAP] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabPetugasEAP] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Strook](
	[Grup] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[urut] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[kode] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_Strook] PRIMARY KEY CLUSTERED 
(
	[Grup] ASC,
	[urut] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_TarifAktiva](
	[kdbud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[Norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[kelompokaset] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[Keterangan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Uraian] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Tarif] [float] NULL,
	[Tahun] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_TarifAktiva] PRIMARY KEY CLUSTERED 
(
	[kdbud] ASC,
	[Norek] ASC,
	[kelompokaset] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_TKesulitan](
	[KD_TK] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NM_TK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KONDISI] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TG_POHON] [nchar](10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[BASIC_TDN] [float] NULL,
	[BASIC_BRN] [float] NULL,
	[PREMI_BRN] [float] NULL,
	[RBT1] [float] NULL,
	[RBT2] [float] NULL,
	[RBT3] [float] NULL,
	[RBT4] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_ttnm](
	[thntnm] [char](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_Tunjangan](
	[kodeunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[struktural] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabatan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[khusus] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[peralihan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_UMK](
	[KodeKebun] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[NamaKebun] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UMK] [float] NULL,
 CONSTRAINT [PK_Ref_UMK] PRIMARY KEY CLUSTERED 
(
	[KodeKebun] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_UserID](
	[userID] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[userPWD] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_Ref_UserID_1] PRIMARY KEY CLUSTERED 
(
	[userID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Ref_ValidasiRekening](
	[KRBB] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[RefKelompokBarang](
	[Norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NamaRekening] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SawKRBB](
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[NoInput] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[NoBukti] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[Keterangan] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[NoUrut] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[kodeafd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[uraian] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[unsur] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DK] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[Nilai] [float] NULL,
	[Jml_Fisik] [float] NULL,
	[TglInput] [varchar](10) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[kmk] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SDM01](
	[SDM01ID] [uniqueidentifier] NOT NULL,
	[NPP] [varchar](14) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Nama] [varchar](250) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GlrDepan] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GlrBelakang] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NamaPanggilan] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KotaLahir] [varchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Propinsi] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Negara] [varchar](150) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglLahir] [datetime] NULL,
	[JenisKelamin] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GolDarah] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Agama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglMasuk] [datetime] NULL,
	[StatSipil] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoAstek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoPes] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NPWP] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Alamat] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Lokasi] [varchar](150) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodePos] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoTelp] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoFaks] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Sansos] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[StatDapenbun] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[StatusKerja] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UserId] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL,
	[noskpensiun] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodepensiun] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_SDM01] PRIMARY KEY CLUSTERED 
(
	[SDM01ID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SDM02](
	[NPP] [varchar](14) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[NoUrut] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Nama] [varchar](500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Hubungan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglLahir] [datetime] NULL,
	[Kota] [varchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Propinsi] [varchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Negara] [varchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[JenisKelamin] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[GolDarah] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Agama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TKPendidikan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[StatSipil] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[StatKerja] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglNikah] [datetime] NULL,
	[TglCerai] [datetime] NULL,
	[StatTanggung] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UserId] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SDM03](
	[NPP] [varchar](14) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoUrut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TKPendidikan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Pendidikan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Nama] [varchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Kota] [varchar](200) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[StatAkreditasi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DNLN] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TahunAwal] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TahunAkhir] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[StatLulus] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoIjasah] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglIjasah] [datetime] NULL,
	[Nilai] [float] NULL,
	[Grade] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UserId] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SDM04](
	[NPP] [varchar](14) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoUrut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Pendidikan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Nama] [varchar](250) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Keterangan] [varchar](250) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DNLN] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglAwal] [datetime] NULL,
	[TglAkhir] [datetime] NULL,
	[NoSertifikat] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglSertifikat] [datetime] NULL,
	[Nilai] [float] NULL,
	[Grade] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UserId] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SDM05](
	[npp] [varchar](14) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nourut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thnawal] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thnakhir] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](150) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabatan] [varchar](150) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NmPejabat] [varchar](250) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nosk] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglsk] [datetime] NULL,
	[UserId] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglinput] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SDM06](
	[npp] [varchar](14) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nourut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[stpegawai] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tmt] [datetime] NULL,
	[nosk] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglsk] [datetime] NULL,
	[NmPejabat] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UserId] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SDM08](
	[NPP] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoUrut] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kd_Mutasi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kd_Unit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kd_afd] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kd_bud] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kd_Jabatan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TMT] [datetime] NULL,
	[No_SK] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tgl_sk] [datetime] NULL,
	[Jns_mutasi] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NmPejabat] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[st_tinggal] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UserId] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglinput] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SDM09](
	[npp] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nourut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdunit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabatan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tmt] [datetime] NULL,
	[nosk] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglsk] [datetime] NULL,
	[tglakhir] [datetime] NULL,
	[NmPejabat] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UserId] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SDM10](
	[npp] [varchar](14) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nourut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdIntansi] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabatan] [varchar](40) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tmt] [datetime] NULL,
	[lama] [decimal](2, 0) NULL,
	[NoSK] [varchar](20) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglSK] [datetime] NULL,
	[TglAkhir] [datetime] NULL,
	[NmPejabat] [varchar](14) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UserId] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglinput] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SDM11](
	[npp] [varchar](14) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nourut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nmsatgas] [varchar](40) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jabatan] [varchar](40) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tmt] [datetime] NULL,
	[nosk] [varchar](20) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglsk] [datetime] NULL,
	[tglakhir] [datetime] NULL,
	[NmPejabat] [varchar](14) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[userId] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SDM12](
	[npp] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nourut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tmt] [datetime] NULL,
	[Nilai] [decimal](5, 2) NULL,
	[nosk] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglsk] [datetime] NULL,
	[NmPejabat] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UserId] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SDM13](
	[npp] [varchar](14) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoUrut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[JnsPenghargaan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Uraian] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglPenghargaan] [datetime] NULL,
	[nosk] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglsk] [datetime] NULL,
	[NmPejabat] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UserId] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SDM14](
	[npp] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nourut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglPelanggaran] [datetime] NULL,
	[JnsPelanggaran] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Uraian] [varchar](150) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[JnsHukuman] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TMT] [datetime] NULL,
	[NoSK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglSK] [datetime] NULL,
	[NmPejabat] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UserId] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SDM15](
	[npp] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nourut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jnscuti] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TMT] [datetime] NULL,
	[LamaCuti] [float] NULL,
	[ThnAnggaran] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nosk] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglsk] [datetime] NULL,
	[NmPejabat] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UserId] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglinput] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SDM16](
	[NPP] [varchar](14) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoUrut] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[St_Pegawai] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Golongan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[MK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TMT] [datetime] NULL,
	[JnsKenaikan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoSK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglSK] [datetime] NULL,
	[NmPejabat] [varchar](250) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[UserId] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglinput] [datetime] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[sql_logins](
	[name] [sysname] COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[principal_id] [int] NOT NULL,
	[sid] [varbinary](85) NULL,
	[type] [char](1) COLLATE Latin1_General_CI_AS_KS_WS NOT NULL,
	[type_desc] [nvarchar](60) COLLATE Latin1_General_CI_AS_KS_WS NULL,
	[is_disabled] [bit] NULL,
	[create_date] [datetime] NOT NULL,
	[modify_date] [datetime] NOT NULL,
	[default_database_name] [sysname] COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[default_language_name] [sysname] COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[credential_id] [int] NULL,
	[is_policy_checked] [bit] NULL,
	[is_expiration_checked] [bit] NULL,
	[password_hash] [varbinary](256) NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[sql_logins1](
	[Account] [sysname] COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[Account Principal ID] [int] NOT NULL,
	[Account SID] [varbinary](85) NULL,
	[Account Type] [nvarchar](60) COLLATE Latin1_General_CI_AS_KS_WS NULL,
	[Account Disabled] [bit] NULL,
	[Account Deny Login] [int] NULL,
	[Has Access] [int] NULL,
	[Account Create Date] [datetime] NOT NULL,
	[Account Modify Date] [datetime] NOT NULL,
	[Account Last Password Change Date] [sql_variant] NULL,
	[Enforce Windows Password Policies?] [bit] NULL,
	[Enforce Windows Expiration Policies?] [bit] NULL,
	[Password Hash] [varbinary](256) NULL,
	[Blank Password?] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[THRKLM2019](
	[KodeKebun] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeAfdeling] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Reg] [varchar](10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[HKJuni2018] [int] NULL,
	[HKJuli2018] [int] NULL,
	[HKAgustus2018] [int] NULL,
	[HKSeptember2018] [int] NULL,
	[HKOktober2018] [int] NULL,
	[HKNopember2018] [int] NULL,
	[HKDesember2018] [int] NULL,
	[HKJanuari2019] [int] NULL,
	[HKFebruari2019] [int] NULL,
	[HKMaret2019] [int] NULL,
	[HKApril2019] [int] NULL,
	[HKMei2019] [int] NULL,
	[JumlahHK] [float] NULL,
	[NilaiTHR] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[tmpprd](
	[AkunProduksiHPID] [uniqueidentifier] NOT NULL,
	[kodeunit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[kodebud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeJenisOlah] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodegrade] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodevar] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodekbn] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[bi] [float] NULL,
	[rbi] [float] NULL,
	[pbi] [float] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TUP](
	[TUPID] [uniqueidentifier] NOT NULL,
	[KodeUnit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[waktu] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[noinput] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nobuku] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglfaktur] [datetime] NULL,
	[nofaktur] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[alamat] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeAfdeling] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeBudidaya] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nourut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebarang] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[qtyminta] [float] NULL,
	[qty] [float] NULL,
	[ppn] [bit] NULL,
	[status] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nilai] [float] NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jml_fisik] [float] NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[keterangan] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Penjelasan] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglkom] [datetime] NULL,
	[namauser] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KMK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoBOM] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
 CONSTRAINT [PK_TUP] PRIMARY KEY CLUSTERED 
(
	[TUPID] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TUPHolding](
	[KodeUnit] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[waktu] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[noinput] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nobuku] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglfaktur] [datetime] NULL,
	[nofaktur] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nama] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[alamat] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeAfdeling] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[KodeBudidaya] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nourut] [varchar](3) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebarang] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[qtyminta] [float] NULL,
	[qty] [float] NULL,
	[ppn] [bit] NULL,
	[status] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nilai] [float] NULL,
	[norek] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[jml_fisik] [float] NULL,
	[kdblok] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[keterangan] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Penjelasan] [varchar](100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tglkom] [datetime] NULL,
	[namauser] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kmk] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[userServer](
	[uid] [smallint] NULL,
	[status] [smallint] NULL,
	[name] [sysname] COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
	[sid] [varbinary](85) NULL,
	[roles] [varbinary](2048) NULL,
	[createdate] [datetime] NOT NULL,
	[updatedate] [datetime] NOT NULL,
	[altuid] [smallint] NULL,
	[password] [varbinary](256) NULL,
	[gid] [smallint] NULL,
	[environ] [varchar](255) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[hasdbaccess] [int] NULL,
	[islogin] [int] NULL,
	[isntname] [int] NULL,
	[isntgroup] [int] NULL,
	[isntuser] [int] NULL,
	[issqluser] [int] NULL,
	[isaliased] [int] NULL,
	[issqlrole] [int] NULL,
	[isapprole] [int] NULL
)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[xAkunMemorial3919](
	[AkunMemorialID] [uniqueidentifier] NOT NULL,
	[KodeUnit] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[tanggal] [datetime] NULL,
	[NoInput] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoBukti] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[Keterangan] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[NoUrut] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodeafd] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kodebud] [varchar](2) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[norek] [varchar](9) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[netral] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[kdblok] [varchar](4) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[thntnm] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[uraian] [varchar](max) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[unsur] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[DK] [varchar](1) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[nilai] [float] NULL,
	[JmlFisik] [float] NULL,
	[NamaUser] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
	[TglInput] [datetime] NULL,
	[KMK] [varchar](50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL
)

GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[AktivaMaster]
(
	[kodeunit] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[AktivaSaldo]
(
	[kodeunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[AktivaTransaksi]
(
	[kodeunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[AkunMemorial]
(
	[KodeUnit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[AkunProduksiHP]
(
	[kodeunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[AkunRKAP]
(
	[kodeunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[AkunSaldoLL]
(
	[kodeunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[AkunSawal]
(
	[KodeUnit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[Eap]
(
	[kodeunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[GajiAbsensi]
(
	[kodeunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[GajiJurnal]
(
	[kodeunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[GajiKulir]
(
	[kodeunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[GajiMaster]
(
	[kdunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[GajiPotongan]
(
	[kodeunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[GajiPPh21]
(
	[kodeunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[GajiPremi]
(
	[kodeunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[GajiPremiPanen]
(
	[kodeunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[GajiSPKHonor]
(
	[kodeunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[kartu]
(
	[KodeUnit] ASC,
	[Tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[KasBank]
(
	[KodeUnit] ASC,
	[Tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[KasBankv]
(
	[KodeUnit] ASC,
	[Tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[Produksi]
(
	[kodeunit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[Ref_Dik]
(
	[KD_KBN] ASC,
	[TANGGAL] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[Ref_DikKLM]
(
	[KD_KBN] ASC,
	[TANGGAL] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[Ref_Rekening]
(
	[KodeUnit] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
SET ANSI_PADDING ON

GO
CREATE NONCLUSTERED INDEX [i1] ON [dbo].[TUP]
(
	[KodeUnit] ASC,
	[tanggal] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON)
GO
ALTER TABLE [dbo].[AktivaMaster] ADD  CONSTRAINT [DF_AktivaMaster_AktivaMasterID]  DEFAULT (newid()) FOR [AktivaMasterID]
GO
ALTER TABLE [dbo].[AktivaMaster] ADD  CONSTRAINT [DF_Aktiva_Master_kelompok]  DEFAULT ('') FOR [kelompok]
GO
ALTER TABLE [dbo].[AktivaMaster] ADD  CONSTRAINT [DF_Aktiva_Master_kondisi]  DEFAULT ((0)) FOR [kondisi]
GO
ALTER TABLE [dbo].[AktivaRegistrasi] ADD  CONSTRAINT [DF_Aktiva_Registrasi_satuan]  DEFAULT ('') FOR [satuan]
GO
ALTER TABLE [dbo].[AktivaSaldo] ADD  CONSTRAINT [DF_AktivaSaldo_AktivaSaldoID]  DEFAULT (newid()) FOR [AktivaSaldoID]
GO
ALTER TABLE [dbo].[AktivaSaldo] ADD  CONSTRAINT [DF_Aktiva_Saldo_kelompok]  DEFAULT ('') FOR [kelompok]
GO
ALTER TABLE [dbo].[AktivaSaldo] ADD  CONSTRAINT [DF_Aktiva_Saldo_satuan]  DEFAULT ('') FOR [satuan]
GO
ALTER TABLE [dbo].[AktivaTransaksi] ADD  CONSTRAINT [DF_AktivaTransaksi_AktivaTransaksiID]  DEFAULT (newid()) FOR [AktivaTransaksiID]
GO
ALTER TABLE [dbo].[AkunKomentar] ADD  CONSTRAINT [DF_AkunKomentar_AkunKomentarID]  DEFAULT (newid()) FOR [AkunKomentarID]
GO
ALTER TABLE [dbo].[AkunMemorial] ADD  CONSTRAINT [DF_AkunMemorial_AkunMemorialID]  DEFAULT (newid()) FOR [AkunMemorialID]
GO
ALTER TABLE [dbo].[AkunProduksiHP] ADD  CONSTRAINT [DF_AkunProduksiHP_AkunProduksiHPID]  DEFAULT (newid()) FOR [AkunProduksiHPID]
GO
ALTER TABLE [dbo].[AkunRKAP] ADD  CONSTRAINT [DF_AkunRKAP_AkunRKAPID]  DEFAULT (newid()) FOR [AkunRKAPID]
GO
ALTER TABLE [dbo].[AkunSaldoLL] ADD  CONSTRAINT [DF_AkunSaldoLL_AkunSaldoLLID]  DEFAULT (newid()) FOR [AkunSaldoLLID]
GO
ALTER TABLE [dbo].[Eap] ADD  CONSTRAINT [DF_Eap_EapID]  DEFAULT (newid()) FOR [EapID]
GO
ALTER TABLE [dbo].[Eap] ADD  CONSTRAINT [DF_EAPTL_kdtrans]  DEFAULT ('') FOR [kdtrans]
GO
ALTER TABLE [dbo].[Eap] ADD  CONSTRAINT [DF_EAPTL_jmlfisik]  DEFAULT ((0)) FOR [jmlfisik]
GO
ALTER TABLE [dbo].[Eap] ADD  CONSTRAINT [DF_EAPTL_nilai]  DEFAULT ((0)) FOR [nilai]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_GajiAbsensiID]  DEFAULT (newid()) FOR [GajiAbsensiID]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_kodeunit]  DEFAULT ('') FOR [kodeunit]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_tanggal]  DEFAULT ('1/1/1900') FOR [tanggal]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_kodeafd]  DEFAULT ('') FOR [kodeafd]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_kodeafd1]  DEFAULT ('') FOR [kodeafd1]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_kodetrans]  DEFAULT ('') FOR [kodetrans]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_kodebud]  DEFAULT ('') FOR [kodebud]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_kodebud1]  DEFAULT ('') FOR [kodebud1]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_regmdr]  DEFAULT ('') FOR [regmdr]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_nama]  DEFAULT ('') FOR [nama]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_sts]  DEFAULT ('') FOR [sts]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_register]  DEFAULT ('') FOR [register]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_kodeabs]  DEFAULT ('') FOR [kodeabs]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_Upah_Norek]  DEFAULT ('') FOR [norek]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_Upah_netral]  DEFAULT ('') FOR [netral]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_thntnm]  DEFAULT ('') FOR [thntnm]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_tkesulitan]  DEFAULT ('') FOR [tkesulitan]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_Upah_kdblok]  DEFAULT ('') FOR [kdblok]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_kdjnsupah]  DEFAULT ('') FOR [kdjnsupah]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_kdgrade]  DEFAULT ('') FOR [kdgrade]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_kdpanen]  DEFAULT ('') FOR [kdpanen]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_stpikul]  DEFAULT ('') FOR [stpikul]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_grup]  DEFAULT ('') FOR [grup]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_jelajahHA]  DEFAULT ((0)) FOR [jelajahHA]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_jmlkg]  DEFAULT ((0)) FOR [jmlkg]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_basic]  DEFAULT ((0)) FOR [basic]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_hrgsatuan]  DEFAULT ((0)) FOR [hrgsatuan]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_hslpanenTBS]  DEFAULT ((0)) FOR [hslpanenTBS]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_hslpanen]  DEFAULT ((0)) FOR [hslpanen]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_hslpanenlump]  DEFAULT ((0)) FOR [hslpanenlump]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_hslpemel]  DEFAULT ((0)) FOR [hslpemel]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_hsllain2]  DEFAULT ((0)) FOR [hsllain2]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_satuan]  DEFAULT ('') FOR [satuan]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_sbrd]  DEFAULT ('') FOR [sbrd]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_nbrg]  DEFAULT ((0)) FOR [nbrd]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_premipikul]  DEFAULT ((0)) FOR [premipikul]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_selmkg]  DEFAULT ((0)) FOR [selmkg]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_tpb]  DEFAULT ((0)) FOR [tpb]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_Upah_jmlupah]  DEFAULT ((0)) FOR [jmlupah]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_premi]  DEFAULT ((0)) FOR [premi]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_jmlhadir]  DEFAULT ((0)) FOR [jmlhadir]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_prekual]  DEFAULT ((0)) FOR [prekual]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_prekuan]  DEFAULT ((0)) FOR [prekuan]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_kodekelas]  DEFAULT ('') FOR [kodekelas]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_stprestasi]  DEFAULT ((0)) FOR [stprestasi]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_pct]  DEFAULT ((0)) FOR [pct]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_CutiTahunan]  DEFAULT ((0)) FOR [CutiTahunan]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_CutiPanjang]  DEFAULT ((0)) FOR [CutiPanjang]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_CutiHamil]  DEFAULT ((0)) FOR [CutiHamil]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_Sakit]  DEFAULT ((0)) FOR [Sakit]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_Ijin]  DEFAULT ((0)) FOR [Ijin]
GO
ALTER TABLE [dbo].[GajiAbsensi] ADD  CONSTRAINT [DF_GajiAbsensi_Mangkir]  DEFAULT ((0)) FOR [Mangkir]
GO
ALTER TABLE [dbo].[GajiJurnal] ADD  CONSTRAINT [DF_GajiJurnal_GajiJurnalID]  DEFAULT (newid()) FOR [GajiJurnalID]
GO
ALTER TABLE [dbo].[GajiKulir] ADD  CONSTRAINT [DF_GajiKulir_GajiKulirID]  DEFAULT (newid()) FOR [GajiKulirID]
GO
ALTER TABLE [dbo].[GajiMaster] ADD  CONSTRAINT [DF_GajiMaster_GajiMasterID]  DEFAULT (newid()) FOR [GajiMasterID]
GO
ALTER TABLE [dbo].[GajiMaster] ADD  CONSTRAINT [DF_GajiMaster_sts]  DEFAULT ('') FOR [sts]
GO
ALTER TABLE [dbo].[GajiMaster] ADD  CONSTRAINT [DF_GajiMaster_JmlHasil]  DEFAULT ((0)) FOR [JmlHasil]
GO
ALTER TABLE [dbo].[GajiPotongan] ADD  CONSTRAINT [DF_GajiPotongan_GajiPotonganID]  DEFAULT (newid()) FOR [GajiPotonganID]
GO
ALTER TABLE [dbo].[GajiPotongan] ADD  CONSTRAINT [DF_GajiPotongan_kodeunit]  DEFAULT ('') FOR [kodeunit]
GO
ALTER TABLE [dbo].[GajiPotongan] ADD  CONSTRAINT [DF_GajiPotongan_tanggal]  DEFAULT ('1/1/1900') FOR [tanggal]
GO
ALTER TABLE [dbo].[GajiPotongan] ADD  CONSTRAINT [DF_GajiPotongan_kodeafd]  DEFAULT ('') FOR [kodeafd]
GO
ALTER TABLE [dbo].[GajiPotongan] ADD  CONSTRAINT [DF_GajiPotongan_sts]  DEFAULT ('') FOR [sts]
GO
ALTER TABLE [dbo].[GajiPotongan] ADD  CONSTRAINT [DF_GajiPotongan_regmdr]  DEFAULT ('') FOR [regmdr]
GO
ALTER TABLE [dbo].[GajiPotongan] ADD  CONSTRAINT [DF_GajiPotongan_kodetrans]  DEFAULT ('') FOR [kodetrans]
GO
ALTER TABLE [dbo].[GajiPotongan] ADD  CONSTRAINT [DF_GajiPotongan_jnsptg]  DEFAULT ('') FOR [jnsptg]
GO
ALTER TABLE [dbo].[GajiPotongan] ADD  CONSTRAINT [DF_GajiPotongan_register]  DEFAULT ('') FOR [register]
GO
ALTER TABLE [dbo].[GajiPotongan] ADD  CONSTRAINT [DF_GajiPotongan_nama]  DEFAULT ('') FOR [nama]
GO
ALTER TABLE [dbo].[GajiPotongan] ADD  CONSTRAINT [DF_GajiPotongan_nilai]  DEFAULT ((0)) FOR [nilai]
GO
ALTER TABLE [dbo].[GajiPotongan] ADD  CONSTRAINT [DF_GajiPotongan_potongan]  DEFAULT ((0)) FOR [potongan]
GO
ALTER TABLE [dbo].[GajiPotongan] ADD  CONSTRAINT [DF_GajiPotongan_keterangan]  DEFAULT ('') FOR [keterangan]
GO
ALTER TABLE [dbo].[GajiPremi] ADD  CONSTRAINT [DF_GajiPremi_GajiPremiID]  DEFAULT (newid()) FOR [GajiPremiID]
GO
ALTER TABLE [dbo].[GajiPremi] ADD  CONSTRAINT [DF_GajiPremi_sts]  DEFAULT ('') FOR [sts]
GO
ALTER TABLE [dbo].[GajiPremiPanen] ADD  CONSTRAINT [DF_GajiPremiPanen_GajiPremiPanenID]  DEFAULT (newid()) FOR [GajiPremiPanenID]
GO
ALTER TABLE [dbo].[GajiSPKHonor] ADD  CONSTRAINT [DF_GajiSPKHonor_GajiSPKHonorID]  DEFAULT (newid()) FOR [GajiSPKHonorID]
GO
ALTER TABLE [dbo].[GajiSPKHonor] ADD  CONSTRAINT [DF_GajiSPKHonor_pph]  DEFAULT ((0)) FOR [pph]
GO
ALTER TABLE [dbo].[GajiTaksasi] ADD  CONSTRAINT [DF_GajiTaksasi_GajiTaksasiID]  DEFAULT (newid()) FOR [GajiTaksasiID]
GO
ALTER TABLE [dbo].[GJIHrgbrgll] ADD  CONSTRAINT [DF_GJIHrgbrgll_GJIHrgbrgllID]  DEFAULT (newid()) FOR [GJIHrgbrgllID]
GO
ALTER TABLE [dbo].[hanca] ADD  CONSTRAINT [DF_hanca_grperphn]  DEFAULT ((0)) FOR [grperphn]
GO
ALTER TABLE [dbo].[hanca] ADD  CONSTRAINT [DF_hanca_hanca]  DEFAULT ((0)) FOR [hanca]
GO
ALTER TABLE [dbo].[hanca] ADD  CONSTRAINT [DF_hanca_populasi]  DEFAULT ((0)) FOR [populasi]
GO
ALTER TABLE [dbo].[kartu] ADD  CONSTRAINT [DF_kartu_KartuID]  DEFAULT (newid()) FOR [KartuID]
GO
ALTER TABLE [dbo].[KasBank] ADD  CONSTRAINT [DF_KasBank_KasBankID]  DEFAULT (newid()) FOR [KasBankID]
GO
ALTER TABLE [dbo].[KasBank] ADD  CONSTRAINT [DF_KasBank_Jml_Fisik]  DEFAULT ((0)) FOR [Jml_Fisik]
GO
ALTER TABLE [dbo].[KasBank] ADD  CONSTRAINT [DF_KasBank_namauser]  DEFAULT ('') FOR [namauser]
GO
ALTER TABLE [dbo].[KasBankv] ADD  CONSTRAINT [DF_KasBankv_KasBankvID]  DEFAULT (newid()) FOR [KasBankvID]
GO
ALTER TABLE [dbo].[Ref_Areal] ADD  CONSTRAINT [DF_Ref_Blok_netral]  DEFAULT ('') FOR [netral]
GO
ALTER TABLE [dbo].[Ref_Barang] ADD  CONSTRAINT [DF_Ref_Barang_InitSatuan]  DEFAULT ('') FOR [InitSatuan]
GO
ALTER TABLE [dbo].[Ref_Grade] ADD  CONSTRAINT [DF_Ref_Grade_mutu]  DEFAULT ('') FOR [mutu]
GO
ALTER TABLE [dbo].[Ref_JenisOlah] ADD  CONSTRAINT [DF_Ref_JenisOlah_KodeUnit]  DEFAULT ('') FOR [KodeUnit]
GO
ALTER TABLE [dbo].[Ref_Rekening] ADD  CONSTRAINT [DF_Ref_Rekening_Netral]  DEFAULT ((0)) FOR [Netral]
GO
ALTER TABLE [dbo].[Ref_Rekening] ADD  CONSTRAINT [DF_Ref_Rekening_vblok]  DEFAULT ((0)) FOR [vblok]
GO
ALTER TABLE [dbo].[Ref_Signature] ADD  CONSTRAINT [DF_Ref_Signature_KepalaPabrik]  DEFAULT ('') FOR [KepalaPabrik]
GO
ALTER TABLE [dbo].[Ref_Signature] ADD  CONSTRAINT [DF_Ref_Signature_PembantuTabin]  DEFAULT ('') FOR [PembantuTabin]
GO
ALTER TABLE [dbo].[Ref_Signature] ADD  CONSTRAINT [DF_Ref_Signature_sts]  DEFAULT ('') FOR [sts]
GO
ALTER TABLE [dbo].[Ref_ValidasiRekening] ADD  CONSTRAINT [DF_Ref_ValidasiRekening_TUP]  DEFAULT ('') FOR [KRBB]
GO
ALTER TABLE [dbo].[SDM01] ADD  CONSTRAINT [DF_SDM01_Sansos]  DEFAULT ('T') FOR [Sansos]
GO
ALTER TABLE [dbo].[TUP] ADD  CONSTRAINT [DF_TUP_TUPID]  DEFAULT (newid()) FOR [TUPID]
GO
ALTER TABLE [dbo].[TUP] ADD  CONSTRAINT [DF_TUP_thntnm]  DEFAULT ('') FOR [thntnm]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[__DataKaryawanPerGolongan]
@tanggal datetime
as
set dateformat dmy
select KD_KBN,COUNT(*) as [Gol.IA],0 as [IB-IID],0 as [IIIA-IVD] into #t1 from ref_dik where MONTH(TANGGAL)=MONTH(@tanggal) and YEAR(TANGGAL)=YEAR(@tanggal) and GOL<'02' group by KD_KBN
union all
select KD_KBN,0 as [Gol.IA],COUNT(*) as [IB-IID],0 as [IIIA-IVD] from ref_dik where MONTH(TANGGAL)=MONTH(@tanggal) and YEAR(TANGGAL)=YEAR(@tanggal) and GOL>'01' and GOL<'09' group by KD_KBN
union all
select KD_KBN,0 as [Gol.IA],0 as [IB-IID],COUNT(*) as [IIIA-IVD] from ref_dik where MONTH(TANGGAL)=MONTH(@tanggal) and YEAR(TANGGAL)=YEAR(@tanggal) and GOL>'08' group by KD_KBN


select a.KD_KBN,b.NamaKebun,SUM([Gol.IA]) as [GOl.IA],SUM([IB-IID]) as [IB-IID],sum([IIIA-IVD]) as [IIIA-IVD] from #t1 a
inner join SPDK_KBN_MASTER_REF..Ref_Kebun b on a.KD_KBN=b.KodeKebun
group by a.KD_KBN,b.NamaKebun
order by a.KD_KBN


--set dateformat dmy exec  __DataKaryawanPerGolongan '01-11-2019'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[__EvalAbsen]
@tanggal datetime
as
set dateformat dmy
declare @zero float
declare @Bulan varchar(50)
set @zero=0
set @Bulan=(select top 1 'BULAN : '+upper(namabulan)+' '+cast(YEAR(@tanggal) as varchar(4)) from Ref_Bulan where bulan=MONTH(@tanggal))

select distinct * into #DIK from Ref_Dik where MONTH(TANGGAL)=MONTH(@tanggal) and YEAR(TANGGAL)=YEAR(@tanggal)
select distinct KodeKebun,NamaKebun into #Ref_Kebun from Ref_Kebun
select distinct kodekebun,kodeafdeling,namaafdeling into #Ref_Afdeling from Ref_Afdeling
select * into #GajiAbsensi from GajiAbsensi where MONTH(TANGGAL)=MONTH(@tanggal) and YEAR(TANGGAL)=YEAR(@tanggal) and kodetrans in ('600','620')

select kodeunit,register,kodeafd,COUNT(*) as Kerja,@zero as Libur,@zero as Sakit,@zero as CutiHamil,@zero as CutiTahunan,@zero as Mangkir,@zero as CutiPanjang,@zero as CutiMBT,@zero as Ijin into #t1 from #GajiAbsensi where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kodeabs='1' group by kodeunit,register,kodeafd
union all
select kodeunit,register,kodeafd,0 as Kerja,COUNT(*) as Libur,@zero as Sakit,@zero as CutiHamil,@zero as CutiTahunan,@zero as Mangkir,@zero as CutiPanjang,@zero as CutiMBT,@zero as Ijin from #GajiAbsensi where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kodeabs='2' group by kodeunit,register,kodeafd
union all
select kodeunit,register,kodeafd,0 as Kerja,0 as Libur,COUNT(*) as Sakit,@zero as CutiHamil,@zero as CutiTahunan,@zero as Mangkir,@zero as CutiPanjang,@zero as CutiMBT,@zero as Ijin from #GajiAbsensi where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kodeabs='3' group by kodeunit,register,kodeafd
union all
select kodeunit,register,kodeafd,0 as Kerja,0 as Libur,0 as Sakit,COUNT(*) as CutiHamil,@zero as CutiTahunan,@zero as Mangkir,@zero as CutiPanjang,@zero as CutiMBT,@zero as Ijin from #GajiAbsensi where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kodeabs='5' group by kodeunit,register,kodeafd
union all
select kodeunit,register,kodeafd,0 as Kerja,0 as Libur,0 as Sakit,0 as CutiHamil,COUNT(*) as CutiTahunan,@zero as Mangkir,@zero as CutiPanjang,@zero as CutiMBT,@zero as Ijin from #GajiAbsensi where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kodeabs='6' group by kodeunit,register,kodeafd
union all
select kodeunit,register,kodeafd,0 as Kerja,0 as Libur,0 as Sakit,0 as CutiHamil,0 as CutiTahunan,COUNT(*) as Mangkir,@zero as CutiPanjang,@zero as CutiMBT,@zero as Ijin from #GajiAbsensi where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kodeabs in ('7','8') group by kodeunit,register,kodeafd
union all
select kodeunit,register,kodeafd,0 as Kerja,0 as Libur,0 as Sakit,0 as CutiHamil,0 as CutiTahunan,0 as Mangkir,COUNT(*) as CutiPanjang,@zero as CutiMBT,@zero as Ijin from #GajiAbsensi where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kodeabs='A' group by kodeunit,register,kodeafd
union all
select kodeunit,register,kodeafd,0 as Kerja,0 as Libur,0 as Sakit,0 as CutiHamil,0 as CutiTahunan,0 as Mangkir,0 as CutiPanjang,COUNT(*) as CutiMBT,@zero as Ijin from #GajiAbsensi where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kodeabs='B' group by kodeunit,register,kodeafd
union all
select kodeunit,register,kodeafd,0 as Kerja,0 as Libur,0 as Sakit,0 as CutiHamil,0 as CutiTahunan,0 as Mangkir,0 as CutiPanjang,0 as CutiMBT,COUNT(*) as Ijin from #GajiAbsensi where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kodeabs='4' group by kodeunit,register,kodeafd
union all
select distinct kodeunit,register,kodeafd,sum(HKE) as Kerja,sum(Libur) as Libur,sum(Sakit) as Sakit,sum(CutiHamil) as CutiHamil,sum(CutiTahunan) as CutiTahunan,sum(Mangkir) as Mangkir,sum(CutiPanjang) as CutiPanjang,sum(CutiMBT) as CutiMBT,sum(ijin) as Ijin from #GajiAbsensi where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and regmdr='' and kodeabs='' group by kodeunit,register,kodeafd


select a.kodeunit,a.kodeafd,upper(c.namaafdeling) as namaafdeling,a.register,b.NAMA,b.NAMA_JAB,'TETAP' as Sts,SUM(Kerja) as Kerja,SUM(Libur) as Libur,SUM(Sakit) as Sakit,SUM(CutiHamil) as CutiHamil,SUM(CutiTahunan) as CutiTahunan,SUM(Ijin) as Ijin,SUM(Mangkir) as Mangkir,SUM(CutiPanjang) as CutiPanjang,SUM(CutiMBT) as CutiMBT
into #t2
from #t1 a
inner join #DIK b on a.register=b.REG and a.kodeunit=b.KD_KBN
inner join #Ref_Afdeling c on a.kodeunit=c.kodekebun and a.kodeafd=c.kodeafdeling
where LEN(a.register)=14
group by a.kodeunit,a.kodeafd,c.namaafdeling,a.register,b.NAMA,b.NAMA_JAB
union all
select a.KodeUnit,a.kodeafd,upper(c.namaafdeling) as namaafdeling,a.register,b.NAMA,b.NAMA_JAB,'PKWT' as Sts,SUM(Kerja) as Kerja,SUM(Libur) as Libur,SUM(Sakit) as Sakit,SUM(CutiHamil) as CutiHamil,SUM(CutiTahunan) as CutiTahunan,SUM(Ijin) as Ijin,SUM(Mangkir) as Mangkir,SUM(CutiPanjang) as CutiPanjang,SUM(CutiMBT) as CutiMBT
from #t1 a
inner join #DIK b on a.register=b.REG and a.kodeunit=b.KD_KBN
inner join #Ref_Afdeling c on a.kodeunit=c.kodekebun and a.kodeafd=c.kodeafdeling
where LEN(a.register)=11
group by a.kodeunit,a.kodeafd,c.namaafdeling,a.register,b.NAMA,b.NAMA_JAB

select *,1 as urut into #t3 from #t2 where len(register)=14
union all
select *,2 as urut from #t2 where len(register)=11

select b.NamaKebun as Kebun,a.*,Kerja+Libur+Sakit+CutiHamil+CutiMBT+CutiPanjang+CutiTahunan+Ijin+Mangkir as JmlHari,@Bulan as Bulan 
into EvalAbsen
from #t3 a
inner join #Ref_Kebun b on a.KodeUnit=b.KodeKebun
order by kodeunit,kodeafd,urut,nama

--set dateformat dmy exec __EvalAbsen '1-1-2020'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[__N]
@tanggal datetime

as
begin
set dateformat dmy 
set nocount on
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@tglakhir

select kodeunit,kodebud as kd_bud,norek,netral,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D'
union all
select kodeunit,kodebud as kd_bud,norek,netral,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K'
union all
select KodeUnit,kodebudidaya as kd_bud,Norek,netral,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal

select kodeunit,kd_bud,norek,netral,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,kd_bud,norek,netral

select kodeunit,kd_bud,norek,netral,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,kd_bud,norek,netral
union all
select kodeunit,kd_bud,norek,netral,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,kd_bud,norek,netral
union all
select kodeunit,kodebudidaya as kd_bud,norek,netral,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where Tanggal>=@TglAwal and Tanggal<=@tglakhir
group by kodeunit,kodebudidaya,norek,netral

select kodeunit,kd_bud,norek,netral,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,kd_bud,norek,netral

select kodeunit,kd_bud,norek,netral,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,kd_bud,norek,netral,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select kodeunit,kd_bud,norek,netral,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit
into #t5
from #t4 a
where KodeUnit='39' and SUBSTRING(norek,1,1) in ('4','6','9')
group by a.kodeunit,kd_bud,norek,netral
order by kodeunit,norek

select substring(norek,1,1) as KRBB,SUM(sawDebet+Debet-SawKredit-Kredit) from #t5 where SUBSTRING(norek,1,1) in ('4','6','9') group by substring(norek,1,1)

select @TglAkhir
select @TglAwal
end

--set dateformat dmy exec __N '31-12-2018'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[__UpahPanenKaret]
@tanggal datetime
as
set dateformat dmy
declare @nmBulan varchar(50)
declare @BulanTran varchar(50)
set @nmBulan=(select top 1 namabulan from Ref_Bulan where bulan=MONTH(@tanggal))
set @BulanTran=@nmBulan+' '+cast(YEAR(@tanggal) as varchar(50))

select REG,NAMA,KD_KBN into #DIK from ref_dik where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)
union all
select REG,NAMA,KD_KBN from ref_dikklm where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)

select * into #Mandor from #DIK
select * into #Karyawan from #DIK

select a.kodeunit,a.regmdr,a.register,a.hslpanen+a.hslpanenlump as Kg,a.jmlupah,a.premi
into #t1
from GajiAbsensi a
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and norek like '602%' and kodeabs='1' and a.kdjnsupah='4' and
a.kodeunit in ('46','47','22','50')

select kodeunit,regmdr,register,COUNT(*) as HK,SUM(Kg) as Kg,SUM(jmlupah) as JmlUpah,SUM(premi) as Premi into #t2 from #t1 group by kodeunit,regmdr,register

select upper(@BulanTran) as Bulan,d.NamaKebun as nmKebun,a.regmdr,b.NAMA as nmMandor,a.HK,SPACE(50) as sts,a.register,c.NAMA as nmKary,a.Kg,a.JmlUpah,a.Premi 
into #t3
from #t2 a
inner join #Mandor b on a.regmdr=b.REG
inner join #Karyawan c on a.register=c.REG
inner join Ref_Kebun d on a.kodeunit=d.KodeKebun

update #t3 set sts='TETEAP' where len(register)=14
update #t3 set sts='LEPAS' where len(register)<14

select *,round(JmlUpah/HK,0) as Rata2 from #t3 order by nmKebun,nmMandor,sts,nmKary

--set dateformat dmy exec __UpahPanenKaret '01-08-2019'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[__X]
@tanggal datetime,
@kdunit varchar(2)
as
begin
set dateformat dmy 
set nocount on
declare @NamaKebun varchar(50)
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @NamaKebun=(select top 1 NamaKebun from Ref_Kebun where KodeKebun=@kdunit)

select * into #Ref_Rekening from Ref_Rekening where KodeUnit=@kdunit
select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@TglAkhir and KodeUnit=@kdunit

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D' and KodeUnit=@kdunit
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K' and KodeUnit=@kdunit
union all
select KodeUnit,Norek,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where Tanggal>=@TglAwal and Tanggal<=@tglakhir and KodeUnit=@kdunit
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select a.kodeunit,a.norek,b.namarekening,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
from #t4 a
full outer join #Ref_Rekening b on a.norek=b.norek
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null 
group by a.kodeunit,a.norek,b.namarekening
order by norek

end

--set dateformat dmy exec __X '01-12-2016','31'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[__XX]
as
set dateformat dmy

select distinct register,nama into #DIK_KLM from GajiAbsensi where sts='KL' and tanggal>='01-06-2018' and tanggal<='30-04-2019' and kodeunit>='10' and kodeunit<='74' and kodeabs='1' and stprestasi=1

select a.kdunit,a.register,b.nama
from GajiMaster a
inner join #DIK_KLM b on a.register=b.register
where sts='KL' and tanggal>='01-06-2018' and tanggal<='30-04-2019' and kdunit>='10' and kdunit<='74' and Kerja>0


--exec __XX

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[__XYZ]
@tanggal datetime,
@kdunit varchar(2)
as
begin
set dateformat dmy 
set nocount on
declare @NamaKebun varchar(50)
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @NamaKebun=(select top 1 NamaKebun from Ref_Kebun where KodeKebun=@kdunit)

select * into #Ref_Rekening from Ref_Rekening where KodeUnit=@kdunit
select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@TglAkhir and KodeUnit=@kdunit

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D' and KodeUnit=@kdunit
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K' and KodeUnit=@kdunit
union all
select KodeUnit,Norek,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where Tanggal>=@TglAwal and Tanggal<=@tglakhir and KodeUnit=@kdunit
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select a.kodeunit,a.norek,b.namarekening,'Kebun/Unit : '+@NamaKebun as NamaKebun,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
into #t5
from #t4 a
full outer join #Ref_Rekening b on a.norek=b.norek
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null and a.norek like '08002%'
group by a.kodeunit,a.norek,b.namarekening

select * from #t5
order by norek



end

--set dateformat dmy exec __XYZ '01-11-2018','39'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[_xNeracaSaldo]
as
set dateformat dmy
declare @zero as float
declare @uraian varchar(50)
set @zero=0
set @uraian='S/D 31 Juli 2018'
select KodeUnit,norek,nilai as SawDebet,@zero as sawKredit,@zero as debet,@zero as kredit,@zero as sakDebet,@zero as sakKredit into #t1 from AkunMemorial where NoInput='SALDO AWAL' AND MONTH(tanggal)=1 AND YEAR(tanggal)=2018 and DK='D'
union all
select KodeUnit,norek,@zero as SawDebet,nilai as sawKredit,@zero as debet,@zero as kredit,@zero as sakDebet,@zero as sakKredit  from AkunMemorial where NoInput='SALDO AWAL' AND MONTH(tanggal)=1 AND YEAR(tanggal)=2018 and DK='K'
union all
select KodeUnit,norek,@zero as SawDebet,@zero as sawKredit,Debet as debet,Kredit as kredit,@zero as sakDebet,@zero as sakKredit from kartu where Tanggal>='01-01-2018' and Tanggal<'01-08-2018'

select KodeUnit,norek,sum(SawDebet) sawDebet,sum(sawKredit) as sawKredit,sum(debet) as Debet,sum(kredit) as Kredit,
@zero as Saldo,@zero as SakDebet,@zero as sakKredit
into #t2
from #t1
group by KodeUnit,norek

update #t2 set Saldo=sawDebet+Debet-sawKredit-Kredit
update #t2 set SakDebet=Saldo where Saldo>0
update #t2 set sakKredit=abs(Saldo) where Saldo<0

select @uraian as uraian,a.KodeUnit,c.NamaKebun,a.norek,b.NamaRekening,SUM(a.sawDebet) as sawDebet,SUM(a.sawKredit) as sawKredit,SUM(a.Debet) as Debet,SUM(a.Kredit) as Kredit,SUM(a.SakDebet) as sakDebet,SUM(a.sakKredit) as sakKredit 
into xNeracaSaldo
from #t2 a
full outer join Ref_Rekening b on a.KodeUnit=b.KodeUnit and a.norek=b.Norek
full outer join Ref_Kebun c on a.KodeUnit=c.KodeKebun
where a.KodeUnit is not null
group by a.KodeUnit,a.norek,b.NamaRekening,c.NamaKebun
order by KodeUnit,norek

--set dateformat dmy exec _xNeracaSaldo

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[AKNcr713]
@tanggal datetime,
@kdbud varchar(50),
@kdunit varchar(50)
as
set dateformat dmy
declare @AwalThn datetime
declare @TglAwal datetime
declare @TglLalu datetime
declare @TglAkhir datetime

set @TglAkhir=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @AwalThn='01-01-'+cast(year(@tanggal) as varchar(4))
set @TglAwal='01-'+cast(month(@tanggal) as varchar(2))+'-'+cast(year(@tanggal) as varchar(4))
set @TglLalu= @TglAwal-1

--REALIASAI BULAN LALU
select kodeunit,norek,netral,cast(0 as float) as BI,cast(0 as float) as ABI,sum(nilai) as SBI,cast(0 as float) as ASBI
into #t1
from AkunMemorial where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and dk='D' and noinput in ('SALDO AWAL','TRANSAKSI') and (substring(norek,1,1)='6' or substring(norek,1,3)='490') and KodeUnit=@kdunit
group by kodeunit,norek,netral
union all
select kodeunit,norek,netral,0 as BI,0 as ABI,-1*sum(nilai) as SBI,0 as ASBI
from AkunMemorial where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and dk='K' and noinput in ('SALDO AWAL','TRANSAKSI') and (substring(norek,1,1)='6' or substring(norek,1,3)='490') and KodeUnit=@kdunit
group by kodeunit,norek,netral
union all

--REALISASI BULAN INI
select kodeunit,norek,netral,sum(debet-kredit) as BI,0 as ABI,sum(debet-kredit) as SBI,0 as ASBI
from kartu where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebudidaya=@kdbud and (substring(norek,1,1)='6' or substring(norek,1,3)='490') and KodeUnit=@kdunit
group by kodeunit,norek,netral
union all

--RKAP BULAN INI
select kodeunit,norek,netral,0 as BI,sum(nilai_RKAP) as ABI,0 as SBI,sum(nilai_RKAP) as ASBI
from AkunRKAP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and (substring(norek,1,1)='6' or substring(norek,1,3)='490') and KodeUnit=@kdunit
group by kodeunit,norek,netral
union all

--RKAP S/D BULAN LALU
select kodeunit,norek,netral,0 as BI,0 as ABI,0 as SBI,sum(nilai_RKAP) as ASBI
from AkunRKAP where tanggal>=@AwalThn and tanggal<=@TglLalu and kodebud=@kdbud and (substring(norek,1,1)='6' or substring(norek,1,3)='490') and KodeUnit=@kdunit
group by kodeunit,norek,netral

select space(2) as Grup,space(50) as nmgrup,a.kodeunit,SPACE(50) as urut,a.Norek,space(50) as uraian,sum(a.bi) as bi,sum(a.abi) as abi,sum(a.sbi) as sbi,sum(a.asbi) as asbi
into #t2
from #t1 a
where not substring(a.norek,1,3)='490' and a.norek not like '60000%' 
group by a.kodeunit,a.norek
union all
select space(2) as Grup,space(50) as nmgrup,a.kodeunit,SPACE(50) as urut,a.Norek,space(50) as uraian,sum(a.bi) as bi,sum(a.abi) as abi,sum(a.sbi) as sbi,sum(a.asbi) as asbi
from #t1 a
where substring(a.norek,1,3) in ('490','600')
group by a.kodeunit,a.norek

select grup,nmgrup,kodeunit,urut,norek,SPACE(50) as uraian,cast(0 as float) as Luas,sum(bi) as bi,sum(abi) as abi,sum(sbi) as sbi,sum(asbi) as asbi,
cast(0 as float) as BS01_BI,  cast(0 as float) as BS02_BI,  cast(0 as float) as BS03_BI,  cast(0 as float) as BS04_BI,  cast(0 as float) as BS05_BI,  cast(0 as float) as BS06_BI,
cast(0 as float) as BS01_ABI, cast(0 as float) as BS02_ABI, cast(0 as float) as BS03_ABI, cast(0 as float) as BS04_ABI, cast(0 as float) as BS05_ABI, cast(0 as float) as BS06_ABI,
cast(0 as float) as BS01_SBI, cast(0 as float) as BS02_SBI, cast(0 as float) as BS03_SBI, cast(0 as float) as BS04_SBI, cast(0 as float) as BS05_SBI, cast(0 as float) as BS06_SBI,
cast(0 as float) as BS01_ASBI,cast(0 as float) as BS02_ASBI,cast(0 as float) as BS03_ASBI,cast(0 as float) as BS04_ASBI,cast(0 as float) as BS05_ASBI,cast(0 as float) as BS06_ASBI,
cast(0 as float) as KR01_BI,  cast(0 as float) as KR02_BI,  cast(0 as float) as KR03_BI,  cast(0 as float) as KR04_BI,  cast(0 as float) as KR05_BI,  cast(0 as float) as KR06_BI,  cast(0 as float) as KR07_BI,
cast(0 as float) as KR01_ABI, cast(0 as float) as KR02_ABI, cast(0 as float) as KR03_ABI, cast(0 as float) as KR04_ABI, cast(0 as float) as KR05_ABI, cast(0 as float) as KR06_ABI, cast(0 as float) as KR07_ABI,
cast(0 as float) as KR01_SBI, cast(0 as float) as KR02_SBI, cast(0 as float) as KR03_SBI, cast(0 as float) as KR04_SBI, cast(0 as float) as KR05_SBI, cast(0 as float) as KR06_SBI, cast(0 as float) as KR07_SBI,
cast(0 as float) as KR01_ASBI,cast(0 as float) as KR02_ASBI,cast(0 as float) as KR03_ASBI,cast(0 as float) as KR04_ASBI,cast(0 as float) as KR05_ASBI,cast(0 as float) as KR06_ASBI,cast(0 as float) as KR07_ASBI,
cast(0 as float) as ssBI,cast(0 as float) as ssABI,cast(0 as float) as ssSBI,cast(0 as float) as ssASBI,'' as Grup2
into #t3
from #t2
group by grup,kodeunit,urut,norek,nmgrup

update #t3 set Luas=(select sum(luas) from ref_areal where exAreal='Areal1' and kodebudidaya=@kdbud  and KodeUnit=@kdunit)

--PRODUKSI BASAH
--sendiri
set dateformat dmy update #t3 set BS01_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='BASAH' and norek='X' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS01_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='BASAH' and norek='X' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS01_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='BASAH' and norek='X' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS01_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='BASAH' and norek='X' and KodeUnit=@kdunit)
--Lancuran
set dateformat dmy update #t3 set BS02_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='BASAH' and norek='6080200' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS02_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='BASAH' and norek='6080200' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS02_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='BASAH' and norek='6080200' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS02_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='BASAH' and norek='6080200' and KodeUnit=@kdunit)
--TBM
set dateformat dmy update #t3 set BS03_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='BASAH' and norek='6080300' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS03_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='BASAH' and norek='6080300' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS03_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='BASAH' and norek='6080300' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS03_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='BASAH' and norek='6080300' and KodeUnit=@kdunit)
--Pembelian D/Pihak ke III/Plasma
set dateformat dmy update #t3 set BS04_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='BASAH' and norek in ('6080101','6080102') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS04_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='BASAH' and norek in ('6080101','6080102') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS04_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='BASAH' and norek in ('6080101','6080102') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS04_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='BASAH' and norek in ('6080101','6080102') and KodeUnit=@kdunit)
--Pembelian
set dateformat dmy update #t3 set BS05_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='BASAH' and norek='6080100' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS05_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='BASAH' and norek='6080100' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS05_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='BASAH' and norek='6080100' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS05_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='BASAH' and norek='6080100' and KodeUnit=@kdunit)
--Penjualan
set dateformat dmy update #t3 set BS06_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='BASAH' and norek='6090100' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS06_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='BASAH' and norek='6090100' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS06_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='BASAH' and norek='6090100' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS06_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='BASAH' and norek='6090100' and KodeUnit=@kdunit)

--PRODUKSI KERING
--sendiri
set dateformat dmy update #t3 set KR01_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='JADI' and norek='X' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR01_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='JADI' and norek='X' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR01_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='JADI' and norek='X' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR01_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='JADI' and norek='X' and KodeUnit=@kdunit)
--Lancuran
set dateformat dmy update #t3 set KR02_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='JADI' and norek='6080500' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR02_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='JADI' and norek='6080500' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR02_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='JADI' and norek='6080500' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR02_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='JADI' and norek='6080500' and KodeUnit=@kdunit)
--TBM
set dateformat dmy update #t3 set KR03_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='JADI' and norek='6080600' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR03_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='JADI' and norek='6080600' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR03_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='JADI' and norek='6080600' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR03_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='JADI' and norek='6080600' and KodeUnit=@kdunit)
--Pembelian D/Pihak ke III/Plasma
set dateformat dmy update #t3 set KR04_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='JADI' and norek in ('6080401','6080402') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR04_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='JADI' and norek in ('6080402','6080402') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR04_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='JADI' and norek in ('6080401','6080402') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR04_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='JADI' and norek in ('6080401','6080402') and KodeUnit=@kdunit)
--Pembelian
set dateformat dmy update #t3 set KR05_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='JADI' and norek='6080400' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR05_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='JADI' and norek='6080400' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR05_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='JADI' and norek='6080400' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR05_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='JADI' and norek='6080400' and KodeUnit=@kdunit)
--Penjualan
set dateformat dmy update #t3 set KR06_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='JADI' and norek in ('6090400','6090500','6090402') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR06_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='JADI' and norek in ('6090400','6090500','6090402') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR06_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='JADI' and norek in ('6090400','6090500','6090402') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR06_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='JADI' and norek in ('6090400','6090500','6090402') and KodeUnit=@kdunit)
--Pengiriman Untuk Barang Bahan
set dateformat dmy update #t3 set KR07_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='JADI' and norek='6900403' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR07_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='JADI' and norek='6900403' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR07_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='JADI' and norek='6900403' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR07_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='JADI' and norek='6900403' and KodeUnit=@kdunit)

--update JIKA NULL
set dateformat dmy update #t3 set BS01_BI=0   where BS01_BI is null   
set dateformat dmy update #t3 set BS01_ABI=0  where BS01_ABI is null  
set dateformat dmy update #t3 set BS01_SBI=0  where BS01_SBI is null  
set dateformat dmy update #t3 set BS01_ASBI=0 where BS01_ASBI is null 
set dateformat dmy update #t3 set BS02_BI=0   where BS02_BI is null   
set dateformat dmy update #t3 set BS02_ABI=0  where BS02_ABI is null  
set dateformat dmy update #t3 set BS02_SBI=0  where BS02_SBI is null  
set dateformat dmy update #t3 set BS02_ASBI=0 where BS02_ASBI is null 
set dateformat dmy update #t3 set BS03_BI=0   where BS03_BI is null   
set dateformat dmy update #t3 set BS03_ABI=0  where BS03_ABI is null  
set dateformat dmy update #t3 set BS03_SBI=0  where BS03_SBI is null  
set dateformat dmy update #t3 set BS03_ASBI=0 where BS03_ASBI is null 
set dateformat dmy update #t3 set BS04_BI=0   where BS04_BI is null   
set dateformat dmy update #t3 set BS04_ABI=0  where BS04_ABI is null  
set dateformat dmy update #t3 set BS04_SBI=0  where BS04_SBI is null  
set dateformat dmy update #t3 set BS04_ASBI=0 where BS04_ASBI is null 
set dateformat dmy update #t3 set BS05_BI=0   where BS05_BI is null   
set dateformat dmy update #t3 set BS05_ABI=0  where BS05_ABI is null  
set dateformat dmy update #t3 set BS05_SBI=0  where BS05_SBI is null  
set dateformat dmy update #t3 set BS05_ASBI=0 where BS05_ASBI is null 
set dateformat dmy update #t3 set BS06_BI=0   where BS06_BI is null   
set dateformat dmy update #t3 set BS06_ABI=0  where BS06_ABI is null  
set dateformat dmy update #t3 set BS06_SBI=0  where BS06_SBI is null  
set dateformat dmy update #t3 set BS06_ASBI=0 where BS06_ASBI is null 
set dateformat dmy update #t3 set KR01_BI=0   where KR01_BI is null   
set dateformat dmy update #t3 set KR01_ABI=0  where KR01_ABI is null  
set dateformat dmy update #t3 set KR01_SBI=0  where KR01_SBI is null  
set dateformat dmy update #t3 set KR01_ASBI=0 where KR01_ASBI is null 
set dateformat dmy update #t3 set KR02_BI=0   where KR02_BI is null   
set dateformat dmy update #t3 set KR02_ABI=0  where KR02_ABI is null  
set dateformat dmy update #t3 set KR02_SBI=0  where KR02_SBI is null  
set dateformat dmy update #t3 set KR02_ASBI=0 where KR02_ASBI is null 
set dateformat dmy update #t3 set KR03_BI=0   where KR03_BI is null   
set dateformat dmy update #t3 set KR03_ABI=0  where KR03_ABI is null  
set dateformat dmy update #t3 set KR03_SBI=0  where KR03_SBI is null  
set dateformat dmy update #t3 set KR03_ASBI=0 where KR03_ASBI is null 
set dateformat dmy update #t3 set KR04_BI=0   where KR04_BI is null   
set dateformat dmy update #t3 set KR04_ABI=0  where KR04_ABI is null  
set dateformat dmy update #t3 set KR04_SBI=0  where KR04_SBI is null  
set dateformat dmy update #t3 set KR04_ASBI=0 where KR04_ASBI is null 
set dateformat dmy update #t3 set KR05_BI=0   where KR05_BI is null   
set dateformat dmy update #t3 set KR05_ABI=0  where KR05_ABI is null  
set dateformat dmy update #t3 set KR05_SBI=0  where KR05_SBI is null  
set dateformat dmy update #t3 set KR05_ASBI=0 where KR05_ASBI is null 
set dateformat dmy update #t3 set KR06_BI=0   where KR06_BI is null   
set dateformat dmy update #t3 set KR06_ABI=0  where KR06_ABI is null  
set dateformat dmy update #t3 set KR06_SBI=0  where KR06_SBI is null  
set dateformat dmy update #t3 set KR06_ASBI=0 where KR06_ASBI is null 
set dateformat dmy update #t3 set KR07_BI=0   where KR07_BI is null   
set dateformat dmy update #t3 set KR07_ABI=0  where KR07_ABI is null  
set dateformat dmy update #t3 set KR07_SBI=0  where KR07_SBI is null  
set dateformat dmy update #t3 set KR07_ASBI=0 where KR07_ASBI is null 
update #t3 set ssBI=BI     where norek like '490%'
update #t3 set ssABI=ABI   where norek like '490%'
update #t3 set ssSBI=SBI   where norek like '490%'
update #t3 set ssASBI=ASBI where norek like '490%'


select 'Kebun/Unit : '+b.namakebun as nmKebun,'BUDIDAYA '+upper(c.nm_bud) as nmBud,a.*,d.NamaRekening as uraian1 
into #t4
from #t3 a
inner join ref_kebun b on a.kodeunit=b.kodekebun 
inner join ref_budidaya c on @kdbud=c.kd_bud and @kdunit=c.KodeUnit
inner join Ref_Rekening d on a.Norek=d.Norek and @kdunit=d.KodeUnit
where a.bi+a.abi+a.sbi+a.asbi<>0 order by Grup,urut 

update #t4 set Grup=''
update #t4 set nmGrup=''
update #t4 set Grup='01' where substring(norek,1,7)='6000001'
update #t4 set Grup='01' where substring(norek,1,3) in ('601','602','619')
update #t4 set Grup='01' where substring(norek,1,5)='60214'
update #t4 set Grup='01' where substring(norek,1,9)='490000100'
update #t4 set urut='1'  where substring(norek,1,7)='6000001' and Grup='01'
update #t4 set urut='2'  where substring(norek,1,3) in ('601','602','619') and Grup='01'
update #t4 set urut='3'  where substring(norek,1,9)='490000100' and Grup='01'
update #t4 set nmgrup='TANAMAN' where Grup='01'

update #t4 set Grup='02' where substring(norek,1,7)='6000002'
update #t4 set Grup='02' where substring(norek,1,3) in ('603','604','605')
update #t4 set urut='1'  where substring(norek,1,7)='6000002' and Grup='02'
update #t4 set urut='2'  where substring(norek,1,3) in ('603','604','605') and Grup='02'
update #t4 set nmgrup='PENGOLAHAN' where Grup='02'

update #t4 set Grup='03' where substring(norek,1,3)='608'
update #t4 set urut='1'  where Grup='03'
update #t4 set nmgrup='PEMBELIAN' where Grup='03'

update #t4 set Grup='04' where substring(norek,1,3) in ('609')
update #t4 set urut='1'  where substring(norek,1,3)='609' and Grup='04'
update #t4 set nmgrup='PENJUALAN' where Grup='04'

update #t4 set Grup='05' where substring(norek,1,3) in ('690')
update #t4 set urut='1'  where substring(norek,1,3)='690' and Grup='05'
update #t4 set nmgrup='PENGIRIMAN' where Grup='05'

update #t4 set Grup='06' where norek='490000200'
update #t4 set urut='1'  where Grup='06' 
update #t4 set nmgrup='PENYUSUTAN NON TANAMAN' where Grup='06'
update #t4 set uraian=uraian1

select * from #t4
order by kodeunit,Grup,urut,norek

--set dateformat dmy exec AKNcr713 '01-01-2018','02','12'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[AKT303]
@tanggal datetime
--WITH ENCRYPTION
as
set dateformat dmy
declare @AwalTahun datetime
declare @AkhirBulan datetime
set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @AkhirBulan=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select distinct nobukti into #tb1 from AktivaMaster 
where tgltran>=@AwalTahun and tgltran<=@AkhirBulan and SUBSTRING(nobukti,1,3)='SST'

--SALDO AWAL
select kelompok as namagrup,'AKTIVA TETAP' as Kelompok,kelompokaset,kodeunit,kdafd,kdbud,'1' as grup,SUBSTRING(norek,1,3) as krbb,norek,tglbeli,noaktiva,nmaktiva,space(2) as blnsst,jmlunit,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
INTO #T1
from AktivaMaster
where YEAR(tgltran)=YEAR(@tanggal) and nobukti='SALDO AWAL' and SUBSTRING(norek,1,3) not in (043,044,045,046,047,048,049)
union all
select kelompok as namagrup,'INVESTASI TAHUN BERJALAN' as Kelompok,kelompokaset,kodeunit,kdafd,kdbud,'2' as grup,SUBSTRING(norek,1,3) as krbb,norek,tglbeli,noaktiva,nmaktiva,space(2) as blnsst,jmlunit,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster
where YEAR(tgltran)=YEAR(@tanggal) and nobukti='SALDO AWAL' and SUBSTRING(norek,1,3) in (043,044,045,046,047,048,049)
union all

--TRANSAKSI AKTIVA TAHUN BERJALAN
select kelompok as namagrup,'AKTIVA TETAP' as Kelompok,kelompokaset,kodeunit,kdafd,kdbud,'1' as grup,substring(norek,1,3) as krbb,norek,tglbeli,noaktiva,nmaktiva,space(2) as blnsst,jmlunit,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster 
where SUBSTRING(norek,1,3) not in (043,044,045,046,047,048,049) and tgltran>=@AwalTahun and tgltran<=@AkhirBulan and nobukti<>'SALDO AWAL'
union all

--TRANSAKSI INVESTASI TAHUN BERJALAN
select kelompok as namagrup,'INVESTASI TAHUN BERJALAN' as Kelompok,kelompokaset,kodeunit,kdafd,kdbud,'2' as grup,substring(norek,1,3) as krbb,norek,tglbeli,noaktiva,nmaktiva,space(2) as blnsst,jmlunit,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster 
where SUBSTRING(norek,1,3) in (043,044,045,046,047,048,049) and tgltran>=@AwalTahun and tgltran<=@AkhirBulan and nobukti<>'SALDO AWAL'

update #T1 set kelompokaset='04' where kelompokaset=''
update #T1 set blnsst=(select COUNT(*) from #tb1)

--REKAPITULASI
select a.kodeunit,'KEBUN/UNIT : '+b.NamaKebun as kebun,a.Kelompok,a.namagrup,c.Uraian,a.kdafd,a.grup,a.krbb,a.norek,a.tglbeli,substring(a.noaktiva,1,10) as noaktiva,a.nmaktiva,a.blnsst,sum(a.jmlunit) as jmlunit,
SUM(a.sawalp) as sawalp,SUM(a.auditp) as auditp,SUM(a.rcp) as rcp,SUM(a.hapusp) as hapusp,SUM(a.rekp) as rekp,SUM(a.kbnp) as kbnp,SUM(a.murnip) as murnip,
SUM(a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip) as jmlmutasip,
SUM(a.sawalp+a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip) as jmlperolehan,
SUM(a.sawals) as sawals,SUM(a.audits) as audits,SUM(a.rcs) as rcs,SUM(a.hapuss) as hapuss,SUM(a.reks) as reks,SUM(a.kbns) as kbns,SUM(a.murnis) as murnis,
SUM(a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as jmlmutasis,
SUM(a.sawals+a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as jmlpenyusutan,
SUM(a.sawalp+a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip)-SUM(a.sawals+a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as NilaiBuku,
'Per : '+cast(substring(convert(varchar(50),@AwalTahun,105),1,10) as varchar(50))as AwalTahun,'Per : '+cast(substring(convert(varchar(50),@akhirbulan,105),1,10) as varchar(50))as akhirbulan
into #t2
from #T1 a
inner join Ref_Kebun b on a.kodeunit=b.KodeKebun
inner join SPDK_KBN_MASTER_REF..Ref_TarifAktiva c on a.namagrup=c.norek and a.kdbud=c.kdbud and a.kelompokaset=c.kelompokaset
group by a.kodeunit,b.NamaKebun,a.Kelompok,a.kdafd,a.namagrup,c.Uraian,a.grup,a.krbb,a.norek,a.tglbeli,a.noaktiva,a.nmaktiva,a.blnsst
order by kodeunit,grup,krbb,noaktiva,tglbeli asc,norek

select kodeunit,replace(kebun,'KEBUN/UNIT :','') as Kebun,noaktiva,nmaktiva,cast(year(tglbeli) as varchar (4)) as TahunPerolehan,jmlunit,jmlperolehan,jmlpenyusutan,NilaiBuku 
into #t3
from #t2 
where nmaktiva like '%mesin petik%' 

update #t3 set NilaiBuku = jmlunit 
where NilaiBuku <=10

select kodeunit,kebun,nmaktiva,TahunPerolehan,SUM(jmlunit)as Fisik,SUM(jmlperolehan)as JmlPerolehan,round(SUM(jmlpenyusutan),0) as JmlPenyusutan,round(SUM(NilaiBuku),0) as Nilaibuku,round(SUM(jmlperolehan/jmlunit),0) as HargaSatuan 
from #t3 
where jmlperolehan > 0
group by kodeunit,kebun,nmaktiva,TahunPerolehan
order by kodeunit

--set dateformat dmy exec AKT303 '01-07-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[Aktiva2016]
@tanggal datetime
as
--FILE M
BEGIN
SET NOCOUNT ON;

set dateformat dmy
select a.kodeunit,a.noaktiva,a.kdafd,a.kdbud,a.norek,a.tglbeli,'' as n_beli,a.nmaktiva,sum(a.jmlunit) as jmlunit,'' as nobukti,'' as LEVERANSIR, 
sum(a.sawalp) as sawalp,sum(a.auditp) as auditp,sum(a.rcp) as rcp,sum(a.hapusp) as hapusp,sum(a.kbnp) as mutasip,sum(a.rekp) as rekp,sum(a.murnip) as murnip,
sum(a.sawals) as sawals,sum(a.audits) as audits,sum(a.rcs) as rcs,sum(a.hapuss) as hapuss,sum(a.kbns) as mutasis,sum(a.reks) as reks,sum(a.murnis) as murnis,
b.tahun as umur
into #M1
from AktivaMaster a
inner join Ref_TarifAktiva b on b.kdbud=a.kdbud and b.Norek=a.kelompok and b.kelompokaset=a.kelompokaset
where YEAR(a.tgltran)=year(@tanggal)-- and a.noaktiva='6900300083'
group by a.kodeunit,a.noaktiva,a.kdafd,a.kdbud,a.norek,a.tglbeli,a.nmaktiva,b.tahun

select kodeunit,kodeafd,kodebud,netral,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='D' and SUBSTRING(norek,1,3) in ('040','041','042')
union all
select kodeunit,kodeafd,kodebud,netral,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='K' and SUBSTRING(norek,1,3) in ('040','041','042')

select kodeunit,kodeafd,kodebud,netral,norek,sum(nilai) as nilai 
into #t1 
from #Sawal 
group by kodeunit,kodeafd,kodebud,netral,norek

select kodeunit,kodeafd,kodebud,netral,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,kodeafd,kodebud,netral,norek
union all
select kodeunit,kodeafd,kodebud,netral,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,kodeafd,kodebud,netral,norek
union all
select kodeunit,KodeAfdeling,KodeBudidaya,netral,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from kartu
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(norek,1,3) in ('040','041','042')
group by kodeunit,KodeAfdeling,KodeBudidaya,netral,norek

select kodeunit,kodeafd,kodebud,netral,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,kodeafd,kodebud,netral,norek

select kodeunit,kodeafd,kodebud,netral,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,kodeafd,kodebud,netral,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select a.kodeunit,'' as kodeafd,a.kodebud,a.netral,substring(a.norek,1,3)+'000000' as norek,cast('' as varchar(50)) as nm_aktiva,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
into #t5
from #t4 a
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null
group by a.kodeunit,a.kodebud,a.netral,substring(a.norek,1,3)

update #t5 set netral='2016' where netral=''
update #t5 set netral=substring(netral,1,4)
update #t5 set nm_aktiva='TTAD' where norek like '040%'
update #t5 set nm_aktiva='TTI'  where norek like '041%'
update #t5 set nm_aktiva='TBM'  where norek like '042%'

select KodeUnit,substring(norek,1,3)+KodeUnit+kodebud+'00'+SUBSTRING(netral,3,2) as noaktiva,kodeafd as kdafd,kodebud as kdbud,norek,cast('01-'+cast(month(@tanggal) as varchar(2))+'-'+netral as datetime) as tglbeli,0 as n_beli,nm_aktiva,
0 as jmlunit,'' as nobukti,'' as leveransir,
0 as sawalp,0 as auditp,0 as rcp,0 as hapusp,0 as mutasip,0 as rekp,round(sum(sakDebet-sakKredit),0) as murnip,
0 as sawals,0 as audits,0 as rcs,0 as hapuss,0 as mutasis,0 as reks,0 as murnis,'' as umur
into #M2
from #t5
group by KodeUnit,kodeafd,kodebud,netral,norek,nm_aktiva

--delete SPDK_KBN_LAYANAN_BAGIAN..File_M
--insert SPDK_KBN_LAYANAN_BAGIAN..File_M
select * from #M1 union all select * from #M2 where murnip>0 order by kodeunit,noaktiva
SET NOCOUNT OFF;
END


--set dateformat dmy exec Aktiva2016 '01-12-2016'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[ArealDanEvaluasiKinerja_HasilKerjaPerBlok]
@BulanAwal as int, 
@TahunAwal as int,
@BulanAkhir as int, 
@TahunAkhir as int,
@Budidaya as nvarchar(max),
@KodeRekening as nvarchar(max)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	set dateformat dmy

	declare @tglAwal as datetime
	declare @tglAkhir as datetime
	
	set @tglAwal = CAST('01/'+cast(@BulanAwal as varchar(10))+'/'+cast(@TahunAwal as varchar(10)) as datetime)  
	if @BulanAkhir=12
	begin
		set @tglAkhir = CAST('01/01/'+cast(@TahunAkhir+1 as varchar(10)) as datetime)  
		set @tglAkhir = @tglAkhir-1
	end
	else
	begin
		set @tglAkhir = CAST('01/'+cast(@BulanAkhir+1 as varchar(10))+'/'+cast(@TahunAkhir as varchar(10)) as datetime)  
		set @tglAkhir = @tglAkhir-1
	end	

    -- Insert statements for procedure here
    
    SELECT A.kodeunit,A.kodebud1,A.kodeafd1,A.kdblok,month(A.tanggal) as bulan, year(A.tanggal) as tahun, A.kdpanen,A.thntnm,A.regmdr,A.grup,substring(A.norek,1,5) as norek,
		Count(*) as RealisasiJumlahHK, SUM(A.jmlupah) as jmlupah, SUM(A.hslpanen) as hslpanen, SUM(A.hslpanenlump) as hslpanenlump, 
        SUM(A.hslpanenTBS) as hslpanenTBS, sum(A.jelajahHA) as Jelajah, sum(A.nbrd) as JumlahPohon, avg(A.jelajahHA) as JelajahMesin,
        SUM(A.hslpemel) as hslpemel, SUM(A.hsllain2) as hsllain2  
        INTO #a FROM[SPDK_KBN_KONSOL].[dbo].[GajiAbsensi] A 
        inner join[SPDK_KBN_KONSOL].[dbo].[ref_areal] B on B.kodekebun + B.kodeafdeling + B.kodeblok = A.kodeunit + A.kodeafd1 + A.kdblok and A.thntnm = B.tahuntanam 
        where A.tanggal >= @tglAwal and A.tanggal <= @tglAkhir and LEN(A.kdblok) = 4 and len(rtrim(A.norek)) = 9 and substring(A.norek, 1, LEN(@KodeRekening)) = @KodeRekening 
        and A.kodeabs = '1' and B.status = 'TM' and len(A.thntnm) = 4 and A.kodebud1=@Budidaya 
        group by A.kodeunit, A.kodebud1, A.kodeafd1, A.kdblok, month(A.tanggal), year(A.tanggal), A.kdpanen, A.thntnm, A.regmdr, A.grup,substring(A.norek,1,5)
    
    SELECT A.kodeunit,A.kodebud,A.kodeafd,A.kdblok,month(A.tanggal) as bulan,year(A.tanggal) as tahun, A.thntnm,substring(A.norek,1,5) as norek,
		sum(A.nilai) as nilai, Count(*) as RealisasiJumlahHK, SUM(A.jmlhasil) as jmlhasil 
		INTO #b FROM [SPDK_KBN_KONSOL].[dbo].[GajiKulir] A
        inner join[SPDK_KBN_KONSOL].[dbo].[ref_areal] B on B.kodekebun + B.kodeafdeling + B.kodeblok = A.kodeunit + A.kodeafd + A.kdblok and A.thntnm = B.tahuntanam 
        where A.tanggal >= @tglAwal and A.tanggal <= @tglAkhir and LEN(A.kdblok)=4 and len(rtrim(A.norek))=9 and substring(A.norek,1,LEN(@KodeRekening))=@KodeRekening 
        and len(A.thntnm)=4 and B.status = 'TM' and A.kodebud=@Budidaya 
        group by A.kodeunit, A.kodebud, A.kodeafd, A.kdblok, month(A.tanggal), year(A.tanggal),A.thntnm, substring(A.norek,1,5)       
        
	SELECT A.kodeunit, A.kodebud, A.kodeafd, A.kdblok, month(A.tanggal) as bulan, year(A.tanggal) as tahun, A.thntnm, substring(A.norek,1,5) as norek,
		sum(A.jmlupah) as jmlupah, sum(A.jmlhadir) as RealisasiJumlahHK, SUM(A.jmlhasil) as jmlhasil 
        INTO #c FROM [SPDK_KBN_KONSOL].[dbo].[GajiSPKHonor] A 
        inner join [SPDK_KBN_KONSOL].[dbo].[ref_areal] B on B.kodekebun + B.kodeafdeling + B.kodeblok = A.kodeunit + A.kodeafd + A.kdblok and A.thntnm = B.tahuntanam 
        where A.tanggal >= @tglAwal and A.tanggal <= @tglAkhir and LEN(A.kdblok)=4 and len(rtrim(A.norek))=9 and substring(A.norek,1,LEN(@KodeRekening))=@KodeRekening 
        and len(A.thntnm)=4  and B.status='TM' and A.kodebud=@Budidaya 
        group by A.kodeunit, A.kodebud, A.kodeafd, A.kdblok, month(A.tanggal), year(A.tanggal),A.thntnm, substring(A.norek,1,5)

	SELECT A.kodeunit, A.kodebud, A.kodeafd, A.kodeblok, A.thntnm, month(A.tanggal) as bulan, year(A.tanggal) as tahun, substring(A.norek,1,5) as norek,
		sum(A.nilai_RKAP) as RKAPjmlupah, sum(A.nilai_PMK) as PMKjmlupah, 
        sum(A.jmlHK_RKAP) as RKAPJumlahHK, sum(A.jmlHK_PMK) as PMKJumlahHK,
        SUM(A.jmlHsl_RKAP) as RKAPjmlhasil, SUM(A.jmlHsl_PMK) as PMKjmlhasil
        INTO #d FROM [SPDK_KBN_KONSOL].[dbo].[AkunRKAP] A 
        inner join [SPDK_KBN_KONSOL].[dbo].[ref_areal] B on B.kodekebun + B.kodeafdeling + B.kodeblok = A.kodeunit + A.kodeafd + A.kodeblok and A.thntnm = B.tahuntanam 
        where A.tanggal >= @tglAwal and A.tanggal <= @tglAkhir and LEN(A.kodeblok)=4 and len(rtrim(A.norek))=9 and substring(A.norek,1,LEN(@KodeRekening))=@KodeRekening 
        and len(A.thntnm)=4  and B.status='TM' and A.kodebud=@Budidaya 
        group by A.kodeunit, A.kodebud, A.kodeafd, A.kodeblok, A.thntnm, month(A.tanggal),year(A.tanggal), substring(A.norek,1,5)
    
    SELECT KodeBlok = A.kodeunit+A.kodeafd1+A.kdblok,
		TahunTanam = A.thntnm,
		KodeBudidaya = A.kodebud1,
		KgLateks = cast(case when A.kodebud1='00' and SUBSTRING(A.norek,1,3)='602' then A.hslpanen else 0 end as decimal(18,2)), 
		KgLump = cast(case when A.kodebud1='00' and SUBSTRING(A.norek,1,3)='602' then A.hslpanenlump else 0 end as decimal(18,2)), 
		KgTBS = cast(case when A.kodebud1='01' and SUBSTRING(A.norek,1,3)='602' and A.kdpanen='1' then A.hslpanen else 0 end as decimal(18,2)),
		KgBrondol =  cast(case when A.kodebud1='01' and SUBSTRING(A.norek,1,3)='602' and A.kdpanen='2' then A.hslpanen else 0 end as decimal(18,2)),
		JumlahTandan = cast(case when A.kodebud1='01' and SUBSTRING(A.norek,1,3)='602' then A.hslpanenTBS else 0 end as decimal(18,2)),
		JumlahPohon = cast(case when A.kodebud1='02' and SUBSTRING(A.norek,1,3)='602' then A.Jelajah else A.JumlahPohon end as decimal(18,2)),
		KgPucuk = cast(case when A.kodebud1='02' and SUBSTRING(A.norek,1,3)='602' then A.hslPanen else 0 end as decimal(18,2)),
		PanenLainnya = cast(case when A.kodebud1!='00' and A.kodebud1!='01' and A.kodebud1!='02' and SUBSTRING(A.norek,1,3)='602' then A.hslPanen else 0 end as decimal(18,2)),
		JumlahHK = cast(A.RealisasiJumlahHK as decimal(18,2)),
		HaJelajah = cast(case when A.kodebud1='02' and SUBSTRING(A.norek,1,3)='602' then A.JelajahMesin else A.Jelajah end as decimal(18,2)),
		RpGaji = cast(A.jmlupah as decimal(18,2)),
		GroupMesin = A.grup ,
		HasilPemeliharaan = cast(case when SUBSTRING(A.norek,1,3)='601' then A.hslpemel else 0 end as decimal(18,2)),
		HasilLainnya = cast(case when SUBSTRING(A.norek,1,3)!='601' and SUBSTRING(A.norek,1,3)!='602' then A.hsllain2 else 0 end as decimal(18,2)),
		RKAPKgLateks = cast(0 as decimal(18,2)),
		RKAPKgTBS = cast(0 as decimal(18,2)),
		RKAPKgPucuk = cast(0 as decimal(18,2)),
        RKAPPanenLainnya = cast(0 as decimal(18,2)),
        RKAPJumlahHK = cast(0 as decimal(18,2)),  
        RKAPRpGaji = cast(0 as decimal(18,2)), 
        PKBKgLateks = cast(0 as decimal(18,2)), 
        PKBKgTBS = cast(0 as decimal(18,2)),
        PKBKgPucuk = cast(0 as decimal(18,2)),
        PKBPanenLainnya = cast(0 as decimal(18,2)),
        PKBJumlahHK = cast(0 as decimal(18,2)), 
        PKBRpGaji = cast(0 as decimal(18,2))
		INTO #e FROM #a as A

	insert into #e  	
    SELECT KodeBlok = B.kodeunit+B.kodeafd+B.kdblok,
		TahunTanam = B.thntnm,
		KodeBudidaya = B.kodebud,
		KgLateks = case when B.kodebud='00' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end, 
		KgLump = 0, 
		KgTBS = case when B.kodebud='01' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end,
		KgBrondol =  0,
		JumlahTandan = 0,
		JumlahPohon = 0,
		KgPucuk = case when B.kodebud='02' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end,
		PanenLainnya = case when B.kodebud!='00' and B.kodebud!='01' and B.kodebud!='02' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end,
		JumlahHK = B.RealisasiJumlahHK,
		HaJelajah = 0,
		RpGaji = B.nilai,
		GroupMesin = '',
		HasilPemeliharaan = case when SUBSTRING(B.norek,1,3)='601' then B.jmlhasil else 0 end,
		HasilLainnya = case when SUBSTRING(B.norek,1,3)!='601' and SUBSTRING(B.norek,1,3)!='602' then B.jmlhasil else 0 end,
		RKAPKgLateks = 0,
		RKAPKgTBS = 0,
		RKAPKgPucuk = 0,
        RKAPPanenLainnya = 0,
        RKAPJumlahHK = 0, 
        RKAPRpGaji = 0, 
        PKBKgLateks = 0, 
        PKBKgTBS = 0,
        PKBKgPucuk = 0,
        PKBPanenLainnya = 0,
        PKBJumlahHK = 0, 
        PKBRpGaji = 0
		FROM #b as B

	insert into #e
    SELECT KodeBlok = C.kodeunit+C.kodeafd+C.kdblok,
		TahunTanam = C.thntnm,
		KodeBudidaya = C.kodebud,
		KgLateks = case when C.kodebud='00' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end, 
		KgLump = 0, 
		KgTBS = case when C.kodebud='01' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end,
		KgBrondol =  0,
		JumlahTandan = 0,
		JumlahPohon = 0,
		KgPucuk = case when C.kodebud='02' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end,
		PanenLainnya = case when C.kodebud!='00' and C.kodebud!='01' and C.kodebud!='02' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end,
		JumlahHK = C.RealisasiJumlahHK,
		HaJelajah = 0,
		RpGaji = C.jmlupah,
		GroupMesin = '',
		HasilPemeliharaan = case when SUBSTRING(C.norek,1,3)='601' then C.jmlhasil else 0 end,
		HasilLainnya = case when SUBSTRING(C.norek,1,3)!='601' and SUBSTRING(C.norek,1,3)!='602' then C.jmlhasil else 0 end,
		RKAPKgLateks = 0,
		RKAPKgTBS = 0,
		RKAPKgPucuk = 0,
        RKAPPanenLainnya = 0,
        RKAPJumlahHK = 0, 
        RKAPRpGaji = 0, 
        PKBKgLateks = 0, 
        PKBKgTBS = 0,
        PKBKgPucuk = 0,
        PKBPanenLainnya = 0,
        PKBJumlahHK = 0, 
        PKBRpGaji = 0
		FROM #c as C	       

	insert into #e  	
    SELECT KodeBlok = D.kodeunit+D.kodeafd+D.kodeblok,
		TahunTanam = D.thntnm,
		KodeBudidaya = D.kodebud,
		KgLateks = 0, 
		KgLump = 0, 
		KgTBS = 0,
		KgBrondol =  0,
		JumlahTandan = 0,
		JumlahPohon = 0,
		KgPucuk = 0,
		PanenLainnya = 0,
		JumlahHK = 0,
		HaJelajah = 0,
		RpGaji = 0,
		GroupMesin = '',
		HasilPemeliharaan = 0,
		HasilLainnya = 0,
		RKAPKgLateks = case when D.kodebud='00' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
		RKAPKgTBS = case when D.kodebud='01' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
		RKAPKgPucuk = case when D.kodebud='02' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
        RKAPPanenLainnya = case when D.kodebud!='00' and D.kodebud!='01' and D.kodebud!='02' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
        RKAPJumlahHK = D.RKAPJumlahHK, 
        RKAPRpGaji = D.RKAPjmlupah, 
        PKBKgLateks = case when D.kodebud='00' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end, 
        PKBKgTBS = case when D.kodebud='01' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end,
        PKBKgPucuk = case when D.kodebud='02' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end,
        PKBPanenLainnya = case when D.kodebud!='00' and D.kodebud!='01' and D.kodebud!='02' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end,
        PKBJumlahHK = D.PMKJumlahHK, 
        PKBRpGaji = D.PMKjmlupah
		FROM #d as D	       
		
    SELECT KodeBlok, TahunTanam, KodeBudidaya, GroupMesin,
		KgLateks = sum(KgLateks), 
		KgLump = SUM(KgLump), 
		KgTBS = SUM(KgTBS),
		KgBrondol =  SUM(KgBrondol),
		JumlahTandan = SUM(JumlahTandan),
		JumlahPohon = SUM(JumlahPohon),
		KgPucuk = SUM(KgPucuk),
		PanenLainnya = SUM(PanenLainnya),
		JumlahHK = SUM(JumlahHK),
		HaJelajah = AVG(HaJelajah),
		RpGaji = SUM(RpGaji),
		HasilPemeliharaan = SUM(HasilPemeliharaan),
		HasilLainnya = SUM(HasilLainnya),
		RKAPKgLateks = SUM(RKAPKgLateks),
		RKAPKgTBS = SUM(RKAPKgTBS),
		RKAPKgPucuk = SUM(RKAPKgPucuk),
        RKAPPanenLainnya = SUM(RKAPPanenLainnya),
        RKAPJumlahHK = SUM(RKAPJumlahHK), 
        RKAPRpGaji = SUM(RKAPRpGaji), 
        PKBKgLateks = SUM(PKBKgLateks), 
        PKBKgTBS = SUM(PKBKgTBS),
        PKBKgPucuk = SUM(PKBKgPucuk),
        PKBPanenLainnya = SUM(PKBPanenLainnya),
        PKBJumlahHK = SUM(PKBJumlahHK), 
        PKBRpGaji = SUM(PKBRpGaji)
		FROM #e 
		GROUP BY KodeBlok, TahunTanam, KodeBudidaya, GroupMesin
END

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[ArealDanEvaluasiKinerja_PetaView]
@Id as nvarchar(max),						-- kode induk nya, kalo @Layer='Kebun' @Id='', kalo @Layer='Afdeling' @Id=Kode Kebun, kalo @Layer='Blok' @Id = Kode Afdeling
@Layer as nvarchar(max),					-- pilihan nya : 'Kebun', 'Afdeling' atau 'Blok'
@BulanAwal as int,@TahunAwal as int,@BulanAkhir as int, @TahunAkhir as int,
@Budidaya as nvarchar(max),					-- Kode Budidaya
@KodeRekening as nvarchar(max),				-- Kode Rekening
@FieldYangDibandingkan as nvarchar(max),	-- 'HK','PRESTASI','BIAYA','PROTAS'
@DibandingkanDengan as nvarchar(max),		-- 'INDUK','RKAP','PKB' atau 'BALAI'
@OrderBulan as nvarchar(max)				-- 'BI' atau 'SBI'
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	set dateformat dmy

	declare @tglAwal as datetime
	declare @tglAkhir as datetime
	
	set @tglAwal = CAST('01/'+cast(@BulanAwal as varchar(10))+'/'+cast(@TahunAwal as varchar(10)) as datetime)  
	if @BulanAkhir=12
	begin
		set @tglAkhir = CAST('01/01/'+cast(@TahunAkhir+1 as varchar(10)) as datetime)  
		set @tglAkhir = @tglAkhir-1
	end
	else
	begin
		set @tglAkhir = CAST('01/'+cast(@BulanAkhir+1 as varchar(10))+'/'+cast(@TahunAkhir as varchar(10)) as datetime)  
		set @tglAkhir = @tglAkhir-1
	end	

    -- Insert statements for procedure here
    
    SELECT A.KMK, A.kodeunit,A.kodebud1,A.kodeafd1,A.kdblok,month(A.tanggal) as bulan, year(A.tanggal) as tahun, A.kdpanen,A.thntnm,A.regmdr,A.grup,substring(A.norek,1,5) as norek,
		Count(*) as RealisasiJumlahHK, SUM(A.jmlupah) as jmlupah, SUM(A.hslpanen) as hslpanen, SUM(A.hslpanenlump) as hslpanenlump, 
        SUM(A.hslpanenTBS) as hslpanenTBS, sum(A.jelajahHA) as Jelajah, sum(A.nbrd) as JumlahPohon, avg(A.jelajahHA) as JelajahMesin,
        SUM(A.hslpemel) as hslpemel, SUM(A.hsllain2) as hsllain2  
        INTO #a FROM[SPDK_KBN_KONSOL].[dbo].[GajiAbsensi] A 
        inner join[SPDK_KBN_KONSOL].[dbo].[ref_areal] B on B.kodekebun + B.kodeafdeling + B.kodeblok = A.kodeunit + A.kodeafd1 + A.kdblok and A.thntnm = B.tahuntanam 
        where A.tanggal >= @tglAwal and A.tanggal <= @tglAkhir and LEN(A.kdblok) = 4 and len(rtrim(A.norek)) = 9 and substring(A.norek, 1, LEN(@KodeRekening)) = @KodeRekening 
        and A.kodeabs = '1' and B.status = 'TM' and len(A.thntnm) = 4 and A.kodebud1=@Budidaya 
        and @Id=substring(A.kodeunit+A.kodeafd1+A.kdblok,1,LEN(@Id))
        group by A.KMK, A.kodeunit, A.kodebud1, A.kodeafd1, A.kdblok, month(A.tanggal), year(A.tanggal), A.kdpanen, A.thntnm, A.regmdr, A.grup,substring(A.norek,1,5)
    
    SELECT A.KMK,A.kodeunit,A.kodebud,A.kodeafd,A.kdblok,month(A.tanggal) as bulan,year(A.tanggal) as tahun, A.thntnm,substring(A.norek,1,5) as norek,
		sum(A.nilai) as nilai, Count(*) as RealisasiJumlahHK, SUM(A.jmlhasil) as jmlhasil 
		INTO #b FROM [SPDK_KBN_KONSOL].[dbo].[GajiKulir] A
        inner join[SPDK_KBN_KONSOL].[dbo].[ref_areal] B on B.kodekebun + B.kodeafdeling + B.kodeblok = A.kodeunit + A.kodeafd + A.kdblok and A.thntnm = B.tahuntanam 
        where A.tanggal >= @tglAwal and A.tanggal <= @tglAkhir and LEN(A.kdblok)=4 and len(rtrim(A.norek))=9 and substring(A.norek,1,LEN(@KodeRekening))=@KodeRekening 
        and len(A.thntnm)=4 and B.status = 'TM' and A.kodebud=@Budidaya 
        and @Id=substring(A.kodeunit+A.kodeafd+A.kdblok,1,LEN(@Id))
        group by A.KMK,A.kodeunit, A.kodebud, A.kodeafd, A.kdblok, month(A.tanggal), year(A.tanggal),A.thntnm, substring(A.norek,1,5)       
        
	SELECT A.KMK,A.kodeunit, A.kodebud, A.kodeafd, A.kdblok, month(A.tanggal) as bulan, year(A.tanggal) as tahun, A.thntnm, substring(A.norek,1,5) as norek,
		sum(A.jmlupah) as jmlupah, sum(A.jmlhadir) as RealisasiJumlahHK, SUM(A.jmlhasil) as jmlhasil 
        INTO #c FROM [SPDK_KBN_KONSOL].[dbo].[GajiSPKHonor] A 
        inner join [SPDK_KBN_KONSOL].[dbo].[ref_areal] B on B.kodekebun + B.kodeafdeling + B.kodeblok = A.kodeunit + A.kodeafd + A.kdblok and A.thntnm = B.tahuntanam 
        where A.tanggal >= @tglAwal and A.tanggal <= @tglAkhir and LEN(A.kdblok)=4 and len(rtrim(A.norek))=9 and substring(A.norek,1,LEN(@KodeRekening))=@KodeRekening 
        and len(A.thntnm)=4  and B.status='TM' and A.kodebud=@Budidaya 
        and @Id=substring(A.kodeunit+A.kodeafd+A.kdblok,1,LEN(@Id))
        group by A.KMK, A.kodeunit, A.kodebud, A.kodeafd, A.kdblok, month(A.tanggal), year(A.tanggal),A.thntnm, substring(A.norek,1,5)

	SELECT A.KMK,A.kodeunit, A.kodebud, A.kodeafd, A.kodeblok, A.thntnm, month(A.tanggal) as bulan, year(A.tanggal) as tahun, substring(A.norek,1,5) as norek,
		sum(A.nilai_RKAP) as RKAPjmlupah, sum(A.nilai_PMK) as PMKjmlupah, 
        sum(A.jmlHK_RKAP) as RKAPJumlahHK, sum(A.jmlHK_PMK) as PMKJumlahHK,
        SUM(A.jmlHsl_RKAP) as RKAPjmlhasil, SUM(A.jmlHsl_PMK) as PMKjmlhasil
        INTO #d FROM [SPDK_KBN_KONSOL].[dbo].[AkunRKAP] A 
        inner join [SPDK_KBN_KONSOL].[dbo].[ref_areal] B on B.kodekebun + B.kodeafdeling + B.kodeblok = A.kodeunit + A.kodeafd + A.kodeblok and A.thntnm = B.tahuntanam 
        where A.tanggal >= @tglAwal and A.tanggal <= @tglAkhir and LEN(A.kodeblok)=4 and len(rtrim(A.norek))=9 and substring(A.norek,1,LEN(@KodeRekening))=@KodeRekening 
        and len(A.thntnm)=4  and B.status='TM' and A.kodebud=@Budidaya 
        and @Id=substring(A.kodeunit+A.kodeafd+A.kodeblok,1,LEN(@Id))
        group by A.KMK, A.kodeunit, A.kodebud, A.kodeafd, A.kodeblok, A.thntnm, month(A.tanggal),year(A.tanggal), substring(A.norek,1,5)

	-- Bulan Ini
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then A.kodeunit 
				when @Layer='Afdeling' then A.kodeunit+A.kodeafd1 
				else A.kodeunit+A.kodeafd1+A.kdblok 
			end,
		TahunTanam = A.thntnm,
		KodeBudidaya = A.kodebud1,
		GroupMesin = A.grup,
		R_KgLateks_BI = cast(case when A.kodebud1='00' and SUBSTRING(A.norek,1,3)='602' then A.hslpanen else 0 end as decimal(18,2)), 
		R_KgLump_BI = cast(case when A.kodebud1='00' and SUBSTRING(A.norek,1,3)='602' then A.hslpanenlump else 0 end as decimal(18,2)), 
		R_KgTBS_BI = cast(case when A.kodebud1='01' and SUBSTRING(A.norek,1,3)='602' and A.kdpanen='1' then A.hslpanen else 0 end as decimal(18,2)),
		R_KgBrondol_BI =  cast(case when A.kodebud1='01' and SUBSTRING(A.norek,1,3)='602' and A.kdpanen='2' then A.hslpanen else 0 end as decimal(18,2)),
		R_JumlahTandan_BI = cast(case when A.kodebud1='01' and SUBSTRING(A.norek,1,3)='602' then A.hslpanenTBS else 0 end as decimal(18,2)),
		R_JumlahPohon_BI = cast(case when A.kodebud1='02' and SUBSTRING(A.norek,1,3)='602' then A.Jelajah else A.JumlahPohon end as decimal(18,2)),
		R_KgPucuk_BI = cast(case when A.kodebud1='02' and SUBSTRING(A.norek,1,3)='602' then A.hslPanen else 0 end as decimal(18,2)),
		R_PanenLainnya_BI = cast(case when A.kodebud1!='00' and A.kodebud1!='01' and A.kodebud1!='02' and SUBSTRING(A.norek,1,3)='602' then A.hslPanen else 0 end as decimal(18,2)),
		R_JumlahHK_BI = cast(A.RealisasiJumlahHK as decimal(18,2)),
		R_HaJelajah_BI = cast(case when A.kodebud1='02' and SUBSTRING(A.norek,1,3)='602' then A.JelajahMesin else A.Jelajah end as decimal(18,2)),
		R_RpGaji_BI = cast(A.jmlupah as decimal(18,2)),
		R_HasilPemeliharaan_BI = cast(case when SUBSTRING(A.norek,1,3)='601' then A.hslpemel else 0 end as decimal(18,2)),
		R_HasilLainnya_BI = cast(case when SUBSTRING(A.norek,1,3)!='601' and SUBSTRING(A.norek,1,3)!='602' then A.hsllain2 else 0 end as decimal(18,2)),
		R_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		R_KgLateks_SBI = cast(0 as decimal(18,2)), 
		R_KgLump_SBI = cast(0 as decimal(18,2)), 
		R_KgTBS_SBI = cast(0 as decimal(18,2)),
		R_KgBrondol_SBI =  cast(0 as decimal(18,2)),
		R_JumlahTandan_SBI = cast(0 as decimal(18,2)),
		R_JumlahPohon_SBI = cast(0 as decimal(18,2)),
		R_KgPucuk_SBI = cast(0 as decimal(18,2)),
		R_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		R_JumlahHK_SBI = cast(0 as decimal(18,2)),
		R_HaJelajah_SBI = cast(0 as decimal(18,2)),
		R_RpGaji_SBI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_SBI = cast(0 as decimal(18,2)),
		
		A_KgLateks_BI = cast(0 as decimal(18,2)), 
		A_KgLump_BI = cast(0 as decimal(18,2)), 
		A_KgTBS_BI = cast(0 as decimal(18,2)), 
		A_KgBrondol_BI =  cast(0 as decimal(18,2)), 
		A_JumlahTandan_BI = cast(0 as decimal(18,2)), 
		A_JumlahPohon_BI = cast(0 as decimal(18,2)), 
		A_KgPucuk_BI = cast(0 as decimal(18,2)), 
		A_PanenLainnya_BI = cast(0 as decimal(18,2)), 
		A_JumlahHK_BI = cast(0 as decimal(18,2)), 
		A_HaJelajah_BI = cast(0 as decimal(18,2)), 
		A_RpGaji_BI = cast(0 as decimal(18,2)), 
		A_HasilPemeliharaan_BI = cast(0 as decimal(18,2)), 
		A_HasilLainnya_BI = cast(0 as decimal(18,2)), 
		A_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		A_KgLateks_SBI = cast(0 as decimal(18,2)), 
		A_KgLump_SBI = cast(0 as decimal(18,2)), 
		A_KgTBS_SBI = cast(0 as decimal(18,2)),
		A_KgBrondol_SBI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_SBI = cast(0 as decimal(18,2)),
		A_JumlahPohon_SBI = cast(0 as decimal(18,2)),
		A_KgPucuk_SBI = cast(0 as decimal(18,2)),
		A_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		A_JumlahHK_SBI = cast(0 as decimal(18,2)),
		A_HaJelajah_SBI = cast(0 as decimal(18,2)),
		A_RpGaji_SBI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_SBI = cast(0 as decimal(18,2))
		INTO #e FROM #a as A
		WHERE A.bulan=@BulanAkhir and A.tahun=@TahunAkhir and (A.KMK='01' or A.KMK is null)
	insert into #e
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then A.kodeunit 
				when @Layer='Afdeling' then A.kodeunit+A.kodeafd1 
				else A.kodeunit+A.kodeafd1+A.kdblok 
			end,
		TahunTanam = A.thntnm,
		KodeBudidaya = A.kodebud1,
		GroupMesin = A.grup,
		R_KgLateks_BI = 0, 
		R_KgLump_BI = 0, 
		R_KgTBS_BI = 0, 
		R_KgBrondol_BI =  0, 
		R_JumlahTandan_BI = 0, 
		R_JumlahPohon_BI = 0, 
		R_KgPucuk_BI = 0, 
		R_PanenLainnya_BI = 0, 
		R_JumlahHK_BI = 0, 
		R_HaJelajah_BI = 0, 
		R_RpGaji_BI = 0, 
		R_HasilPemeliharaan_BI = 0, 
		R_HasilLainnya_BI = 0, 
		R_RKAPKgLateks_BI = 0, 
		R_RKAPKgTBS_BI = 0, 
		R_RKAPKgPucuk_BI = 0, 
        R_RKAPPanenLainnya_BI = 0, 
        R_RKAPJumlahHK_BI = 0, 
        R_RKAPRpGaji_BI = 0, 
		R_RKAPHasilPemeliharaan_BI = 0, 
		R_RKAPHasilLainnya_BI = 0, 
        R_PKBKgLateks_BI = 0, 
        R_PKBKgTBS_BI = 0, 
        R_PKBKgPucuk_BI = 0, 
        R_PKBPanenLainnya_BI = 0, 
        R_PKBJumlahHK_BI = 0, 
        R_PKBRpGaji_BI = 0, 
		R_PKBHasilPemeliharaan_BI = 0, 
		R_PKBHasilLainnya_BI = 0, 
		R_KgLateks_SBI = 0, 
		R_KgLump_SBI = 0, 
		R_KgTBS_SBI = 0, 
		R_KgBrondol_SBI =  0, 
		R_JumlahTandan_SBI = 0, 
		R_JumlahPohon_SBI = 0, 
		R_KgPucuk_SBI = 0, 
		R_PanenLainnya_SBI = 0, 
		R_JumlahHK_SBI = 0, 
		R_HaJelajah_SBI = 0, 
		R_RpGaji_SBI = 0, 
		R_HasilPemeliharaan_SBI = 0, 
		R_HasilLainnya_SBI = 0, 
		R_RKAPKgLateks_SBI = 0, 
		R_RKAPKgTBS_SBI = 0, 
		R_RKAPKgPucuk_SBI = 0, 
        R_RKAPPanenLainnya_SBI = 0, 
        R_RKAPJumlahHK_SBI = 0, 
        R_RKAPRpGaji_SBI = 0, 
		R_RKAPHasilPemeliharaan_SBI = 0, 
		R_RKAPHasilLainnya_SBI = 0, 
        R_PKBKgLateks_SBI = 0, 
        R_PKBKgTBS_SBI = 0, 
        R_PKBKgPucuk_SBI = 0, 
        R_PKBPanenLainnya_SBI = 0, 
        R_PKBJumlahHK_SBI = 0, 
        R_PKBRpGaji_SBI = 0, 
		R_PKBHasilPemeliharaan_SBI = 0, 
		R_PKBHasilLainnya_SBI = 0, 
		A_KgLateks_BI = cast(case when A.kodebud1='00' and SUBSTRING(A.norek,1,3)='602' then A.hslpanen else 0 end as decimal(18,2)), 
		A_KgLump_BI = cast(case when A.kodebud1='00' and SUBSTRING(A.norek,1,3)='602' then A.hslpanenlump else 0 end as decimal(18,2)), 
		A_KgTBS_BI = cast(case when A.kodebud1='01' and SUBSTRING(A.norek,1,3)='602' and A.kdpanen='1' then A.hslpanen else 0 end as decimal(18,2)),
		A_KgBrondol_BI =  cast(case when A.kodebud1='01' and SUBSTRING(A.norek,1,3)='602' and A.kdpanen='2' then A.hslpanen else 0 end as decimal(18,2)),
		A_JumlahTandan_BI = cast(case when A.kodebud1='01' and SUBSTRING(A.norek,1,3)='602' then A.hslpanenTBS else 0 end as decimal(18,2)),
		A_JumlahPohon_BI = cast(case when A.kodebud1='02' and SUBSTRING(A.norek,1,3)='602' then A.Jelajah else A.JumlahPohon end as decimal(18,2)),
		A_KgPucuk_BI = cast(case when A.kodebud1='02' and SUBSTRING(A.norek,1,3)='602' then A.hslPanen else 0 end as decimal(18,2)),
		A_PanenLainnya_BI = cast(case when A.kodebud1!='00' and A.kodebud1!='01' and A.kodebud1!='02' and SUBSTRING(A.norek,1,3)='602' then A.hslPanen else 0 end as decimal(18,2)),
		A_JumlahHK_BI = cast(A.RealisasiJumlahHK as decimal(18,2)),
		A_HaJelajah_BI = cast(case when A.kodebud1='02' and SUBSTRING(A.norek,1,3)='602' then A.JelajahMesin else A.Jelajah end as decimal(18,2)),
		A_RpGaji_BI = cast(A.jmlupah as decimal(18,2)),
		A_HasilPemeliharaan_BI = cast(case when SUBSTRING(A.norek,1,3)='601' then A.hslpemel else 0 end as decimal(18,2)),
		A_HasilLainnya_BI = cast(case when SUBSTRING(A.norek,1,3)!='601' and SUBSTRING(A.norek,1,3)!='602' then A.hsllain2 else 0 end as decimal(18,2)),
		A_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		A_KgLateks_SBI = cast(0 as decimal(18,2)), 
		A_KgLump_SBI = cast(0 as decimal(18,2)), 
		A_KgTBS_SBI = cast(0 as decimal(18,2)),
		A_KgBrondol_SBI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_SBI = cast(0 as decimal(18,2)),
		A_JumlahPohon_SBI = cast(0 as decimal(18,2)),
		A_KgPucuk_SBI = cast(0 as decimal(18,2)),
		A_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		A_JumlahHK_SBI = cast(0 as decimal(18,2)),
		A_HaJelajah_SBI = cast(0 as decimal(18,2)),
		A_RpGaji_SBI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_SBI = cast(0 as decimal(18,2))



		FROM #a as A
		WHERE A.bulan=@BulanAkhir and A.tahun=@TahunAkhir and A.KMK='02'
		
	-- sd Bulan Ini
	insert into #e
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then A.kodeunit 
				when @Layer='Afdeling' then A.kodeunit+A.kodeafd1 
				else A.kodeunit+A.kodeafd1+A.kdblok 
			end,
		TahunTanam = A.thntnm,
		KodeBudidaya = A.kodebud1,
		GroupMesin = A.grup,
		
		R_KgLateks_BI = cast(0 as decimal(18,2)), 
		R_KgLump_BI = cast(0 as decimal(18,2)), 
		R_KgTBS_BI = cast(0 as decimal(18,2)),
		R_KgBrondol_BI =  cast(0 as decimal(18,2)),
		R_JumlahTandan_BI = cast(0 as decimal(18,2)),
		R_JumlahPohon_BI = cast(0 as decimal(18,2)),
		R_KgPucuk_BI = cast(0 as decimal(18,2)),
		R_PanenLainnya_BI = cast(0 as decimal(18,2)),
		R_JumlahHK_BI = cast(0 as decimal(18,2)),
		R_HaJelajah_BI = cast(0 as decimal(18,2)),
		R_RpGaji_BI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_HasilLainnya_BI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		R_KgLateks_SBI = cast(case when A.kodebud1='00' and SUBSTRING(A.norek,1,3)='602' then A.hslpanen else 0 end as decimal(18,2)), 
		R_KgLump_SBI = cast(case when A.kodebud1='00' and SUBSTRING(A.norek,1,3)='602' then A.hslpanenlump else 0 end as decimal(18,2)), 
		R_KgTBS_SBI = cast(case when A.kodebud1='01' and SUBSTRING(A.norek,1,3)='602' and A.kdpanen='1' then A.hslpanen else 0 end as decimal(18,2)),
		R_KgBrondol_SBI =  cast(case when A.kodebud1='01' and SUBSTRING(A.norek,1,3)='602' and A.kdpanen='2' then A.hslpanen else 0 end as decimal(18,2)),
		R_JumlahTandan_SBI = cast(case when A.kodebud1='01' and SUBSTRING(A.norek,1,3)='602' then A.hslpanenTBS else 0 end as decimal(18,2)),
		R_JumlahPohon_SBI = cast(case when A.kodebud1='02' and SUBSTRING(A.norek,1,3)='602' then A.Jelajah else A.JumlahPohon end as decimal(18,2)),
		R_KgPucuk_SBI = cast(case when A.kodebud1='02' and SUBSTRING(A.norek,1,3)='602' then A.hslPanen else 0 end as decimal(18,2)),
		R_PanenLainnya_SBI = cast(case when A.kodebud1!='00' and A.kodebud1!='01' and A.kodebud1!='02' and SUBSTRING(A.norek,1,3)='602' then A.hslPanen else 0 end as decimal(18,2)),
		R_JumlahHK_SBI = cast(A.RealisasiJumlahHK as decimal(18,2)),
		R_HaJelajah_SBI = cast(case when A.kodebud1='02' and SUBSTRING(A.norek,1,3)='602' then A.JelajahMesin else A.Jelajah end as decimal(18,2)),
		R_RpGaji_SBI = cast(A.jmlupah as decimal(18,2)),
		R_HasilPemeliharaan_SBI = cast(case when SUBSTRING(A.norek,1,3)='601' then A.hslpemel else 0 end as decimal(18,2)),
		R_HasilLainnya_SBI = cast(case when SUBSTRING(A.norek,1,3)!='601' and SUBSTRING(A.norek,1,3)!='602' then A.hsllain2 else 0 end as decimal(18,2)),
		R_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_SBI = cast(0 as decimal(18,2)),
		A_KgLateks_BI = cast(0 as decimal(18,2)), 
		A_KgLump_BI = cast(0 as decimal(18,2)), 
		A_KgTBS_BI = cast(0 as decimal(18,2)), 
		A_KgBrondol_BI =  cast(0 as decimal(18,2)), 
		A_JumlahTandan_BI = cast(0 as decimal(18,2)), 
		A_JumlahPohon_BI = cast(0 as decimal(18,2)), 
		A_KgPucuk_BI = cast(0 as decimal(18,2)), 
		A_PanenLainnya_BI = cast(0 as decimal(18,2)), 
		A_JumlahHK_BI = cast(0 as decimal(18,2)), 
		A_HaJelajah_BI = cast(0 as decimal(18,2)), 
		A_RpGaji_BI = cast(0 as decimal(18,2)), 
		A_HasilPemeliharaan_BI = cast(0 as decimal(18,2)), 
		A_HasilLainnya_BI = cast(0 as decimal(18,2)), 
		A_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		A_KgLateks_SBI = cast(0 as decimal(18,2)), 
		A_KgLump_SBI = cast(0 as decimal(18,2)), 
		A_KgTBS_SBI = cast(0 as decimal(18,2)),
		A_KgBrondol_SBI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_SBI = cast(0 as decimal(18,2)),
		A_JumlahPohon_SBI = cast(0 as decimal(18,2)),
		A_KgPucuk_SBI = cast(0 as decimal(18,2)),
		A_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		A_JumlahHK_SBI = cast(0 as decimal(18,2)),
		A_HaJelajah_SBI = cast(0 as decimal(18,2)),
		A_RpGaji_SBI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_SBI = cast(0 as decimal(18,2))
		FROM #a as A
		where A.KMK='01' or A.KMK is null

	insert into #e
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then A.kodeunit 
				when @Layer='Afdeling' then A.kodeunit+A.kodeafd1 
				else A.kodeunit+A.kodeafd1+A.kdblok 
			end,
		TahunTanam = A.thntnm,
		KodeBudidaya = A.kodebud1,
		GroupMesin = A.grup,
		
		A_KgLateks_BI = cast(0 as decimal(18,2)), 
		A_KgLump_BI = cast(0 as decimal(18,2)), 
		A_KgTBS_BI = cast(0 as decimal(18,2)),
		A_KgBrondol_BI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_BI = cast(0 as decimal(18,2)),
		A_JumlahPohon_BI = cast(0 as decimal(18,2)),
		A_KgPucuk_BI = cast(0 as decimal(18,2)),
		A_PanenLainnya_BI = cast(0 as decimal(18,2)),
		A_JumlahHK_BI = cast(0 as decimal(18,2)),
		A_HaJelajah_BI = cast(0 as decimal(18,2)),
		A_RpGaji_BI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_HasilLainnya_BI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		A_KgLateks_SBI = cast(case when A.kodebud1='00' and SUBSTRING(A.norek,1,3)='602' then A.hslpanen else 0 end as decimal(18,2)), 
		A_KgLump_SBI = cast(case when A.kodebud1='00' and SUBSTRING(A.norek,1,3)='602' then A.hslpanenlump else 0 end as decimal(18,2)), 
		A_KgTBS_SBI = cast(case when A.kodebud1='01' and SUBSTRING(A.norek,1,3)='602' and A.kdpanen='1' then A.hslpanen else 0 end as decimal(18,2)),
		A_KgBrondol_SBI =  cast(case when A.kodebud1='01' and SUBSTRING(A.norek,1,3)='602' and A.kdpanen='2' then A.hslpanen else 0 end as decimal(18,2)),
		A_JumlahTandan_SBI = cast(case when A.kodebud1='01' and SUBSTRING(A.norek,1,3)='602' then A.hslpanenTBS else 0 end as decimal(18,2)),
		A_JumlahPohon_SBI = cast(case when A.kodebud1='02' and SUBSTRING(A.norek,1,3)='602' then A.Jelajah else A.JumlahPohon end as decimal(18,2)),
		A_KgPucuk_SBI = cast(case when A.kodebud1='02' and SUBSTRING(A.norek,1,3)='602' then A.hslPanen else 0 end as decimal(18,2)),
		A_PanenLainnya_SBI = cast(case when A.kodebud1!='00' and A.kodebud1!='01' and A.kodebud1!='02' and SUBSTRING(A.norek,1,3)='602' then A.hslPanen else 0 end as decimal(18,2)),
		A_JumlahHK_SBI = cast(A.RealisasiJumlahHK as decimal(18,2)),
		A_HaJelajah_SBI = cast(case when A.kodebud1='02' and SUBSTRING(A.norek,1,3)='602' then A.JelajahMesin else A.Jelajah end as decimal(18,2)),
		A_RpGaji_SBI = cast(A.jmlupah as decimal(18,2)),
		A_HasilPemeliharaan_SBI = cast(case when SUBSTRING(A.norek,1,3)='601' then A.hslpemel else 0 end as decimal(18,2)),
		A_HasilLainnya_SBI = cast(case when SUBSTRING(A.norek,1,3)!='601' and SUBSTRING(A.norek,1,3)!='602' then A.hsllain2 else 0 end as decimal(18,2)),
		A_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_SBI = cast(0 as decimal(18,2)),
		
		R_KgLateks_BI = cast(0 as decimal(18,2)), 
		R_KgLump_BI = cast(0 as decimal(18,2)), 
		R_KgTBS_BI = cast(0 as decimal(18,2)), 
		R_KgBrondol_BI =  cast(0 as decimal(18,2)), 
		R_JumlahTandan_BI = cast(0 as decimal(18,2)), 
		R_JumlahPohon_BI = cast(0 as decimal(18,2)), 
		R_KgPucuk_BI = cast(0 as decimal(18,2)), 
		R_PanenLainnya_BI = cast(0 as decimal(18,2)), 
		R_JumlahHK_BI = cast(0 as decimal(18,2)), 
		R_HaJelajah_BI = cast(0 as decimal(18,2)), 
		R_RpGaji_BI = cast(0 as decimal(18,2)), 
		R_HasilPemeliharaan_BI = cast(0 as decimal(18,2)), 
		R_HasilLainnya_BI = cast(0 as decimal(18,2)), 
		R_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		R_KgLateks_SBI = cast(0 as decimal(18,2)), 
		R_KgLump_SBI = cast(0 as decimal(18,2)), 
		R_KgTBS_SBI = cast(0 as decimal(18,2)),
		R_KgBrondol_SBI =  cast(0 as decimal(18,2)),
		R_JumlahTandan_SBI = cast(0 as decimal(18,2)),
		R_JumlahPohon_SBI = cast(0 as decimal(18,2)),
		R_KgPucuk_SBI = cast(0 as decimal(18,2)),
		R_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		R_JumlahHK_SBI = cast(0 as decimal(18,2)),
		R_HaJelajah_SBI = cast(0 as decimal(18,2)),
		R_RpGaji_SBI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_SBI = cast(0 as decimal(18,2))
		
		FROM #a as A
		where A.KMK='02' 



	insert into #e
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then B.kodeunit 
				when @Layer='Afdeling' then B.kodeunit+B.kodeafd 
				else B.kodeunit+B.kodeafd+B.kdblok 
			end,
		TahunTanam = B.thntnm,
		KodeBudidaya = B.kodebud,
		GroupMesin = '',
		R_KgLateks_BI = case when B.kodebud='00' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end, 
		R_KgLump_BI = 0, 
		R_KgTBS_BI = case when B.kodebud='01' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end,
		R_KgBrondol_BI =  0,
		R_JumlahTandan_BI = 0,
		R_JumlahPohon_BI = 0,
		R_KgPucuk_BI = case when B.kodebud='02' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end,
		R_PanenLainnya_BI = case when B.kodebud!='00' and B.kodebud!='01' and B.kodebud!='02' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end,
		R_JumlahHK_BI = B.RealisasiJumlahHK,
		R_HaJelajah_BI = 0,
		R_RpGaji_BI = B.nilai,
		R_HasilPemeliharaan_BI = case when SUBSTRING(B.norek,1,3)='601' then B.jmlhasil else 0 end,
		R_HasilLainnya_BI = case when SUBSTRING(B.norek,1,3)!='601' and SUBSTRING(B.norek,1,3)!='602' then B.jmlhasil else 0 end,
		R_RKAPKgLateks_BI = 0,
		R_RKAPKgTBS_BI = 0,
		R_RKAPKgPucuk_BI = 0,
        R_RKAPPanenLainnya_BI = 0,
        R_RKAPJumlahHK_BI = 0, 
        R_RKAPRpGaji_BI = 0, 
		R_RKAPHasilPemeliharaan_BI = 0,
		R_RKAPHasilLainnya_BI = 0,
        R_PKBKgLateks_BI = 0, 
        R_PKBKgTBS_BI = 0,
        R_PKBKgPucuk_BI = 0,
        R_PKBPanenLainnya_BI = 0,
        R_PKBJumlahHK_BI = 0, 
        R_PKBRpGaji_BI = 0,
		R_PKBHasilPemeliharaan_BI = 0,
		R_PKBHasilLainnya_BI = 0,
		R_KgLateks_SBI = cast(0 as decimal(18,2)), 
		R_KgLump_SBI = cast(0 as decimal(18,2)), 
		R_KgTBS_SBI = cast(0 as decimal(18,2)),
		R_KgBrondol_SBI =  cast(0 as decimal(18,2)),
		R_JumlahTandan_SBI = cast(0 as decimal(18,2)),
		R_JumlahPohon_SBI = cast(0 as decimal(18,2)),
		R_KgPucuk_SBI = cast(0 as decimal(18,2)),
		R_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		R_JumlahHK_SBI = cast(0 as decimal(18,2)),
		R_HaJelajah_SBI = cast(0 as decimal(18,2)),
		R_RpGaji_SBI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_SBI = cast(0 as decimal(18,2)),
		A_KgLateks_BI = cast(0 as decimal(18,2)), 
		A_KgLump_BI = cast(0 as decimal(18,2)), 
		A_KgTBS_BI = cast(0 as decimal(18,2)), 
		A_KgBrondol_BI =  cast(0 as decimal(18,2)), 
		A_JumlahTandan_BI = cast(0 as decimal(18,2)), 
		A_JumlahPohon_BI = cast(0 as decimal(18,2)), 
		A_KgPucuk_BI = cast(0 as decimal(18,2)), 
		A_PanenLainnya_BI = cast(0 as decimal(18,2)), 
		A_JumlahHK_BI = cast(0 as decimal(18,2)), 
		A_HaJelajah_BI = cast(0 as decimal(18,2)), 
		A_RpGaji_BI = cast(0 as decimal(18,2)), 
		A_HasilPemeliharaan_BI = cast(0 as decimal(18,2)), 
		A_HasilLainnya_BI = cast(0 as decimal(18,2)), 
		A_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		A_KgLateks_SBI = cast(0 as decimal(18,2)), 
		A_KgLump_SBI = cast(0 as decimal(18,2)), 
		A_KgTBS_SBI = cast(0 as decimal(18,2)),
		A_KgBrondol_SBI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_SBI = cast(0 as decimal(18,2)),
		A_JumlahPohon_SBI = cast(0 as decimal(18,2)),
		A_KgPucuk_SBI = cast(0 as decimal(18,2)),
		A_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		A_JumlahHK_SBI = cast(0 as decimal(18,2)),
		A_HaJelajah_SBI = cast(0 as decimal(18,2)),
		A_RpGaji_SBI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_SBI = cast(0 as decimal(18,2))
		FROM #b as B
		WHERE B.bulan=@BulanAkhir and b.tahun=@TahunAkhir and (B.KMK='01' or B.KMK is null)

	insert into #e
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then B.kodeunit 
				when @Layer='Afdeling' then B.kodeunit+B.kodeafd 
				else B.kodeunit+B.kodeafd+B.kdblok 
			end,
		TahunTanam = B.thntnm,
		KodeBudidaya = B.kodebud,
		GroupMesin = '',
		A_KgLateks_BI = case when B.kodebud='00' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end, 
		A_KgLump_BI = 0, 
		A_KgTBS_BI = case when B.kodebud='01' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end,
		A_KgBrondol_BI =  0,
		A_JumlahTandan_BI = 0,
		A_JumlahPohon_BI = 0,
		A_KgPucuk_BI = case when B.kodebud='02' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end,
		A_PanenLainnya_BI = case when B.kodebud!='00' and B.kodebud!='01' and B.kodebud!='02' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end,
		A_JumlahHK_BI = B.RealisasiJumlahHK,
		A_HaJelajah_BI = 0,
		A_RpGaji_BI = B.nilai,
		A_HasilPemeliharaan_BI = case when SUBSTRING(B.norek,1,3)='601' then B.jmlhasil else 0 end,
		A_HasilLainnya_BI = case when SUBSTRING(B.norek,1,3)!='601' and SUBSTRING(B.norek,1,3)!='602' then B.jmlhasil else 0 end,
		A_RKAPKgLateks_BI = 0,
		A_RKAPKgTBS_BI = 0,
		A_RKAPKgPucuk_BI = 0,
        A_RKAPPanenLainnya_BI = 0,
        A_RKAPJumlahHK_BI = 0, 
        A_RKAPRpGaji_BI = 0, 
		A_RKAPHasilPemeliharaan_BI = 0,
		A_RKAPHasilLainnya_BI = 0,
        A_PKBKgLateks_BI = 0, 
        A_PKBKgTBS_BI = 0,
        A_PKBKgPucuk_BI = 0,
        A_PKBPanenLainnya_BI = 0,
        A_PKBJumlahHK_BI = 0, 
        A_PKBRpGaji_BI = 0,
		A_PKBHasilPemeliharaan_BI = 0,
		A_PKBHasilLainnya_BI = 0,
		A_KgLateks_SBI = cast(0 as decimal(18,2)), 
		A_KgLump_SBI = cast(0 as decimal(18,2)), 
		A_KgTBS_SBI = cast(0 as decimal(18,2)),
		A_KgBrondol_SBI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_SBI = cast(0 as decimal(18,2)),
		A_JumlahPohon_SBI = cast(0 as decimal(18,2)),
		A_KgPucuk_SBI = cast(0 as decimal(18,2)),
		A_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		A_JumlahHK_SBI = cast(0 as decimal(18,2)),
		A_HaJelajah_SBI = cast(0 as decimal(18,2)),
		A_RpGaji_SBI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_SBI = cast(0 as decimal(18,2)),
		R_KgLateks_BI = cast(0 as decimal(18,2)), 
		R_KgLump_BI = cast(0 as decimal(18,2)), 
		R_KgTBS_BI = cast(0 as decimal(18,2)), 
		R_KgBrondol_BI =  cast(0 as decimal(18,2)), 
		R_JumlahTandan_BI = cast(0 as decimal(18,2)), 
		R_JumlahPohon_BI = cast(0 as decimal(18,2)), 
		R_KgPucuk_BI = cast(0 as decimal(18,2)), 
		R_PanenLainnya_BI = cast(0 as decimal(18,2)), 
		R_JumlahHK_BI = cast(0 as decimal(18,2)), 
		R_HaJelajah_BI = cast(0 as decimal(18,2)), 
		R_RpGaji_BI = cast(0 as decimal(18,2)), 
		R_HasilPemeliharaan_BI = cast(0 as decimal(18,2)), 
		R_HasilLainnya_BI = cast(0 as decimal(18,2)), 
		R_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		R_KgLateks_SBI = cast(0 as decimal(18,2)), 
		R_KgLump_SBI = cast(0 as decimal(18,2)), 
		R_KgTBS_SBI = cast(0 as decimal(18,2)),
		R_KgBrondol_SBI =  cast(0 as decimal(18,2)),
		R_JumlahTandan_SBI = cast(0 as decimal(18,2)),
		R_JumlahPohon_SBI = cast(0 as decimal(18,2)),
		R_KgPucuk_SBI = cast(0 as decimal(18,2)),
		R_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		R_JumlahHK_SBI = cast(0 as decimal(18,2)),
		R_HaJelajah_SBI = cast(0 as decimal(18,2)),
		R_RpGaji_SBI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_SBI = cast(0 as decimal(18,2))
		FROM #b as B
		WHERE B.bulan=@BulanAkhir and b.tahun=@TahunAkhir and (B.KMK='02')


	insert into #e
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then B.kodeunit 
				when @Layer='Afdeling' then B.kodeunit+B.kodeafd 
				else B.kodeunit+B.kodeafd+B.kdblok 
			end,
		TahunTanam = B.thntnm,
		KodeBudidaya = B.kodebud,
		GroupMesin = '',
		R_KgLateks_BI = cast(0 as decimal(18,2)), 
		R_KgLump_BI = cast(0 as decimal(18,2)), 
		R_KgTBS_BI = cast(0 as decimal(18,2)),
		R_KgBrondol_BI =  cast(0 as decimal(18,2)),
		R_JumlahTandan_BI = cast(0 as decimal(18,2)),
		R_JumlahPohon_BI = cast(0 as decimal(18,2)),
		R_KgPucuk_BI = cast(0 as decimal(18,2)),
		R_PanenLainnya_BI = cast(0 as decimal(18,2)),
		R_JumlahHK_BI = cast(0 as decimal(18,2)),
		R_HaJelajah_BI = cast(0 as decimal(18,2)),
		R_RpGaji_BI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_HasilLainnya_BI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		R_KgLateks_SBI = case when B.kodebud='00' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end, 
		R_KgLump_SBI = 0, 
		R_KgTBS_SBI = case when B.kodebud='01' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end,
		R_KgBrondol_SBI =  0,
		R_JumlahTandan_SBI = 0,
		R_JumlahPohon_SBI = 0,
		R_KgPucuk_SBI = case when B.kodebud='02' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end,
		R_PanenLainnya_SBI = case when B.kodebud!='00' and B.kodebud!='01' and B.kodebud!='02' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end,
		R_JumlahHK_SBI = B.RealisasiJumlahHK,
		R_HaJelajah_SBI = 0,
		R_RpGaji_SBI = B.nilai,
		R_HasilPemeliharaan_SBI = case when SUBSTRING(B.norek,1,3)='601' then B.jmlhasil else 0 end,
		R_HasilLainnya_SBI = case when SUBSTRING(B.norek,1,3)!='601' and SUBSTRING(B.norek,1,3)!='602' then B.jmlhasil else 0 end,
		R_RKAPKgLateks_SBI = 0,
		R_RKAPKgTBS_SBI = 0,
		R_RKAPKgPucuk_SBI = 0,
        R_RKAPPanenLainnya_SBI = 0,
        R_RKAPJumlahHK_SBI = 0, 
        R_RKAPRpGaji_SBI = 0, 
		R_RKAPHasilPemeliharaan_SBI = 0,
		R_RKAPHasilLainnya_SBI = 0,
        R_PKBKgLateks_SBI = 0, 
        R_PKBKgTBS_SBI = 0,
        R_PKBKgPucuk_SBI = 0,
        R_PKBPanenLainnya_SBI = 0,
        R_PKBJumlahHK_SBI = 0, 
        R_PKBRpGaji_SBI = 0,
		R_PKBHasilPemeliharaan_SBI = 0,
		R_PKBHasilLainnya_SBI = 0,
		
		A_KgLateks_BI = cast(0 as decimal(18,2)), 
		A_KgLump_BI = cast(0 as decimal(18,2)), 
		A_KgTBS_BI = cast(0 as decimal(18,2)), 
		A_KgBrondol_BI =  cast(0 as decimal(18,2)), 
		A_JumlahTandan_BI = cast(0 as decimal(18,2)), 
		A_JumlahPohon_BI = cast(0 as decimal(18,2)), 
		A_KgPucuk_BI = cast(0 as decimal(18,2)), 
		A_PanenLainnya_BI = cast(0 as decimal(18,2)), 
		A_JumlahHK_BI = cast(0 as decimal(18,2)), 
		A_HaJelajah_BI = cast(0 as decimal(18,2)), 
		A_RpGaji_BI = cast(0 as decimal(18,2)), 
		A_HasilPemeliharaan_BI = cast(0 as decimal(18,2)), 
		A_HasilLainnya_BI = cast(0 as decimal(18,2)), 
		A_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		A_KgLateks_SBI = cast(0 as decimal(18,2)), 
		A_KgLump_SBI = cast(0 as decimal(18,2)), 
		A_KgTBS_SBI = cast(0 as decimal(18,2)),
		A_KgBrondol_SBI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_SBI = cast(0 as decimal(18,2)),
		A_JumlahPohon_SBI = cast(0 as decimal(18,2)),
		A_KgPucuk_SBI = cast(0 as decimal(18,2)),
		A_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		A_JumlahHK_SBI = cast(0 as decimal(18,2)),
		A_HaJelajah_SBI = cast(0 as decimal(18,2)),
		A_RpGaji_SBI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_SBI = cast(0 as decimal(18,2))
		FROM #b as B
		where B.KMK='01' or B.KMK is null

	insert into #e
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then B.kodeunit 
				when @Layer='Afdeling' then B.kodeunit+B.kodeafd 
				else B.kodeunit+B.kodeafd+B.kdblok 
			end,
		TahunTanam = B.thntnm,
		KodeBudidaya = B.kodebud,
		GroupMesin = '',

		R_KgLateks_BI = cast(0 as decimal(18,2)), 
		R_KgLump_BI = cast(0 as decimal(18,2)), 
		R_KgTBS_BI = cast(0 as decimal(18,2)),
		R_KgBrondol_BI =  cast(0 as decimal(18,2)),
		R_JumlahTandan_BI = cast(0 as decimal(18,2)),
		R_JumlahPohon_BI = cast(0 as decimal(18,2)),
		R_KgPucuk_BI = cast(0 as decimal(18,2)),
		R_PanenLainnya_BI = cast(0 as decimal(18,2)),
		R_JumlahHK_BI = cast(0 as decimal(18,2)),
		R_HaJelajah_BI = cast(0 as decimal(18,2)),
		R_RpGaji_BI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_HasilLainnya_BI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		R_KgLateks_SBI = cast(0 as decimal(18,2)),
		R_KgLump_SBI = 0, 
		R_KgTBS_SBI = cast(0 as decimal(18,2)),
		R_KgBrondol_SBI =  0,
		R_JumlahTandan_SBI = 0,
		R_JumlahPohon_SBI = 0,
		R_KgPucuk_SBI = cast(0 as decimal(18,2)),
		R_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		R_JumlahHK_SBI = cast(0 as decimal(18,2)),
		R_HaJelajah_SBI = 0,
		R_RpGaji_SBI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_SBI = 0,
		R_RKAPKgTBS_SBI = 0,
		R_RKAPKgPucuk_SBI = 0,
        R_RKAPPanenLainnya_SBI = 0,
        R_RKAPJumlahHK_SBI = 0, 
        R_RKAPRpGaji_SBI = 0, 
		R_RKAPHasilPemeliharaan_SBI = 0,
		R_RKAPHasilLainnya_SBI = 0,
        R_PKBKgLateks_SBI = 0, 
        R_PKBKgTBS_SBI = 0,
        R_PKBKgPucuk_SBI = 0,
        R_PKBPanenLainnya_SBI = 0,
        R_PKBJumlahHK_SBI = 0, 
        R_PKBRpGaji_SBI = 0,
		R_PKBHasilPemeliharaan_SBI = 0,
		R_PKBHasilLainnya_SBI = 0,
		A_KgLateks_BI = cast(0 as decimal(18,2)), 
		A_KgLump_BI = cast(0 as decimal(18,2)), 
		A_KgTBS_BI = cast(0 as decimal(18,2)),
		A_KgBrondol_BI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_BI = cast(0 as decimal(18,2)),
		A_JumlahPohon_BI = cast(0 as decimal(18,2)),
		A_KgPucuk_BI = cast(0 as decimal(18,2)),
		A_PanenLainnya_BI = cast(0 as decimal(18,2)),
		A_JumlahHK_BI = cast(0 as decimal(18,2)),
		A_HaJelajah_BI = cast(0 as decimal(18,2)),
		A_RpGaji_BI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_HasilLainnya_BI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		A_KgLateks_SBI = case when B.kodebud='00' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end, 
		A_KgLump_SBI = 0, 
		A_KgTBS_SBI = case when B.kodebud='01' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end,
		A_KgBrondol_SBI =  0,
		A_JumlahTandan_SBI = 0,
		A_JumlahPohon_SBI = 0,
		A_KgPucuk_SBI = case when B.kodebud='02' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end,
		A_PanenLainnya_SBI = case when B.kodebud!='00' and B.kodebud!='01' and B.kodebud!='02' and SUBSTRING(B.norek,1,3)='602' then B.jmlhasil else 0 end,
		A_JumlahHK_SBI = B.RealisasiJumlahHK,
		A_HaJelajah_SBI = 0,
		A_RpGaji_SBI = B.nilai,
		A_HasilPemeliharaan_SBI = case when SUBSTRING(B.norek,1,3)='601' then B.jmlhasil else 0 end,
		A_HasilLainnya_SBI = case when SUBSTRING(B.norek,1,3)!='601' and SUBSTRING(B.norek,1,3)!='602' then B.jmlhasil else 0 end,
		A_RKAPKgLateks_SBI = 0,
		A_RKAPKgTBS_SBI = 0,
		A_RKAPKgPucuk_SBI = 0,
        A_RKAPPanenLainnya_SBI = 0,
        A_RKAPJumlahHK_SBI = 0, 
        A_RKAPRpGaji_SBI = 0, 
		A_RKAPHasilPemeliharaan_SBI = 0,
		A_RKAPHasilLainnya_SBI = 0,
        A_PKBKgLateks_SBI = 0, 
        A_PKBKgTBS_SBI = 0,
        A_PKBKgPucuk_SBI = 0,
        A_PKBPanenLainnya_SBI = 0,
        A_PKBJumlahHK_SBI = 0, 
        A_PKBRpGaji_SBI = 0,
		A_PKBHasilPemeliharaan_SBI = 0,
		A_PKBHasilLainnya_SBI = 0
		FROM #b as B
		where B.KMK='02'

	insert into #e
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then C.kodeunit 
				when @Layer='Afdeling' then C.kodeunit+C.kodeafd 
				else C.kodeunit+C.kodeafd+C.kdblok 
			end,
		TahunTanam = C.thntnm,
		KodeBudidaya = C.kodebud,
		GroupMesin = '',
		R_KgLateks_BI = case when C.kodebud='00' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end, 
		R_KgLump_BI = 0, 
		R_KgTBS_BI = case when C.kodebud='01' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end,
		R_KgBrondol_BI =  0,
		R_JumlahTandan_BI = 0,
		R_JumlahPohon_BI = 0,
		R_KgPucuk_BI = case when C.kodebud='02' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end,
		R_PanenLainnya_BI = case when C.kodebud!='00' and C.kodebud!='01' and C.kodebud!='02' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end,
		R_JumlahHK_BI = C.RealisasiJumlahHK,
		R_HaJelajah_BI = 0,
		R_RpGaji_BI = C.jmlupah,
		R_HasilPemeliharaan_BI = case when SUBSTRING(C.norek,1,3)='601' then C.jmlhasil else 0 end,
		R_HasilLainnya_BI = case when SUBSTRING(C.norek,1,3)!='601' and SUBSTRING(C.norek,1,3)!='602' then C.jmlhasil else 0 end,
		R_RKAPKgLateks_BI = 0,
		R_RKAPKgTBS_BI = 0,
		R_RKAPKgPucuk_BI = 0,
        R_RKAPPanenLainnya_BI = 0,
        R_RKAPJumlahHK_BI = 0, 
        R_RKAPRpGaji_BI = 0, 
        R_RKAPHasilPemeliharaan_BI = 0,
		R_RKAPHasilLainnya_BI = 0,
        R_PKBKgLateks_BI = 0, 
        R_PKBKgTBS_BI = 0,
        R_PKBKgPucuk_BI = 0,
        R_PKBPanenLainnya_BI = 0,
        R_PKBJumlahHK_BI = 0, 
        R_PKBRpGaji_BI = 0,
		R_PKBHasilPemeliharaan_BI = 0,
		R_PKBHasilLainnya_BI = 0,
		R_KgLateks_SBI = cast(0 as decimal(18,2)), 
		R_KgLump_SBI = cast(0 as decimal(18,2)), 
		R_KgTBS_SBI = cast(0 as decimal(18,2)),
		R_KgBrondol_SBI =  cast(0 as decimal(18,2)),
		R_JumlahTandan_SBI = cast(0 as decimal(18,2)),
		R_JumlahPohon_SBI = cast(0 as decimal(18,2)),
		R_KgPucuk_SBI = cast(0 as decimal(18,2)),
		R_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		R_JumlahHK_SBI = cast(0 as decimal(18,2)),
		R_HaJelajah_SBI = cast(0 as decimal(18,2)),
		R_RpGaji_SBI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_SBI = cast(0 as decimal(18,2)),
		A_KgLateks_BI = cast(0 as decimal(18,2)), 
		A_KgLump_BI = cast(0 as decimal(18,2)), 
		A_KgTBS_BI = cast(0 as decimal(18,2)),
		A_KgBrondol_BI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_BI = cast(0 as decimal(18,2)),
		A_JumlahPohon_BI = cast(0 as decimal(18,2)),
		A_KgPucuk_BI = cast(0 as decimal(18,2)),
		A_PanenLainnya_BI = cast(0 as decimal(18,2)),
		A_JumlahHK_BI = cast(0 as decimal(18,2)),
		A_HaJelajah_BI = cast(0 as decimal(18,2)),
		A_RpGaji_BI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_HasilLainnya_BI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		A_KgLateks_SBI = 0, 
		A_KgLump_SBI = 0, 
		A_KgTBS_SBI = 0,
		A_KgBrondol_SBI =  0,
		A_JumlahTandan_SBI = 0,
		A_JumlahPohon_SBI = 0,
		A_KgPucuk_SBI = 0,
		A_PanenLainnya_SBI = 0,
		A_JumlahHK_SBI = 0,
		A_HaJelajah_SBI = 0,
		A_RpGaji_SBI = 0,
		A_HasilPemeliharaan_SBI = 0,
		A_HasilLainnya_SBI = 0,
		A_RKAPKgLateks_SBI = 0,
		A_RKAPKgTBS_SBI = 0,
		A_RKAPKgPucuk_SBI = 0,
        A_RKAPPanenLainnya_SBI = 0,
        A_RKAPJumlahHK_SBI = 0, 
        A_RKAPRpGaji_SBI = 0, 
		A_RKAPHasilPemeliharaan_SBI = 0,
		A_RKAPHasilLainnya_SBI = 0,
        A_PKBKgLateks_SBI = 0, 
        A_PKBKgTBS_SBI = 0,
        A_PKBKgPucuk_SBI = 0,
        A_PKBPanenLainnya_SBI = 0,
        A_PKBJumlahHK_SBI = 0, 
        A_PKBRpGaji_SBI = 0,
		A_PKBHasilPemeliharaan_SBI = 0,
		A_PKBHasilLainnya_SBI = 0
		FROM #c as C	  
		WHERE C.bulan=@BulanAkhir and C.tahun=@TahunAkhir and (C.KMK='01' or C.KMK is null)    
		

	insert into #e
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then C.kodeunit 
				when @Layer='Afdeling' then C.kodeunit+C.kodeafd 
				else C.kodeunit+C.kodeafd+C.kdblok 
			end,
		TahunTanam = C.thntnm,
		KodeBudidaya = C.kodebud,
		GroupMesin = '',

		R_KgLateks_BI = cast(0 as decimal(18,2)), 
		R_KgLump_BI = cast(0 as decimal(18,2)), 
		R_KgTBS_BI = cast(0 as decimal(18,2)),
		R_KgBrondol_BI =  cast(0 as decimal(18,2)),
		R_JumlahTandan_BI = cast(0 as decimal(18,2)),
		R_JumlahPohon_BI = cast(0 as decimal(18,2)),
		R_KgPucuk_BI = cast(0 as decimal(18,2)),
		R_PanenLainnya_BI = cast(0 as decimal(18,2)),
		R_JumlahHK_BI = cast(0 as decimal(18,2)),
		R_HaJelajah_BI = cast(0 as decimal(18,2)),
		R_RpGaji_BI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_HasilLainnya_BI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		R_KgLateks_SBI = cast(0 as decimal(18,2)),
		R_KgLump_SBI = 0, 
		R_KgTBS_SBI = cast(0 as decimal(18,2)),
		R_KgBrondol_SBI =  0,
		R_JumlahTandan_SBI = 0,
		R_JumlahPohon_SBI = 0,
		R_KgPucuk_SBI = cast(0 as decimal(18,2)),
		R_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		R_JumlahHK_SBI = cast(0 as decimal(18,2)),
		R_HaJelajah_SBI = 0,
		R_RpGaji_SBI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_SBI = 0,
		R_RKAPKgTBS_SBI = 0,
		R_RKAPKgPucuk_SBI = 0,
        R_RKAPPanenLainnya_SBI = 0,
        R_RKAPJumlahHK_SBI = 0, 
        R_RKAPRpGaji_SBI = 0, 
		R_RKAPHasilPemeliharaan_SBI = 0,
		R_RKAPHasilLainnya_SBI = 0,
        R_PKBKgLateks_SBI = 0, 
        R_PKBKgTBS_SBI = 0,
        R_PKBKgPucuk_SBI = 0,
        R_PKBPanenLainnya_SBI = 0,
        R_PKBJumlahHK_SBI = 0, 
        R_PKBRpGaji_SBI = 0,
		R_PKBHasilPemeliharaan_SBI = 0,
		R_PKBHasilLainnya_SBI = 0,

		A_KgLateks_BI = case when C.kodebud='00' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end, 
		A_KgLump_BI = 0, 
		A_KgTBS_BI = case when C.kodebud='01' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end,
		A_KgBrondol_BI =  0,
		A_JumlahTandan_BI = 0,
		A_JumlahPohon_BI = 0,
		A_KgPucuk_BI = case when C.kodebud='02' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end,
		A_PanenLainnya_BI = case when C.kodebud!='00' and C.kodebud!='01' and C.kodebud!='02' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end,
		A_JumlahHK_BI = C.RealisasiJumlahHK,
		A_HaJelajah_BI = 0,
		A_RpGaji_BI = C.jmlupah,
		A_HasilPemeliharaan_BI = case when SUBSTRING(C.norek,1,3)='601' then C.jmlhasil else 0 end,
		A_HasilLainnya_BI = case when SUBSTRING(C.norek,1,3)!='601' and SUBSTRING(C.norek,1,3)!='602' then C.jmlhasil else 0 end,
		A_RKAPKgLateks_BI = 0,
		A_RKAPKgTBS_BI = 0,
		A_RKAPKgPucuk_BI = 0,
        A_RKAPPanenLainnya_BI = 0,
        A_RKAPJumlahHK_BI = 0, 
        A_RKAPRpGaji_BI = 0, 
        A_RKAPHasilPemeliharaan_BI = 0,
		A_RKAPHasilLainnya_BI = 0,
        A_PKBKgLateks_BI = 0, 
        A_PKBKgTBS_BI = 0,
        A_PKBKgPucuk_BI = 0,
        A_PKBPanenLainnya_BI = 0,
        A_PKBJumlahHK_BI = 0, 
        A_PKBRpGaji_BI = 0,
		A_PKBHasilPemeliharaan_BI = 0,
		A_PKBHasilLainnya_BI = 0,
		A_KgLateks_SBI = cast(0 as decimal(18,2)), 
		A_KgLump_SBI = cast(0 as decimal(18,2)), 
		A_KgTBS_SBI = cast(0 as decimal(18,2)),
		A_KgBrondol_SBI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_SBI = cast(0 as decimal(18,2)),
		A_JumlahPohon_SBI = cast(0 as decimal(18,2)),
		A_KgPucuk_SBI = cast(0 as decimal(18,2)),
		A_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		A_JumlahHK_SBI = cast(0 as decimal(18,2)),
		A_HaJelajah_SBI = cast(0 as decimal(18,2)),
		A_RpGaji_SBI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_SBI = cast(0 as decimal(18,2))
		FROM #c as C	  
		WHERE C.bulan=@BulanAkhir and C.tahun=@TahunAkhir and C.KMK='02' 
		

	insert into #e
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then C.kodeunit 
				when @Layer='Afdeling' then C.kodeunit+C.kodeafd 
				else C.kodeunit+C.kodeafd+C.kdblok 
			end,
		TahunTanam = C.thntnm,
		KodeBudidaya = C.kodebud,
		GroupMesin = '',
		R_KgLateks_BI = cast(0 as decimal(18,2)), 
		R_KgLump_BI = cast(0 as decimal(18,2)), 
		R_KgTBS_BI = cast(0 as decimal(18,2)),
		R_KgBrondol_BI =  cast(0 as decimal(18,2)),
		R_JumlahTandan_BI = cast(0 as decimal(18,2)),
		R_JumlahPohon_BI = cast(0 as decimal(18,2)),
		R_KgPucuk_BI = cast(0 as decimal(18,2)),
		R_PanenLainnya_BI = cast(0 as decimal(18,2)),
		R_JumlahHK_BI = cast(0 as decimal(18,2)),
		R_HaJelajah_BI = cast(0 as decimal(18,2)),
		R_RpGaji_BI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_HasilLainnya_BI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		R_KgLateks_SBI = case when C.kodebud='00' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end, 
		R_KgLump_SBI = 0, 
		R_KgTBS_SBI = case when C.kodebud='01' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end,
		R_KgBrondol_SBI =  0,
		R_JumlahTandan_SBI = 0,
		R_JumlahPohon_SBI = 0,
		R_KgPucuk_SBI = case when C.kodebud='02' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end,
		R_PanenLainnya_SBI = case when C.kodebud!='00' and C.kodebud!='01' and C.kodebud!='02' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end,
		R_JumlahHK_SBI = C.RealisasiJumlahHK,
		R_HaJelajah_SBI = 0,
		R_RpGaji_SBI = C.jmlupah,
		R_HasilPemeliharaan_SBI = case when SUBSTRING(C.norek,1,3)='601' then C.jmlhasil else 0 end,
		R_HasilLainnya_SBI = case when SUBSTRING(C.norek,1,3)!='601' and SUBSTRING(C.norek,1,3)!='602' then C.jmlhasil else 0 end,
		R_RKAPKgLateks_SBI = 0,
		R_RKAPKgTBS_SBI = 0,
		R_RKAPKgPucuk_SBI = 0,
        R_RKAPPanenLainnya_SBI = 0,
        R_RKAPJumlahHK_SBI = 0, 
        R_RKAPRpGaji_SBI = 0, 
        R_RKAPHasilPemeliharaan_SBI = 0,
		R_RKAPHasilLainnya_SBI = 0,
        R_PKBKgLateks_SBI = 0, 
        R_PKBKgTBS_SBI = 0,
        R_PKBKgPucuk_SBI = 0,
        R_PKBPanenLainnya_SBI = 0,
        R_PKBJumlahHK_SBI = 0, 
        R_PKBRpGaji_SBI = 0,
		R_PKBHasilPemeliharaan_SBI = 0,
		R_PKBHasilLainnya_SBI = 0,
		A_KgLateks_BI = cast(0 as decimal(18,2)), 
		A_KgLump_BI = cast(0 as decimal(18,2)), 
		A_KgTBS_BI = cast(0 as decimal(18,2)),
		A_KgBrondol_BI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_BI = cast(0 as decimal(18,2)),
		A_JumlahPohon_BI = cast(0 as decimal(18,2)),
		A_KgPucuk_BI = cast(0 as decimal(18,2)),
		A_PanenLainnya_BI = cast(0 as decimal(18,2)),
		A_JumlahHK_BI = cast(0 as decimal(18,2)),
		A_HaJelajah_BI = cast(0 as decimal(18,2)),
		A_RpGaji_BI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_HasilLainnya_BI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		A_KgLateks_SBI = 0, 
		A_KgLump_SBI = 0, 
		A_KgTBS_SBI = 0,
		A_KgBrondol_SBI =  0,
		A_JumlahTandan_SBI = 0,
		A_JumlahPohon_SBI = 0,
		A_KgPucuk_SBI = 0,
		A_PanenLainnya_SBI = 0,
		A_JumlahHK_SBI = 0,
		A_HaJelajah_SBI = 0,
		A_RpGaji_SBI = 0,
		A_HasilPemeliharaan_SBI = 0,
		A_HasilLainnya_SBI = 0,
		A_RKAPKgLateks_SBI = 0,
		A_RKAPKgTBS_SBI = 0,
		A_RKAPKgPucuk_SBI = 0,
        A_RKAPPanenLainnya_SBI = 0,
        A_RKAPJumlahHK_SBI = 0, 
        A_RKAPRpGaji_SBI = 0, 
		A_RKAPHasilPemeliharaan_SBI = 0,
		A_RKAPHasilLainnya_SBI = 0,
        A_PKBKgLateks_SBI = 0, 
        A_PKBKgTBS_SBI = 0,
        A_PKBKgPucuk_SBI = 0,
        A_PKBPanenLainnya_SBI = 0,
        A_PKBJumlahHK_SBI = 0, 
        A_PKBRpGaji_SBI = 0,
		A_PKBHasilPemeliharaan_SBI = 0,
		A_PKBHasilLainnya_SBI = 0
		FROM #c as C	  
		where C.KMK='01' or C.KMK is null


	insert into #e
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then C.kodeunit 
				when @Layer='Afdeling' then C.kodeunit+C.kodeafd 
				else C.kodeunit+C.kodeafd+C.kdblok 
			end,
		TahunTanam = C.thntnm,
		KodeBudidaya = C.kodebud,
		GroupMesin = '',
		R_KgLateks_BI = cast(0 as decimal(18,2)), 
		R_KgLump_BI = cast(0 as decimal(18,2)), 
		R_KgTBS_BI = cast(0 as decimal(18,2)),
		R_KgBrondol_BI =  cast(0 as decimal(18,2)),
		R_JumlahTandan_BI = cast(0 as decimal(18,2)),
		R_JumlahPohon_BI = cast(0 as decimal(18,2)),
		R_KgPucuk_BI = cast(0 as decimal(18,2)),
		R_PanenLainnya_BI = cast(0 as decimal(18,2)),
		R_JumlahHK_BI = cast(0 as decimal(18,2)),
		R_HaJelajah_BI = cast(0 as decimal(18,2)),
		R_RpGaji_BI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_HasilLainnya_BI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		R_KgLateks_SBI = cast(0 as decimal(18,2)),
		R_KgLump_SBI = 0, 
		R_KgTBS_SBI = cast(0 as decimal(18,2)),
		R_KgBrondol_SBI =  0,
		R_JumlahTandan_SBI = 0,
		R_JumlahPohon_SBI = 0,
		R_KgPucuk_SBI = cast(0 as decimal(18,2)),
		R_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		R_JumlahHK_SBI = cast(0 as decimal(18,2)),
		R_HaJelajah_SBI = 0,
		R_RpGaji_SBI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_SBI = 0,
		R_RKAPKgTBS_SBI = 0,
		R_RKAPKgPucuk_SBI = 0,
        R_RKAPPanenLainnya_SBI = 0,
        R_RKAPJumlahHK_SBI = 0, 
        R_RKAPRpGaji_SBI = 0, 
		R_RKAPHasilPemeliharaan_SBI = 0,
		R_RKAPHasilLainnya_SBI = 0,
        R_PKBKgLateks_SBI = 0, 
        R_PKBKgTBS_SBI = 0,
        R_PKBKgPucuk_SBI = 0,
        R_PKBPanenLainnya_SBI = 0,
        R_PKBJumlahHK_SBI = 0, 
        R_PKBRpGaji_SBI = 0,
		R_PKBHasilPemeliharaan_SBI = 0,
		R_PKBHasilLainnya_SBI = 0,
		A_KgLateks_BI = cast(0 as decimal(18,2)), 
		A_KgLump_BI = cast(0 as decimal(18,2)), 
		A_KgTBS_BI = cast(0 as decimal(18,2)),
		A_KgBrondol_BI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_BI = cast(0 as decimal(18,2)),
		A_JumlahPohon_BI = cast(0 as decimal(18,2)),
		A_KgPucuk_BI = cast(0 as decimal(18,2)),
		A_PanenLainnya_BI = cast(0 as decimal(18,2)),
		A_JumlahHK_BI = cast(0 as decimal(18,2)),
		A_HaJelajah_BI = cast(0 as decimal(18,2)),
		A_RpGaji_BI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_HasilLainnya_BI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		A_KgLateks_SBI = case when C.kodebud='00' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end, 
		A_KgLump_SBI = 0, 
		A_KgTBS_SBI = case when C.kodebud='01' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end,
		A_KgBrondol_SBI =  0,
		A_JumlahTandan_SBI = 0,
		A_JumlahPohon_SBI = 0,
		A_KgPucuk_SBI = case when C.kodebud='02' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end,
		A_PanenLainnya_SBI = case when C.kodebud!='00' and C.kodebud!='01' and C.kodebud!='02' and SUBSTRING(C.norek,1,3)='602' then C.jmlhasil else 0 end,
		A_JumlahHK_SBI = C.RealisasiJumlahHK,
		A_HaJelajah_SBI = 0,
		A_RpGaji_SBI = C.jmlupah,
		A_HasilPemeliharaan_SBI = case when SUBSTRING(C.norek,1,3)='601' then C.jmlhasil else 0 end,
		A_HasilLainnya_SBI = case when SUBSTRING(C.norek,1,3)!='601' and SUBSTRING(C.norek,1,3)!='602' then C.jmlhasil else 0 end,
		A_RKAPKgLateks_SBI = 0,
		A_RKAPKgTBS_SBI = 0,
		A_RKAPKgPucuk_SBI = 0,
        A_RKAPPanenLainnya_SBI = 0,
        A_RKAPJumlahHK_SBI = 0, 
        A_RKAPRpGaji_SBI = 0, 
        A_RKAPHasilPemeliharaan_SBI = 0,
		A_RKAPHasilLainnya_SBI = 0,
        A_PKBKgLateks_SBI = 0, 
        A_PKBKgTBS_SBI = 0,
        A_PKBKgPucuk_SBI = 0,
        A_PKBPanenLainnya_SBI = 0,
        A_PKBJumlahHK_SBI = 0, 
        A_PKBRpGaji_SBI = 0,
		A_PKBHasilPemeliharaan_SBI = 0,
		A_PKBHasilLainnya_SBI = 0
		FROM #c as C	  
		where C.KMK='02'

	insert into #e
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then D.kodeunit 
				when @Layer='Afdeling' then D.kodeunit+D.kodeafd 
				else D.kodeunit+D.kodeafd+D.kodeblok 
			end,
		TahunTanam = D.thntnm,
		KodeBudidaya = D.kodebud,
		GroupMesin = '',
		R_KgLateks_BI = 0, 
		R_KgLump_BI = 0, 
		R_KgTBS_BI = 0,
		R_KgBrondol_BI =  0,
		R_JumlahTandan_BI = 0,
		R_JumlahPohon_BI = 0,
		R_KgPucuk_BI = 0,
		R_PanenLainnya_BI = 0,
		R_JumlahHK_BI = 0,
		R_HaJelajah_BI = 0,
		R_RpGaji_BI = 0,
		R_HasilPemeliharaan_BI = 0,
		R_HasilLainnya_BI = 0,
		R_RKAPKgLateks_BI = case when D.kodebud='00' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
		R_RKAPKgTBS_BI = case when D.kodebud='01' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
		R_RKAPKgPucuk_BI = case when D.kodebud='02' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
        R_RKAPPanenLainnya_BI = case when D.kodebud!='00' and D.kodebud!='01' and D.kodebud!='02' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
        R_RKAPJumlahHK_BI = D.RKAPJumlahHK, 
        R_RKAPRpGaji_BI = D.RKAPjmlupah, 
        R_RKAPHasilPemeliharaan_BI = case when SUBSTRING(D.norek,1,3)='601' then D.RKAPjmlhasil else 0 end,
		R_RKAPHasilLainnya_BI = case when SUBSTRING(D.norek,1,3)!='601' and SUBSTRING(D.norek,1,3)!='602' then D.RKAPjmlhasil else 0 end,
        R_PKBKgLateks_BI = case when D.kodebud='00' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end, 
        R_PKBKgTBS_BI = case when D.kodebud='01' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end,
        R_PKBKgPucuk_BI = case when D.kodebud='02' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end,
        R_PKBPanenLainnya_BI = case when D.kodebud!='00' and D.kodebud!='01' and D.kodebud!='02' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end,
        R_PKBJumlahHK_BI = D.PMKJumlahHK, 
        R_PKBRpGaji_BI = D.PMKjmlupah,
        R_PKBHasilPemeliharaan_BI = case when SUBSTRING(D.norek,1,3)='601' then D.PMKjmlhasil else 0 end,
		R_PKBHasilLainnya_BI = case when SUBSTRING(D.norek,1,3)!='601' and SUBSTRING(D.norek,1,3)!='602' then D.PMKjmlhasil else 0 end,
		R_KgLateks_SBI = cast(0 as decimal(18,2)), 
		R_KgLump_SBI = cast(0 as decimal(18,2)), 
		R_KgTBS_SBI = cast(0 as decimal(18,2)),
		R_KgBrondol_SBI =  cast(0 as decimal(18,2)),
		R_JumlahTandan_SBI = cast(0 as decimal(18,2)),
		R_JumlahPohon_SBI = cast(0 as decimal(18,2)),
		R_KgPucuk_SBI = cast(0 as decimal(18,2)),
		R_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		R_JumlahHK_SBI = cast(0 as decimal(18,2)),
		R_HaJelajah_SBI = cast(0 as decimal(18,2)),
		R_RpGaji_SBI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_SBI = cast(0 as decimal(18,2)),
		A_KgLateks_BI = cast(0 as decimal(18,2)), 
		A_KgLump_BI = cast(0 as decimal(18,2)), 
		A_KgTBS_BI = cast(0 as decimal(18,2)),
		A_KgBrondol_BI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_BI = cast(0 as decimal(18,2)),
		A_JumlahPohon_BI = cast(0 as decimal(18,2)),
		A_KgPucuk_BI = cast(0 as decimal(18,2)),
		A_PanenLainnya_BI = cast(0 as decimal(18,2)),
		A_JumlahHK_BI = cast(0 as decimal(18,2)),
		A_HaJelajah_BI = cast(0 as decimal(18,2)),
		A_RpGaji_BI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_HasilLainnya_BI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		A_KgLateks_SBI = 0, 
		A_KgLump_SBI = 0, 
		A_KgTBS_SBI = 0,
		A_KgBrondol_SBI =  0,
		A_JumlahTandan_SBI = 0,
		A_JumlahPohon_SBI = 0,
		A_KgPucuk_SBI = 0,
		A_PanenLainnya_SBI = 0,
		A_JumlahHK_SBI = 0,
		A_HaJelajah_SBI = 0,
		A_RpGaji_SBI = 0,
		A_HasilPemeliharaan_SBI = 0,
		A_HasilLainnya_SBI = 0,
		A_RKAPKgLateks_SBI = 0,
		A_RKAPKgTBS_SBI = 0,
		A_RKAPKgPucuk_SBI = 0,
        A_RKAPPanenLainnya_SBI = 0,
        A_RKAPJumlahHK_SBI = 0, 
        A_RKAPRpGaji_SBI = 0, 
		A_RKAPHasilPemeliharaan_SBI = 0,
		A_RKAPHasilLainnya_SBI = 0,
        A_PKBKgLateks_SBI = 0, 
        A_PKBKgTBS_SBI = 0,
        A_PKBKgPucuk_SBI = 0,
        A_PKBPanenLainnya_SBI = 0,
        A_PKBJumlahHK_SBI = 0, 
        A_PKBRpGaji_SBI = 0,
		A_PKBHasilPemeliharaan_SBI = 0,
		A_PKBHasilLainnya_SBI = 0
		FROM #d as D	       
		WHERE D.bulan=@BulanAkhir and D.tahun=@TahunAkhir and (d.KMK='01' or d.KMK is null)

		
	insert into #e
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then D.kodeunit 
				when @Layer='Afdeling' then D.kodeunit+D.kodeafd 
				else D.kodeunit+D.kodeafd+D.kodeblok 
			end,
		TahunTanam = D.thntnm,
		KodeBudidaya = D.kodebud,
		GroupMesin = '',
		R_KgLateks_BI = cast(0 as decimal(18,2)), 
		R_KgLump_BI = cast(0 as decimal(18,2)), 
		R_KgTBS_BI = cast(0 as decimal(18,2)),
		R_KgBrondol_BI =  cast(0 as decimal(18,2)),
		R_JumlahTandan_BI = cast(0 as decimal(18,2)),
		R_JumlahPohon_BI = cast(0 as decimal(18,2)),
		R_KgPucuk_BI = cast(0 as decimal(18,2)),
		R_PanenLainnya_BI = cast(0 as decimal(18,2)),
		R_JumlahHK_BI = cast(0 as decimal(18,2)),
		R_HaJelajah_BI = cast(0 as decimal(18,2)),
		R_RpGaji_BI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_HasilLainnya_BI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		R_KgLateks_SBI = cast(0 as decimal(18,2)),
		R_KgLump_SBI = 0, 
		R_KgTBS_SBI = cast(0 as decimal(18,2)),
		R_KgBrondol_SBI =  0,
		R_JumlahTandan_SBI = 0,
		R_JumlahPohon_SBI = 0,
		R_KgPucuk_SBI = cast(0 as decimal(18,2)),
		R_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		R_JumlahHK_SBI = cast(0 as decimal(18,2)),
		R_HaJelajah_SBI = 0,
		R_RpGaji_SBI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_SBI = 0,
		R_RKAPKgTBS_SBI = 0,
		R_RKAPKgPucuk_SBI = 0,
        R_RKAPPanenLainnya_SBI = 0,
        R_RKAPJumlahHK_SBI = 0, 
        R_RKAPRpGaji_SBI = 0, 
		R_RKAPHasilPemeliharaan_SBI = 0,
		R_RKAPHasilLainnya_SBI = 0,
        R_PKBKgLateks_SBI = 0, 
        R_PKBKgTBS_SBI = 0,
        R_PKBKgPucuk_SBI = 0,
        R_PKBPanenLainnya_SBI = 0,
        R_PKBJumlahHK_SBI = 0, 
        R_PKBRpGaji_SBI = 0,
		R_PKBHasilPemeliharaan_SBI = 0,
		R_PKBHasilLainnya_SBI = 0,
		A_KgLateks_BI = 0, 
		A_KgLump_BI = 0, 
		A_KgTBS_BI = 0,
		A_KgBrondol_BI =  0,
		A_JumlahTandan_BI = 0,
		A_JumlahPohon_BI = 0,
		A_KgPucuk_BI = 0,
		A_PanenLainnya_BI = 0,
		A_JumlahHK_BI = 0,
		A_HaJelajah_BI = 0,
		A_RpGaji_BI = 0,
		A_HasilPemeliharaan_BI = 0,
		A_HasilLainnya_BI = 0,
		A_RKAPKgLateks_BI = case when D.kodebud='00' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
		A_RKAPKgTBS_BI = case when D.kodebud='01' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
		A_RKAPKgPucuk_BI = case when D.kodebud='02' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
        A_RKAPPanenLainnya_BI = case when D.kodebud!='00' and D.kodebud!='01' and D.kodebud!='02' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
        A_RKAPJumlahHK_BI = D.RKAPJumlahHK, 
        A_RKAPRpGaji_BI = D.RKAPjmlupah, 
        A_RKAPHasilPemeliharaan_BI = case when SUBSTRING(D.norek,1,3)='601' then D.RKAPjmlhasil else 0 end,
		A_RKAPHasilLainnya_BI = case when SUBSTRING(D.norek,1,3)!='601' and SUBSTRING(D.norek,1,3)!='602' then D.RKAPjmlhasil else 0 end,
        A_PKBKgLateks_BI = case when D.kodebud='00' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end, 
        A_PKBKgTBS_BI = case when D.kodebud='01' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end,
        A_PKBKgPucuk_BI = case when D.kodebud='02' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end,
        A_PKBPanenLainnya_BI = case when D.kodebud!='00' and D.kodebud!='01' and D.kodebud!='02' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end,
        A_PKBJumlahHK_BI = D.PMKJumlahHK, 
        A_PKBRpGaji_BI = D.PMKjmlupah,
        A_PKBHasilPemeliharaan_BI = case when SUBSTRING(D.norek,1,3)='601' then D.PMKjmlhasil else 0 end,
		A_PKBHasilLainnya_BI = case when SUBSTRING(D.norek,1,3)!='601' and SUBSTRING(D.norek,1,3)!='602' then D.PMKjmlhasil else 0 end,
		A_KgLateks_SBI = cast(0 as decimal(18,2)), 
		A_KgLump_SBI = cast(0 as decimal(18,2)), 
		A_KgTBS_SBI = cast(0 as decimal(18,2)),
		A_KgBrondol_SBI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_SBI = cast(0 as decimal(18,2)),
		A_JumlahPohon_SBI = cast(0 as decimal(18,2)),
		A_KgPucuk_SBI = cast(0 as decimal(18,2)),
		A_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		A_JumlahHK_SBI = cast(0 as decimal(18,2)),
		A_HaJelajah_SBI = cast(0 as decimal(18,2)),
		A_RpGaji_SBI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_SBI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_SBI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_SBI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_SBI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_SBI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_SBI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_SBI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_SBI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_SBI = cast(0 as decimal(18,2))
		FROM #d as D	       
		WHERE D.bulan=@BulanAkhir and D.tahun=@TahunAkhir and D.KMK='02'

	insert into #e
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then D.kodeunit 
				when @Layer='Afdeling' then D.kodeunit+D.kodeafd 
				else D.kodeunit+D.kodeafd+D.kodeblok 
			end,
		TahunTanam = D.thntnm,
		KodeBudidaya = D.kodebud,
		GroupMesin = '',
		R_KgLateks_BI = cast(0 as decimal(18,2)), 
		R_KgLump_BI = cast(0 as decimal(18,2)), 
		R_KgTBS_BI = cast(0 as decimal(18,2)),
		R_KgBrondol_BI =  cast(0 as decimal(18,2)),
		R_JumlahTandan_BI = cast(0 as decimal(18,2)),
		R_JumlahPohon_BI = cast(0 as decimal(18,2)),
		R_KgPucuk_BI = cast(0 as decimal(18,2)),
		R_PanenLainnya_BI = cast(0 as decimal(18,2)),
		R_JumlahHK_BI = cast(0 as decimal(18,2)),
		R_HaJelajah_BI = cast(0 as decimal(18,2)),
		R_RpGaji_BI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_HasilLainnya_BI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		R_KgLateks_SBI = 0, 
		R_KgLump_SBI = 0, 
		R_KgTBS_SBI = 0,
		R_KgBrondol_SBI =  0,
		R_JumlahTandan_SBI = 0,
		R_JumlahPohon_SBI = 0,
		R_KgPucuk_SBI = 0,
		R_PanenLainnya_SBI = 0,
		R_JumlahHK_SBI = 0,
		R_HaJelajah_SBI = 0,
		R_RpGaji_SBI = 0,
		R_HasilPemeliharaan_SBI = 0,
		R_HasilLainnya_SBI = 0,
		R_RKAPKgLateks_SBI = case when D.kodebud='00' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
		R_RKAPKgTBS_SBI = case when D.kodebud='01' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
		R_RKAPKgPucuk_SBI = case when D.kodebud='02' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
        R_RKAPPanenLainnya_SBI = case when D.kodebud!='00' and D.kodebud!='01' and D.kodebud!='02' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
        R_RKAPJumlahHK_SBI = D.RKAPJumlahHK, 
        R_RKAPRpGaji_SBI = D.RKAPjmlupah, 
        R_RKAPHasilPemeliharaan_SBI = case when SUBSTRING(D.norek,1,3)='601' then D.RKAPjmlhasil else 0 end,
		R_RKAPHasilLainnya_SBI = case when SUBSTRING(D.norek,1,3)!='601' and SUBSTRING(D.norek,1,3)!='602' then D.RKAPjmlhasil else 0 end,
        R_PKBKgLateks_SBI = case when D.kodebud='00' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end, 
        R_PKBKgTBS_SBI = case when D.kodebud='01' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end,
        R_PKBKgPucuk_SBI = case when D.kodebud='02' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end,
        R_PKBPanenLainnya_SBI = case when D.kodebud!='00' and D.kodebud!='01' and D.kodebud!='02' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end,
        R_PKBJumlahHK_SBI = D.PMKJumlahHK, 
        R_PKBRpGaji_SBI = D.PMKjmlupah,
        R_PKBHasilPemeliharaan_SBI = case when SUBSTRING(D.norek,1,3)='601' then D.PMKjmlhasil else 0 end,
		R_PKBHasilLainnya_SBI = case when SUBSTRING(D.norek,1,3)!='601' and SUBSTRING(D.norek,1,3)!='602' then D.PMKjmlhasil else 0 end,
		A_KgLateks_BI = cast(0 as decimal(18,2)), 
		A_KgLump_BI = cast(0 as decimal(18,2)), 
		A_KgTBS_BI = cast(0 as decimal(18,2)),
		A_KgBrondol_BI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_BI = cast(0 as decimal(18,2)),
		A_JumlahPohon_BI = cast(0 as decimal(18,2)),
		A_KgPucuk_BI = cast(0 as decimal(18,2)),
		A_PanenLainnya_BI = cast(0 as decimal(18,2)),
		A_JumlahHK_BI = cast(0 as decimal(18,2)),
		A_HaJelajah_BI = cast(0 as decimal(18,2)),
		A_RpGaji_BI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_HasilLainnya_BI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		A_KgLateks_SBI = 0, 
		A_KgLump_SBI = 0, 
		A_KgTBS_SBI = 0,
		A_KgBrondol_SBI =  0,
		A_JumlahTandan_SBI = 0,
		A_JumlahPohon_SBI = 0,
		A_KgPucuk_SBI = 0,
		A_PanenLainnya_SBI = 0,
		A_JumlahHK_SBI = 0,
		A_HaJelajah_SBI = 0,
		A_RpGaji_SBI = 0,
		A_HasilPemeliharaan_SBI = 0,
		A_HasilLainnya_SBI = 0,
		A_RKAPKgLateks_SBI = 0,
		A_RKAPKgTBS_SBI = 0,
		A_RKAPKgPucuk_SBI = 0,
        A_RKAPPanenLainnya_SBI = 0,
        A_RKAPJumlahHK_SBI = 0, 
        A_RKAPRpGaji_SBI = 0, 
		A_RKAPHasilPemeliharaan_SBI = 0,
		A_RKAPHasilLainnya_SBI = 0,
        A_PKBKgLateks_SBI = 0, 
        A_PKBKgTBS_SBI = 0,
        A_PKBKgPucuk_SBI = 0,
        A_PKBPanenLainnya_SBI = 0,
        A_PKBJumlahHK_SBI = 0, 
        A_PKBRpGaji_SBI = 0,
		A_PKBHasilPemeliharaan_SBI = 0,
		A_PKBHasilLainnya_SBI = 0
		FROM #d as D	       
		where D.KMK='01' or D.KMK is null


	insert into #e
    SELECT 
		KodeBlok = 
			case 
				when @Layer='Kebun' then D.kodeunit 
				when @Layer='Afdeling' then D.kodeunit+D.kodeafd 
				else D.kodeunit+D.kodeafd+D.kodeblok 
			end,
		TahunTanam = D.thntnm,
		KodeBudidaya = D.kodebud,
		GroupMesin = '',
		R_KgLateks_BI = cast(0 as decimal(18,2)), 
		R_KgLump_BI = cast(0 as decimal(18,2)), 
		R_KgTBS_BI = cast(0 as decimal(18,2)),
		R_KgBrondol_BI =  cast(0 as decimal(18,2)),
		R_JumlahTandan_BI = cast(0 as decimal(18,2)),
		R_JumlahPohon_BI = cast(0 as decimal(18,2)),
		R_KgPucuk_BI = cast(0 as decimal(18,2)),
		R_PanenLainnya_BI = cast(0 as decimal(18,2)),
		R_JumlahHK_BI = cast(0 as decimal(18,2)),
		R_HaJelajah_BI = cast(0 as decimal(18,2)),
		R_RpGaji_BI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_HasilLainnya_BI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		R_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		R_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        R_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        R_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		R_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        R_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        R_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        R_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        R_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        R_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		R_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		R_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		R_KgLateks_SBI = cast(0 as decimal(18,2)),
		R_KgLump_SBI = 0, 
		R_KgTBS_SBI = cast(0 as decimal(18,2)),
		R_KgBrondol_SBI =  0,
		R_JumlahTandan_SBI = 0,
		R_JumlahPohon_SBI = 0,
		R_KgPucuk_SBI = cast(0 as decimal(18,2)),
		R_PanenLainnya_SBI = cast(0 as decimal(18,2)),
		R_JumlahHK_SBI = cast(0 as decimal(18,2)),
		R_HaJelajah_SBI = 0,
		R_RpGaji_SBI = cast(0 as decimal(18,2)),
		R_HasilPemeliharaan_SBI = cast(0 as decimal(18,2)),
		R_HasilLainnya_SBI = cast(0 as decimal(18,2)),
		R_RKAPKgLateks_SBI = 0,
		R_RKAPKgTBS_SBI = 0,
		R_RKAPKgPucuk_SBI = 0,
        R_RKAPPanenLainnya_SBI = 0,
        R_RKAPJumlahHK_SBI = 0, 
        R_RKAPRpGaji_SBI = 0, 
		R_RKAPHasilPemeliharaan_SBI = 0,
		R_RKAPHasilLainnya_SBI = 0,
        R_PKBKgLateks_SBI = 0, 
        R_PKBKgTBS_SBI = 0,
        R_PKBKgPucuk_SBI = 0,
        R_PKBPanenLainnya_SBI = 0,
        R_PKBJumlahHK_SBI = 0, 
        R_PKBRpGaji_SBI = 0,
		R_PKBHasilPemeliharaan_SBI = 0,
		R_PKBHasilLainnya_SBI = 0,
		A_KgLateks_BI = cast(0 as decimal(18,2)), 
		A_KgLump_BI = cast(0 as decimal(18,2)), 
		A_KgTBS_BI = cast(0 as decimal(18,2)),
		A_KgBrondol_BI =  cast(0 as decimal(18,2)),
		A_JumlahTandan_BI = cast(0 as decimal(18,2)),
		A_JumlahPohon_BI = cast(0 as decimal(18,2)),
		A_KgPucuk_BI = cast(0 as decimal(18,2)),
		A_PanenLainnya_BI = cast(0 as decimal(18,2)),
		A_JumlahHK_BI = cast(0 as decimal(18,2)),
		A_HaJelajah_BI = cast(0 as decimal(18,2)),
		A_RpGaji_BI = cast(0 as decimal(18,2)),
		A_HasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_HasilLainnya_BI = cast(0 as decimal(18,2)),
		A_RKAPKgLateks_BI = cast(0 as decimal(18,2)),
		A_RKAPKgTBS_BI = cast(0 as decimal(18,2)),
		A_RKAPKgPucuk_BI = cast(0 as decimal(18,2)),
        A_RKAPPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_RKAPJumlahHK_BI = cast(0 as decimal(18,2)),  
        A_RKAPRpGaji_BI = cast(0 as decimal(18,2)), 
		A_RKAPHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_RKAPHasilLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBKgLateks_BI = cast(0 as decimal(18,2)), 
        A_PKBKgTBS_BI = cast(0 as decimal(18,2)),
        A_PKBKgPucuk_BI = cast(0 as decimal(18,2)),
        A_PKBPanenLainnya_BI = cast(0 as decimal(18,2)),
        A_PKBJumlahHK_BI = cast(0 as decimal(18,2)), 
        A_PKBRpGaji_BI = cast(0 as decimal(18,2)),
		A_PKBHasilPemeliharaan_BI = cast(0 as decimal(18,2)),
		A_PKBHasilLainnya_BI = cast(0 as decimal(18,2)),
		A_KgLateks_SBI = 0, 
		A_KgLump_SBI = 0, 
		A_KgTBS_SBI = 0,
		A_KgBrondol_SBI =  0,
		A_JumlahTandan_SBI = 0,
		A_JumlahPohon_SBI = 0,
		A_KgPucuk_SBI = 0,
		A_PanenLainnya_SBI = 0,
		A_JumlahHK_SBI = 0,
		A_HaJelajah_SBI = 0,
		A_RpGaji_SBI = 0,
		A_HasilPemeliharaan_SBI = 0,
		A_HasilLainnya_SBI = 0,
		A_RKAPKgLateks_SBI = case when D.kodebud='00' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
		A_RKAPKgTBS_SBI = case when D.kodebud='01' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
		A_RKAPKgPucuk_SBI = case when D.kodebud='02' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
        A_RKAPPanenLainnya_SBI = case when D.kodebud!='00' and D.kodebud!='01' and D.kodebud!='02' and SUBSTRING(D.norek,1,3)='602' then D.RKAPjmlhasil else 0 end,
        A_RKAPJumlahHK_SBI = D.RKAPJumlahHK, 
        A_RKAPRpGaji_SBI = D.RKAPjmlupah, 
        A_RKAPHasilPemeliharaan_SBI = case when SUBSTRING(D.norek,1,3)='601' then D.RKAPjmlhasil else 0 end,
		A_RKAPHasilLainnya_SBI = case when SUBSTRING(D.norek,1,3)!='601' and SUBSTRING(D.norek,1,3)!='602' then D.RKAPjmlhasil else 0 end,
        A_PKBKgLateks_SBI = case when D.kodebud='00' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end, 
        A_PKBKgTBS_SBI = case when D.kodebud='01' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end,
        A_PKBKgPucuk_SBI = case when D.kodebud='02' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end,
        A_PKBPanenLainnya_SBI = case when D.kodebud!='00' and D.kodebud!='01' and D.kodebud!='02' and SUBSTRING(D.norek,1,3)='602' then D.PMKjmlhasil else 0 end,
        A_PKBJumlahHK_SBI = D.PMKJumlahHK, 
        A_PKBRpGaji_SBI = D.PMKjmlupah,
        A_PKBHasilPemeliharaan_SBI = case when SUBSTRING(D.norek,1,3)='601' then D.PMKjmlhasil else 0 end,
		A_PKBHasilLainnya_SBI = case when SUBSTRING(D.norek,1,3)!='601' and SUBSTRING(D.norek,1,3)!='602' then D.PMKjmlhasil else 0 end
		FROM #d as D	       
		where D.KMK='02'


    SELECT 
		KodeBlok, 
		KodeBudidaya,
		R_KgLateks_BI = sum(R_KgLateks_BI), 
		R_KgLump_BI = SUM(R_KgLump_BI), 
		R_KgTBS_BI = SUM(R_KgTBS_BI),
		R_KgBrondol_BI =  SUM(R_KgBrondol_BI),
		R_JumlahTandan_BI = SUM(R_JumlahTandan_BI),
		R_JumlahPohon_BI = SUM(R_JumlahPohon_BI),
		R_KgPucuk_BI = SUM(R_KgPucuk_BI),
		R_PanenLainnya_BI = SUM(R_PanenLainnya_BI),
		R_JumlahHK_BI = SUM(R_JumlahHK_BI),
		R_HaJelajah_BI = AVG(R_HaJelajah_BI),
		R_RpGaji_BI = SUM(R_RpGaji_BI),
		R_HasilPemeliharaan_BI = SUM(R_HasilPemeliharaan_BI),
		R_HasilLainnya_BI = SUM(R_HasilLainnya_BI),
		R_RKAPKgLateks_BI = SUM(R_RKAPKgLateks_BI),
		R_RKAPKgTBS_BI = SUM(R_RKAPKgTBS_BI),
		R_RKAPKgPucuk_BI = SUM(R_RKAPKgPucuk_BI),
        R_RKAPPanenLainnya_BI = SUM(R_RKAPPanenLainnya_BI),
        R_RKAPJumlahHK_BI = SUM(R_RKAPJumlahHK_BI), 
        R_RKAPRpGaji_BI = SUM(R_RKAPRpGaji_BI), 
        R_RKAPHasilPemeliharaan_BI = SUM(R_RKAPHasilPemeliharaan_BI),
		R_RKAPHasilLainnya_BI = SUM(R_RKAPHasilLainnya_BI),
        R_PKBKgLateks_BI = SUM(R_PKBKgLateks_BI), 
        R_PKBKgTBS_BI = SUM(R_PKBKgTBS_BI),
        R_PKBKgPucuk_BI = SUM(R_PKBKgPucuk_BI),
        R_PKBPanenLainnya_BI = SUM(R_PKBPanenLainnya_BI),
        R_PKBJumlahHK_BI = SUM(R_PKBJumlahHK_BI), 
        R_PKBRpGaji_BI = SUM(R_PKBRpGaji_BI),
        R_PKBHasilPemeliharaan_BI = SUM(R_PKBHasilPemeliharaan_BI),
		R_PKBHasilLainnya_BI = SUM(R_PKBHasilLainnya_BI),
		A_KgLateks_BI = sum(A_KgLateks_BI), 
		A_KgLump_BI = SUM(A_KgLump_BI), 
		A_KgTBS_BI = SUM(A_KgTBS_BI),
		A_KgBrondol_BI = SUM(A_KgBrondol_BI),
		A_JumlahTandan_BI = SUM(A_JumlahTandan_BI),
		A_JumlahPohon_BI = SUM(A_JumlahPohon_BI),
		A_KgPucuk_BI = SUM(A_KgPucuk_BI),
		A_PanenLainnya_BI = SUM(A_PanenLainnya_BI),
		A_JumlahHK_BI = SUM(A_JumlahHK_BI),
		A_HaJelajah_BI = AVG(A_HaJelajah_BI),
		A_RpGaji_BI = SUM(A_RpGaji_BI),
		A_HasilPemeliharaan_BI = SUM(A_HasilPemeliharaan_BI),
		A_HasilLainnya_BI = SUM(A_HasilLainnya_BI),
		A_RKAPKgLateks_BI = SUM(A_RKAPKgLateks_BI),
		A_RKAPKgTBS_BI = SUM(A_RKAPKgTBS_BI),
		A_RKAPKgPucuk_BI = SUM(A_RKAPKgPucuk_BI),
        A_RKAPPanenLainnya_BI = SUM(A_RKAPPanenLainnya_BI),
        A_RKAPJumlahHK_BI = SUM(A_RKAPJumlahHK_BI), 
        A_RKAPRpGaji_BI = SUM(A_RKAPRpGaji_BI), 
        A_RKAPHasilPemeliharaan_BI = SUM(A_RKAPHasilPemeliharaan_BI),
		A_RKAPHasilLainnya_BI = SUM(A_RKAPHasilLainnya_BI),
        A_PKBKgLateks_BI = SUM(A_PKBKgLateks_BI), 
        A_PKBKgTBS_BI = SUM(A_PKBKgTBS_BI),
        A_PKBKgPucuk_BI = SUM(A_PKBKgPucuk_BI),
        A_PKBPanenLainnya_BI = SUM(A_PKBPanenLainnya_BI),
        A_PKBJumlahHK_BI = SUM(A_PKBJumlahHK_BI), 
        A_PKBRpGaji_BI = SUM(A_PKBRpGaji_BI),
        A_PKBHasilPemeliharaan_BI = SUM(A_PKBHasilPemeliharaan_BI),
        A_PKBHasilLainnya_BI = SUM(A_PKBHasilLainnya_BI),
		R_KgLateks_SBI = sum(R_KgLateks_SBI), 
		R_KgLump_SBI = SUM(R_KgLump_SBI), 
		R_KgTBS_SBI = SUM(R_KgTBS_SBI),
		R_KgBrondol_SBI =  SUM(R_KgBrondol_SBI),
		R_JumlahTandan_SBI = SUM(R_JumlahTandan_SBI),
		R_JumlahPohon_SBI = SUM(R_JumlahPohon_SBI),
		R_KgPucuk_SBI = SUM(R_KgPucuk_SBI),
		R_PanenLainnya_SBI = SUM(R_PanenLainnya_SBI),
		R_JumlahHK_SBI = SUM(R_JumlahHK_SBI),
		R_HaJelajah_SBI = AVG(R_HaJelajah_SBI),
		R_RpGaji_SBI = SUM(R_RpGaji_SBI),
		R_HasilPemeliharaan_SBI = SUM(R_HasilPemeliharaan_SBI),
		R_HasilLainnya_SBI = SUM(R_HasilLainnya_SBI),
		R_RKAPKgLateks_SBI = SUM(R_RKAPKgLateks_SBI),
		R_RKAPKgTBS_SBI = SUM(R_RKAPKgTBS_SBI),
		R_RKAPKgPucuk_SBI = SUM(R_RKAPKgPucuk_SBI),
        R_RKAPPanenLainnya_SBI = SUM(R_RKAPPanenLainnya_SBI),
        R_RKAPJumlahHK_SBI = SUM(R_RKAPJumlahHK_SBI), 
        R_RKAPRpGaji_SBI = SUM(R_RKAPRpGaji_SBI), 
        R_RKAPHasilPemeliharaan_SBI = SUM(R_RKAPHasilPemeliharaan_SBI),
		R_RKAPHasilLainnya_SBI = SUM(R_RKAPHasilLainnya_SBI),
        R_PKBKgLateks_SBI = SUM(R_PKBKgLateks_SBI), 
        R_PKBKgTBS_SBI = SUM(R_PKBKgTBS_SBI),
        R_PKBKgPucuk_SBI = SUM(R_PKBKgPucuk_SBI),
        R_PKBPanenLainnya_SBI = SUM(R_PKBPanenLainnya_SBI),
        R_PKBJumlahHK_SBI = SUM(R_PKBJumlahHK_SBI), 
        R_PKBRpGaji_SBI = SUM(R_PKBRpGaji_SBI),
        R_PKBHasilPemeliharaan_SBI = SUM(R_PKBHasilPemeliharaan_SBI),
		R_PKBHasilLainnya_SBI = SUM(R_PKBHasilLainnya_SBI),
		A_KgLateks_SBI = sum(A_KgLateks_SBI), 
		A_KgLump_SBI = SUM(A_KgLump_SBI), 
		A_KgTBS_SBI = SUM(A_KgTBS_SBI),
		A_KgBrondol_SBI =  SUM(A_KgBrondol_SBI),
		A_JumlahTandan_SBI = SUM(A_JumlahTandan_SBI),
		A_JumlahPohon_SBI = SUM(A_JumlahPohon_SBI),
		A_KgPucuk_SBI = SUM(A_KgPucuk_SBI),
		A_PanenLainnya_SBI = SUM(A_PanenLainnya_SBI),
		A_JumlahHK_SBI = SUM(A_JumlahHK_SBI),
		A_HaJelajah_SBI = AVG(A_HaJelajah_SBI),
		A_RpGaji_SBI = SUM(A_RpGaji_SBI),
		A_HasilPemeliharaan_SBI = SUM(A_HasilPemeliharaan_SBI),
		A_HasilLainnya_SBI = SUM(A_HasilLainnya_SBI),
		A_RKAPKgLateks_SBI = SUM(A_RKAPKgLateks_SBI),
		A_RKAPKgTBS_SBI = SUM(A_RKAPKgTBS_SBI),
		A_RKAPKgPucuk_SBI = SUM(A_RKAPKgPucuk_SBI),
        A_RKAPPanenLainnya_SBI = SUM(A_RKAPPanenLainnya_SBI),
        A_RKAPJumlahHK_SBI = SUM(A_RKAPJumlahHK_SBI), 
        A_RKAPRpGaji_SBI = SUM(A_RKAPRpGaji_SBI), 
        A_RKAPHasilPemeliharaan_SBI = SUM(A_RKAPHasilPemeliharaan_SBI),
		A_RKAPHasilLainnya_SBI = SUM(A_RKAPHasilLainnya_SBI),
        A_PKBKgLateks_SBI = SUM(A_PKBKgLateks_SBI), 
        A_PKBKgTBS_SBI = SUM(A_PKBKgTBS_SBI),
        A_PKBKgPucuk_SBI = SUM(A_PKBKgPucuk_SBI),
        A_PKBPanenLainnya_SBI = SUM(A_PKBPanenLainnya_SBI),
        A_PKBJumlahHK_SBI = SUM(A_PKBJumlahHK_SBI), 
        A_PKBRpGaji_SBI = SUM(A_PKBRpGaji_SBI),
        A_PKBHasilPemeliharaan_SBI = SUM(A_PKBHasilPemeliharaan_SBI),
        A_PKBHasilLainnya_SBI = SUM(A_PKBHasilLainnya_SBI)
        INTO #f FROM #e as A
		GROUP BY KodeBlok, KodeBudidaya

			
		select 
			Id=						-- KebunId, AfdelingId atau BlokId
				case 
					when @Layer='Kebun' then (select top 1 kebunid from [ReferensiEF].[dbo].[Kebun] where kd_kbn=A.KodeBlok)
					when @Layer='Afdeling' then (select top 1 afdelingid from [ReferensiEF].[dbo].[Afdeling] where kd_afd=A.KodeBlok)
					else (select top 1 blokid from [ReferensiEF].[dbo].[Blok] where kd_blok=A.KodeBlok)
				end,
			KodeKebun=A.KodeBlok,	-- Kode Kebun, Kode Afdeling 
			Peta='',
			LuasTM=
				case 
					when @Layer='Kebun' then (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun=A.KodeBlok and [status]='TM')
					when @Layer='Afdeling' then (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun+kodeafdeling=A.KodeBlok and [status]='TM')
					else (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun+kodeafdeling+kodeblok=A.KodeBlok and [status]='TM')
				end,
			Nama=
				case 
					when @Layer='Kebun' then (select top 1 nama from [ReferensiEF].[dbo].[Kebun] where kd_kbn=A.KodeBlok)
					when @Layer='Afdeling' then (select top 1 nama from [ReferensiEF].[dbo].[Afdeling] where kd_afd=A.KodeBlok)
					else (select top 1 nama from [ReferensiEF].[dbo].[Blok] where kd_blok=A.KodeBlok)
				end,
			Value1 =
				case
					when @FieldYangDibandingkan='HK' then
						case 
							when @OrderBulan='BI' then R_JumlahHK_BI+A_JumlahHK_BI
							else R_JumlahHK_SBI+A_JumlahHK_SBI
						end
					when @FieldYangDibandingkan='PRESTASI' then
						case
							when @OrderBulan='BI' then R_KgLateks_BI+R_KgLump_BI+R_KgTBS_BI+R_KgBrondol_BI+R_KgPucuk_BI+R_PanenLainnya_BI+R_HasilPemeliharaan_BI+R_HasilLainnya_BI +
															A_KgLateks_BI+A_KgLump_BI+A_KgTBS_BI+A_KgBrondol_BI+A_KgPucuk_BI+A_PanenLainnya_BI+A_HasilPemeliharaan_BI+A_HasilLainnya_BI
							else R_KgLateks_SBI+R_KgLump_SBI+R_KgTBS_SBI+R_KgBrondol_SBI+R_KgPucuk_SBI+R_PanenLainnya_SBI+R_HasilPemeliharaan_SBI+R_HasilLainnya_SBI +
									A_KgLateks_SBI+A_KgLump_SBI+A_KgTBS_SBI+A_KgBrondol_SBI+A_KgPucuk_SBI+A_PanenLainnya_SBI+A_HasilPemeliharaan_SBI+A_HasilLainnya_SBI
						end
					when @FieldYangDibandingkan='PROTAS' then	
						case
							when @OrderBulan='BI' then (R_KgLateks_BI+R_KgLump_BI+R_KgTBS_BI+R_KgBrondol_BI+R_KgPucuk_BI+R_PanenLainnya_BI+
															A_KgLateks_BI+A_KgLump_BI+A_KgTBS_BI+A_KgBrondol_BI+A_KgPucuk_BI+A_PanenLainnya_BI)/
															(case 
																when @Layer='Kebun' then (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun=A.KodeBlok and [status]='TM')
																when @Layer='Afdeling' then (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun+kodeafdeling=A.KodeBlok and [status]='TM')
																else (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun+kodeafdeling+kodeblok=A.KodeBlok and [status]='TM')
															end) 
							else (R_KgLateks_SBI+R_KgLump_SBI+R_KgTBS_SBI+R_KgBrondol_SBI+R_KgPucuk_SBI+R_PanenLainnya_SBI+
									A_KgLateks_SBI+A_KgLump_SBI+A_KgTBS_SBI+A_KgBrondol_SBI+A_KgPucuk_SBI+A_PanenLainnya_SBI)/
															(case 
																when @Layer='Kebun' then (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun=A.KodeBlok and [status]='TM')
																when @Layer='Afdeling' then (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun+kodeafdeling=A.KodeBlok and [status]='TM')
																else (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun+kodeafdeling+kodeblok=A.KodeBlok and [status]='TM')
															end) 
						end
					else
						case
							when @OrderBulan='BI' then R_RpGaji_BI+A_RpGaji_BI
							else R_RpGaji_SBI+A_RpGaji_SBI
						end
				end,
			Value2 =
				case 
					when @DibandingkanDengan='RKAP' then 
						case 
							when @FieldYangDibandingkan='HK' then
								case 
									when @OrderBulan='BI' then R_RKAPJumlahHK_BI+A_RKAPJumlahHK_BI
									else R_RKAPJumlahHK_SBI+A_RKAPJumlahHK_SBI
								end
							when @FieldYangDibandingkan='PRESTASI' then
								case
									when @OrderBulan='BI' then R_RKAPKgLateks_BI+R_RKAPKgTBS_BI+R_RKAPKgPucuk_BI+R_RKAPPanenLainnya_BI+R_RKAPHasilPemeliharaan_BI+R_RKAPHasilLainnya_BI +
																A_RKAPKgLateks_BI+A_RKAPKgTBS_BI+A_RKAPKgPucuk_BI+A_RKAPPanenLainnya_BI+A_RKAPHasilPemeliharaan_BI+A_RKAPHasilLainnya_BI
									else R_RKAPKgLateks_SBI+R_RKAPKgTBS_SBI+R_RKAPKgPucuk_SBI+R_RKAPPanenLainnya_SBI+R_RKAPHasilPemeliharaan_SBI+R_RKAPHasilLainnya_SBI +
											A_RKAPKgLateks_SBI+A_RKAPKgTBS_SBI+A_RKAPKgPucuk_SBI+A_RKAPPanenLainnya_SBI+A_RKAPHasilPemeliharaan_SBI+A_RKAPHasilLainnya_SBI
								end
							when @FieldYangDibandingkan='PROTAS' then	
								case
									when @OrderBulan='BI' then (R_RKAPKgLateks_BI+R_RKAPKgTBS_BI+R_RKAPKgPucuk_BI+R_RKAPPanenLainnya_BI+
																A_RKAPKgLateks_BI+A_RKAPKgTBS_BI+A_RKAPKgPucuk_BI+A_RKAPPanenLainnya_BI)/
															(case 
																when @Layer='Kebun' then (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun=A.KodeBlok and [status]='TM')
																when @Layer='Afdeling' then (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun+kodeafdeling=A.KodeBlok and [status]='TM')
																else (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun+kodeafdeling+kodeblok=A.KodeBlok and [status]='TM')
															end) 

									else (R_RKAPKgLateks_SBI+R_RKAPKgTBS_SBI+R_RKAPKgPucuk_SBI+R_RKAPPanenLainnya_SBI+
											A_RKAPKgLateks_SBI+A_RKAPKgTBS_SBI+A_RKAPKgPucuk_SBI+A_RKAPPanenLainnya_SBI)/
															(case 
																when @Layer='Kebun' then (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun=A.KodeBlok and [status]='TM')
																when @Layer='Afdeling' then (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun+kodeafdeling=A.KodeBlok and [status]='TM')
																else (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun+kodeafdeling+kodeblok=A.KodeBlok and [status]='TM')
															end) 
									
								end	
							else
								case
									when @OrderBulan='BI' then R_RKAPRpGaji_BI+A_RKAPRpGaji_BI
									else R_RKAPRpGaji_SBI+A_RKAPRpGaji_SBI
								end
								
						end
					when @DibandingkanDengan='PKB' then
						case 
							when @FieldYangDibandingkan='HK' then
								case 
									when @OrderBulan='BI' then R_PKBJumlahHK_BI+A_PKBJumlahHK_BI
									else R_PKBJumlahHK_SBI+A_PKBJumlahHK_SBI
								end
							when @FieldYangDibandingkan='PRESTASI' then
								case
									when @OrderBulan='BI' then R_PKBKgLateks_BI+R_PKBKgTBS_BI+R_PKBKgPucuk_BI+R_PKBPanenLainnya_BI+R_PKBHasilPemeliharaan_BI+R_PKBHasilLainnya_BI +
																A_PKBKgLateks_BI+A_PKBKgTBS_BI+A_PKBKgPucuk_BI+A_PKBPanenLainnya_BI+A_PKBHasilPemeliharaan_BI+A_PKBHasilLainnya_BI
									else R_PKBKgLateks_SBI+R_PKBKgTBS_SBI+R_PKBKgPucuk_SBI+R_PKBPanenLainnya_SBI+R_PKBHasilPemeliharaan_SBI+R_PKBHasilLainnya_SBI +
											A_PKBKgLateks_SBI+A_PKBKgTBS_SBI+A_PKBKgPucuk_SBI+A_PKBPanenLainnya_SBI+A_PKBHasilPemeliharaan_SBI+A_PKBHasilLainnya_SBI
								end
							when @FieldYangDibandingkan='PROTAS' then
								case
									when @OrderBulan='BI' then (R_PKBKgLateks_BI+R_PKBKgTBS_BI+R_PKBKgPucuk_BI+R_PKBPanenLainnya_BI+
																A_PKBKgLateks_BI+A_PKBKgTBS_BI+A_PKBKgPucuk_BI+A_PKBPanenLainnya_BI)/
															(case 
																when @Layer='Kebun' then (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun=A.KodeBlok and [status]='TM')
																when @Layer='Afdeling' then (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun+kodeafdeling=A.KodeBlok and [status]='TM')
																else (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun+kodeafdeling+kodeblok=A.KodeBlok and [status]='TM')
															end) 
																
									else (R_PKBKgLateks_SBI+R_PKBKgTBS_SBI+R_PKBKgPucuk_SBI+R_PKBPanenLainnya_SBI+
											A_PKBKgLateks_SBI+A_PKBKgTBS_SBI+A_PKBKgPucuk_SBI+A_PKBPanenLainnya_SBI)/
															(case 
																when @Layer='Kebun' then (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun=A.KodeBlok and [status]='TM')
																when @Layer='Afdeling' then (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun+kodeafdeling=A.KodeBlok and [status]='TM')
																else (select SUM(luas) from [SPDK_KBN_KONSOL].[dbo].[Ref_Areal] where kodebudidaya=@Budidaya and kodekebun+kodeafdeling+kodeblok=A.KodeBlok and [status]='TM')
															end) 
											
								end
							else
								case
									when @OrderBulan='BI' then R_RKAPRpGaji_BI+A_RKAPRpGaji_BI
									else R_RKAPRpGaji_SBI+A_RKAPRpGaji_SBI
								end
								
						end
				end
		--	Value3, 
		--	Warna
		from #f as A
		order by KodeBlok
END

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[BahanKoreksiAktiva]
@tanggal datetime,
@kdunit varchar(2)
as
set dateformat dmy
declare @AwalTahun datetime
declare @AkhirBulan datetime
set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @AkhirBulan=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select distinct nobukti into #tb1 from AktivaMaster 
where tgltran>=@AwalTahun and tgltran<=@AkhirBulan and SUBSTRING(nobukti,1,3)='SST'

--SALDO AWAL
select * into #X1 from AktivaMaster where nobukti='SALDO AWAL' and YEAR(tgltran)=YEAR(@tanggal) 

select kelompok as namagrup,'AKTIVA TETAP' as Kelompok,kelompokaset,kodeunit,kdafd,kdbud,'1' as grup,SUBSTRING(norek,1,3) as krbb,norek,tglbeli,noaktiva,nmaktiva,space(2) as blnsst,jmlunit,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
INTO #T1
from AktivaMaster
where YEAR(tgltran)=YEAR(@tanggal) and nobukti='SALDO AWAL' and SUBSTRING(norek,1,3) not in (043,044,045,046,047,048,049)  
union all
select kelompok as namagrup,'INVESTASI TAHUN BERJALAN' as Kelompok,kelompokaset,kodeunit,kdafd,kdbud,'2' as grup,SUBSTRING(norek,1,3) as krbb,norek,tglbeli,noaktiva,nmaktiva,space(2) as blnsst,jmlunit,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster
where YEAR(tgltran)=YEAR(@tanggal) and nobukti='SALDO AWAL' and SUBSTRING(norek,1,3) in (043,044,045,046,047,048,049) 
union all

--TRANSAKSI AKTIVA TAHUN BERJALAN
select kelompok as namagrup,'AKTIVA TETAP' as Kelompok,kelompokaset,kodeunit,kdafd,kdbud,'1' as grup,substring(norek,1,3) as krbb,norek,tglbeli,noaktiva,nmaktiva,space(2) as blnsst,jmlunit,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster 
where SUBSTRING(norek,1,3) not in (043,044,045,046,047,048,049) and tgltran>=@AwalTahun and tgltran<=@AkhirBulan and nobukti<>'SALDO AWAL' 
union all

--TRANSAKSI INVESTASI TAHUN BERJALAN
select kelompok as namagrup,'INVESTASI TAHUN BERJALAN' as Kelompok,kelompokaset,kodeunit,kdafd,kdbud,'2' as grup,substring(norek,1,3) as krbb,norek,tglbeli,noaktiva,nmaktiva,space(2) as blnsst,jmlunit,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster 
where SUBSTRING(norek,1,3) in (043,044,045,046,047,048,049) and tgltran>=@AwalTahun and tgltran<=@AkhirBulan and nobukti<>'SALDO AWAL' 

update #T1 set kelompokaset='04' where kelompokaset=''
update #T1 set blnsst=(select COUNT(*) from #tb1)

--REKAPITULASI
select a.kodeunit,'KEBUN/UNIT : '+b.NamaKebun as kebun,a.Kelompok,a.namagrup,c.Uraian,a.kdafd,a.grup,a.krbb,a.norek,a.tglbeli,substring(a.noaktiva,1,10) as noaktiva,a.nmaktiva,a.blnsst,sum(a.jmlunit) as jmlunit,
SUM(a.sawalp) as sawalp,SUM(a.auditp) as auditp,SUM(a.rcp) as rcp,SUM(a.hapusp) as hapusp,SUM(a.rekp) as rekp,SUM(a.kbnp) as kbnp,SUM(a.murnip) as murnip,
SUM(a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip) as jmlmutasip,
SUM(a.sawalp+a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip) as jmlperolehan,
SUM(a.sawals) as sawals,SUM(a.audits) as audits,SUM(a.rcs) as rcs,SUM(a.hapuss) as hapuss,SUM(a.reks) as reks,SUM(a.kbns) as kbns,SUM(a.murnis) as murnis,
SUM(a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as jmlmutasis,
SUM(a.sawals+a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as jmlpenyusutan,
SUM(a.sawalp+a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip)-SUM(a.sawals+a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as NilaiBuku,
'Per : '+cast(substring(convert(varchar(50),@AwalTahun,105),1,10) as varchar(50))as AwalTahun,'Per : '+cast(substring(convert(varchar(50),@akhirbulan,105),1,10) as varchar(50))as akhirbulan
into #t2
from #T1 a
inner join Ref_Kebun b on a.kodeunit=b.KodeKebun
inner join Ref_TarifAktiva c on a.namagrup=c.norek and a.kdbud=c.kdbud and a.kelompokaset=c.kelompokaset
group by a.kodeunit,b.NamaKebun,a.Kelompok,a.kdafd,a.namagrup,c.Uraian,a.grup,a.krbb,a.norek,a.tglbeli,a.noaktiva,a.nmaktiva,a.blnsst
order by grup,krbb,noaktiva,tglbeli asc,norek

--select a.jmlunit,a.noaktiva,b.kelompok,b.tarifpct,a.nmaktiva,a.sawalp,a.sawals,a.NilaiBuku,round(((a.sawalp*(b.tarifpct/100))/12)*6,0) as koreksi 
--into #x2
--from #t2 a
--inner join #X1 b on a.noaktiva=b.noaktiva
--where a.sawalp-a.sawals=a.jmlunit and a.audits<>0 and a.NilaiBuku>(a.sawalp-a.sawals)

--select @kdunit as unit,jmlunit,noaktiva,tarifpct,nmaktiva,sawalp,sawals,sawalp-sawals as NB,NilaiBuku,koreksi from #x2 where NilaiBuku>koreksi
--union all
--select @kdunit as unit,jmlunit,noaktiva,tarifpct,nmaktiva,sawalp,sawals,sawalp-sawals as NB,NilaiBuku,jmlunit-NilaiBuku as koreksi from #x2 where NilaiBuku<koreksi

select * into #t3 from #t2 where auditp<>0 
union all
select * from #t2 where audits<>0 

select kodeunit,norek,noaktiva,jmlunit,sawalp,sawals,auditp,audits from #t3 where audits<>jmlunit and sawalp>0

--set dateformat dmy exec BahanKoreksiAktiva '01-06-2017','50'

--SELECT * FROM AktivaMaster WHERE kodeunit='50' AND YEAR(tgltran)=2017

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[BPK_RI]
@tanggal datetime
as
set dateformat dmy
declare @bulan varchar(50)
if MONTH(@tanggal)<10
	set @bulan=cast(YEAR(@tanggal) as varchar(4))+'0'+cast(MONTH(@tanggal) as varchar(2))
else
	set @bulan=cast(YEAR(@tanggal) as varchar(4))+cast(MONTH(@tanggal) as varchar(2))

select KodeUnit,Tanggal,NoBukti,NoInput,KodeBudidaya,KodeAfdeling,Norek,KodeBarang,Netral,kdblok,KodeUnsur,Uraian,Jml_fisik,Debet,Kredit,Aplikasi from Kartu where MONTH(Tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal)  order by KodeUnit,Tanggal,Aplikasi
--union all
--select KodeUnit,tanggal,no_bukti,no_bukti,kd_bud,kd_afd,norek,'' as kodebarang,netral,'' as kdblok,'' as unsur,uraian,0 as fisik,debet,kredit,'xBASE' from KartuClipper where Bulan=@bulan order by KodeUnit,Tanggal,Aplikasi

--set dateformat dmy exec BPK_RI '01-01-2016'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create proc [dbo].[cek_150_Debet]
@tanggal datetime,
@kebun varchar(2)
as
set dateformat dmy 

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where KodeUnit=@kebun and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='D'
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where KodeUnit=@kebun and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='K'

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from kartu
where KodeUnit=@kebun and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select substring(a.norek,1,3)+'.'+SUBSTRING(a.norek,4,2)+'.'+SUBSTRING(a.norek,6,2)+'.'+SUBSTRING(a.norek,8,2) as [REKENING],b.namarekening as [NAMA REKENING],sum(a.sakDebet) as DEBET
from #t4 a
full outer join ref_rekening b on a.norek=b.norek and @kebun=b.KodeUnit
where sakDebet+SakKredit<>0 and a.norek like '150%'
group by a.kodeunit,a.norek,b.namarekening
order by a.norek

--set dateformat dmy exec cek154_Debet '01-12-2016','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create proc [dbo].[cek_154_Debet]
@tanggal datetime,
@kebun varchar(2)
as
set dateformat dmy 

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where KodeUnit=@kebun and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='D'
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where KodeUnit=@kebun and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='K'

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from kartu
where KodeUnit=@kebun and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select substring(a.norek,1,3)+'.'+SUBSTRING(a.norek,4,2)+'.'+SUBSTRING(a.norek,6,2)+'.'+SUBSTRING(a.norek,8,2) as [REKENING],b.namarekening as [NAMA REKENING],sum(a.sakDebet) as DEBET
from #t4 a
full outer join ref_rekening b on a.norek=b.norek and @kebun=b.KodeUnit
where sakDebet+SakKredit<>0 and a.norek like '154%'
group by a.kodeunit,a.norek,b.namarekening
order by a.norek

--set dateformat dmy exec cek154_Debet '01-12-2016','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[cek_154_JLL]
@tanggal datetime,
@kebun varchar(2)
as
set dateformat dmy
select NoInput,substring(norek,1,3)+'.'+SUBSTRING(norek,4,2)+'.'+SUBSTRING(norek,6,2)+'.'+SUBSTRING(norek,8,2) as [REKENING],uraian,DK,nilai from AkunMemorial 
where KodeUnit=@kebun and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(NoInput,1,3) not in ('SAL','TRA') and norek like '154%' 
order by norek

--set dateformat dmy exec Cek154_JLL '01-12-2016','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[cek_BiayaProduksi]
@tanggal datetime,
@kdbud varchar(2),
@Kebun varchar(2)
as
set dateformat dmy
BEGIN
SET NOCOUNT ON;

declare @AwalThn datetime
declare @TglAwal datetime
declare @TglLalu datetime
declare @TglAkhir datetime

set @TglAkhir=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @AwalThn='01-01-'+cast(year(@tanggal) as varchar(4))
set @TglAwal='01-'+cast(month(@tanggal) as varchar(2))+'-'+cast(year(@tanggal) as varchar(4))
set @TglLalu= @TglAwal-1

select * into #AkunMemorial from AkunMemorial where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and KodeUnit=@kebun and kodebud=@kdbud
select * into #AkunRKAP     from AkunRKAP     where YEAR(tanggal)=YEAR(@tanggal)   and KodeUnit=@kebun and kodebud=@kdbud
select * into #kartu        from Kartu        where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and KodeUnit=@kebun and KodeBudidaya=@kdbud

--REALIASAI BULAN LALU
select substring(norek,1,3) as norek,cast(0 as float) as BI,cast(0 as float) as ABI,sum(nilai) as SBI,cast(0 as float) as ASBI
into #t1
from #AkunMemorial 
where dk='D' and noinput in ('SALDO AWAL','TRANSAKSI') and (substring(norek,1,1)='6' OR SUBSTRING(norek,1,3)='490') 
group by substring(norek,1,3)
union all
select substring(norek,1,3) as norek,0 as BI,0 as ABI,-1*sum(nilai) as SBI,0 as ASBI
from #AkunMemorial 
where dk='K' and noinput in ('SALDO AWAL','TRANSAKSI') and (substring(norek,1,1)='6' OR SUBSTRING(norek,1,3)='490') 
group by substring(norek,1,3)
union all

--BIAYA UMUM BULAN INI
select substring(norek,1,3) as norek,SUM(Debet-kredit) as bi,0 as abi,SUM(Debet-kredit) as sbi,0 as asbi 
from #Kartu
where (SUBSTRING(norek,1,1)='6' OR SUBSTRING(norek,1,3)='490')
group by substring(norek,1,3)
union all

--ANGGARAN BULAN INI
select substring(norek,1,3) as norek,0 as bi,SUM(nilai_RKAP) as abi,0 as sbi,0 as asbi 
from #AkunRKAP
where (SUBSTRING(norek,1,1)='6' OR SUBSTRING(norek,1,3)='490') and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)
group by substring(norek,1,3)
union all

--ANGGARAN SAMPAI DENGAN BULAN INI
select substring(norek,1,3) as norek,0 as bi,0 as abi,0 as sbi,SUM(nilai_RKAP) as asbi 
from #AkunRKAP
where (SUBSTRING(norek,1,1)='6' OR SUBSTRING(norek,1,3)='490') and tanggal>=@AwalThn AND tanggal<=@TglAkhir
group by substring(norek,1,3)

select 'BIAYA PRODUKSI SEBELUM PENYUSUTAN' as URAIAN,SUM(bi) as [REAL.BL.INI],SUM(abi) as [RKAP BL.INI],SUM(sbi) as [REAL.SD BL.INI],SUM(asbi) as [RKAP SD BL.INI]
from #t1
where not SUBSTRING(norek,1,3)='490'
union all
select 'BIAYA PENYUSUTAN' as Ket,SUM(bi) as bi,SUM(abi) as abi,SUM(sbi) as sbi,SUM(asbi) as asbi 
from #t1
where SUBSTRING(norek,1,3)='490'
union all
select 'BIAYA PRODUKSI (TOTAL)' as Ket,SUM(bi) as bi,SUM(abi) as abi,SUM(sbi) as sbi,SUM(asbi) as asbi 
from #t1

SET NOCOUNT ON;
END

--set dateformat dmy exec CekBiayaProduksi '01-12-2016','02','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[cek_BiayaProduksiSKU]
@tanggal datetime,
@kdbud varchar(2),
@kebun varchar(2)
as
--BIAYA PRODUKSI PER SKU
BEGIN
SET NOCOUNT ON;

set dateformat dmy
declare @AwalThn datetime
declare @TglAwal datetime
declare @TglLalu datetime
set @AwalThn='01-01-'+cast(year(@tanggal) as varchar(4))
set @TglAwal='01-'+cast(month(@tanggal) as varchar(2))+'-'+cast(year(@tanggal) as varchar(4))
set @TglLalu= @TglAwal-1

select kodeJenisOlah,kodegrade,SUM(bi) as bi,SUM(rbi) as rbi,SUM(pbi) as pbi 
into #ProduksiHP
from AkunProduksiHP 
where kodeunit=@Kebun and kodebud=@kdbud and tanggal>=@AwalThn and tanggal<=@TglLalu
group by kodeJenisOlah,kodegrade

select * into #Ref_Budidaya from Ref_Budidaya where KodeUnit=@kebun
select * into #Ref_Kebun    from SPDK_KBN_MASTER_REF..Ref_Kebun    where KodeKebun=@kebun

--PRODUKSI BULAN INI
select a.kodeunit,a.kodebud as kdbud,a.kodegrade as kodeproduk,b.merk,b.NamaProduk,b.kemasan,sum(a.bi) as JFBI,sum(a.bi) as JFSBI,cast(0 as float) as NilaiBI,cast(0 as float) as NilaiSBI,cast(0 as float) as KemasanBI,cast(0 as float) as KemasanSBI,
cast(0 as float) as HrgSatKgBI,cast(0 as float) as HrgSatKgSBI,cast(0 as float) as HrgSatKmsBI,cast(0 as float) as HrgSatKmsSBI
into #t1
from AkunProduksiHP a
inner join Ref_KodeProdukIHT b on a.kodegrade=b.kdgrade
where a.kodeunit=@Kebun and a.bi>0 and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.kodebud=@kdbud
group by a.kodeunit,a.kodebud,a.kodegrade,b.merk,b.NamaProduk,b.kemasan
union all
--PRODUKSI BULAN LALU
select a.kodeunit,a.kodebud as kdbud,a.kodegrade as kodeproduk,b.merk,b.NamaProduk,b.kemasan,0 as JFBI,sum(a.bi) as JFSBI,cast(0 as float) as NilaiBI,cast(0 as float) as NilaiSBI,cast(0 as float) as KemasanBI,cast(0 as float) as KemasanSBI,
cast(0 as float) as HrgSatKgBI,cast(0 as float) as HrgSatKgSBI,cast(0 as float) as HrgSatKmsBI,cast(0 as float) as HrgSatKmsSBI
from AkunProduksiHP a
inner join Ref_KodeProdukIHT b on a.kodegrade=b.kdgrade
where a.kodeunit=@Kebun and a.bi>0 and a.tanggal>=@AwalThn and a.tanggal<=@TglLalu and a.kodebud=@kdbud
group by a.kodeunit,a.kodebud,a.kodegrade,b.merk,b.NamaProduk,b.kemasan
union all

--REALISASI BIAYA BULAN INI
select a.KodeUnit,a.kodebudidaya as kdbud,a.netral as kodeproduk,b.merk,b.NamaProduk,b.kemasan,0 as JFBI,0 as JFSBI,sum(a.debet-a.kredit) as NilaiBI,sum(a.debet-a.kredit) as NilaiSBI,sum(c.bi/b.konversiberat) as KemasanBI,sum(c.bi/b.konversiberat) as KemasanSBI,
sum(a.debet-a.kredit)/sum(c.bi) as HrgSatKgBI,sum(a.debet-a.kredit)/sum(c.bi) as HrgSatKgSBI,
sum(a.debet-a.kredit)/sum(c.bi/b.konversiberat) as HrgSatKmsBI,sum(a.debet-a.kredit)/sum(c.bi/b.konversiberat) as HrgSatKmsSBI
from kartu a 
inner join Ref_KodeProdukIHT b on a.netral=b.kdgrade
inner join AkunProduksiHP c on a.netral=c.kodegrade and MONTH(a.Tanggal)=MONTH(c.tanggal) and YEAR(a.Tanggal)=YEAR(c.tanggal)
where a.kodeunit=@Kebun and a.netral<>'' and b.kdgrade<>'0210' and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.kodebudidaya=@kdbud and c.bi>0
group by a.KodeUnit,a.netral,b.NamaProduk,b.kemasan,b.merk,a.kodebudidaya
union all

---REALISASI BIAYA S/D BULAN LALU
select a.KodeUnit,a.kodebud as kdbud,a.netral as kodeproduk,b.merk,b.NamaProduk,b.kemasan,0 as JFBI,0 as JFSBI,0 as NilaiBI,sum(a.nilai) as NilaiSBI,0 as KemasanBI,sum(c.bi/b.konversiberat) as KemasanSBI,
0 as HrgSatKgBI,sum(a.nilai)/sum(c.bi) as HrgSatKgSBI,
0 as HrgSatKmsBI,sum(a.nilai)/sum(c.bi/b.konversiberat) as HrgSatKmsSBI
from AkunMemorial a 
inner join Ref_KodeProdukIHT b on a.netral=b.kdgrade
inner join #ProduksiHP c on a.netral=c.kodegrade 
where a.kodeunit=@Kebun and a.DK='D' and a.netral<>'' and b.kdgrade<>'0210' and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.kodebud=@kdbud and c.bi>0 and a.NoInput in ('SALDO AWAL','TRANSAKSI')
group by a.KodeUnit,a.netral,b.NamaProduk,b.kemasan,b.merk,a.kodebud
union all
select a.KodeUnit,a.kodebud as kdbud,a.netral as kodeproduk,b.merk,b.NamaProduk,b.kemasan,0 as JFBI,0 as JFSBI,0 as NilaiBI,-1*sum(a.nilai) as NilaiSBI,0 as KemasanBI,sum(c.bi/b.konversiberat) as KemasanSBI,
0 as HrgSatKgBI,-1*sum(a.nilai)/sum(c.bi) as HrgSatKgSBI,
0 as HrgSatKmsBI,-1*sum(a.nilai)/sum(c.bi/b.konversiberat) as HrgSatKmsSBI
from AkunMemorial a 
inner join Ref_KodeProdukIHT b on a.netral=b.kdgrade
inner join #ProduksiHP c on a.netral=c.kodegrade 
where a.kodeunit=@Kebun and a.DK='K' and a.netral<>'' and b.kdgrade<>'0210' and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.kodebud=@kdbud and c.bi>0 and a.NoInput in ('SALDO AWAL','TRANSAKSI')
group by a.KodeUnit,a.netral,b.NamaProduk,b.kemasan,b.merk,a.kodebud

select a.kodeunit,'UNIT : '+b.namakebun as nmUnit,c.nm_bud as nmBud,a.kodeproduk,a.merk,a.namaproduk,a.kemasan,a.kdbud,
sum(a.JFBI) as JFBI,
sum(a.JFSBI) as JFSBI,
sum(a.NilaiBI) as NilaiBI,
sum(a.NilaiSBI) as NilaiSBI,
sum(a.JFBI/d.konversiberat) as KemasanBI,
sum(a.JFSBI/konversiberat) as KemasanSBI,
0 as HrgSatKgBI,
0 as HrgSatKgSBI,
0 as HrgSatKmsBI,
0 as HrgSatKmsSBI
into #t2
from #t1 a
inner join #ref_Kebun b on a.kodeunit=b.kodekebun
inner join #ref_budidaya c on a.kdbud=c.kd_bud
inner join Ref_KodeProdukIHT d on a.kodeproduk=d.kdgrade
group by a.kodeunit,b.namakebun,a.kodeproduk,a.merk,a.namaproduk,a.kemasan,a.kdbud,c.nm_bud

select kodeproduk as [KODE PRODUK],NamaProduk AS [NAMA PRODUK],round(NilaiBI,0) as [REAL.BL.INI],round(NilaiSBI,0) AS [REAL.S/D BL.INI] into #t3 from #t2
union all
select '99999' as kodeproduk,'JUMLAH' as NamaProduk,sum(round(NilaiBI,0)),sum(round(NilaiSBI,0)) from #t2

update #t3 set [REAL.BL.INI]=0 where [REAL.BL.INI] is null
update #t3 set [REAL.S/D BL.INI]=0 where [REAL.S/D BL.INI] is null

select * from #t3 order by [KODE PRODUK] 
SET NOCOUNT ON;
END

--set dateformat dmy exec cek_BiayaProduksiSKU '29-12-2016','02','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[cek_BiayaUmum]
@tanggal datetime,
@Kebun varchar(2)
as
set dateformat dmy
BEGIN
SET NOCOUNT ON;

declare @AwalThn datetime
declare @TglAwal datetime
declare @TglLalu datetime
declare @TglAkhir datetime

set @TglAkhir=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @AwalThn='01-01-'+cast(year(@tanggal) as varchar(4))
set @TglAwal='01-'+cast(month(@tanggal) as varchar(2))+'-'+cast(year(@tanggal) as varchar(4))
set @TglLalu= @TglAwal-1

select * into #AkunMemorial from AkunMemorial where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and KodeUnit=@kebun
select * into #AkunRKAP     from AkunRKAP     where YEAR(tanggal)=YEAR(@tanggal)   and KodeUnit=@kebun
select * into #kartu        from Kartu        where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and KodeUnit=@kebun

--REALIASAI BULAN LALU
select substring(norek,1,3) as norek,cast(0 as float) as BI,cast(0 as float) as ABI,sum(nilai) as SBI,cast(0 as float) as ASBI
into #t1
from #AkunMemorial 
where dk='D' and noinput in ('SALDO AWAL','TRANSAKSI') and (substring(norek,1,1)='4') 
group by substring(norek,1,3)
union all
select substring(norek,1,3) as norek,0 as BI,0 as ABI,-1*sum(nilai) as SBI,0 as ASBI
from #AkunMemorial 
where dk='K' and noinput in ('SALDO AWAL','TRANSAKSI') and (substring(norek,1,1)='4') 
group by substring(norek,1,3)
union all

--BIAYA UMUM BULAN INI
select substring(norek,1,3) as norek,SUM(Debet-kredit) as bi,0 as abi,SUM(Debet-kredit) as sbi,0 as asbi 
from #Kartu
where SUBSTRING(norek,1,1)='4'
group by substring(norek,1,3)
union all

--ANGGARAN BULAN INI
select substring(norek,1,3) as norek,0 as bi,SUM(nilai_RKAP) as abi,0 as sbi,0 as asbi 
from #AkunRKAP
where SUBSTRING(norek,1,1)='4' and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)
group by substring(norek,1,3)
union all

--ANGGARAN SAMPAI DENGAN BULAN INI
select substring(norek,1,3) as norek,0 as bi,0 as abi,0 as sbi,SUM(nilai_RKAP) as asbi 
from #AkunRKAP
where SUBSTRING(norek,1,1)='4' and tanggal>=@AwalThn AND tanggal<=@TglAkhir
group by substring(norek,1,3)

select 'BIAYA UMUM (NON PENYUSUTAN)' as URAIAN,SUM(bi) as [REAL.BL.INI],SUM(abi) as [RKAP BL.INI],SUM(sbi) as [REAL.SD BL.INI],SUM(asbi) as [RKAP SD BL.INI]
from #t1
where not SUBSTRING(norek,1,3)='490'
union all
select 'BIAYA UMUM (PENYUSUTAN)' as Ket,SUM(bi) as bi,SUM(abi) as abi,SUM(sbi) as sbi,SUM(asbi) as asbi 
from #t1
where SUBSTRING(norek,1,3)='490'
union all
select 'BIAYA UMUM (TOTAL)' as Ket,SUM(bi) as bi,SUM(abi) as abi,SUM(sbi) as sbi,SUM(asbi) as asbi 
from #t1

SET NOCOUNT ON;
END
--set dateformat dmy exec CekBiayaUmum '01-12-2016','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[cek_IkhtisarLabaRugi]
@tanggal datetime,
@kebun varchar(2)
as
begin
set nocount on
set dateformat dmy
declare @AwalTahun datetime
declare @TglLalu datetime
declare @TglAwal datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal='01-'+cast(MONTH(@tanggal) as varchar(2))+'-'+cast(YEAR(@tanggal) as varchar(4))
set @TglLalu=@TglAwal-1

select KodeUnit,norek,0 as BI,0 as PBI,0 as ABI,SUM(nilai) as SBI,0 as PSBI,0 as ASBI
into #t1
from AkunMemorial 
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and NoInput in ('SALDO AWAL','TRANSAKSI') and DK='D' and SUBSTRING(norek,1,1) in ('6','4') and KodeUnit=@kebun
group by KodeUnit,norek
union all
select KodeUnit,norek,0 as BI,0 as PBI,0 as ABI,-1*SUM(nilai) as SBI,0 as PSBI,0 as ASBI
from AkunMemorial 
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and NoInput in ('SALDO AWAL','TRANSAKSI') and DK='K' and SUBSTRING(norek,1,1) in ('8') and KodeUnit=@kebun
group by KodeUnit,norek
union all
select KodeUnit,Norek,Debet-kredit as BI,0 as PBI,0 as ABI,Debet-kredit as SBI,0 as PSBI,0 as ASBI 
from Kartu
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,1) in ('8','6','4') and KodeUnit=@kebun
union all
select KodeUnit,Norek,0 as BI,nilai_PMK as PBI,nilai_RKAP as ABI,0 as SBI,nilai_PMK as PSBI,nilai_RKAP as ASBI 
from AkunRKAP
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,1) in ('8','6','4') and KodeUnit=@kebun
union all
select KodeUnit,Norek,0 as BI,0 as PBI,0 as ABI,0 as SBI,nilai_PMK as PSBI,nilai_RKAP as ASBI 
from AkunRKAP
where tanggal>=@AwalTahun and tanggal<=@TglLalu and SUBSTRING(norek,1,1) in ('8','6','4') and KodeUnit=@kebun

select KodeUnit,norek,-1*SUM(bi) as bi,-1*SUM(pbi) as pbi,-1*SUM(abi) as abi,-1*SUM(sbi) as sbi,-1*SUM(psbi) as psbi,-1*SUM(asbi) as asbi 
into #t2
from #t1 where norek like '8%'
group by KodeUnit,norek
union all
select KodeUnit,norek,-1*SUM(bi) as bi,-1*SUM(pbi) as pbi,-1*SUM(abi) as abi,-1*SUM(sbi) as sbi,-1*SUM(psbi) as psbi,-1*SUM(asbi) as asbi 
from #t1 where substring(norek,1,1) in ('4','6')
group by KodeUnit,norek

select KodeUnit,'1' as Grup,'PENDAPATAN' as nmGrup,'859' as KRBB,norek,SUM(BI) as BI,SUM(PBI) as PBI,SUM(ABI) as ABI,SUM(SBI) as SBI,SUM(PSBI) as PSBI,SUM(ASBI) as ASBI 
into #t3
from #t2
where norek like '8%'
group by KodeUnit,norek
union all
select KodeUnit,'2' as Grup,'BIAYA LANGSUNG' as nmGrup,'640' as KRBB,norek,SUM(BI) as BI,SUM(PBI) as PBI,SUM(ABI) as ABI,SUM(SBI) as SBI,SUM(PSBI) as PSBI,SUM(ASBI) as ASBI 
from #t2
where norek like '6%'
group by KodeUnit,norek
union all
select KodeUnit,'3' as Grup,'BIAYA ADMINISTRASI' as nmGrup,'400-490' as KRBB,norek,SUM(BI) as BI,SUM(PBI) as PBI,SUM(ABI) as ABI,SUM(SBI) as SBI,SUM(PSBI) as PSBI,SUM(ASBI) as ASBI 
from #t2
where norek like '4%'
group by KodeUnit,norek

select a.Grup,a.nmGrup,a.KRBB,a.norek,c.NamaRekening,
a.BI,a.PBI,a.ABI,a.SBI,a.PSBI,a.ASBI,
cast(0 as float) as xBI,cast(0 as float) as xPBI,cast(0 as float) as xABI,cast(0 as float) as xSBI,cast(0 as float) as xPSBI,cast(0 as float) as xASBI
into #t4
from #t3 a
inner join Ref_Rekening c on a.norek=c.Norek
where a.BI+a.PBI+a.ABI+a.SBI+a.PSBI+a.ASBI<>0

update #t4 set xBI=(BI),xPBI=(PBI),xABI=(ABI),xSBI=(SBI),xPSBI=(PSBI),xASBI=(ASBI) where substring(norek,1,1) in ('8')
update #t4 set xBI=(BI),xPBI=(PBI),xABI=(ABI),xSBI=(SBI),xPSBI=(PSBI),xASBI=(ASBI) where substring(norek,1,1) in ('6')

select Grup,nmGrup,SUM(bi) as [REAL.BL.INI],SUM(abi) as [RKAP BL.INI],SUM(SBI) as [REAL.SD.BI],SUM(ASBI) as [RKAP SD.BL.INI]
INTO #T5
from #t4
group by Grup,nmGrup
union all
select '9' as Grup,'LABA(RUGI)' as nmGrup,SUM(bi) as [REAL.BL.INI],SUM(abi) as [RKAP BL.INI],SUM(SBI) as [REAL.SD.BI],SUM(ASBI) as [RKAP SD.BL.INI]
from #t4

SELECT * FROM #T5 ORDER BY Grup
set nocount off
end
--set dateformat dmy exec cek_IkhtisarLabaRugi '01-12-2016','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc cek_Neraca
@Kebun varchar(2),
@tanggal datetime
as
set dateformat dmy
declare @AwalThn datetime
declare @AkhirBln datetime
declare @zero float
set @AwalThn='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @AkhirBln='01-'+cast(month(@tanggal) as varchar(2))+'-'+cast(YEAR(@tanggal) as varchar(4))
set @zero=0

select * into #T1 from ref_lm where kode='701' and tampil='YA' and kodeunit=@Kebun
select * into #Kartu from Kartu where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and KodeUnit=@Kebun

select KodeUnit,tanggal,NoInput,NoBukti,Keterangan,NoUrut,kodeafd,kodebud,norek,netral,kdblok,thntnm,uraian,unsur,DK,JmlFisik,nilai as debet,@zero as kredit 
into #SawalKRBB
from AkunMemorial 
where NoInput like 'SAL%' and KodeUnit=@Kebun and MONTH(tanggal)=1 and YEAR(tanggal)=YEAR(@tanggal) and DK='D'
union all
select KodeUnit,tanggal,NoInput,NoBukti,Keterangan,NoUrut,kodeafd,kodebud,norek,netral,kdblok,thntnm,uraian,unsur,DK,JmlFisik,@zero as debet,nilai as kredit 
from AkunMemorial 
where NoInput like 'SAL%' and KodeUnit=@Kebun and MONTH(tanggal)=1 and YEAR(tanggal)=YEAR(@tanggal) and DK='K'
union all

select KodeUnit,Tanggal,NoInput,NoBukti,'' as keterangan,'' as nourut,KodeAfdeling,KodeBudidaya,Norek,Netral,kdblok,'' as thntnm,Uraian,KodeUnsur,'D' as dk,Jml_fisik,Debet,@zero as kredit 
from kartu 
where KodeUnit=@Kebun and Debet>0 and Tanggal>=@AwalThn and Tanggal<@AkhirBln
union all
select KodeUnit,Tanggal,NoInput,NoBukti,'' as keterangan,'' as nourut,KodeAfdeling,KodeBudidaya,Norek,Netral,kdblok,'' as thntnm,Uraian,KodeUnsur,'K' as dk,Jml_fisik,@zero,Kredit as kredit 
from kartu 
where KodeUnit=@Kebun and Kredit>0 and Tanggal>=@AwalThn and Tanggal<@AkhirBln

select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as Norek,b.uraian,sum(a.debet) as sawdebet,cast(0 as float) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
into #TS1
from #SawalKRBB a
inner join #T1 b on substring(a.norek,1,len(b.norek))=b.norek
where a.KodeUnit=@Kebun and a.dk='D' and substring(a.norek,1,len(b.norek)) in (select distinct norek from ref_lm where kode='701' and tampil='YA') and substring(a.norek,1,2) not in ('40','41','42') and not substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as Norek,b.uraian,cast(0 as float) as sawdebet,sum(a.kredit) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
from #SawalKRBB a
inner join #T1 b on substring(a.norek,1,len(b.norek))=b.norek
where a.KodeUnit=@Kebun and a.dk='K' and substring(a.norek,1,len(b.norek)) in (select distinct norek from ref_lm where kode='701' and tampil='YA') and substring(a.norek,1,2) not in ('40','41','42') and not substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all

--SALDO AWAL BIAYA UMUM
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,'404142' as Norek,b.uraian,sum(a.debet) as sawdebet,cast(0 as float) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
from #SawalKRBB a
inner join #T1 b on '404142'=b.norek
where a.KodeUnit=@Kebun and a.dk='D' and substring(a.norek,1,2) in ('40','41','42') and substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,'404142' as Norek,b.uraian,cast(0 as float) as sawdebet,sum(a.kredit) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
from #SawalKRBB a
inner join #T1 b on '404142'=b.norek
where a.KodeUnit=@Kebun and a.dk='K' and substring(a.norek,1,2) in ('40','41','42') and substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup

select kdkbn,kdgrup,nmgrup,urut,norek,uraian,sum(sawDebet-sawKredit) as nilai into #TS2 from #TS1 group by kdkbn,kdgrup,nmgrup,urut,norek,uraian

select kdkbn,kdgrup,nmgrup,urut,norek,uraian,sum(nilai) as SawDebet,0 as sawKredit,0 as Debet,0 as Kredit into #TS3 from #TS2 where nilai>0 group by kdkbn,kdgrup,nmgrup,urut,norek,uraian
union all
select kdkbn,kdgrup,nmgrup,urut,norek,uraian,0 as SawDebet,sum(abs(nilai)) as sawKredit,0 as Debet,0 as Kredit from #TS2 where nilai<0 group by kdkbn,kdgrup,nmgrup,urut,norek,uraian

select * into #T2 from #TS3
union all
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as Norek,b.uraian,0 as sawdebet,0 as sawkredit,sum(debet) as debet,sum(kredit) as kredit 
from #kartu a
inner join #T1 b on substring(a.norek,1,len(b.norek))=b.norek
where substring(a.norek,1,len(b.norek)) in (select distinct norek from ref_lm where kode='701' and tampil='YA') and substring(a.norek,1,2) not in ('40','41','42') and not substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all

select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,'404142' as Norek,b.uraian,0 as sawdebet,0 as sawkredit,sum(debet) as debet,sum(kredit) as kredit 
from #kartu a
inner join #T1 b on '404142'=substring(b.norek,1,6)
where substring(a.norek,1,2) in ('40','41','42') 
group by a.kodeunit,b.kdgrup,b.urut,b.uraian,b.nmgrup
union all
select kodeunit as kdkbn,kdgrup,nmgrup,urut,norek,uraian,0,0,0,0 from #t1

select 'Kebun/Unit : '+b.NamaKebun as nmKbn,a.kdgrup,a.nmgrup,a.urut,a.norek,a.uraian,sum(a.sawdebet) as sawdebet,sum(a.sawkredit) as sawkredit,sum(a.debet) as debet,sum(a.kredit) as kredit,
sum(sawDebet+debet-sawKredit-kredit) as nilai
into #t3
from #t2 a
inner join SPDK_KBN_MASTER_REF..ref_kebun b on @Kebun=b.KodeKebun
group by b.NamaKebun,a.kdgrup,a.urut,a.norek,a.uraian,a.nmgrup

select nmKbn,kdgrup,nmgrup,urut,norek,uraian,sawdebet,sawkredit,debet,kredit,nilai as sakdebet,0 as sakkredit 
into #t4
from #t3 
where nilai>=0
union all
select nmKbn,kdgrup,nmgrup,urut,norek,uraian,sawdebet,sawkredit,debet,kredit,0 as sakdebet,abs(nilai) as sakkredit 
from #t3 
where nilai<0

update #t4 set norek='400-426' where norek='404142'

select nmKbn,kdgrup,nmgrup,urut,norek,uraian,sum(sawdebet) as sawdebet,sum(sawkredit) as sawkredit,sum(debet) as debet,sum(kredit) as kredit,sum(sakdebet) as sakdebet,sum(sakkredit) as sakkredit 
into #t5
from #t4
where sawdebet+sawkredit+debet+kredit+sakdebet+sakkredit<>0
group by nmKbn,kdgrup,nmgrup,urut,norek,uraian

select '1' as urut,'DEBET' as URAIAN,ROUND(sum(sawdebet),0) as [SALDO AWAL],ROUND(sum(debet),0) as MUTASI,ROUND(sum(sakdebet),0) as [SALDO AKHIR]
from #t5
union all
select '2' as urut,'KREDIT' as uraian,ROUND(sum(sawkredit),0) as sawdebet,ROUND(sum(kredit),0) as debet,ROUND(sum(sakkredit),0) as sakdebet
from #t5
union all
select '3' as urut,'SELISIH' as uraian,ROUND(sum(sawdebet-sawkredit),0) as sawdebet,ROUND(sum(debet-kredit),0) as debet,ROUND(sum(sakdebet-sakkredit),0) as sakdebet
from #t5
order by urut

--set dateformat dmy exec SP_Test '13','01-05-2017'
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create proc [dbo].[cek_Neraca_VS_Aktiva]
@tanggal datetime,
@Kebun varchar(2)
as
set dateformat dmy
declare @AwalTahun datetime
declare @AkhirBulan datetime
set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @AkhirBulan=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select distinct Norek,uraian into #tabel from SPDK_KBN_MASTER_REF..Ref_TarifAktiva 
union all
select distinct '04'+substring(Norek,3,1),uraian from SPDK_KBN_MASTER_REF..Ref_TarifAktiva where Norek not in (000,001,002,010,011) 
union all
select distinct '049',uraian from SPDK_KBN_MASTER_REF..Ref_TarifAktiva where Norek in (011) 

select distinct nobukti into #tb1 from AktivaMaster 
where tgltran>=@AwalTahun and tgltran<=@AkhirBulan and SUBSTRING(nobukti,1,3)='SST'

--SALDO AWAL
select 'AKTIVA TETAP' as Kelompok,kodeunit,'1' as grup,SUBSTRING(norek,1,3) as krbb,nmaktiva,SPACE(2) as blnsst,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
INTO #T1
from AktivaMaster
where kodeunit=@Kebun and YEAR(tgltran)=YEAR(@tanggal) and nobukti='SALDO AWAL' AND SUBSTRING(norek,1,3) not in (043,044,045,046,047,048,049)
union all
select 'INVESTASI TAHUN BERJALAN' as Kelompok,kodeunit,'2' as grup,SUBSTRING(norek,1,3) as krbb,nmaktiva,SPACE(2) as blnsst,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster
where kodeunit=@Kebun and YEAR(tgltran)=YEAR(@tanggal) and nobukti='SALDO AWAL' AND SUBSTRING(norek,1,3) in (043,044,045,046,047,048,049)
union all

--TRANSAKSI AKTIVA TAHUN BERJALAN
select 'AKTIVA TETAP' as Kelompok,kodeunit,'1' as grup,substring(norek,1,3) as krbb,nmaktiva,SPACE(2) as blnsst,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster 
where kodeunit=@Kebun and nobukti<>'SALDO AWAL' AND SUBSTRING(norek,1,3) not in (043,044,045,046,047,048,049) and tgltran>=@AwalTahun and tgltran<=@AkhirBulan
union all

--TRANSAKSI INVESTASI TAHUN BERJALAN
select 'INVESTASI TAHUN BERJALAN' as Kelompok,kodeunit,'2' as grup,substring(norek,1,3) as krbb,nmaktiva,SPACE(2) as blnsst,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster 
where kodeunit=@Kebun and nobukti<>'SALDO AWAL' and SUBSTRING(norek,1,3) in (043,044,045,046,047,048,049) and tgltran>=@AwalTahun and tgltran<=@AkhirBulan

update #T1 set blnsst=(select COUNT(*) from #tb1)

--REKAPITULASI
select a.kelompok,'KEBUN/UNIT : '+b.NamaKebun as kebun,
'Per : '+cast(substring(convert(varchar(50),@AwalTahun,105),1,10) as varchar(50))as awaltahun,'Per : '+cast(substring(convert(varchar(50),@akhirbulan,105),1,10) as varchar(50))as akhirbulan,
a.grup,a.krbb,d.Uraian as nmaktiva,a.blnsst,
SUM(a.sawalp) as sawalp,SUM(a.auditp) as auditp,SUM(a.rcp) as rcp,SUM(a.hapusp) as hapusp,SUM(a.rekp) as rekp,SUM(a.kbnp) as kbnp,SUM(a.murnip) as murnip,
SUM(a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip) as jmlmutasip,
SUM(a.sawalp+a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip) as jmlperolehan,
SUM(a.sawals) as sawals,SUM(a.audits) as audits,SUM(a.rcs) as rcs,SUM(a.hapuss) as hapuss,SUM(a.reks) as reks,SUM(a.kbns) as kbns,SUM(a.murnis) as murnis,
SUM(a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as jmlmutasis,
SUM(a.sawals+a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as jmlpenyusutan,
SUM(a.sawalp+a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip)-SUM(a.sawals+a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as NilaiBuku
INTO #T2
from #T1 a
inner join SPDK_KBN_MASTER_REF..Ref_Kebun b on a.kodeunit=b.KodeKebun
inner join #tabel d on a.krbb=d.Norek 
group by b.NamaKebun,a.Kelompok,a.grup,a.krbb,d.Uraian,a.blnsst
--order by grup,krbb

select '2' as urut,'AKTIVA TETAP' as uraian,SUM(jmlperolehan) as Perolehan,SUM(jmlpenyusutan) as Penyusutan,SUM(jmlperolehan-jmlpenyusutan) as NilaiBuku into #t3 from #T2
union all
--PEROLEHAN DARI SALDO AWAL
select '1' as urut,'NERACA' as uraian,SUM(Nilai) as Perolehan,0 as Penyusutan,0 as jmlperolehan from AkunMemorial where KodeUnit=@Kebun and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and DK='D' and SUBSTRING(norek,1,2) in ('00','01') and SUBSTRING(NoInput,1,3) in ('SAL','TRA')
union all
select '1' as urut,'NERACA' as uraian,-1*SUM(Nilai) as Perolehan,0 as Penyusutan,0 as jmlperolehan from AkunMemorial where KodeUnit=@Kebun and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and DK='K' and SUBSTRING(norek,1,2) in ('00','01') and SUBSTRING(NoInput,1,3) in ('SAL','TRA')
union all
--PENYUSUTAN DARI SALDO AWAL
select '1' as urut,'NERACA' as uraian,0 as Perolehan,SUM(Nilai) as Penyusutan,0 as jmlperolehan from AkunMemorial where KodeUnit=@Kebun and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and DK='D' and SUBSTRING(norek,1,2) in ('02','03') and SUBSTRING(NoInput,1,3) in ('SAL','TRA')
union all
select '1' as urut,'NERACA' as uraian,0 as Perolehan,-1*SUM(Nilai) as Penyusutan,0 as jmlperolehan from AkunMemorial where KodeUnit=@Kebun and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and DK='K' and SUBSTRING(norek,1,2) in ('02','03') and SUBSTRING(NoInput,1,3) in ('SAL','TRA')
union all
--PEROLEHAN DARI MUTASI BULAN INI
select '1' as urut,'NERACA' as uraian,SUM(debet-kredit) as Perolehan,0 as Penyusutan,0 as jmlperolehan from Kartu where KodeUnit=@Kebun and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,2) in ('00','01')
union all
select '1' as urut,'NERACA' as uraian,0 as Perolehan,SUM(debet-kredit) as Penyusutan,0 as jmlperolehan from Kartu where KodeUnit=@Kebun and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,2) in ('02','03')

select urut,uraian,abs(SUM(Perolehan)) as Perolehan,abs(SUM(Penyusutan)) as Penyusutan 
into #t4
from #t3 where urut='1'
group by urut,uraian
union all
select urut,uraian,abs(SUM(Perolehan)) as Perolehan,abs(SUM(Penyusutan)) as Penyusutan 
from #t3 where urut='2'
group by urut,uraian

select urut,uraian,-1*Perolehan as Perolehan,-1*Penyusutan as Penyusutan into #t5 from #t4 where urut='1'
union all
select urut,uraian,Perolehan,Penyusutan from #t4 where urut='2'

select urut,uraian,abs(SUM(Perolehan)) as PEROLEHAN,abs(SUM(Penyusutan)) as PENYUSUTAN,abs(SUM(Perolehan-Penyusutan)) as NILAIBUKU from #t5 group by urut,uraian
union all
select '3' as urut,'SELISIH' as uraian,abs(SUM(Perolehan)),abs(SUM(Penyusutan)),abs(SUM(Perolehan-Penyusutan)) from #t5
order by urut

--set dateformat dmy exec cekNeraca_VS_Aktiva '01-12-2016','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[cek_Neraca_VS_KAS]
@Tanggal datetime,
@kebun varchar(2)
as
set dateformat dmy
declare @TglAwal datetime 
declare @TglAkhir datetime 
set @TglAwal='01-'+cast(month(@Tanggal) as varchar(2))+'-'+cast(year(@Tanggal) as varchar(4))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

--SALDO AWAL
SELECT KodeUnit as kdunit,rekkb,sum(nilai) as Sawal,0 as Debet,0 as Kredit into #TmpSaldo from KasBank
where Tanggal=@TglAwal and noinput='Saldo Awal' and KodeUnit=@kebun
group by KodeUnit,rekkb
union all

--MUTASI BULAN INI
--PENERIMAAN KAS/BANK
SELECT a.KodeUnit as kdunit,a.rekkb,0 as Sawal,sum(a.nilai) as Debet,0 as Kredit from KasBank a
inner join kasbankv b on a.noinput=b.noinput
where b.tgl_ver>=@TglAwal and b.tgl_ver<=@TglAkhir and a.nilai>0 and a.KT in('KT','BT') and substring(b.nobuku,5,1)<>'' and a.NoInput<>'SALDO AWAL' and a.KodeUnit=@kebun
group by a.kodeunit,a.rekkb
union all
SELECT a.KodeUnit as kdunit,a.rekkb,0 as Sawal,0 as Debet,sum(abs(a.nilai)) as Kredit from KasBank a
inner join kasbankv b on a.noinput=b.noinput
where b.tgl_ver>=@TglAwal and b.tgl_ver<=@TglAkhir and a.nilai<0 and a.KT in('KT','BT') and substring(b.nobuku,5,1)<>'' and a.NoInput<>'SALDO AWAL' and a.KodeUnit=@kebun
group by a.kodeunit,a.rekkb
union

--PENGELUARAN KAS/BANK
SELECT a.KodeUnit as kdunit,a.rekkb,0 as Sawal,0 as Debet,sum(a.nilai) as Kredit from KasBank a
inner join kasbankv b on a.noinput=b.noinput
where b.tgl_ver>=@TglAwal and b.tgl_ver<=@TglAkhir and a.nilai>0 and a.KT in('KK','BK') and substring(b.nobuku,5,1)<>'' and a.NoInput<>'SALDO AWAL' and a.KodeUnit=@kebun
group by a.kodeunit,a.rekkb
union
SELECT a.KodeUnit as kdunit,a.rekkb,0 as Sawal,sum(abs(a.nilai)) as Debet,0 as Kredit from KasBank a
inner join kasbankv b on a.noinput=b.noinput
where b.tgl_ver>=@TglAwal and b.tgl_ver<=@TglAkhir and a.nilai<0 and a.KT in('KK','BK') and substring(b.nobuku,5,1)<>'' and a.NoInput<>'SALDO AWAL' and a.KodeUnit=@kebun
group by a.kodeunit,a.rekkb

select KodeUnit,norek,nilai into #t1 from AkunMemorial where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and substring(NoInput,1,3) in ('SAL','TRA') and DK='D' and SUBSTRING(norek,1,3) in ('100','110') and KodeUnit=@kebun
union all
select KodeUnit,norek,-1*nilai from AkunMemorial where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and substring(NoInput,1,3) in ('SAL','TRA') and DK='K' and SUBSTRING(norek,1,3) in ('100','110') and KodeUnit=@kebun
union all
select KodeUnit,norek,Debet as nilai from Kartu where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and SUBSTRING(norek,1,3) in ('100','110') and Debet<>0 and KodeUnit=@kebun
union all
select KodeUnit,norek,-1*Kredit as nilai from Kartu where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and SUBSTRING(norek,1,3) in ('100','110') and Kredit<>0 and KodeUnit=@kebun

select a.rekkb as Norek,b.NamaRekening as Uraian,
sum(a.Sawal+a.Debet-a.Kredit) as Saldo,0 as Neraca
into #t2
from #TmpSaldo a
inner join Ref_Rekening b on a.rekkb=b.norek
inner join SPDK_KBN_MASTER_REF..Ref_kebun    c on a.kdunit=c.KodeKebun
group by a.rekkb,b.NamaRekening
union all
select a.norek,b.NamaRekening,0 as Kas,SUM(a.nilai) as nilai from #t1 a
inner join Ref_Rekening b on a.KodeUnit=b.KodeUnit and a.norek=b.Norek
group by b.NamaRekening,a.norek

select Norek,Uraian,SUM(saldo) as [KAS/BANK],SUM(Neraca) AS NERACA,SUM(saldo)-SUM(Neraca) AS SELISIH
from #t2 
group by Norek,Uraian
order by Norek

--set dateformat dmy exec cek_Neraca_VS_KAS '01-12-2016','14'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create proc [dbo].[cek_Neraca_VS_TUP] 
@Tanggal datetime, 
@kebun varchar(2)
as 
set dateformat dmy
declare @NamaKebun varchar(50)
declare @TglAwal datetime
declare @TglAkhir datetime 
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @NamaKebun=(select top 1 NamaKebun from SPDK_KBN_MASTER_REF..Ref_Kebun where KodeKebun=@kebun)

select * into #TUP from TUP where KodeUnit=@kebun and MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) 
select * into #AkunMemorial from AkunMemorial where KodeUnit=@kebun and MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and norek like '30%'
select Norek,SUM(Debet-kredit) as nilai into #Kartu from Kartu where KodeUnit=@kebun and MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and norek like '30%' group by Norek
 
--SALDO AWAL
select kodeunit,kodebarang,sum(nilai) as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
into #t1 
from #tup 
where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and noinput='SALDO AWAL' 
group by kodeunit,kodebarang 
union all
 
--MUTASI BULAN INI
--PEMBELIAN SENDIRI
select kodeunit,kodebarang,0 as sawNilai,sum(nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=1) and tanggal<'01-09-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,sum((nilai*.1)+nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=2) and tanggal<'01-09-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,sum((nilai*.1)+nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014' 
group by kodeunit,kodebarang 
union all 

select kodeunit,kodebarang,0 as sawNilai,sum(nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,sum((nilai*.1)+nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 

select kodeunit,kodebarang,0 as sawNilai,sum(nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=0 
group by kodeunit,kodebarang 
union all 
 
--PEMBELIAN DARI KEBUN SE-INDUK
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,sum(nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=1) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,sum((nilai*.1)+nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=2) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,sum((nilai*.1)+nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,sum(nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,sum((nilai*.1)+nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,sum(nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=0 
group by kodeunit,kodebarang 
union all 
 
--PEMBELIAN DARI KANTOR PUSAT
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum(nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=1) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum((nilai*.1)+nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=2) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum((nilai*.1)+nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum(nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum((nilai*.1)+nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum(nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=0 
group by kodeunit,kodebarang 
union all 
 
--PENERIMAAN LAIN-LAIN
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum(nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=1) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum((nilai*.1)+nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=2) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum((nilai*.1)+nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum(nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum((nilai*.1)+nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum(nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=0 
group by kodeunit,kodebarang 
union all 
 
--PEMAKAIAN SENDIRI
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,sum(nilai) as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and not substring(norek,1,3) in ('080','196') 
group by kodeunit,kodebarang 
union all 
 
--PEMAKAIAN KEBUN SE-INDUK
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,sum(nilai) as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and substring(norek,1,5)='08002' and not substring(norek,1,7)='0800209' 
group by kodeunit,kodebarang 
union all 
 
--PEMAKAIAN KANTOR PUSAT
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,sum(nilai) as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and substring(norek,1,7)='0800209' 
group by kodeunit,kodebarang 
union all 
 
--PEMAKAIAN LAIN-LAIN
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,sum(nilai) as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and substring(norek,1,3) in ('196') 
group by kodeunit,kodebarang 
union all 
 
--KOREKSI KELEBIHAN
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum(nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR' and nilai>0 
group by kodeunit,kodebarang 
union all 
 
--KOREKSI KEKURANGAN
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,sum(abs(nilai)) as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR' and nilai<0 
group by kodeunit,kodebarang 
 
select @TglAwal-1 as per,substring(b.norek,1,5) as grup,'KEBUN/UNIT : '+c.namakebun as namakebun,b.norek,d.namarekening, 
sum(a.sawNilai) as sawNilai, 
sum(a.trmSDR) as trmSDR, 
sum(a.trmKBN) as trmKBN, 
sum(a.trmDIR) as trmDIR, 
sum(a.trmLLN) as trmLLN, 
sum(a.trmSDR+a.trmKBN+a.trmDIR+a.trmLLN) as trmJML, 
sum(a.klrSDR) as klrSDR, 
sum(a.klrKBN) as klrKBN, 
sum(a.klrDIR) as klrDIR, 
sum(a.klrLLN) as klrLLN, 
sum(a.klrSDR+a.klrKBN+a.klrDIR+a.klrLLN) as klrJML, 
sum(a.sawNilai+a.trmSDR+a.trmKBN+a.trmDIR+a.trmLLN)-sum(a.klrSDR+a.klrKBN+a.klrDIR+a.klrLLN) as sakNilai 
into #t2 
from #t1 a 
inner join SPDK_KBN_MASTER_REF..ref_barang b on a.kodebarang=b.kodebarang 
inner join SPDK_KBN_MASTER_REF..ref_kebun c on @kebun=c.KodeKebun 
inner join SPDK_KBN_MASTER_REF..ref_rekening d on b.norek=d.Norek 
group by a.kodeunit,b.norek,c.namakebun,d.namarekening 
 
select per,grup,namakebun,norek,namarekening, 
sum(sawNilai) as sawNilai, 
sum(trmSDR) as trmSDR, 
sum(trmKBN) as trmKBN, 
sum(trmDIR) as trmDIR, 
sum(trmLLN) as trmLLN, 
sum(trmJML) as trmJML, 
sum(klrSDR) as klrSDR, 
sum(klrKBN) as klrKBN, 
sum(klrDIR) as klrDIR, 
sum(klrLLN) as klrLLN, 
sum(klrJML) as klrJML, 
sum(sakNilai) as sakNilai
into #t3 
from #t2 
where sawNilai+trmJML+klrJML<>0 
group by per,grup,namakebun,norek,namarekening 

select norek,SUM(sakNilai) as TUP,0 as Neraca into #t4 from #t3 group by norek
union all
select norek,0 as TUP,sum(nilai) as Neraca from #AkunMemorial where DK='D' group by norek
union all
select norek,0 as TUP,-1*sum(nilai) as Neraca from #AkunMemorial where DK='K' group by norek
union all
select norek,0 as TUP,sum(nilai) as Neraca from #Kartu group by norek

select a.norek,b.NamaRekening,SUM(a.TUP) as TUP,SUM(a.Neraca) as Neraca 
into #t5
from #t4 a
inner join SPDK_KBN_MASTER_REF..Ref_Rekening b on a.norek=b.Norek
group by a.norek,b.NamaRekening

select @NamaKebun as [NAMAKEBUN],norek,substring(norek,1,3)+'.'+substring(norek,4,2)+'.'+substring(norek,6,2)+'.'+substring(norek,8,2) AS [REKENING],NamaRekening,ROUND(TUP,0) as TUP,round(Neraca,0) as NERACA,round(TUP-Neraca,0) as SELISIH from #t5 where TUP+Neraca<>0
union all
select @NamaKebun as [NAMAKEBUN],'99' as norek,'' AS [REKENING],'JUMLAH' as NamaRekening,ROUND(SUM(TUP),0) as TUP,round(SUM(Neraca),0) as NERACA,round(SUM(TUP-Neraca),0) as SELISIH from #t5 where TUP+Neraca<>0
order by norek

--set dateformat dmy exec cek_Neraca_VS_TUP '01-12-2016','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create proc [dbo].[cek_NilaiBuku_Minus]
@tanggal datetime,
@Kebun varchar(2)
as
set dateformat dmy
declare @AwalTahun datetime
declare @AkhirBulan datetime
set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @AkhirBulan=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select distinct nobukti into #tb1 from AktivaMaster 
where tgltran>=@AwalTahun and tgltran<=@AkhirBulan and SUBSTRING(nobukti,1,3)='SST'

--SALDO AWAL
select kelompok as namagrup,'AKTIVA TETAP' as Kelompok,kelompokaset,kodeunit,kdafd,kdbud,'1' as grup,SUBSTRING(norek,1,3) as krbb,norek,tglbeli,noaktiva,nmaktiva,space(2) as blnsst,jmlunit,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
INTO #T1
from AktivaMaster
where kodeunit=@Kebun and YEAR(tgltran)=YEAR(@tanggal) and nobukti='SALDO AWAL' and SUBSTRING(norek,1,3) not in (043,044,045,046,047,048,049)
union all
select kelompok as namagrup,'INVESTASI TAHUN BERJALAN' as Kelompok,kelompokaset,kodeunit,kdafd,kdbud,'2' as grup,SUBSTRING(norek,1,3) as krbb,norek,tglbeli,noaktiva,nmaktiva,space(2) as blnsst,jmlunit,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster
where kodeunit=@Kebun and YEAR(tgltran)=YEAR(@tanggal) and nobukti='SALDO AWAL' and SUBSTRING(norek,1,3) in (043,044,045,046,047,048,049)
union all

--TRANSAKSI AKTIVA TAHUN BERJALAN
select kelompok as namagrup,'AKTIVA TETAP' as Kelompok,kelompokaset,kodeunit,kdafd,kdbud,'1' as grup,substring(norek,1,3) as krbb,norek,tglbeli,noaktiva,nmaktiva,space(2) as blnsst,jmlunit,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster 
where kodeunit=@Kebun and SUBSTRING(norek,1,3) not in (043,044,045,046,047,048,049) and tgltran>=@AwalTahun and tgltran<=@AkhirBulan and nobukti<>'SALDO AWAL'
union all

--TRANSAKSI INVESTASI TAHUN BERJALAN
select kelompok as namagrup,'INVESTASI TAHUN BERJALAN' as Kelompok,kelompokaset,kodeunit,kdafd,kdbud,'2' as grup,substring(norek,1,3) as krbb,norek,tglbeli,noaktiva,nmaktiva,space(2) as blnsst,jmlunit,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster 
where kodeunit=@Kebun and SUBSTRING(norek,1,3) in (043,044,045,046,047,048,049) and tgltran>=@AwalTahun and tgltran<=@AkhirBulan and nobukti<>'SALDO AWAL'

update #T1 set blnsst=(select COUNT(*) from #tb1)

--REKAPITULASI
select a.kodeunit,'KEBUN/UNIT : '+b.NamaKebun as kebun,a.Kelompok,a.namagrup,c.Uraian,a.kdafd,a.grup,a.krbb,a.norek,a.tglbeli,substring(a.noaktiva,1,10) as noaktiva,a.nmaktiva,a.blnsst,sum(a.jmlunit) as jmlunit,
SUM(a.sawalp) as sawalp,SUM(a.auditp) as auditp,SUM(a.rcp) as rcp,SUM(a.hapusp) as hapusp,SUM(a.rekp) as rekp,SUM(a.kbnp) as kbnp,SUM(a.murnip) as murnip,
SUM(a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip) as jmlmutasip,
SUM(a.sawalp+a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip) as jmlperolehan,
SUM(a.sawals) as sawals,SUM(a.audits) as audits,SUM(a.rcs) as rcs,SUM(a.hapuss) as hapuss,SUM(a.reks) as reks,SUM(a.kbns) as kbns,SUM(a.murnis) as murnis,
SUM(a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as jmlmutasis,
SUM(a.sawals+a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as jmlpenyusutan,
SUM(a.sawalp+a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip)-SUM(a.sawals+a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as NilaiBuku,
'Per : '+cast(substring(convert(varchar(50),@AwalTahun,105),1,10) as varchar(50))as AwalTahun,'Per : '+cast(substring(convert(varchar(50),@akhirbulan,105),1,10) as varchar(50))as akhirbulan
into #t2
from #T1 a
inner join SPDK_KBN_MASTER_REF..Ref_Kebun b on a.kodeunit=b.KodeKebun
inner join SPDK_KBN_MASTER_REF..Ref_TarifAktiva c on a.namagrup=c.norek and a.kdbud=c.kdbud and a.kelompokaset=c.kelompokaset
group by a.kodeunit,b.NamaKebun,a.Kelompok,a.kdafd,a.namagrup,c.Uraian,a.grup,a.krbb,a.norek,a.tglbeli,a.noaktiva,a.nmaktiva,a.blnsst
order by grup,krbb,noaktiva,tglbeli asc,norek

select substring(norek,1,3) as [REKENING],noaktiva as [NO.AKTIVA],nmaktiva as [NAMA AKTIVA],NilaiBuku as [NILAI BUKU] from #t2 where NilaiBuku<=0

--set dateformat dmy exec cekNilaiBuku_Minus '01-12-2016','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create proc [dbo].[cek_ProduksiHP]
@tanggal datetime,
@kebun varchar(2),
@kdbud varchar(2)
as
set dateformat dmy
BEGIN
SET NOCOUNT ON;
declare @AwalTahun datetime
declare @AwalBulan datetime
declare @BulanLalu datetime
set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @AwalBulan='01-'+cast(MONTH(@tanggal) as varchar(2))+'-'+cast(YEAR(@tanggal) as varchar(4))
set @BulanLalu=@AwalBulan-1

select * into #AkunProduksiHP from AkunProduksiHP where YEAR(tanggal)=YEAR(@tanggal) and kodeunit=@kebun and kodebud=@kdbud and kodevar='JADI'

--BULAN INI
select '1' as grup,'PRODUKSI SENDIRI' AS URAIAN,SUM(bi) as realBI,SUM(rbi) as rkapBI,SUM(bi) as realSBI,SUM(rbi) as rkapSBI 
into #t1
from #AkunProduksiHP 
where norek='X' and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)
union all
select '2' as grup,'PEMBELIAN' AS URAIAN,SUM(bi) as realBI,SUM(rbi) as rkapBI,SUM(bi) as realSBI,SUM(rbi) as rkapSBI 
from #AkunProduksiHP 
where substring(norek,1,3)='608' and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)
union all
select '3' as grup,'PENJUALAN' AS URAIAN,SUM(bi) as realBI,SUM(rbi) as rkapBI,SUM(bi) as realSBI,SUM(rbi) as rkapSBI 
from #AkunProduksiHP 
where substring(norek,1,3)='609' and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)
union all
select '4' as grup,'TOTAL (PRODUKSI PEMBAGI HRG.POKOK)' AS URAIAN,SUM(bi) as realBI,SUM(rbi) as rkapBI,SUM(bi) as realSBI,SUM(rbi) as rkapSBI 
from #AkunProduksiHP 
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)
union all

----BULAN INI
--select '1' as grup,'PRODUKSI SENDIRI' AS URAIAN,SUM(bi) as realBI,SUM(rbi) as rkapBI,0 as realSBI,0 as rkapSBI 
--into #t1
--from #AkunProduksiHP 
--where norek='X' and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)
--union all
--select '2' as grup,'PEMBELIAN' AS URAIAN,SUM(bi) as realBI,SUM(rbi) as rkapBI,0 as realSBI,0 as rkapSBI 
--from #AkunProduksiHP 
--where substring(norek,1,3)='608' and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)
--union all
--select '3' as grup,'PENJUALAN' AS URAIAN,SUM(bi) as realBI,SUM(rbi) as rkapBI,0 as realSBI,0 as rkapSBI 
--from #AkunProduksiHP 
--where substring(norek,1,3)='609' and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)
--union all
--select '4' as grup,'TOTAL' AS URAIAN,SUM(bi) as realBI,SUM(rbi) as rkapBI,0 as realSBI,0 as rkapSBI 
--from #AkunProduksiHP 
--where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)
--union all


--S/D BULAN INI
select '1' as grup,'PRODUKSI SENDIRI' AS URAIAN,0 as realBI,0 as rkapBI,SUM(bi) as realSBI,SUM(rbi) as rkapSBI 
from #AkunProduksiHP 
where norek='X' and tanggal>=@AwalTahun and tanggal<=@BulanLalu
union all
select '2' as grup,'PEMBELIAN' AS URAIAN,0 as realBI,0 as rkapBI,SUM(bi) as realSBI,SUM(rbi) as rkapSBI 
from #AkunProduksiHP 
where substring(norek,1,3)='608' and tanggal>=@AwalTahun and tanggal<=@BulanLalu
union all
select '3' as grup,'PENJUALAN' AS URAIAN,0 as realBI,0 as rkapBI,SUM(bi) as realSBI,SUM(rbi) as rkapSBI 
from #AkunProduksiHP 
where substring(norek,1,3)='609' and tanggal>=@AwalTahun and tanggal<=@BulanLalu
union all
select '4' as grup,'TOTAL (PRODUKSI PEMBAGI HRG.POKOK)' AS URAIAN,0 as realBI,0 as rkapBI,SUM(bi) as realSBI,SUM(rbi) as rkapSBI 
from #AkunProduksiHP 
where tanggal>=@AwalTahun and tanggal<=@BulanLalu

select grup,URAIAN,SUM(realBI) as [REAL.BL.INI],SUM(rkapBI) AS [RKAP BL.INI],SUM(realSBI) AS [REAL.SD.BL.INI],SUM(rkapSBI) AS [RKAP SD BL.INI] 
from #t1 
group by grup,URAIAN
order by grup

SET NOCOUNT OFF;
END

--SET DATEFORMAT DMY EXEC CekProduksiHP '01-12-2016','10','02'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create proc [dbo].[cek_RekeningNetral]
@tanggal datetime,
@kebun varchar(2)
as
begin
set nocount on
set dateformat dmy 
declare @NamaKebun varchar(50)
set @NamaKebun=(select top 1 NamaKebun from SPDK_KBN_MASTER_REF..Ref_Kebun where KodeKebun=@kebun)

select * into #AkunMemorial from AkunMemorial where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and KodeUnit=@kebun and norek like '2%'
select * into #kartu        from Kartu where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and KodeUnit=@kebun and norek like '2%'
select * into #Ref_Rekening from Ref_Rekening where KodeUnit=@kebun

select kodeunit,norek,nilai as nilai
into #Sawal 
from #akunmemorial 
where KodeUnit=@kebun and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='D'
union all
select kodeunit,norek,-1*nilai as nilai 
from #akunmemorial 
where KodeUnit=@kebun and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='K'

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where KodeUnit=@kebun and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select a.kodeunit,a.norek,b.namarekening,'Kebun/Unit : '+@NamaKebun as NamaKebun,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
into #t5
from #t4 a
full outer join #ref_rekening b on a.norek=b.norek and @kebun=b.KodeUnit
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null
group by a.kodeunit,a.norek,b.namarekening

--select SUBSTRING(norek,1,3) as KRBB,floor(sakDebet-sakKredit) as Beban,0 as Pemindahbukuan into #t6 from #t5 where not SUBSTRING(norek,4,2)='99'
--union all
--select SUBSTRING(norek,1,3) as KRBB,0 as Beban,floor(sakDebet-sakKredit) as Pemindahbukuan from #t5 where SUBSTRING(norek,4,2)='99'

select SUBSTRING(norek,1,3) as KRBB,(sakDebet-sakKredit) as Beban,0 as Pemindahbukuan into #t6 from #t5 where not SUBSTRING(norek,4,2)='99'
union all
select SUBSTRING(norek,1,3) as KRBB,0 as Beban,(sakDebet-sakKredit) as Pemindahbukuan from #t5 where SUBSTRING(norek,4,2)='99'


select KRBB,SUM(Beban) as [BEBAN BIAYA],SUM(Pemindahbukuan) as [PEMIDAH BUKUAN],SUM(Beban+Pemindahbukuan) as [SELISIH] INTO #T7 from #t6 group by KRBB
SELECT KRBB,[BEBAN BIAYA],ABS([PEMIDAH BUKUAN]) AS [PEMINDAH BUKUAN],SELISIH FROM #T7 order by KRBB


set nocount off
end

--set dateformat dmy exec Cek_RekeningNetral '01-12-2016','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create proc [dbo].[cek_SaldoNormal]
@tanggal datetime,
@kebun varchar(2)
as
set dateformat dmy 

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where KodeUnit=@kebun and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='D'
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where KodeUnit=@kebun and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='K'

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from kartu
where KodeUnit=@kebun and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select a.kodeunit,substring(a.norek,1,3)+'.'+SUBSTRING(a.norek,4,2)+'.'+SUBSTRING(a.norek,6,2)+'.'+SUBSTRING(a.norek,8,2) as [REKENING],b.namarekening as [NAMA REKENING],sum(a.sakDebet) as DEBET,sum(a.sakKredit) as KREDIT
from #t4 a
full outer join ref_rekening b on a.norek=b.norek and @kebun=b.KodeUnit
where sakDebet+sakKredit<>0
group by a.kodeunit,a.norek,b.namarekening
order by a.norek

--set dateformat dmy exec cekSaldoNormal '01-12-2016','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[cek_TahunTanamInvestasiTanaman]
@tanggal datetime,
@kebun varchar(2)
as
begin
set nocount on
select A.NoBukti AS NoInput ,a.KodeAfdeling AS [AFDELING],a.Norek AS [REKENING],A.Uraian AS [NAMA REKENING],a.Netral as [TAHUN TANAM],a.Debet-a.Kredit as [NILAI]
INTO #T1
from Kartu a
inner join Ref_Rekening b on a.Norek=b.Norek and @kebun=b.KodeUnit
where substring(a.Norek,1,3) in ('040','041','042') and MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and LEN(a.netral)<>4
union all
select 'SALDO AWAL' AS NoInput,a.kodeafd,a.Norek,b.NamaRekening,a.Netral,a.nilai 
from AkunMemorial a
inner join Ref_Rekening b on a.Norek=b.Norek and @kebun=b.KodeUnit
where substring(a.Norek,1,3) in ('040','041','042') and MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and LEN(a.netral)<>4 and NoInput in ('SALDO AWAL','TRANSAKSI')

SELECT NoInput AS [NO.INPUT],AFDELING,REKENING,[NAMA REKENING] ,[TAHUN TANAM] ,sum(NILAI) as NILAI  
FROM #T1
GROUP BY NoInput,AFDELING,REKENING,[NAMA REKENING] ,[TAHUN TANAM] 
ORDER BY [TAHUN TANAM] 
set nocount off
end

--set dateformat dmy exec cek_TahunTanamInvestasiTanaman '01-12-2016','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[Cek_TotalSelisih]
@tanggal datetime
as
set dateformat dmy
select KodeUnit,nilai as Sawdebet,0 as Sawkredit,0 as debet,0 as kredit into #t1 from AkunMemorial where NoInput not like 'JLL%' and DK='D' and YEAR(tanggal)=YEAR(@tanggal)
union all
select KodeUnit,0 as Sawdebet,nilai as Sawkredit,0 as debet,0 as kredit from AkunMemorial where NoInput not like 'JLL%' and DK='K' and YEAR(tanggal)=YEAR(@tanggal)
union all
select KodeUnit,0,0,Debet,Kredit from kartu where YEAR(tanggal)=YEAR(@tanggal)

select a.KodeUnit,b.NamaKebun as [Kebun/Unit],
round(SUM(a.Sawdebet),0) as [Saw.Debet],round(SUM(a.Sawkredit),0) as [Saw.Kredit],round(SUM(a.Sawdebet-Sawkredit),0) as [Selisih],
round(SUM(a.debet),0) as Debet,round(SUM(a.kredit),0) as Kredit,round(SUM(debet-kredit),0) as [Selisih]
from #t1 a
inner join Ref_Kebun b on a.KodeUnit=b.KodeKebun
group by a.KodeUnit,b.NamaKebun
order by KodeUnit

--set dateformat dmy exec Cek_TotalSelisih '01-01-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[cek_TUP] 
@Tanggal datetime 
--@kebun varchar(2)
as 
set dateformat dmy
declare @NamaKebun varchar(50)
declare @TglAwal datetime
declare @TglAkhir datetime 
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
--set @NamaKebun=(select top 1 NamaKebun from SPDK_KBN_MASTER_REF..Ref_Kebun where KodeKebun=@kebun)

select * into #TUP from TUP where  MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) 
select * into #AkunMemorial from AkunMemorial where  MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and norek like '30%'
select Norek,SUM(Debet-kredit) as nilai into #Kartu from Kartu where  MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and norek like '30%' group by Norek
 
--SALDO AWAL
select kodebarang,sum(nilai) as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
into #t1 
from #tup 
where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and noinput='SALDO AWAL' 
group by kodebarang 
union all
 
--MUTASI BULAN INI
--PEMBELIAN SENDIRI
select kodebarang,0 as sawNilai,sum(nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=1) and tanggal<'01-09-2014' 
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,sum((nilai*.1)+nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=2) and tanggal<'01-09-2014' 
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,sum((nilai*.1)+nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014' 
group by kodebarang 
union all 

select kodebarang,0 as sawNilai,sum(nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,sum((nilai*.1)+nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodebarang 
union all 

select kodebarang,0 as sawNilai,sum(nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=0 
group by kodebarang 
union all 
 
--PEMBELIAN DARI KEBUN SE-INDUK
select kodebarang,0 as sawNilai,0 as trmSDR,sum(nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=1) and tanggal<'01-09-2014'
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,0 as trmSDR,sum((nilai*.1)+nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=2) and tanggal<'01-09-2014'
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,0 as trmSDR,sum((nilai*.1)+nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,0 as trmSDR,sum(nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,0 as trmSDR,sum((nilai*.1)+nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,0 as trmSDR,sum(nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=0 
group by kodebarang 
union all 
 
--PEMBELIAN DARI KANTOR PUSAT
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum(nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=1) and tanggal<'01-09-2014'
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum((nilai*.1)+nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=2) and tanggal<'01-09-2014'
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum((nilai*.1)+nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum(nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum((nilai*.1)+nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum(nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=0 
group by kodebarang 
union all 
 
--PENERIMAAN LAIN-LAIN
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum(nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=1) and tanggal<'01-09-2014'
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum((nilai*.1)+nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=2) and tanggal<'01-09-2014'
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum((nilai*.1)+nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum(nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum((nilai*.1)+nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodebarang 
union all 
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum(nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=0 
group by kodebarang 
union all 
 
--PEMAKAIAN SENDIRI
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,sum(nilai) as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and not substring(norek,1,3) in ('080','196') 
group by kodebarang 
union all 
 
--PEMAKAIAN KEBUN SE-INDUK
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,sum(nilai) as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and substring(norek,1,5)='08002' and not substring(norek,1,7)='0800209' 
group by kodebarang 
union all 
 
--PEMAKAIAN KANTOR PUSAT
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,sum(nilai) as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and substring(norek,1,7)='0800209' 
group by kodebarang 
union all 
 
--PEMAKAIAN LAIN-LAIN
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,sum(nilai) as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and substring(norek,1,3) in ('196') 
group by kodebarang 
union all 
 
--KOREKSI KELEBIHAN
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum(nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR' and nilai>0 
group by kodebarang 
union all 
 
--KOREKSI KEKURANGAN
select kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,sum(abs(nilai)) as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR' and nilai<0 
group by kodebarang 
 
select @TglAwal-1 as per,substring(b.norek,1,5) as grup,b.norek,d.namarekening, 
sum(a.sawNilai) as sawNilai, 
sum(a.trmSDR) as trmSDR, 
sum(a.trmKBN) as trmKBN, 
sum(a.trmDIR) as trmDIR, 
sum(a.trmLLN) as trmLLN, 
sum(a.trmSDR+a.trmKBN+a.trmDIR+a.trmLLN) as trmJML, 
sum(a.klrSDR) as klrSDR, 
sum(a.klrKBN) as klrKBN, 
sum(a.klrDIR) as klrDIR, 
sum(a.klrLLN) as klrLLN, 
sum(a.klrSDR+a.klrKBN+a.klrDIR+a.klrLLN) as klrJML, 
sum(a.sawNilai+a.trmSDR+a.trmKBN+a.trmDIR+a.trmLLN)-sum(a.klrSDR+a.klrKBN+a.klrDIR+a.klrLLN) as sakNilai 
into #t2 
from #t1 a 
inner join SPDK_KBN_MASTER_REF..ref_barang b on a.kodebarang=b.kodebarang 
--inner join SPDK_KBN_MASTER_REF..ref_kebun c on @kebun=c.KodeKebun 
inner join SPDK_KBN_MASTER_REF..ref_rekening d on b.norek=d.Norek 
group by b.norek,d.namarekening 
 
select per,grup,norek,namarekening, 
sum(sawNilai) as sawNilai, 
sum(trmSDR) as trmSDR, 
sum(trmKBN) as trmKBN, 
sum(trmDIR) as trmDIR, 
sum(trmLLN) as trmLLN, 
sum(trmJML) as trmJML, 
sum(klrSDR) as klrSDR, 
sum(klrKBN) as klrKBN, 
sum(klrDIR) as klrDIR, 
sum(klrLLN) as klrLLN, 
sum(klrJML) as klrJML, 
sum(sakNilai) as sakNilai
into #t3 
from #t2 
where sawNilai+trmJML+klrJML<>0 
group by per,grup,norek,namarekening 

select norek,SUM(sakNilai) as TUP,0 as Neraca into #t4 from #t3 group by norek
union all
select norek,0 as TUP,sum(nilai) as Neraca from #AkunMemorial where DK='D' group by norek
union all
select norek,0 as TUP,-1*sum(nilai) as Neraca from #AkunMemorial where DK='K' group by norek
union all
select norek,0 as TUP,sum(nilai) as Neraca from #Kartu group by norek

select a.norek,b.NamaRekening,SUM(a.TUP) as TUP,SUM(a.Neraca) as Neraca 
into #t5
from #t4 a
inner join SPDK_KBN_MASTER_REF..Ref_Rekening b on a.norek=b.Norek
group by a.norek,b.NamaRekening

select norek,substring(norek,1,3)+'.'+substring(norek,4,2)+'.'+substring(norek,6,2)+'.'+substring(norek,8,2) AS [REKENING],NamaRekening,ROUND(TUP,0) as TUP,round(Neraca,0) as NERACA,round(TUP-Neraca,0) as SELISIH from #t5 where TUP+Neraca<>0
union all
select '99' as norek,'' AS [REKENING],'JUMLAH' as NamaRekening,ROUND(SUM(TUP),0) as TUP,round(SUM(Neraca),0) as NERACA,round(SUM(TUP-Neraca),0) as SELISIH from #t5 where TUP+Neraca<>0
order by norek

--set dateformat dmy exec cek_TUP '01-06-2018'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create proc [dbo].[cek_TUP_Minus]
@Tanggal datetime,
@Kebun varchar(2)
as
set dateformat dmy
declare @TglAwal datetime 
declare @TglAkhir datetime 
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select kodeunit,kodebarang,
sum(qty) as sawQty,sum(nilai) as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
into #t1
from tup
where KodeUnit=@Kebun and MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and noinput='SALDO AWAL'
group by kodeunit,kodebarang
union all

--MUTASI BULAN INI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where KodeUnit=@Kebun and (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal<'01-09-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where KodeUnit=@Kebun and (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal>='01-11-2014'
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where KodeUnit=@Kebun and (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal<'01-09-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where KodeUnit=@Kebun and (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal>='01-11-2014'
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where KodeUnit=@Kebun and (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and nilai>0) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where KodeUnit=@Kebun and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=0 and nilai>0
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,sum(qty) as klrQty,sum(nilai) as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where KodeUnit=@Kebun and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58'
group by kodeunit,kodebarang
union all
 
--KOREKSI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,sum(qty) as korQty,sum(nilai) as korNilai,0 as sakQty,0 as sakNilai
from tup
where KodeUnit=@Kebun and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR'
group by kodeunit,kodebarang

select upper('Kebun/Unit :'+d.namakebun) as namakebun,b.norek,c.namarekening,a.kodebarang,b.namabarang,
sum(a.sawQty) as sawQty,sum(a.sawNilai) as sawNilai,sum(a.trmQty) as trmQty,sum(a.trmNilai) as trmNilai,
sum(a.klrQty) as klrQty,sum(a.klrNilai) as klrNilai,sum(a.korQty) as korQty,sum(a.korNilai) as korNilai,
sum(a.sawQty+a.trmQty-a.klrQty+a.korQty) as sakQty,sum(a.sawNilai+a.trmNilai-a.klrNilai+a.korNilai) as sakNilai
into #t2
from #t1 a
inner join SPDK_KBN_MASTER_REF..ref_barang b on a.kodebarang=b.kodebarang
inner join SPDK_KBN_MASTER_REF..ref_rekening c on b.norek=c.norek
inner join SPDK_KBN_MASTER_REF..ref_kebun d on a.kodeunit=d.kodekebun
group by d.namakebun,b.norek,c.namarekening,a.kodebarang,b.namabarang

select kodebarang as [KODE BARANG],NamaBarang as [NAMA BARANG],sakNilai as [NILAI] from #t2 where sakNilai<0 order by NamaBarang

--set dateformat dmy exec cekTUP_Minus '01-12-2016','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Cek150]
	@tanggal datetime
AS
set dateformat dmy
BEGIN
	SET NOCOUNT ON;

    declare @AwalTahun datetime
	declare @AkhirBulan datetime
    set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
    set @AkhirBulan=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
    declare @bulan varchar (50)
    
    if MONTH(@tanggal) < 10
      set @bulan = '0'+CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal) as varchar(4))
    else
      set @bulan=CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal)as varchar(4))
    
-- Kebun 10
select  norek as norek, sum(nilai*-1) as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 into #t1
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='10' and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, sum(nilai) as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='10'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 11
select  norek as norek, 0 as k10,sum(nilai*-1) as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='11'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,sum(nilai) as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='11'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 12
select  norek as norek, 0 as k10,0 as k11,sum(nilai*-1) as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='12'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,sum(nilai) as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='12'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 13
select  norek as norek, 0 as k10,0 as k11,0 as k12,sum(nilai*-1) as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='13'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,sum(nilai) as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='13'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 14
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,sum(nilai*-1) as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='14'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,sum(nilai) as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='14'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 15
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,sum(nilai*-1) as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='15'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,sum(nilai) as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='15'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 16
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,sum(nilai*-1) as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='16'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,sum(nilai) as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='16'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 17
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
sum(nilai*-1) as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='17'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 sum(nilai) as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='17'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 18
select  norek as norek,0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,sum(nilai*-1) as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='18'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,sum(nilai) as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='18'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 19
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,sum(nilai*-1) as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='19'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,sum(nilai) as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='19'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 20
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,sum(nilai*-1) as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='20'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,sum(nilai) as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='20'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 21
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,sum(nilai*-1) as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='21'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,sum(nilai) as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='21'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 22
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,sum(nilai*-1) as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='22'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,sum(nilai) as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='22'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 23
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,sum(nilai*-1) as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='23'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,sum(nilai) as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='23'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 24
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,sum(nilai*-1) as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='24'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,sum(nilai) as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='24'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 25
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 sum(nilai*-1) as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='25'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 sum(nilai) as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='25'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 28
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,sum(nilai*-1) as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='28'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,sum(nilai) as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='28'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 29
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,sum(nilai*-1) as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='29'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,sum(nilai) as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='29'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 31
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,sum(nilai*-1) as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='31'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,sum(nilai) as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='31'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 32
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,sum(nilai*-1) as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='32'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,sum(nilai) as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='32'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 33
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,sum(nilai*-1) as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='33'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,sum(nilai) as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='33'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 34
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,sum(nilai*-1) as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='34'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,sum(nilai) as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='34'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 35
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,sum(nilai*-1) as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='35'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,sum(nilai) as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='35'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 36
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 sum(nilai*-1) as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='36'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 sum(nilai) as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='36'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 37
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,sum(nilai*-1) as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='37'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,sum(nilai) as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='37'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 39
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,sum(nilai*-1) as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='39'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,sum(nilai) as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='39'and SUBSTRING(norek,1,3)='150'
group by norek
Union all

-- Kebun 40
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,sum(nilai*-1) as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='40'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,sum(nilai) as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='40'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 41
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,sum(nilai*-1) as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='41'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,sum(nilai) as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='41'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 42
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,sum(nilai*-1) as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='42'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,sum(nilai) as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='42'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 43
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,sum(nilai*-1) as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='43'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,sum(nilai) as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='43'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 44
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,sum(nilai*-1) as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='44'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,sum(nilai) as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='44'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 45
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 sum(nilai*-1) as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='45'and SUBSTRING(norek,1,3)='150'
group by norek

union all

select  norek as norek,  0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 sum(nilai) as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='45'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 46
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,sum(nilai*-1) as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='46'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,sum(nilai) as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='46'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 47
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,sum(nilai*-1) as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='47'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,sum(nilai) as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='47' and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 49
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,sum(nilai*-1) as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='49'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,sum(nilai) as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='49'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 50
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,sum(nilai*-1) as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='50'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,sum(nilai) as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='50'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 62
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,sum(nilai*-1) as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='62'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,sum(nilai) as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='62'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 64
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,sum(nilai*-1) as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='64'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,sum(nilai) as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='64'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 65
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,sum(nilai*-1) as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='65'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,sum(nilai) as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='65'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 68
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 sum(nilai*-1) as k68,0 as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='68'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 sum(nilai) as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='68'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 69
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,sum(nilai*-1) as k69,0 as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='69'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,sum(nilai) as k69,0 as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='69'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 71
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,sum(nilai*-1) as k71,0 as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='71'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,sum(nilai) as k71,0 as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='71'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 72
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,sum(nilai*-1) as k72,0 as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='72'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,sum(nilai) as k72,0 as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='72'and SUBSTRING(norek,1,3)='150'
group by norek

Union all
-- Kebun 74
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,sum(nilai*-1) as k74
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  and KodeUnit='74'and SUBSTRING(norek,1,3)='150'
group by norek

union all
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,sum(nilai) as k74
  from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='K'  and KodeUnit='74'and SUBSTRING(norek,1,3)='150'
group by norek
 
union all
-- kebun 10
select  norek as norek, sum(kredit-debet) as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='10'and SUBSTRING(norek,1,3)='150'
group by norek
Union all

-- kebun 11
select  norek as norek, 0 as k10,sum(kredit-debet) as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='11'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 12
select  norek as norek, 0 as k10,0 as k11,sum(kredit-debet) as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='12'and SUBSTRING(norek,1,3)='150'
group by norek
Union all

-- kebun 13
select  norek as norek, 0 as k10,0 as k11,0 as k12,sum(kredit-debet) as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='13'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 14
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,sum(kredit-debet) as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='14'and SUBSTRING(norek,1,3)='150'
group by norek


union all
-- kebun 15
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,sum(kredit-debet) as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='15'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 10
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,sum(kredit-debet) as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='16'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 17
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 sum(kredit-debet) as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='17'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 18
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,sum(kredit-debet) as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='18'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 19
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,sum(kredit-debet) as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='19'and SUBSTRING(norek,1,3)='150'
group by norek


union all
-- kebun 20
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,sum(kredit-debet) as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='20'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 21
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,sum(kredit-debet) as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='21'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 22
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,sum(kredit-debet) as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='22'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 23
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,sum(kredit-debet) as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='23'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 24
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,sum(kredit-debet) as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='24'and SUBSTRING(norek,1,3)='150'
group by norek
Union all

-- kebun 25
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 sum(kredit-debet) as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='25'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 28
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,sum(kredit-debet) as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='28'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 29
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,sum(kredit-debet) as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='29'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 31
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,sum(kredit-debet) as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='31'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 32
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,sum(kredit-debet) as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='32'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 33
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,sum(kredit-debet) as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='33'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 34
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,sum(kredit-debet) as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='34'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 35
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,sum(kredit-debet) as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='35'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 36
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 sum(kredit-debet) as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='36'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 37
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,sum(kredit-debet) as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='37'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 39
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,sum(kredit-debet) as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='39'and SUBSTRING(norek,1,3)='150'
group by norek


union all
-- kebun 40
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,sum(kredit-debet) as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='40'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 41
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,sum(kredit-debet) as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='41'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 42
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,sum(kredit-debet) as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='42'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 43
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,sum(kredit-debet) as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='43'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 44
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,sum(kredit-debet) as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='44'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 45
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 sum(kredit-debet) as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='45'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 46
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,sum(kredit-debet) as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='46'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 47
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,sum(kredit-debet) as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='47'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 49
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,sum(kredit-debet) as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='49'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 50
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,sum(kredit-debet) as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='50'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 62
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,sum(kredit-debet) as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='62'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 64
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,sum(kredit-debet) as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='64'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 65
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,sum(kredit-debet) as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='65'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 68
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 sum(kredit-debet) as k68,0 as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='68'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 69
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,sum(kredit-debet) as k69,0 as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='69'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 71
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,sum(kredit-debet) as k71,0 as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='71'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 72
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,sum(kredit-debet) as k72,0 as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='72'and SUBSTRING(norek,1,3)='150'
group by norek

union all
-- kebun 74
select  norek as norek, 0 as k10,0 as k11,0 as k12,0 as k13,0 as k14,0 as k15,0 as k16,
 0 as k17,0 as k18,0 as k19,0 as k20,0 as k21,0 as k22,0 as k23,0 as k24,
 0 as k25,0 as k28,0 as k29,0 as k31,0 as k32,0 as k33,0 as k34,0 as k35,
 0 as k36,0 as k37,0 as k39,0 as k40,0 as k41,0 as k42,0 as k43,0 as k44,
 0 as k45,0 as k46,0 as k47,0 as k49,0 as k50,0 as k62,0 as k64,0 as k65,
 0 as k68,0 as k69,0 as k71,0 as k72,sum(kredit-debet) as k74
  from kartu
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit='74'and SUBSTRING(norek,1,3)='150'
group by norek


select  norek as norek, sum(k10) as k10,sum(k11) as k11,sum(k12) as k12,sum(k13) as k13,
 sum(k14) as k14,sum(k15) as k15,sum(k16) as k16,SUM(k17) as k17,sum(k18) as k18,
 sum(k19) as k19,sum(k20) as k20,sum(k21) as k21,sum(k22) as k22,sum(k23) as k23,sum(k24) as k24,
 sum(k25) as k25,sum(k28) as k28,sum(k29) as k29,sum(k31) as k31,sum(k32) as k32,sum(k33) as k33,
 sum(k34) as k34,sum(k35) as k35,sum(k36) as k36,sum(k37) as k37,sum(k39) as k39,sum(k40) as k40,
 sum(k41) as k41,sum(k42) as k42,sum(k43) as k43,sum(k44) as k44,sum(k45) as k45,sum(k46) as k46,
 sum(k47) as k47,sum(k49) as k49,sum(k50) as k50,sum(k62) as k62,sum(k64) as k64,sum(k65) as k65,
 sum(k68) as k68,sum(k69) as k69,sum(k71) as k71,sum(k72) as k72,sum(k74) as k74
from #t1
group by norek
order by norek


set nocount off
END

--set dateformat dmy exec Cek150 '01-10-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Cek150Vendor]
	@tanggal datetime
AS
set dateformat dmy
BEGIN
	SET NOCOUNT ON;

    declare @AwalTahun datetime
	declare @AkhirBulan datetime
    set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
    set @AkhirBulan=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
    declare @bulan varchar (50)
    
    if MONTH(@tanggal) < 10
      set @bulan = '0'+CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal) as varchar(4))
    else
      set @bulan=CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal)as varchar(4))
    
-- saldo awal Kredit
select  norek as norek, sum(nilai) as saldo,0 as d01,0 as k01,0 as d02,0 as k02,0 as d03,0 as k03,
 0 as d04,0 as k04,0 as d05,0 as k05,0 as d06,0 as k06,0 as d07,0 as k07,
  0 as d08,0 as k08,0 as d09,0 as k09,0 as d10,0 as k10,0 as d11,0 as k11,
 0 as d12,0 as k12
 into #t1
 from AkunMemorial
 where MONTH(tanggal)=1 and YEAR(Tanggal)=YEAR(@tanggal) and NoInput='SALDO AWAL' and DK='K'  and SUBSTRING(norek,1,3)='150'
group by norek

-- Saldo Awal debet
union all
select  norek as norek, sum(nilai*-1) as saldo,0 as d01,0 as k01,0 as d02,0 as k02,0 as d03,0 as k03,
 0 as d04,0 as k04,0 as d05,0 as k05,0 as d06,0 as k06,0 as d07,0 as k07,
 0 as d08,0 as k08,0 as d09,0 as k09,0 as d10,0 as k10,0 as d11,0 as k11,
 0 as d12,0 as k12
 from AkunMemorial
 where MONTH(tanggal)=1 and YEAR(Tanggal)=YEAR(@tanggal) and NoInput='SALDO AWAL' and DK='D'  and SUBSTRING(norek,1,3)='150'
group by norek


-- Transaksi bulan Januari 
union all
select  norek as norek, 0 as saldo,sum(Debet) as d01,sum(kredit) as k01,0 as d02,0 as k02,0 as d03,0 as k03,
 0 as d04,0 as k04,0 as d05,0 as k05,0 as d06,0 as k06,0 as d07,0 as k07,
 0 as d08,0 as k08,0 as d09,0 as k09,0 as d10,0 as k10,0 as d11,0 as k11,
 0 as d12,0 as k12
 from kartu
 where MONTH(tanggal)=1 and YEAR(Tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3)='150'
group by norek

-- Transaksi bulan Pebruari
union all
select  norek as norek, 0 as saldo,0 as d01,0 as k01,sum(debet) as d02,sum(kredit) as k02,0 as d03,0 as k03,
 0 as d04,0 as k04,0 as d05,0 as k05,0 as d06,0 as k06,0 as d07,0 as k07,
 0 as d08,0 as k08,0 as d09,0 as k09,0 as d10,0 as k10,0 as d11,0 as k11,
 0 as d12,0 as k12
 from kartu
 where MONTH(tanggal)=2 and YEAR(Tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3)='150'
group by norek


-- Transaksi bulan Maret
union all
select  norek as norek, 0 as saldo,0 as d01,0 as k01,0 as d02,0 as k02,sum(debet) as d03,sum(kredit) as k03,
 0 as d04,0 as k04,0 as d05,0 as k05,0 as d06,0 as k06,0 as d07,0 as k07,
 0 as d08,0 as k08,0 as d09,0 as k09,0 as d10,0 as k10,0 as d11,0 as k11,
 0 as d12,0 as k12
 from kartu
 where MONTH(tanggal)=3 and YEAR(Tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3)='150'
group by norek

-- Transaksi bulan April
union all
select  norek as norek, 0 as saldo,0 as d01,0 as k01,0 as d02,0 as k02,0 as d03,0 as k03,
 sum(debet) as d04,sum(kredit) as k04,0 as d05,0 as k05,0 as d06,0 as k06,0 as d07,0 as k07,
 0 as d08,0 as k08,0 as d09,0 as k09,0 as d10,0 as k10,0 as d11,0 as k11,
 0 as d12,0 as k12
 from kartu
 where MONTH(tanggal)=4 and YEAR(Tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3)='150'
group by norek

-- Transaksi bulan Mei
union all
select  norek as norek, 0 as saldo,0 as d01,0 as k01,0 as d02,0 as k02,0 as d03,0 as k03,
 0 as d04,0 as k04,sum(debet) as d05,sum(kredit) as k05,0 as d06,0 as k06,0 as d07,0 as k07,
 0 as d08,0 as k08,0 as d09,0 as k09,0 as d10,0 as k10,0 as d11,0 as k11,
 0 as d12,0 as k12
 from kartu
 where MONTH(tanggal)=5 and YEAR(Tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3)='150'
group by norek

-- Transaksi bulan Juni
union all
select  norek as norek, 0 as saldo,0 as d01,0 as k01,0 as d02,0 as k02,0 as d03,0 as k03,
 0 as d04,0 as k04,0 as d05,0 as k05,sum(debet) as d06,sum(kredit) as k06,0 as d07,0 as k07,
 0 as d08,0 as k08,0 as d09,0 as k09,0 as d10,0 as k10,0 as d11,0 as k11,
 0 as d12,0 as k12
 from kartu
 where MONTH(tanggal)=6 and YEAR(Tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3)='150'
group by norek

-- Transaksi bulan Juli
union all
select  norek as norek, 0 as saldo,0 as d01,0 as k01,0 as d02,0 as k02,0 as d03,0 as k03,
 0 as d04,0 as k04,0 as d05,0 as k05,0 as d06,0 as k06,sum(debet) as d07,sum(kredit) as k07,
 0 as d08,0 as k08,0 as d09,0 as k09,0 as d10,0 as k10,0 as d11,0 as k11,
 0 as d12,0 as k12
 from kartu
 where MONTH(tanggal)=7 and YEAR(Tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3)='150'
group by norek

-- Transaksi bulan Agustus
union all
select  norek as norek, 0 as saldo,0 as d01,0 as k01,0 as d02,0 as k02,0 as d03,0 as k03,
 0 as d04,0 as k04,0 as d05,0 as k05,0 as d06,0 as k06,0 as d07,0 as k07,
 sum(debet) as d08,sum(kredit) as k08,0 as d09,0 as k09,0 as d10,0 as k10,0 as d11,0 as k11,
 0 as d12,0 as k12
 from kartu
 where MONTH(tanggal)=8 and YEAR(Tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3)='150'
group by norek

-- Transaksi bulan September
union all
select  norek as norek, 0 as saldo,0 as d01,0 as k01,0 as d02,0 as k02,0 as d03,0 as k03,
 0 as d04,0 as k04,0 as d05,0 as k05,0 as d06,0 as k06,0 as d07,0 as k07,
 0 as d08,0 as k08,sum(debet) as d09,sum(kredit) as k09,0 as d10,0 as k10,0 as d11,0 as k11,
 0 as d12,0 as k12
 from kartu
 where MONTH(tanggal)=9 and YEAR(Tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3)='150'
group by norek

-- Transaksi bulan Oktober
union all
select  norek as norek, 0 as saldo,0 as d01,0 as k01,0 as d02,0 as k02,0 as d03,0 as k03,
 0 as d04,0 as k04,0 as d05,0 as k05,0 as d06,0 as k06,0 as d07,0 as k07,
 0 as d08,0 as k08,0 as d09,0 as k09,sum(debet) as d10,sum(kredit) as k10,0 as d11,0 as k11,
 0 as d12,0 as k12
 from kartu
 where MONTH(tanggal)=10 and YEAR(Tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3)='150'
group by norek

-- Transaksi bulan Nopember
union all
select  norek as norek, 0 as saldo,0 as d01,0 as k01,0 as d02,0 as k02,0 as d03,0 as k03,
 0 as d04,0 as k04,0 as d05,0 as k05,0 as d06,0 as k06,0 as d07,0 as k07,
 0 as d08,0 as k08,0 as d09,0 as k09,0 as d10,0 as k10,sum(debet) as d11,sum(kredit) as k11,
 0 as d12,0 as k12
 from kartu
 where MONTH(tanggal)=11 and YEAR(Tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3)='150'
group by norek

-- Transaksi bulan Desember
union all
select  norek as norek, 0 as saldo,0 as d01,0 as k01,0 as d02,0 as k02,0 as d03,0 as k03,
 0 as d04,0 as k04,0 as d05,0 as k05,0 as d06,0 as k06,0 as d07,0 as k07,
 0 as d08,0 as k08,0 as d09,0 as k09,0 as d10,0 as k10,0 as d11,0 as k11,
 sum(debet) as d12,sum(kredit) as k12
 from kartu
 where MONTH(tanggal)=12 and YEAR(Tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3)='150'
group by norek

select  norek as norek, sum(saldo) as saldo,sum(d01) as d01,sum(k01) as k01,sum(d02) as d02,sum(k02) as k02,sum(d03) as d03,
 SUM(k03) as k03,SUM(d04) as d04,sum(k04) as k04,sum(d05) as d05,sum(k05) as k05,sum(d06) as d06,sum(k06) as k06,
 SUM(d07) as d07,SUM(k07) as k07,sum(d08) as d08,sum(k08) as k08,sum(d09) as d09,sum(k09) as k09,sum(d10) as d10,
 sum(k10) as k10,sum(d11) as d11,sum(k11) as k11,sum(d12) as d12,sum(k12) as k12
from #t1
group by norek
order by norek


set nocount off
END

--set dateformat dmy exec Cek150Vendor '01-10-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[CekBiayaYMHDibayar]
@tanggal datetime,
@KodeUnit varchar(2)
as
set dateformat dmy
select a.KodeUnit,c.NamaKebun,substring(a.Norek,1,3) as Grp,substring(a.Norek,1,9) as Norek,b.NamaRekening,SUM(a.Debet-a.Kredit) as Kredit 
from Kartu a
inner join Ref_Rekening b on a.KodeUnit=b.KodeUnit and a.Norek=b.Norek
inner join Ref_Kebun c on a.KodeUnit=c.KodeKebun
where a.Aplikasi='GUP' and Kredit>0 and MONTH(a.Tanggal)=MONTH(@tanggal) and YEAR(a.Tanggal)=YEAR(@tanggal) and a.KodeUnit=@KodeUnit
group by a.KodeUnit,substring(a.Norek,1,3),substring(a.Norek,1,9),b.NamaRekening,c.NamaKebun
order by a.KodeUnit,Norek

--set dateformat dmy exec CekBiayaYMHDibayar '01-08-2016','15'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[CekHasilMigrasiKartu]
@tahun varchar(4)
as
select distinct kodeunit,bulan into #t1 from kartuclipper where SUBSTRING(bulan,1,4)=@tahun order by kodeunit,bulan
select kodeunit,SUBSTRING(bulan,1,4) as Tahun,COUNT(*) as Jml  into #t2 from #t1 group by kodeunit,SUBSTRING(bulan,1,4) 
select * from #t2 --where Jml<12
order by kodeunit,Tahun

--exec CekHasilMigrasiKartu '2011'

--select * from Kartuclipper where bulan like '2011%'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[CekHasilMigrasiKaru]
as
select distinct kodeunit,bulan into #t1 from kartuclipper order by kodeunit,bulan
select kodeunit,SUBSTRING(bulan,1,4) as Tahun,COUNT(*) as Jml  from #t1 group by kodeunit,SUBSTRING(bulan,1,4) order by kodeunit,Tahun

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[CekLM]
@tanggal datetime
as
--FILE M
BEGIN
SET NOCOUNT ON;

set dateformat dmy
select kodeunit,noaktiva,kdafd,kdbud,norek,tglbeli,'' as n_beli,nmaktiva,sum(jmlunit) as jmlunit,'' as nobukti,'' as LEVERANSIR, 
sum(sawalp) as sawalp,sum(auditp) as auditp,sum(rcp) as rcp,sum(hapusp) as hapusp,sum(kbnp) as mutasip,sum(rekp) as rekp,sum(murnip) as murnip,
sum(sawals) as sawals,sum(audits) as audits,sum(rcs) as rcs,sum(hapuss) as hapuss,sum(kbns) as mutasis,sum(reks) as reks,sum(murnis) as murnis
into #M1
from AktivaMaster
where YEAR(tgltran)=YEAR(@tanggal)
group by kodeunit,noaktiva,kdafd,kdbud,norek,tglbeli,nmaktiva

select kodeunit,kodeafd,kodebud,netral,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='D' and SUBSTRING(norek,1,2) in ('00','01','02','03')

union all
select kodeunit,kodeafd,kodebud,netral,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='K' and SUBSTRING(norek,1,2) in ('00','01','02','03')

select kodeunit,kodeafd,kodebud,netral,norek,sum(nilai) as nilai 
into #t1 
from #Sawal 
group by kodeunit,kodeafd,kodebud,netral,norek

select kodeunit,kodeafd,kodebud,netral,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,kodeafd,kodebud,netral,norek
union all
select kodeunit,kodeafd,kodebud,netral,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,kodeafd,kodebud,netral,norek
union all
select kodeunit,KodeAfdeling,KodeBudidaya,netral,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from kartu
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(norek,1,2) in ('00','01','02','03')
group by kodeunit,KodeAfdeling,KodeBudidaya,netral,norek

select kodeunit,kodeafd,kodebud,netral,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,kodeafd,kodebud,netral,norek

select kodeunit,kodeafd,kodebud,netral,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,kodeafd,kodebud,netral,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select a.kodeunit,'' as kodeafd,a.kodebud,a.netral,substring(a.norek,1,3)+'000000' as norek,cast('' as varchar(50)) as nm_aktiva,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
into #t5
from #t4 a
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null
group by a.kodeunit,a.kodebud,a.netral,substring(a.norek,1,3)

update #t5 set netral='2016' where netral=''
update #t5 set netral=substring(netral,1,4)
update #t5 set nm_aktiva='TTAD' where norek like '040%'
update #t5 set nm_aktiva='TTI'  where norek like '041%'
update #t5 set nm_aktiva='TBM'  where norek like '042%'

select KodeUnit,substring(norek,1,3)+KodeUnit+kodebud+'00'+SUBSTRING(netral,3,2) as noaktiva,kodeafd as kdafd,kodebud as kdbud,norek,cast('01-'+cast(month(@tanggal) as varchar(2))+'-'+netral as datetime) as tglbeli,0 as n_beli,nm_aktiva,
0 as jmlunit,'' as nobukti,'' as leveransir,
0 as sawalp,0 as auditp,0 as rcp,0 as hapusp,0 as mutasip,0 as rekp,round(sum(sakDebet-sakKredit),0) as murnip,
0 as sawals,0 as audits,0 as rcs,0 as hapuss,0 as mutasis,0 as reks,0 as murnis
into #M2
from #t5
group by KodeUnit,kodeafd,kodebud,netral,norek,nm_aktiva

--delete SPDK_KBN_LAYANAN_BAGIAN..File_M
--insert SPDK_KBN_LAYANAN_BAGIAN..File_M
select * from #M1 
union all 
select * from #M2
order by kodeunit,noaktiva

Select 'AKT' as Bkt,kodeunit as unit,substring(norek,1,3) as Norek,kdbud as bud,
sum(sawalp+auditp+rcp+hapusp+mutasip+rekp+murnip) as akt,0 as akn
into #Tes1
from #m1
Group By 'AKT'+kodeunit,SUBSTRING(norek,1,3),kdbud

Union All
Select 'AKT' as Bkt,kodeunit as unit,'02'+substring(norek,3,1) as Norek,kdbud as bud,
sum(sawals+audits+rcs+hapuss+mutasis+reks+murnis) as akt,0 as akn
from #m1
Group By 'AKT'+kodeunit,'02'+SUBSTRING(norek,3,1),kdbud





SET NOCOUNT OFF;



END


--set dateformat dmy exec File_M '01-01-2018'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[CekNeracaPercobaan]
@tanggal datetime,
@kebun varchar(2)
as
set dateformat dmy
declare @kbn varchar(2)
set @kbn=(select top 1 kodeunit from akunmemorial where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal))

select * into #Ref_Kebun from Ref_Kebun where KodeKebun=@kebun
select * into #T1 from ref_lm where kode='701' and tampil='YA' --and kodeunit=@kebun

select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as Norek,b.uraian,sum(a.nilai) as sawdebet,cast(0 as float) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
into #TS1
from AkunMemorial a
inner join #T1 b on substring(a.norek,1,len(b.norek))=b.norek
where a.kodeunit=@kebun and a.dk='D' and substring(a.norek,1,len(b.norek)) in (select distinct norek from ref_lm where kode='701' and tampil='YA') and substring(a.norek,1,2) not in ('40','41','42') and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.noinput in ('SALDO AWAL','TRANSAKSI') and not substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as Norek,b.uraian,cast(0 as float) as sawdebet,sum(a.nilai) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
from AkunMemorial a
inner join #T1 b on substring(a.norek,1,len(b.norek))=b.norek
where a.kodeunit=@kebun and a.dk='K' and substring(a.norek,1,len(b.norek)) in (select distinct norek from ref_lm where kode='701' and tampil='YA') and substring(a.norek,1,2) not in ('40','41','42') and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.noinput in ('SALDO AWAL','TRANSAKSI') and not substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all

--SALDO AWAL BIAYA UMUM
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,'404142' as Norek,b.uraian,sum(a.nilai) as sawdebet,cast(0 as float) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
from AkunMemorial a
inner join #T1 b on '404142'=b.norek
where a.kodeunit=@kebun and a.dk='D' and substring(a.norek,1,2) in ('40','41','42') and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.noinput in ('SALDO AWAL','TRANSAKSI') and substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,'404142' as Norek,b.uraian,cast(0 as float) as sawdebet,sum(a.nilai) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
from AkunMemorial a
inner join #T1 b on '404142'=b.norek
where a.kodeunit=@kebun and a.dk='K' and substring(a.norek,1,2) in ('40','41','42') and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.noinput in ('SALDO AWAL','TRANSAKSI') and substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup

select kdkbn,kdgrup,nmgrup,urut,norek,uraian,sum(sawDebet-sawKredit) as nilai into #TS2 from #TS1 group by kdkbn,kdgrup,nmgrup,urut,norek,uraian

select kdkbn,kdgrup,nmgrup,urut,norek,uraian,sum(nilai) as SawDebet,0 as sawKredit,0 as Debet,0 as Kredit into #TS3 from #TS2 where nilai>0 group by kdkbn,kdgrup,nmgrup,urut,norek,uraian
union all
select kdkbn,kdgrup,nmgrup,urut,norek,uraian,0 as SawDebet,sum(abs(nilai)) as sawKredit,0 as Debet,0 as Kredit from #TS2 where nilai<0 group by kdkbn,kdgrup,nmgrup,urut,norek,uraian

select * into #T2 from #TS3
union all
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as Norek,b.uraian,0 as sawdebet,0 as sawkredit,sum(debet) as debet,sum(kredit) as kredit 
from kartu a
inner join #T1 b on substring(a.norek,1,len(b.norek))=b.norek
where a.kodeunit=@kebun and substring(a.norek,1,len(b.norek)) in (select distinct norek from ref_lm where kode='701' and tampil='YA') and substring(a.norek,1,2) not in ('40','41','42') and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and not substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all

select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,'404142' as Norek,b.uraian,0 as sawdebet,0 as sawkredit,sum(debet) as debet,sum(kredit) as kredit 
from kartu a
inner join #T1 b on '404142'=substring(b.norek,1,6)
where a.kodeunit=@kebun and substring(a.norek,1,2) in ('40','41','42') and MONTH(a.tanggal)=MONTH(@tanggal) and year(a.tanggal)=year(@tanggal)  --and not substring(a.norek,1,2)='49'
group by a.kodeunit,b.kdgrup,b.urut,b.uraian,b.nmgrup
union all
select kodeunit as kdkbn,kdgrup,nmgrup,urut,norek,uraian,0,0,0,0 from #t1

select 'Kebun/Unit : '+b.NamaKebun as nmKbn,a.kdgrup,a.nmgrup,a.urut,a.norek,a.uraian,sum(a.sawdebet) as sawdebet,sum(a.sawkredit) as sawkredit,sum(a.debet) as debet,sum(a.kredit) as kredit,
sum(sawDebet+debet-sawKredit-kredit) as nilai
into #t3
from #t2 a
inner join #Ref_Kebun b on @kebun=b.KodeKebun
group by b.NamaKebun,a.kdgrup,a.urut,a.norek,a.uraian,a.nmgrup

select nmKbn,kdgrup,nmgrup,urut,norek,uraian,sawdebet,sawkredit,debet,kredit,nilai as sakdebet,0 as sakkredit 
into #t4
from #t3 
where nilai>=0
union all
select nmKbn,kdgrup,nmgrup,urut,norek,uraian,sawdebet,sawkredit,debet,kredit,0 as sakdebet,abs(nilai) as sakkredit 
from #t3 
where nilai<0

update #t4 set norek='400-426' where norek='404142'

select nmKbn,kdgrup,nmgrup,urut,norek,uraian,sum(sawdebet) as sawdebet,sum(sawkredit) as sawkredit,sum(debet) as debet,sum(kredit) as kredit,sum(sakdebet) as sakdebet,sum(sakkredit) as sakkredit 
into #t5
from #t4
where sawdebet+sawkredit+debet+kredit+sakdebet+sakkredit>=1
group by nmKbn,kdgrup,nmgrup,urut,norek,uraian
order by kdgrup,urut

select '1' as GRUP,'SALDO AWAL' as URAIAN,sum((sawdebet)) as debet,sum((sawkredit)) as kredit,sum((sawkredit-sawdebet)) as selisih from #t5
union all
select '2' as GRUP,'MUTASI BULAN INI' as URAIAN,sum((debet)),sum((kredit)),sum((debet-kredit)) as selisih from #t5
union all
select '2' as GRUP,'SALDO AKHIR' as URAIAN,sum((sakdebet)),sum((sakkredit)),sum((sakdebet-sakkredit)) as selisih from #t5

--set dateformat dmy exec CekNeracaPercobaan '01-01-2018','50'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[CekRekg154]
@tanggal datetime
--WITH ENCRYPTION
as
set dateformat dmy 
--declare @NamaKebun varchar(50)
--set @NamaKebun=(select top 1 NamaKebun from Ref_Kebun where Status=1)

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='D'
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='K'

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from kartu
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and Aplikasi<>'GUP'
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select a.kodeunit,c.NamaKebun as NamaKebun,a.norek,b.namarekening,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
--into SPDK_KBN_LAYANAN_BAGIAN..Rek154
from #t4 a
full outer join ref_rekening b on a.norek=b.norek and a.KodeUnit=b.KodeUnit
inner join Ref_Kebun c on a.KodeUnit=c.KodeKebun
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null and a.norek like '154%' and a.KodeUnit='32'
group by a.kodeunit,c.NamaKebun,a.norek,b.namarekening
order by KodeUnit,norek

--select Norek,NamaRekening from Ref_Rekening where Norek like '168%'

--set dateformat dmy exec CekRekg154 '01-10-2018'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[crCek_Neraca]
@tanggal datetime,
@kebun varchar(2)
as
set dateformat dmy
declare @NamaKebun varchar(50)
select * into #T1 from ref_lm where kode='701' and tampil='YA' and kodeunit=@kebun
select * into #AkunMemorial from AkunMemorial where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and KodeUnit=@kebun
select * into #Kartu from Kartu where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and KodeUnit=@kebun
set @NamaKebun=(select top 1 NamaKebun from SPDK_KBN_MASTER_REF..Ref_Kebun where KodeKebun=@kebun)

select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as Norek,b.uraian,sum(a.nilai) as sawdebet,cast(0 as float) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
into #TS1
from #AkunMemorial a
inner join #T1 b on substring(a.norek,1,len(b.norek))=b.norek
where a.dk='D' and substring(a.norek,1,len(b.norek)) in (select distinct norek from ref_lm where kode='701' and tampil='YA') and substring(a.norek,1,2) not in ('40','41','42') and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.noinput in ('SALDO AWAL','TRANSAKSI') and not substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as Norek,b.uraian,cast(0 as float) as sawdebet,sum(a.nilai) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
from #AkunMemorial a
inner join #T1 b on substring(a.norek,1,len(b.norek))=b.norek
where a.dk='K' and substring(a.norek,1,len(b.norek)) in (select distinct norek from ref_lm where kode='701' and tampil='YA') and substring(a.norek,1,2) not in ('40','41','42') and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.noinput in ('SALDO AWAL','TRANSAKSI') and not substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all

--SALDO AWAL BIAYA UMUM
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,'404142' as Norek,b.uraian,sum(a.nilai) as sawdebet,cast(0 as float) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
from #AkunMemorial a
inner join #T1 b on '404142'=b.norek
where a.dk='D' and substring(a.norek,1,2) in ('40','41','42') and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.noinput in ('SALDO AWAL','TRANSAKSI') and substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,'404142' as Norek,b.uraian,cast(0 as float) as sawdebet,sum(a.nilai) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
from #AkunMemorial a
inner join #T1 b on '404142'=b.norek
where a.dk='K' and substring(a.norek,1,2) in ('40','41','42') and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.noinput in ('SALDO AWAL','TRANSAKSI') and substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup

select kdkbn,kdgrup,nmgrup,urut,norek,uraian,sum(sawDebet-sawKredit) as nilai into #TS2 from #TS1 group by kdkbn,kdgrup,nmgrup,urut,norek,uraian

select kdkbn,kdgrup,nmgrup,urut,norek,uraian,sum(nilai) as SawDebet,0 as sawKredit,0 as Debet,0 as Kredit into #TS3 from #TS2 where nilai>0 group by kdkbn,kdgrup,nmgrup,urut,norek,uraian
union all
select kdkbn,kdgrup,nmgrup,urut,norek,uraian,0 as SawDebet,sum(abs(nilai)) as sawKredit,0 as Debet,0 as Kredit from #TS2 where nilai<0 group by kdkbn,kdgrup,nmgrup,urut,norek,uraian

select * into #T2 from #TS3
union all
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as Norek,b.uraian,0 as sawdebet,0 as sawkredit,sum(debet) as debet,sum(kredit) as kredit 
from #kartu a
inner join #T1 b on substring(a.norek,1,len(b.norek))=b.norek
where substring(a.norek,1,len(b.norek)) in (select distinct norek from ref_lm where kode='701' and tampil='YA') and substring(a.norek,1,2) not in ('40','41','42') and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and not substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all

select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,'404142' as Norek,b.uraian,0 as sawdebet,0 as sawkredit,sum(debet) as debet,sum(kredit) as kredit 
from #kartu a
inner join #T1 b on '404142'=substring(b.norek,1,6)
where substring(a.norek,1,2) in ('40','41','42') and MONTH(a.tanggal)=MONTH(@tanggal) and year(a.tanggal)=year(@tanggal)  --and not substring(a.norek,1,2)='49'
group by a.kodeunit,b.kdgrup,b.urut,b.uraian,b.nmgrup
union all
select kodeunit as kdkbn,kdgrup,nmgrup,urut,norek,uraian,0,0,0,0 from #t1

select 'Kebun/Unit : '+@NamaKebun as nmKbn,a.kdgrup,a.nmgrup,a.urut,a.norek,a.uraian,sum(a.sawdebet) as sawdebet,sum(a.sawkredit) as sawkredit,sum(a.debet) as debet,sum(a.kredit) as kredit,
sum(sawDebet+debet-sawKredit-kredit) as nilai
into #t3
from #t2 a
group by a.kdgrup,a.urut,a.norek,a.uraian,a.nmgrup

select nmKbn,kdgrup,nmgrup,urut,norek,uraian,sawdebet,sawkredit,debet,kredit,nilai as sakdebet,0 as sakkredit 
into #t4
from #t3 
where nilai>=0
union all
select nmKbn,kdgrup,nmgrup,urut,norek,uraian,sawdebet,sawkredit,debet,kredit,0 as sakdebet,abs(nilai) as sakkredit 
from #t3 
where nilai<0

update #t4 set norek='400-426' where norek='404142'

select nmKbn,kdgrup,nmgrup,urut,norek,uraian,sum(sawdebet) as sawdebet,sum(sawkredit) as sawkredit,sum(debet) as debet,sum(kredit) as kredit,sum(sakdebet) as sakdebet,sum(sakkredit) as sakkredit 
from #t4
where sawdebet+sawkredit+debet+kredit+sakdebet+sakkredit<>0
group by nmKbn,kdgrup,nmgrup,urut,norek,uraian
order by kdgrup,urut

--set dateformat dmy exec crCek_Neraca '01-12-2016','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[Create_MasterGaji_Karpim]
@tanggal datetime
as
set dateformat dmy
select * into #DIK from ref_dik where MONTH(TANGGAL)=MONTH(@tanggal) and YEAR(TANGGAL)=YEAR(@tanggal)

select a.kdunit,'201809' as Periode,'08'+RIGHT(a.register,6) as [Personnel Number],b.NAMA,a.register,b.GOL as KodeGolongan,c.GOL+'/'+c.MK as Golongan,a.GajiPokok,a.TTetap,a.TKhusus,a.TSansos,a.TStruktural,a.TJabatan,a.TJamSostek,a.TDapenbun,a.TPPIP,a.TKomunikasi,a.TPeralihan,a.TTransportasi,a.UpahHarian,a.UpahBorong,a.UpahRecovery,a.TPPH21,a.Rapel,a.Premi,a.PJamsostek,a.PDapenbun,a.PPPIP,a.PPPH21,a.PKebun,a.PKoperasi,a.TBPJS,a.PBPJS,a.TBPJSKes,a.PBPJSKes,
a.GajiPokok+a.TTetap+a.TKhusus+a.TSansos+a.TStruktural+a.TJabatan+a.TJamSostek+a.TDapenbun+a.TPPIP+a.TKomunikasi+a.TPeralihan+a.TTransportasi+a.UpahHarian+a.UpahBorong+a.UpahRecovery+a.TPPH21+a.Rapel+a.Premi+a.TBPJS+a.TBPJSKes as [Jumlah GP + Tunjangan],
a.PJamsostek+a.PDapenbun+a.PPPIP+a.PPPH21+a.PKebun+a.PKoperasi+a.PBPJS+a.PBPJSKes as [Jumlah Potongan],
(a.GajiPokok+a.TTetap+a.TKhusus+a.TSansos+a.TStruktural+a.TJabatan+a.TJamSostek+a.TDapenbun+a.TPPIP+a.TKomunikasi+a.TPeralihan+a.TTransportasi+a.UpahHarian+a.UpahBorong+a.UpahRecovery+a.TPPH21+a.Rapel+a.Premi+a.TBPJS+a.TBPJSKes)-(a.PJamsostek+a.PDapenbun+a.PPPIP+a.PPPH21+a.PKebun+a.PKoperasi+a.PBPJS+a.PBPJSKes) as [Bank Transfer]
into SPDK_KBN_LAYANAN_BAGIAN..MasterGajiKarpim_092018
from gajimaster a 
inner join #DIK b on a.register=b.REG
inner join SPDK_KBN_MASTER_REF..Ref_KomponenGaji1 c on b.GOL+b.MK=c.GOLBARU
where month(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and b.GOL>='09'
order by a.kdunit

--select * from SPDK_KBN_MASTER_REF..Ref_KomponenGaji1

--set dateformat dmy exec Create_MasterGaji_Karpim '01-09-2018'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[crKontrolTransaksi1Tahun]
@tanggal datetime,
@kdUnit varchar(2)
as
set dateformat dmy
declare @zero float
declare @tgl varchar(50)
set @zero=0
set @tgl='01-01-'+cast(YEAR(@tanggal) as varchar(4))

select * into #Norek from Ref_Rekening where KodeUnit=@kdUnit

select KodeUnit,norek,nilai as sawDr,@zero as sawCr,@zero as dr01,@zero as cr01,@zero as dr02,@zero as cr02,@zero as dr03,@zero as cr03,0 as dr04,@zero as cr04,@zero as dr05,@zero as cr05,@zero as dr06,@zero as cr06,@zero as dr07,@zero as cr07,@zero as dr08,@zero as cr08,@zero as dr09,@zero as cr09,@zero as dr10,@zero as cr10,@zero as dr11,@zero as cr11,@zero as dr12,@zero as cr12,@zero as sakDr,@zero as sakCr into #t1 from AkunMemorial where substring(NoInput,1,3) not in ('TRA','JLL') and MONTH(tanggal)=1 and YEAR(tanggal)=2017 and DK='D' and KodeUnit=@kdUnit
union all
select KodeUnit,norek,0 as sawDr,nilai as sawCr,0 as dr01,0 as cr01,0 as dr02,0 as cr02,0 as dr03,0 as cr03,0 as dr04,0 as cr04,0 as dr05,0 as cr05,0 as dr06,0 as cr06,0 as dr07,0 as cr07,0 as dr08,0 as cr08,0 as dr09,0 as cr09,0 as dr10,0 as cr10,0 as dr11,0 as cr11,0 as dr12,0 as cr12,0 as sakDr,0 as sakCr from AkunMemorial where substring(NoInput,1,3) not in ('TRA','JLL') and MONTH(tanggal)=1 and YEAR(tanggal)=2017 and DK='K' and KodeUnit=@kdUnit
union all

select KodeUnit,Norek,0 as sawDr,0 as sawCr,Debet as dr01,Kredit as cr01,0 as dr02,0 as cr02,0 as dr03,0 as cr03,0 as dr04,0 as cr04,0 as dr05,0 as cr05,0 as dr06,0 as cr06,0 as dr07,0 as cr07,0 as dr08,0 as cr08,0 as dr09,0 as cr09,0 as dr10,0 as cr10,0 as dr11,0 as cr11,0 as dr12,0 as cr12,0 as sakDr,0 as sakCr  from kartu where MONTH(Tanggal)=1 and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit=@kdUnit
union all
select KodeUnit,Norek,0 as sawDr,0 as sawCr,0 as dr01,0 as cr01,Debet as dr02,Kredit as cr02,0 as dr03,0 as cr03,0 as dr04,0 as cr04,0 as dr05,0 as cr05,0 as dr06,0 as cr06,0 as dr07,0 as cr07,0 as dr08,0 as cr08,0 as dr09,0 as cr09,0 as dr10,0 as cr10,0 as dr11,0 as cr11,0 as dr12,0 as cr12,0 as sakDr,0 as sakCr  from kartu where MONTH(Tanggal)=2 and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit=@kdUnit
union all
select KodeUnit,Norek,0 as sawDr,0 as sawCr,0 as dr01,0 as cr01,0 as dr02,0 as cr02,Debet as dr03,Kredit as cr03,0 as dr04,0 as cr04,0 as dr05,0 as cr05,0 as dr06,0 as cr06,0 as dr07,0 as cr07,0 as dr08,0 as cr08,0 as dr09,0 as cr09,0 as dr10,0 as cr10,0 as dr11,0 as cr11,0 as dr12,0 as cr12,0 as sakDr,0 as sakCr  from kartu where MONTH(Tanggal)=3 and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit=@kdUnit
union all
select KodeUnit,Norek,0 as sawDr,0 as sawCr,0 as dr01,0 as cr01,0 as dr02,0 as cr02,0 as dr03,0 as cr03,Debet as dr04,Kredit as cr04,0 as dr05,0 as cr05,0 as dr06,0 as cr06,0 as dr07,0 as cr07,0 as dr08,0 as cr08,0 as dr09,0 as cr09,0 as dr10,0 as cr10,0 as dr11,0 as cr11,0 as dr12,0 as cr12,0 as sakDr,0 as sakCr  from kartu where MONTH(Tanggal)=4 and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit=@kdUnit
union all
select KodeUnit,Norek,0 as sawDr,0 as sawCr,0 as dr01,0 as cr01,0 as dr02,0 as cr02,0 as dr03,0 as cr03,0 as dr04,0 as cr04,Debet as dr05,Kredit as cr05,0 as dr06,0 as cr06,0 as dr07,0 as cr07,0 as dr08,0 as cr08,0 as dr09,0 as cr09,0 as dr10,0 as cr10,0 as dr11,0 as cr11,0 as dr12,0 as cr12,0 as sakDr,0 as sakCr  from kartu where MONTH(Tanggal)=5 and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit=@kdUnit
union all
select KodeUnit,Norek,0 as sawDr,0 as sawCr,0 as dr01,0 as cr01,0 as dr02,0 as cr02,0 as dr03,0 as cr03,0 as dr04,0 as cr04,0 as dr05,0 as cr05,Debet as dr06,Kredit as cr06,0 as dr07,0 as cr07,0 as dr08,0 as cr08,0 as dr09,0 as cr09,0 as dr10,0 as cr10,0 as dr11,0 as cr11,0 as dr12,0 as cr12,0 as sakDr,0 as sakCr  from kartu where MONTH(Tanggal)=6 and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit=@kdUnit
union all
select KodeUnit,Norek,0 as sawDr,0 as sawCr,0 as dr01,0 as cr01,0 as dr02,0 as cr02,0 as dr03,0 as cr03,0 as dr04,0 as cr04,0 as dr05,0 as cr05,0 as dr06,0 as cr06,Debet as dr07,Kredit as cr07,0 as dr08,0 as cr08,0 as dr09,0 as cr09,0 as dr10,0 as cr10,0 as dr11,0 as cr11,0 as dr12,0 as cr12,0 as sakDr,0 as sakCr  from kartu where MONTH(Tanggal)=7 and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit=@kdUnit
union all
select KodeUnit,Norek,0 as sawDr,0 as sawCr,0 as dr01,0 as cr01,0 as dr02,0 as cr02,0 as dr03,0 as cr03,0 as dr04,0 as cr04,0 as dr05,0 as cr05,0 as dr06,0 as cr06,0 as dr07,0 as cr07,Debet as dr08,Kredit as cr08,0 as dr09,0 as cr09,0 as dr10,0 as cr10,0 as dr11,0 as cr11,0 as dr12,0 as cr12,0 as sakDr,0 as sakCr  from kartu where MONTH(Tanggal)=8 and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit=@kdUnit
union all
select KodeUnit,Norek,0 as sawDr,0 as sawCr,0 as dr01,0 as cr01,0 as dr02,0 as cr02,0 as dr03,0 as cr03,0 as dr04,0 as cr04,0 as dr05,0 as cr05,0 as dr06,0 as cr06,0 as dr07,0 as cr07,0 as dr08,0 as cr08,Debet as dr09,Kredit as cr09,0 as dr10,0 as cr10,0 as dr11,0 as cr11,0 as dr12,0 as cr12,0 as sakDr,0 as sakCr  from kartu where MONTH(Tanggal)=9 and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit=@kdUnit
union all
select KodeUnit,Norek,0 as sawDr,0 as sawCr,0 as dr01,0 as cr01,0 as dr02,0 as cr02,0 as dr03,0 as cr03,0 as dr04,0 as cr04,0 as dr05,0 as cr05,0 as dr06,0 as cr06,0 as dr07,0 as cr07,0 as dr08,0 as cr08,0 as dr09,0 as cr09,Debet as dr10,Kredit as cr10,0 as dr11,0 as cr11,0 as dr12,0 as cr12,0 as sakDr,0 as sakCr  from kartu where MONTH(Tanggal)=10 and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit=@kdUnit
union all
select KodeUnit,Norek,0 as sawDr,0 as sawCr,0 as dr01,0 as cr01,0 as dr02,0 as cr02,0 as dr03,0 as cr03,0 as dr04,0 as cr04,0 as dr05,0 as cr05,0 as dr06,0 as cr06,0 as dr07,0 as cr07,0 as dr08,0 as cr08,0 as dr09,0 as cr09,0 as dr10,0 as cr10,Debet as dr11,Kredit as cr11,0 as dr12,0 as cr12,0 as sakDr,0 as sakCr  from kartu where MONTH(Tanggal)=11 and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit=@kdUnit
union all
select KodeUnit,Norek,0 as sawDr,0 as sawCr,0 as dr01,0 as cr01,0 as dr02,0 as cr02,0 as dr03,0 as cr03,0 as dr04,0 as cr04,0 as dr05,0 as cr05,0 as dr06,0 as cr06,0 as dr07,0 as cr07,0 as dr08,0 as cr08,0 as dr09,0 as cr09,0 as dr10,0 as cr10,0 as dr11,0 as cr11,Debet as dr12,Kredit as cr12,0 as sakDr,0 as sakCr  from kartu where MONTH(Tanggal)=12 and YEAR(Tanggal)=YEAR(@tanggal) and KodeUnit=@kdUnit

select a.KodeUnit,c.NamaKebun,a.norek,b.NamaRekening,sum(a.sawDr-a.sawCr) as Sawal,@zero as SawDr,@zero as SawCr,
sum(a.Dr01) as dr01,sum(a.Cr01) as cr01,sum(a.Dr02) as dr02,sum(a.Cr02) as cr02,sum(a.Dr03) as dr03,sum(a.Cr03) as cr03,
sum(a.Dr04) as dr04,sum(a.Cr04) as cr04,sum(a.Dr05) as dr05,sum(a.Cr05) as cr05,sum(a.Dr06) as dr06,sum(a.Cr06) as cr06,
sum(a.Dr07) as dr07,sum(a.Cr07) as cr07,sum(a.Dr08) as dr08,sum(a.Cr08) as cr08,sum(a.Dr09) as dr09,sum(a.Cr09) as cr09,
sum(a.Dr10) as dr10,sum(a.Cr10) as cr10,sum(a.Dr11) as dr11,sum(a.Cr11) as cr11,sum(a.Dr12) as dr12,sum(a.Cr12) as cr12,
sum(a.sawdr+a.dr01+a.dr02+a.dr03+a.dr04+a.dr05+a.dr06+a.dr07+a.dr08+a.dr09+a.dr10+a.dr11+a.dr12)-sum(a.sawCr+a.cr01+a.cr02+a.cr03+a.cr04+a.cr05+a.cr06+a.cr07+a.cr08+a.cr09+a.cr10+a.cr11+a.cr12) as sakir,@zero as sakDr,@zero as sakCr
into #t2
from #t1 a
inner join #Norek b on a.norek=b.Norek
inner join Ref_Kebun c on a.KodeUnit=c.KodeKebun
group by a.KodeUnit,a.norek,b.NamaRekening,c.NamaKebun

update #t2 set SawDr=Sawal where Sawal>=0
update #t2 set SawCr=abs(Sawal) where Sawal<0
update #t2 set SakDr=sakir where sakir>=0
update #t2 set SakCr=abs(sakir) where sakir<0

select @tgl as Per,NamaKebun,norek,NamaRekening,
sum(SawDr) as SawDr, 
sum(SawCr) as SawCr, 
sum(dr01) as dr01, 
sum(cr01) as cr01, 
sum(dr02) as dr02, 
sum(cr02) as cr02, 
sum(dr03) as dr03, 
sum(cr03) as cr03, 
sum(dr04) as dr04, 
sum(cr04) as cr04, 
sum(dr05) as dr05, 
sum(cr05) as cr05, 
sum(dr06) as dr06, 
sum(cr06) as cr06, 
sum(dr07) as dr07, 
sum(cr07) as cr07, 
sum(dr08) as dr08, 
sum(cr08) as cr08, 
sum(dr09) as dr09, 
sum(cr09) as cr09, 
sum(dr10) as dr10, 
sum(cr10) as cr10, 
sum(dr11) as dr11, 
sum(cr11) as cr11, 
sum(dr12) as dr12, 
sum(cr12) as cr12, 
sum(sakDr) as sakDr, 
sum(sakCr) as sakCr
from #t2
group by NamaKebun,norek,NamaRekening
order by norek

--set dateformat dmy exec crKontrolTransaksi1Tahun '01-01-2017','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[crSPCek_TotalSelisih]
@tanggal datetime
as
set dateformat dmy
select KodeUnit,nilai as Sawdebet,0 as Sawkredit,0 as debet,0 as kredit into #t1 from AkunMemorial where NoInput not like 'JLL%' and DK='D' and YEAR(tanggal)=YEAR(@tanggal)
union all
select KodeUnit,0 as Sawdebet,nilai as Sawkredit,0 as debet,0 as kredit from AkunMemorial where NoInput not like 'JLL%' and DK='K' and YEAR(tanggal)=YEAR(@tanggal)
union all
select KodeUnit,0,0,Debet,Kredit from kartu where YEAR(tanggal)=YEAR(@tanggal)

select a.KodeUnit,b.NamaKebun,
round(SUM(a.Sawdebet),0) as SawDebet,round(SUM(a.Sawkredit),0) as sawKredit,round(SUM(a.Sawdebet-Sawkredit),0) as SawSelisih,
round(SUM(a.debet),0) as debet,round(SUM(a.kredit),0) as kredit,round(SUM(debet-kredit),0) as MutSelisih
from #t1 a
inner join Ref_Kebun b on a.KodeUnit=b.KodeKebun
group by a.KodeUnit,b.NamaKebun
order by KodeUnit

--set dateformat dmy exec crSPCek_TotalSelisih '01-01-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[DSB_AKNcr700]
@tanggal datetime,
@kdunit varchar(2)
as
begin
set dateformat dmy 
set nocount on
declare @NamaKebun varchar(50)
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @NamaKebun=(select top 1 NamaKebun from Ref_Kebun where KodeKebun=@kdunit)

select * into #Ref_Rekening from Ref_Rekening where KodeUnit=@kdunit
select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@TglAkhir and KodeUnit=@kdunit

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D' and KodeUnit=@kdunit
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K' and KodeUnit=@kdunit
union all
select KodeUnit,Norek,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where Tanggal>=@TglAwal and Tanggal<=@tglakhir and KodeUnit=@kdunit
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select a.kodeunit,a.norek,b.namarekening,'Kebun/Unit : '+@NamaKebun as NamaKebun,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
from #t4 a
full outer join #Ref_Rekening b on a.norek=b.norek
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null 
group by a.kodeunit,a.norek,b.namarekening
order by norek

end

--set dateformat dmy exec DSB_AKNcr700 '01-04-2017','40'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[DSB_AKNcr701]
@tanggal datetime,
@kdunit varchar(50)
as
set dateformat dmy
declare @kbn varchar(2)
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime
declare @TglLalu datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
--set @TglLalu=@TglAkhir-1
set @TglLalu='01-'+cast(MONTH(@tanggal) as varchar(2))+'-'+cast(YEAR(@tanggal) as varchar(4))


--set @kbn=(select top 1 kodeunit from akunmemorial where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and KodeUnit=@kdunit)
set @kbn=(select top 1 kodeunit from akunmemorial where KodeUnit=@kdunit)
select * into #T1 from ref_lm where kode='701' and tampil='YA' and kodeunit=@kdunit

---------------------------------------------------------------------------------
--PEMBENTUKAN SALDO AWAL DARI AWAL TAHUN
select KodeUnit,norek,sum(nilai) as nilai 
into #Sawal1
from AkunMemorial 
where NoInput='SALDO AWAL' AND MONTH(tanggal)=1 AND YEAR(tanggal)=YEAR(@tanggal) AND DK='D' and KodeUnit=@kdunit
group by KodeUnit,norek
union all
select KodeUnit,norek,-1*sum(nilai) as nilai 
from AkunMemorial 
where NoInput='SALDO AWAL' AND MONTH(tanggal)=1 AND YEAR(tanggal)=YEAR(@tanggal) AND DK='K' and KodeUnit=@kdunit
group by KodeUnit,norek
union all
select KodeUnit,Norek,sum(Debet-Kredit) as nilai 
from kartu 
where Tanggal>=@AwalTahun and Tanggal<@TglLalu and KodeUnit=@kdunit
group by KodeUnit,Norek

select KodeUnit,norek,SUM(nilai) as Nilai,'' as DK into #AkunMemorial from #Sawal1 group by KodeUnit,norek

update #AkunMemorial set DK='D' where Nilai>=0
update #AkunMemorial set DK='K' where Nilai<0
update #AkunMemorial set Nilai=abs(Nilai) where Nilai<0
---------------------------------------------------------------------------------

select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as Norek,b.uraian,sum(a.nilai) as sawdebet,cast(0 as float) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
into #TS1
from #AkunMemorial a
inner join #T1 b on substring(a.norek,1,len(b.norek))=b.norek
where a.KodeUnit=@kdunit and a.dk='D' and substring(a.norek,1,len(b.norek)) in (select distinct norek from ref_lm where kode='701' and tampil='YA') and substring(a.norek,1,2) not in ('40','41','42') and not substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as Norek,b.uraian,cast(0 as float) as sawdebet,sum(a.nilai) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
from #AkunMemorial a
inner join #T1 b on substring(a.norek,1,len(b.norek))=b.norek
where a.KodeUnit=@kdunit and a.dk='K' and substring(a.norek,1,len(b.norek)) in (select distinct norek from ref_lm where kode='701' and tampil='YA') and substring(a.norek,1,2) not in ('40','41','42') and not substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all

--SALDO AWAL BIAYA UMUM
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,'404142' as Norek,b.uraian,sum(a.nilai) as sawdebet,cast(0 as float) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
from #AkunMemorial a
inner join #T1 b on '404142'=b.norek
where a.KodeUnit=@kdunit and a.dk='D' and substring(a.norek,1,2) in ('40','41','42') and substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,'404142' as Norek,b.uraian,cast(0 as float) as sawdebet,sum(a.nilai) as sawkredit,cast(0 as float) as debet,cast(0 as float) as kredit
from #AkunMemorial a
inner join #T1 b on '404142'=b.norek
where a.KodeUnit=@kdunit and a.dk='K' and substring(a.norek,1,2) in ('40','41','42') and substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup

select kdkbn,kdgrup,nmgrup,urut,norek,uraian,sum(sawDebet-sawKredit) as nilai into #TS2 from #TS1 group by kdkbn,kdgrup,nmgrup,urut,norek,uraian

select kdkbn,kdgrup,nmgrup,urut,norek,uraian,sum(nilai) as SawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit into #TS3 from #TS2 where nilai>0 group by kdkbn,kdgrup,nmgrup,urut,norek,uraian
union all
select kdkbn,kdgrup,nmgrup,urut,norek,uraian,0 as SawDebet,sum(abs(nilai)) as sawKredit,0 as Debet,0 as Kredit from #TS2 where nilai<0 group by kdkbn,kdgrup,nmgrup,urut,norek,uraian

select * into #T2 from #TS3
union all
select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as Norek,b.uraian,0 as sawdebet,0 as sawkredit,sum(debet) as debet,sum(kredit) as kredit 
from kartu a
inner join #T1 b on substring(a.norek,1,len(b.norek))=b.norek
where a.KodeUnit=@kdunit and substring(a.norek,1,len(b.norek)) in (select distinct norek from ref_lm where kode='701' and tampil='YA') and substring(a.norek,1,2) not in ('40','41','42') and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and not substring(b.norek,1,6)='404142'
group by a.kodeunit,substring(a.norek,1,len(b.norek)),b.kdgrup,b.uraian,b.urut,b.nmgrup
union all

select a.kodeunit as kdkbn,b.kdgrup,b.nmgrup,b.urut,'404142' as Norek,b.uraian,0 as sawdebet,0 as sawkredit,sum(debet) as debet,sum(kredit) as kredit 
from kartu a
inner join #T1 b on '404142'=substring(b.norek,1,6)
where a.KodeUnit=@kdunit and substring(a.norek,1,2) in ('40','41','42') and MONTH(a.tanggal)=MONTH(@tanggal) and year(a.tanggal)=year(@tanggal)  --and not substring(a.norek,1,2)='49'
group by a.kodeunit,b.kdgrup,b.urut,b.uraian,b.nmgrup
union all
select kodeunit as kdkbn,kdgrup,nmgrup,urut,norek,uraian,0,0,0,0 from #t1

select 'Kebun/Unit : '+b.NamaKebun as nmKbn,a.kdgrup,a.nmgrup,a.urut,a.norek,a.uraian,sum(a.sawdebet) as sawdebet,sum(a.sawkredit) as sawkredit,sum(a.debet) as debet,sum(a.kredit) as kredit,
sum(sawDebet+debet-sawKredit-kredit) as nilai
into #t3
from #t2 a
inner join ref_kebun b on @kbn=b.KodeKebun
group by b.NamaKebun,a.kdgrup,a.urut,a.norek,a.uraian,a.nmgrup

select nmKbn,kdgrup,nmgrup,urut,norek,uraian,sawdebet,sawkredit,debet,kredit,nilai as sakdebet,0 as sakkredit 
into #t4
from #t3 
where nilai>=0
union all
select nmKbn,kdgrup,nmgrup,urut,norek,uraian,sawdebet,sawkredit,debet,kredit,0 as sakdebet,abs(nilai) as sakkredit 
from #t3 
where nilai<0

update #t4 set norek='400-426' where norek='404142'

select nmKbn,kdgrup,nmgrup,urut,norek,uraian,sum(sawdebet) as sawdebet,sum(sawkredit) as sawkredit,sum(debet) as debet,sum(kredit) as kredit,sum(sakdebet) as sakdebet,sum(sakkredit) as sakkredit,CAST(0 as float) as saldo 
into #t5
from #t4
--where sum(sawdebet+sawkredit+debet+kredit+sakdebet+sakkredit)<>0
group by nmKbn,kdgrup,nmgrup,urut,norek,uraian

update #t5 set saldo=sawdebet+sawkredit+debet+kredit+sakdebet+sakkredit

select nmKbn,kdgrup,nmgrup,urut,norek,uraian,sum(sawdebet) as sawdebet,sum(sawkredit) as sawkredit,sum(debet) as debet,sum(kredit) as kredit,sum(sakdebet) as sakdebet,sum(sakkredit) as sakkredit 
from #t5
where saldo<>0
group by nmKbn,kdgrup,nmgrup,urut,norek,uraian
order by kdgrup,urut

--set dateformat dmy exec DSB_AKNcr701 '31-10-2019','43'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[DSB_AKNcr708]
@Tanggal datetime,
@kdunit varchar(2),
@kdbud varchar(2)
as
set dateformat dmy
declare @AwalTahun datetime
declare @TglAwal datetime
declare @TglAkhir datetime
declare @TglLalu datetime
set @AwalTahun='01-01-'+cast(year(@tanggal) as varchar(4))
set @TglAwal='01-'+cast(month(@tanggal) as varchar(2))+'-'+cast(year(@tanggal) as varchar(4))
set @TglAkhir=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @TglLalu= @TglAwal-1

select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@TglLalu and KodeUnit=@kdunit and KodeBudidaya=@kdbud

--SALDO AWAL TAHUN
select kodeunit,norek,nilai as nilai
into #AkunMemorial
from AkunMemorial
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D' and KodeUnit=@kdunit and kodebud=@kdbud
union all
select kodeunit,norek,-1*nilai as nilai
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K' and KodeUnit=@kdunit and kodebud=@kdbud
union all
select KodeUnit,Norek,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal
----------------END OF SALDO

--REALISASI S/D BULAN LALU
select kodeunit,norek,cast(0 as float) as BI,cast(0 as float) as ABI,cast(nilai as float) as SBI,cast(0 as float) as ASBI
into #t1
from #AkunMemorial where substring(norek,1,1) in ('4','6') and nilai>0
union all
select kodeunit,norek,cast(0 as float) as BI,cast(0 as float) as ABI,nilai as SBI,cast(0 as float) as ASBI
from #AkunMemorial where substring(norek,1,1) in ('4','6')  and nilai<0
union all

--REALISASI BULAN INI
select kodeunit,norek,debet-kredit as BI,cast(0 as float) as ABI,debet-kredit as SBI,cast(0 as float) as ASBI 
from Kartu 
where substring(norek,1,1) in ('4','6') and MONTH(Tanggal)=MONTH(@Tanggal) and YEAR(Tanggal)=YEAR(@Tanggal) and KodeBudidaya=@kdbud and KodeUnit=@kdunit
union all

--RKAP BULAN INI
select kodeunit,norek,0 as BI,nilai_RKAP as ABI,cast(0 as float) as SBI,nilai_RKAP as ASBI 
from AkunRKAP
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(norek,1,1) in ('4','6') and kodebud=@kdbud and kodeunit=@kdunit
union all

--RKAP S/D BULAN LALU
select kodeunit,norek,cast(0 as float) as BI,cast(0 as float) as ABI,cast(0 as float) as SBI,nilai_RKAP as ASBI 
from AkunRKAP
where tanggal>=@AwalTahun and tanggal<=@TglLalu and substring(norek,1,1) in ('4','6') and kodebud=@kdbud and kodeunit=@kdunit

select a.kodeunit,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as norek,b.uraian,sum(a.bi) as BI,sum(a.abi) as ABI,sum(a.sbi) as SBI,sum(a.asbi) as ASBI
into #T2
from #T1 a
inner join ref_lm b on '708'=b.kode and substring(a.norek,1,len(b.norek))=b.norek and a.KodeUnit=b.kodeunit
where a.norek not like '60214%'
group by a.kodeunit,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)),b.uraian
union all
select a.kodeunit,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as norek,b.uraian,sum(a.bi) as BI,sum(a.abi) as ABI,sum(a.sbi) as SBI,sum(a.asbi) as ASBI
from #T1 a
inner join ref_lm b on '708'=b.kode and substring(a.norek,1,len(b.norek))=b.norek and a.KodeUnit=b.kodeunit
where b.norek='60214'
group by a.kodeunit,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)),b.uraian
union all
select kodeunit,kdgrup,nmgrup,urut,norek,uraian,0 as bi,0 as abi,0 as sbi,0 as asbi from ref_lm where kode='708' and kodeunit=@kdunit

select 'Kebun/Unit : '+b.namakebun as nmKebun,c.nm_bud as nmBud,a.norek as Rekg,dbo.proper(a.Uraian) as Uraian,a.kodeunit,a.kdgrup as Grup,a.urut,a.nmgrup as Judul,sum(a.bi) as bi,sum(a.abi) as abi,sum(a.sbi) as sbi,sum(a.asbi) as asbi,
cast(0 as float) as  ArealTM,
cast(0 as float) as  SSBI,cast(0 as float) AS SSABI,cast(0 as float) AS SSSBI,cast(0 as float) AS SSASBI,
cast(0 as float) as  BS01_BI,  cast(0 as float) as  BS02_BI,  cast(0 as float) as  BS03_BI,  cast(0 as float) as  BS04_BI,  cast(0 as float) as  BS05_BI,  cast(0 as float) as  BS06_BI,  cast(0 as float) as  BS07_BI,
cast(0 as float) as  BS01_ABI, cast(0 as float) as  BS02_ABI, cast(0 as float) as  BS03_ABI, cast(0 as float) as  BS04_ABI, cast(0 as float) as  BS05_ABI, cast(0 as float) as  BS06_ABI, cast(0 as float) as  BS07_ABI,
cast(0 as float) as  BS01_SBI, cast(0 as float) as  BS02_SBI, cast(0 as float) as  BS03_SBI, cast(0 as float) as  BS04_SBI, cast(0 as float) as  BS05_SBI, cast(0 as float) as  BS06_SBI, cast(0 as float) as  BS07_SBI,
cast(0 as float) as  BS01_ASBI,cast(0 as float) as  BS02_ASBI,cast(0 as float) as  BS03_ASBI,cast(0 as float) as  BS04_ASBI,cast(0 as float) as  BS05_ASBI,cast(0 as float) as  BS06_ASBI,cast(0 as float) as  BS07_ASBI,
cast(0 as float) as  KR01_BI,  cast(0 as float) as  KR02_BI,  cast(0 as float) as  KR03_BI,  cast(0 as float) as  KR04_BI,  cast(0 as float) as  KR05_BI,  cast(0 as float) as  KR06_BI,  cast(0 as float) as  KR07_BI,
cast(0 as float) as  KR01_ABI, cast(0 as float) as  KR02_ABI, cast(0 as float) as  KR03_ABI, cast(0 as float) as  KR04_ABI, cast(0 as float) as  KR05_ABI, cast(0 as float) as  KR06_ABI, cast(0 as float) as  KR07_ABI,
cast(0 as float) as  KR01_SBI, cast(0 as float) as  KR02_SBI, cast(0 as float) as  KR03_SBI, cast(0 as float) as  KR04_SBI, cast(0 as float) as  KR05_SBI, cast(0 as float) as  KR06_SBI, cast(0 as float) as  KR07_SBI,
cast(0 as float) as  KR01_ASBI,cast(0 as float) as  KR02_ASBI,cast(0 as float) as  KR03_ASBI,cast(0 as float) as  KR04_ASBI,cast(0 as float) as  KR05_ASBI,cast(0 as float) as  KR06_ASBI,cast(0 as float) as  KR07_ASBI,
a.kdgrup as Grup2
into #t3
from #t2 a
inner join ref_kebun b on a.kodeunit=b.kodekebun
inner join ref_budidaya c on @kdbud=c.kd_bud and @kdunit=c.KodeUnit
group by a.kodeunit,b.namakebun,c.nm_bud,a.kdgrup,a.nmgrup,a.urut,a.norek,a.uraian

update #t3 set ArealTM=(select sum(luas) from ref_areal where status='TM' and kodebudidaya=@kdbud and kodekebun=@kdunit)
update #t3 set SSBI=BI,SSABI=ABI,SSSBI=SBI,SSASBI=ASBI where rekg='4900001'
update #t3 set SSBI=BI,SSABI=ABI,SSSBI=SBI,SSASBI=ASBI where rekg='4900002'


--REALIASAI PRODUKSI BASAH SAMPAI DENGAN BULAN LALU
update #t3 set BS01_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek='X'                      and kodevar='BASAH') --SENDIRI
update #t3 set BS02_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek in ('6080200')           and kodevar='BASAH') --PEMBELIAN DARI LANCURAN
update #t3 set BS03_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek in ('6080300')           and kodevar='BASAH') --PEMBELIAN DARI TBM
update #t3 set BS04_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek in ('6080102','6080101') and kodevar='BASAH') --PEMBELIAN DARI PIHAK KE III/PLASMA
update #t3 set BS05_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek in ('6080100')           and kodevar='BASAH') --PENERIMAAN DARI KEBUN SE-INDUK
update #t3 set BS06_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek in ('6090100')           and kodevar='BASAH') --PENJUALAN KE KEBUN SE-INDUK
update #t3 set BS07_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek in ('6090101')           and kodevar='BASAH') --PENJUALAN KE PIHAK KE III

update #t3 set BS01_SBI=0 where BS01_SBI is null
update #t3 set BS02_SBI=0 where BS02_SBI is null
update #t3 set BS03_SBI=0 where BS03_SBI is null
update #t3 set BS04_SBI=0 where BS04_SBI is null
update #t3 set BS05_SBI=0 where BS05_SBI is null
update #t3 set BS06_SBI=0 where BS06_SBI is null
update #t3 set BS07_SBI=0 where BS07_SBI is null

--REALIASAI PRODUKSI BASAH BULAN INI DAN SAMPAI DENGAN BULAN INI
update #t3 set BS01_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek='X'                      and kodevar='BASAH') --SENDIRI
update #t3 set BS02_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6080200')           and kodevar='BASAH') --PEMBELIAN DARI LANCURAN
update #t3 set BS03_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6080300')           and kodevar='BASAH') --PEMBELIAN DARI TBM
update #t3 set BS04_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6080102','6080101') and kodevar='BASAH') --PEMBELIAN DARI PIHAK KE III/PLASMA
update #t3 set BS05_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6080100')           and kodevar='BASAH') --PENERIMAAN DARI KEBUN SE-INDUK
update #t3 set BS06_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6090100')           and kodevar='BASAH') --PENJUALAN KE KEBUN SE-INDUK
update #t3 set BS07_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6090101')           and kodevar='BASAH') --PENJUALAN KE PIHAK KE III

update #t3 set BS01_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='X'                      and kodevar='BASAH') --SENDIRI
update #t3 set BS02_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6080200')           and kodevar='BASAH') --PEMBELIAN DARI LANCURAN
update #t3 set BS03_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6080300')           and kodevar='BASAH') --PEMBELIAN DARI TBM
update #t3 set BS04_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6080102','6080101') and kodevar='BASAH') --PEMBELIAN DARI PIHAK KE III/PLASMA
update #t3 set BS05_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6080100')           and kodevar='BASAH') --PENERIMAAN DARI KEBUN SE-INDUK
update #t3 set BS06_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6090100')           and kodevar='BASAH') --PENJUALAN KE KEBUN SE-INDUK
update #t3 set BS07_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6090101')           and kodevar='BASAH') --PENJUALAN KE PIHAK KE III

update #t3 set BS01_BI=0 where BS01_BI is null
update #t3 set BS02_BI=0 where BS02_BI is null
update #t3 set BS03_BI=0 where BS03_BI is null
update #t3 set BS04_BI=0 where BS04_BI is null
update #t3 set BS05_BI=0 where BS05_BI is null
update #t3 set BS06_BI=0 where BS06_BI is null
update #t3 set BS07_BI=0 where BS07_BI is null

update #t3 set BS01_SBI=0 where BS01_SBI is null
update #t3 set BS02_SBI=0 where BS02_SBI is null
update #t3 set BS03_SBI=0 where BS03_SBI is null
update #t3 set BS04_SBI=0 where BS04_SBI is null
update #t3 set BS05_SBI=0 where BS05_SBI is null
update #t3 set BS06_SBI=0 where BS06_SBI is null
update #t3 set BS07_SBI=0 where BS07_SBI is null

--ANGGARAN PRODUKSI BASAH S/D BULAN LALU
update #t3 set BS01_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek='X'                      and kodevar='BASAH') --SENDIRI
update #t3 set BS02_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek in ('6080200')           and kodevar='BASAH') --PEMBELIAN DARI LANCURAN
update #t3 set BS03_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek in ('6080300')           and kodevar='BASAH') --PEMBELIAN DARI TBM
update #t3 set BS04_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek in ('6080102','6080101') and kodevar='BASAH') --PEMBELIAN DARI PIHAK KE III/PLASMA
update #t3 set BS05_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek in ('6080100')           and kodevar='BASAH') --PENERIMAAN DARI KEBUN SE-INDUK
update #t3 set BS06_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek in ('6090100')           and kodevar='BASAH') --PENJUALAN KE KEBUN SE-INDUK
update #t3 set BS07_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek in ('6090101')           and kodevar='BASAH') --PENJUALAN KE PIHAK KE III

update #t3 set BS01_ASBI=0 where BS01_ASBI is null
update #t3 set BS02_ASBI=0 where BS02_ASBI is null
update #t3 set BS03_ASBI=0 where BS03_ASBI is null
update #t3 set BS04_ASBI=0 where BS04_ASBI is null
update #t3 set BS05_ASBI=0 where BS05_ASBI is null
update #t3 set BS06_ASBI=0 where BS06_ASBI is null
update #t3 set BS07_ASBI=0 where BS07_ASBI is null

--ANGGARAN PRODUKSI BASAH BULAN INI DAN SAMPAI DENGAN BULAN INI
update #t3 set BS01_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek='X'                      and kodevar='BASAH') --SENDIRI
update #t3 set BS02_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6080200')           and kodevar='BASAH') --PEMBELIAN DARI LANCURAN
update #t3 set BS03_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6080300')           and kodevar='BASAH') --PEMBELIAN DARI TBM
update #t3 set BS04_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6080102','6080101') and kodevar='BASAH') --PEMBELIAN DARI PIHAK KE III/PLASMA
update #t3 set BS05_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6080100')           and kodevar='BASAH') --PENERIMAAN DARI KEBUN SE-INDUK
update #t3 set BS06_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6090100')           and kodevar='BASAH') --PENJUALAN KE KEBUN SE-INDUK
update #t3 set BS07_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6090101')           and kodevar='BASAH') --PENJUALAN KE PIHAK KE III

update #t3 set BS01_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='X'                      and kodevar='BASAH') --SENDIRI
update #t3 set BS02_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6080200')           and kodevar='BASAH') --PEMBELIAN DARI LANCURAN
update #t3 set BS03_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6080300')           and kodevar='BASAH') --PEMBELIAN DARI TBM
update #t3 set BS04_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6080102','6080101') and kodevar='BASAH') --PEMBELIAN DARI PIHAK KE III/PLASMA
update #t3 set BS05_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6080100')           and kodevar='BASAH') --PENERIMAAN DARI KEBUN SE-INDUK
update #t3 set BS06_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6090100')           and kodevar='BASAH') --PENJUALAN KE KEBUN SE-INDUK
update #t3 set BS07_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6090101')           and kodevar='BASAH') --PENJUALAN KE PIHAK KE III

update #t3 set BS01_ABI=0 where BS01_ABI is null
update #t3 set BS02_ABI=0 where BS02_ABI is null
update #t3 set BS03_ABI=0 where BS03_ABI is null
update #t3 set BS04_ABI=0 where BS04_ABI is null
update #t3 set BS05_ABI=0 where BS05_ABI is null
update #t3 set BS06_ABI=0 where BS06_ABI is null
update #t3 set BS07_ABI=0 where BS07_ABI is null
update #t3 set BS01_ASBI=0 where BS01_ASBI is null
update #t3 set BS02_ASBI=0 where BS02_ASBI is null
update #t3 set BS03_ASBI=0 where BS03_ASBI is null
update #t3 set BS04_ASBI=0 where BS04_ASBI is null
update #t3 set BS05_ASBI=0 where BS05_ASBI is null
update #t3 set BS06_ASBI=0 where BS06_ASBI is null
update #t3 set BS07_ASBI=0 where BS07_ASBI is null

--REALIASAI PRODUKSI KERING S/D BULAN LALU
update #t3 set KR01_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek='X'                                and kodevar='JADI') --SENDIRI
update #t3 set KR02_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek='6080500'                          and kodevar='JADI') --LANCURAN
update #t3 set KR03_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek='6080600'                          and kodevar='JADI') --TBM
update #t3 set KR04_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek in ('6080401','6080402')           and kodevar='JADI') --PIHAK KE 3/PLASMA
update #t3 set KR05_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek='6080400'                          and kodevar='JADI') --PENERIMAAN DARI KEBUN SE INDUK
update #t3 set KR06_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek in ('6090400','6090500','6090402') and kodevar='JADI') --PENJUALAN KE KEBUN SE INDUK DAN Penjualan Kering (Eks Penjualan Basah)
update #t3 set KR07_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and norek='6900403'                          and kodevar='JADI') --PENGIRIMAN BARANG BAHAN

update #t3 set KR01_SBI=0 where KR01_SBI is null
update #t3 set KR02_SBI=0 where KR02_SBI is null
update #t3 set KR03_SBI=0 where KR03_SBI is null
update #t3 set KR04_SBI=0 where KR04_SBI is null
update #t3 set KR05_SBI=0 where KR05_SBI is null
update #t3 set KR06_SBI=0 where KR06_SBI is null
update #t3 set KR07_SBI=0 where KR07_SBI is null

--REALIASAI PRODUKSI KERING BULAN INI DAN SAMPAI DENGAN BULAN INI
update #t3 set KR01_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek='X'                                and kodevar='JADI') --SENDIRI
update #t3 set KR02_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek='6080500'                          and kodevar='JADI') --LANCURAN
update #t3 set KR03_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek='6080600'                          and kodevar='JADI') --TBM
update #t3 set KR04_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6080401','6080402')           and kodevar='JADI') --PIHAK KE 3/PLASMA
update #t3 set KR05_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek='6080400'                          and kodevar='JADI') --PENERIMAAN DARI KEBUN SE INDUK
update #t3 set KR06_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6090400','6090500','6090402') and kodevar='JADI') --PENJUALAN KE KEBUN SE INDUK DAN Penjualan Kering (Eks Penjualan Basah)
update #t3 set KR07_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek='6900403'                          and kodevar='JADI') --PENGIRIMAN BARANG BAHAN

update #t3 set KR01_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='X'                                and kodevar='JADI') --SENDIRI
update #t3 set KR02_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='6080500'                          and kodevar='JADI') --LANCURAN
update #t3 set KR03_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='6080600'                          and kodevar='JADI') --TBM
update #t3 set KR04_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6080401','6080402')           and kodevar='JADI') --PIHAK KE 3/PLASMA
update #t3 set KR05_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='6080400'                          and kodevar='JADI') --PENERIMAAN DARI KEBUN SE INDUK
update #t3 set KR06_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6090400','6090500','6090402') and kodevar='JADI') --PENJUALAN KE KEBUN SE INDUK DAN Penjualan Kering (Eks Penjualan Basah)
update #t3 set KR07_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='6900403'                          and kodevar='JADI') --PENGIRIMAN BARANG

update #t3 set KR01_BI=0 where KR01_BI is null
update #t3 set KR02_BI=0 where KR02_BI is null
update #t3 set KR03_BI=0 where KR03_BI is null
update #t3 set KR04_BI=0 where KR04_BI is null
update #t3 set KR05_BI=0 where KR05_BI is null
update #t3 set KR06_BI=0 where KR06_BI is null
update #t3 set KR07_BI=0 where KR07_BI is null
update #t3 set KR01_SBI=0 where KR01_SBI is null
update #t3 set KR02_SBI=0 where KR02_SBI is null
update #t3 set KR03_SBI=0 where KR03_SBI is null
update #t3 set KR04_SBI=0 where KR04_SBI is null
update #t3 set KR05_SBI=0 where KR05_SBI is null
update #t3 set KR06_SBI=0 where KR06_SBI is null
update #t3 set KR07_SBI=0 where KR07_SBI is null

--ANGGARAN PRODUKSI KERING S/D BULAN LALU
update #t3 set KR01_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='X'                                and kodevar='JADI') --SENDIRI
update #t3 set KR02_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='6080500'                          and kodevar='JADI') --LANCURAN
update #t3 set KR03_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='6080600'                          and kodevar='JADI') --TBM
update #t3 set KR04_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6080401','6080402')           and kodevar='JADI') --PIHAK KE 3/PLASMA
update #t3 set KR05_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='6080400'                          and kodevar='JADI') --PENERIMAAN DARI KEBUN SE INDUK
update #t3 set KR06_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6090400','6090500','6090402') and kodevar='JADI') --PENJUALAN KE KEBUN SE INDUK DAN Penjualan Kering (Eks Penjualan Basah)
update #t3 set KR07_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='6900403'                          and kodevar='JADI') --PENGIRIMAN BARANG

update #t3 set KR01_ASBI=0 where KR01_ASBI is null
update #t3 set KR02_ASBI=0 where KR02_ASBI is null
update #t3 set KR03_ASBI=0 where KR03_ASBI is null
update #t3 set KR04_ASBI=0 where KR04_ASBI is null
update #t3 set KR05_ASBI=0 where KR05_ASBI is null
update #t3 set KR06_ASBI=0 where KR06_ASBI is null
update #t3 set KR07_ASBI=0 where KR07_ASBI is null

--ANGGARAN PRODUKSI KERING BULAN INI DAN SAMPAI DENGAN BULAN INI
update #t3 set KR01_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek='X'                                and kodevar='JADI') --SENDIRI
update #t3 set KR02_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek='6080500'                          and kodevar='JADI') --LANCURAN
update #t3 set KR03_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek='6080600'                          and kodevar='JADI') --TBM
update #t3 set KR04_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6080401','6080402')           and kodevar='JADI') --PIHAK KE 3/PLASMA
update #t3 set KR05_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek='6080400'                          and kodevar='JADI') --PENERIMAAN DARI KEBUN SE INDUK
update #t3 set KR06_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek in ('6090400','6090500','6090402') and kodevar='JADI') --PENJUALAN KE KEBUN SE INDUK DAN Penjualan Kering (Eks Penjualan Basah)
update #t3 set KR07_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and norek='6900403'                          and kodevar='JADI') --PENGIRIMAN BARANG

update #t3 set KR01_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='X'                                and kodevar='JADI') --SENDIRI
update #t3 set KR02_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='6080500'                          and kodevar='JADI') --LANCURAN
update #t3 set KR03_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='6080600'                          and kodevar='JADI') --TBM
update #t3 set KR04_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6080401','6080402')           and kodevar='JADI') --PIHAK KE 3/PLASMA
update #t3 set KR05_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='6080400'                          and kodevar='JADI') --PENERIMAAN DARI KEBUN SE INDUK
update #t3 set KR06_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek in ('6090400','6090500','6090402') and kodevar='JADI') --PENJUALAN KE KEBUN SE INDUK DAN Penjualan Kering (Eks Penjualan Basah)
update #t3 set KR07_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdunit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and norek='6900403'                          and kodevar='JADI') --PENGIRIMAN BARANG

update #t3 set KR01_ABI=0 where KR01_ABI is null
update #t3 set KR02_ABI=0 where KR02_ABI is null
update #t3 set KR03_ABI=0 where KR03_ABI is null
update #t3 set KR04_ABI=0 where KR04_ABI is null
update #t3 set KR05_ABI=0 where KR05_ABI is null
update #t3 set KR06_ABI=0 where KR06_ABI is null
update #t3 set KR07_ABI=0 where KR07_ABI is null
update #t3 set KR01_ASBI=0 where KR01_ASBI is null
update #t3 set KR02_ASBI=0 where KR02_ASBI is null
update #t3 set KR03_ASBI=0 where KR03_ASBI is null
update #t3 set KR04_ASBI=0 where KR04_ASBI is null
update #t3 set KR05_ASBI=0 where KR05_ASBI is null
update #t3 set KR06_ASBI=0 where KR06_ASBI is null
update #t3 set KR07_ASBI=0 where KR07_ASBI is null

select * from #t3
where bi+abi+sbi+asbi<>0
order by grup,urut

--set dateformat dmy exec DSB_AKNcr708 '01-07-2017','50','00'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[DSB_AKNcr709]
@Tanggal datetime,
@kdUnit varchar(2),
@kdbud varchar(2),
@kdolah varchar(4)
as
set dateformat dmy
declare @AwalTahun datetime
declare @TglAwal datetime
declare @TglLalu datetime
declare @TglAkhir datetime

set @AwalTahun='01-01-'+cast(year(@tanggal) as varchar(4))
set @TglAwal='01-'+cast(month(@tanggal) as varchar(2))+'-'+cast(year(@tanggal) as varchar(4))
set @TglLalu= @TglAwal-1
set @TglAkhir=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@tglakhir and KodeUnit=@kdunit and KodeBudidaya=@kdbud and Netral=@kdolah
select distinct KodeUnit,KodeBudidaya,KodeJenisOlah,Uraian into #Ref_JenisOlah from Ref_JenisOlah where KodeUnit=@kdUnit and KodeBudidaya=@kdbud

--REALISASI S/D BULAN LALU
select kodeunit,norek,cast(0 as float) as BI,cast(0 as float) as ABI,cast(nilai as float) as SBI,cast(0 as float) as ASBI
into #t1
from AkunMemorial where dk='D' and substring(norek,1,1) in ('4','6') and kodebud=@kdbud and netral=@kdolah and MONTH(tanggal)=1 and YEAR(tanggal)=YEAR(@Tanggal) and NoInput in ('SALDO AWAL') and KodeUnit=@kdUnit
union all
select kodeunit,norek,cast(0 as float) as BI,cast(0 as float) as ABI,-1*nilai as SBI,cast(0 as float) as ASBI
from AkunMemorial where dk='K' and substring(norek,1,1) in ('4','6') and kodebud=@kdbud and netral=@kdolah and MONTH(tanggal)=1 and YEAR(tanggal)=YEAR(@Tanggal) and NoInput in ('SALDO AWAL') and KodeUnit=@kdUnit
union all
select kodeunit,norek,cast(0 as float) as BI,cast(0 as float) as ABI,cast(Debet-Kredit as float) as SBI,cast(0 as float) as ASBI
from #kartu
where Tanggal>=@AwalTahun and Tanggal<=@TglLalu
union all

--REALISASI BULAN INI
select kodeunit,norek,sum(debet-kredit) as BI,cast(0 as float) as ABI,sum(debet-kredit) as SBI,cast(0 as float) as ASBI 
from #kartu 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(norek,1,1) in ('4','6') and kodebudidaya=@kdbud and netral=@kdolah and KodeUnit=@kdUnit
group by kodeunit,norek
union all

--RKAP BULAN INI
select kodeunit,norek,0 as BI,nilai_RKAP as ABI,cast(0 as float) as SBI,nilai_RKAP as ASBI 
from AkunRKAP
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(norek,1,1) in ('4','6') and kodebud=@kdbud and netral=@kdolah and KodeUnit=@kdUnit
union all

--RKAP S/D BULAN LALU
select kodeunit,norek,cast(0 as float) as BI,cast(0 as float) as ABI,cast(0 as float) as SBI,nilai_RKAP as ASBI 
from AkunRKAP
where tanggal>=@AwalTahun and tanggal<=@TglLalu and substring(norek,1,1) in ('4','6') and kodebud=@kdbud and netral=@kdolah and KodeUnit=@kdUnit

select a.kodeunit,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as norek,b.uraian,sum(a.bi) as BI,sum(a.abi) as ABI,sum(a.sbi) as SBI,sum(a.asbi) as ASBI
into #T2
from #T1 a
inner join ref_lm b on '708'=b.kode and substring(a.norek,1,len(b.norek))=b.norek and a.KodeUnit=b.kodeunit
where a.norek not like '60214%'
group by a.kodeunit,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)),b.uraian
union all
select a.kodeunit,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)) as norek,b.uraian,sum(a.bi) as BI,sum(a.abi) as ABI,sum(a.sbi) as SBI,sum(a.asbi) as ASBI
from #T1 a
inner join ref_lm b on '708'=b.kode and substring(a.norek,1,len(b.norek))=b.norek and a.KodeUnit=b.kodeunit
where b.norek='60214'
group by a.kodeunit,b.kdgrup,b.nmgrup,b.urut,substring(a.norek,1,len(b.norek)),b.uraian
union all
select kodeunit,kdgrup,nmgrup,urut,norek,uraian,0 as bi,0 as abi,0 as sbi,0 as asbi from ref_lm where kode='708' and kodeunit=@kdUnit

select 'Kebun/Unit : '+b.namakebun as nmKebun,c.nm_bud as nmBud,@kdOlah as kdOlah,d.Uraian as JnsOlah,a.norek as Rekg,dbo.proper(a.Uraian) as Uraian,a.kodeunit,a.kdgrup as Grup,a.urut,a.nmgrup as Judul,sum(a.bi) as bi,sum(a.abi) as abi,sum(a.sbi) as sbi,sum(a.asbi) as asbi,
cast(0 as float) as  ArealTM,
cast(0 as float) as  SSBI,cast(0 as float) AS SSABI,cast(0 as float) AS SSSBI,cast(0 as float) AS SSASBI,
cast(0 as float) as  BS01_BI,  cast(0 as float) as  BS02_BI,  cast(0 as float) as  BS03_BI,  cast(0 as float) as  BS04_BI,  cast(0 as float) as  BS05_BI,  cast(0 as float) as  BS06_BI,  cast(0 as float) as  BS07_BI,
cast(0 as float) as  BS01_ABI, cast(0 as float) as  BS02_ABI, cast(0 as float) as  BS03_ABI, cast(0 as float) as  BS04_ABI, cast(0 as float) as  BS05_ABI, cast(0 as float) as  BS06_ABI, cast(0 as float) as  BS07_ABI,
cast(0 as float) as  BS01_SBI, cast(0 as float) as  BS02_SBI, cast(0 as float) as  BS03_SBI, cast(0 as float) as  BS04_SBI, cast(0 as float) as  BS05_SBI, cast(0 as float) as  BS06_SBI, cast(0 as float) as  BS07_SBI,
cast(0 as float) as  BS01_ASBI,cast(0 as float) as  BS02_ASBI,cast(0 as float) as  BS03_ASBI,cast(0 as float) as  BS04_ASBI,cast(0 as float) as  BS05_ASBI,cast(0 as float) as  BS06_ASBI,cast(0 as float) as  BS07_ASBI,
cast(0 as float) as  KR01_BI,  cast(0 as float) as  KR02_BI,  cast(0 as float) as  KR03_BI,  cast(0 as float) as  KR04_BI,  cast(0 as float) as  KR05_BI,  cast(0 as float) as  KR06_BI,  cast(0 as float) as  KR07_BI,
cast(0 as float) as  KR01_ABI, cast(0 as float) as  KR02_ABI, cast(0 as float) as  KR03_ABI, cast(0 as float) as  KR04_ABI, cast(0 as float) as  KR05_ABI, cast(0 as float) as  KR06_ABI, cast(0 as float) as  KR07_ABI,
cast(0 as float) as  KR01_SBI, cast(0 as float) as  KR02_SBI, cast(0 as float) as  KR03_SBI, cast(0 as float) as  KR04_SBI, cast(0 as float) as  KR05_SBI, cast(0 as float) as  KR06_SBI, cast(0 as float) as  KR07_SBI,
cast(0 as float) as  KR01_ASBI,cast(0 as float) as  KR02_ASBI,cast(0 as float) as  KR03_ASBI,cast(0 as float) as  KR04_ASBI,cast(0 as float) as  KR05_ASBI,cast(0 as float) as  KR06_ASBI,cast(0 as float) as  KR07_ASBI,
a.kdgrup as Grup2
into #t3
from #t2 a
inner join ref_kebun b on a.kodeunit=b.kodekebun
inner join ref_budidaya c on @kdbud=c.kd_bud and a.KodeUnit=b.KodeKebun
inner join #Ref_JenisOlah d on @kdbud=d.KodeBudidaya and @kdolah=d.KodeJenisOlah and @kdUnit=c.KodeUnit
group by a.kodeunit,b.namakebun,c.nm_bud,a.kdgrup,a.nmgrup,a.urut,a.norek,a.uraian,d.uraian

update #t3 set ArealTM=(select sum(luas) from ref_areal where status='TM' and kodebudidaya=@kdbud and kodekebun=@kdUnit)
update #t3 set SSBI=BI,SSABI=ABI,SSSBI=SBI,SSASBI=ASBI where rekg='4900001'
update #t3 set SSBI=BI,SSABI=ABI,SSSBI=SBI,SSASBI=ASBI where rekg='4900002'


--REALIASAI PRODUKSI BASAH SAMPAI DENGAN BULAN LALU
update #t3 set BS01_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='X'                      and kodevar='BASAH') --SENDIRI
update #t3 set BS02_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080200')           and kodevar='BASAH') --PEMBELIAN DARI LANCURAN
update #t3 set BS03_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080300')           and kodevar='BASAH') --PEMBELIAN DARI TBM
update #t3 set BS04_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080102','6080101') and kodevar='BASAH') --PEMBELIAN DARI PIHAK KE III/PLASMA
update #t3 set BS05_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080100')           and kodevar='BASAH') --PENERIMAAN DARI KEBUN SE-INDUK
update #t3 set BS06_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090100')           and kodevar='BASAH') --PENJUALAN KE KEBUN SE-INDUK
update #t3 set BS07_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090101')           and kodevar='BASAH') --PENJUALAN KE PIHAK KE III

update #t3 set BS01_SBI=0 where BS01_SBI is null
update #t3 set BS02_SBI=0 where BS02_SBI is null
update #t3 set BS03_SBI=0 where BS03_SBI is null
update #t3 set BS04_SBI=0 where BS04_SBI is null
update #t3 set BS05_SBI=0 where BS05_SBI is null
update #t3 set BS06_SBI=0 where BS06_SBI is null
update #t3 set BS07_SBI=0 where BS07_SBI is null

--REALIASAI PRODUKSI BASAH BULAN INI DAN SAMPAI DENGAN BULAN INI
update #t3 set BS01_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='X'                      and kodevar='BASAH') --SENDIRI
update #t3 set BS02_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080200')           and kodevar='BASAH') --PEMBELIAN DARI LANCURAN
update #t3 set BS03_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080300')           and kodevar='BASAH') --PEMBELIAN DARI TBM
update #t3 set BS04_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080102','6080101') and kodevar='BASAH') --PEMBELIAN DARI PIHAK KE III/PLASMA
update #t3 set BS05_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080100')           and kodevar='BASAH') --PENERIMAAN DARI KEBUN SE-INDUK
update #t3 set BS06_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090100')           and kodevar='BASAH') --PENJUALAN KE KEBUN SE-INDUK
update #t3 set BS07_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090101')           and kodevar='BASAH') --PENJUALAN KE PIHAK KE III

update #t3 set BS01_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='X'                      and kodevar='BASAH') --SENDIRI
update #t3 set BS02_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080200')           and kodevar='BASAH') --PEMBELIAN DARI LANCURAN
update #t3 set BS03_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080300')           and kodevar='BASAH') --PEMBELIAN DARI TBM
update #t3 set BS04_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080102','6080101') and kodevar='BASAH') --PEMBELIAN DARI PIHAK KE III/PLASMA
update #t3 set BS05_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080100')           and kodevar='BASAH') --PENERIMAAN DARI KEBUN SE-INDUK
update #t3 set BS06_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090100')           and kodevar='BASAH') --PENJUALAN KE KEBUN SE-INDUK
update #t3 set BS07_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090101')           and kodevar='BASAH') --PENJUALAN KE PIHAK KE III

update #t3 set BS01_BI=0 where BS01_BI is null
update #t3 set BS02_BI=0 where BS02_BI is null
update #t3 set BS03_BI=0 where BS03_BI is null
update #t3 set BS04_BI=0 where BS04_BI is null
update #t3 set BS05_BI=0 where BS05_BI is null
update #t3 set BS06_BI=0 where BS06_BI is null
update #t3 set BS07_BI=0 where BS07_BI is null
update #t3 set BS01_SBI=0 where BS01_SBI is null
update #t3 set BS02_SBI=0 where BS02_SBI is null
update #t3 set BS03_SBI=0 where BS03_SBI is null
update #t3 set BS04_SBI=0 where BS04_SBI is null
update #t3 set BS05_SBI=0 where BS05_SBI is null
update #t3 set BS06_SBI=0 where BS06_SBI is null
update #t3 set BS07_SBI=0 where BS07_SBI is null

--ANGGARAN PRODUKSI BASAH S/D BULAN LALU
update #t3 set BS01_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='X'                      and kodevar='BASAH') --SENDIRI
update #t3 set BS02_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080200')           and kodevar='BASAH') --PEMBELIAN DARI LANCURAN
update #t3 set BS03_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080300')           and kodevar='BASAH') --PEMBELIAN DARI TBM
update #t3 set BS04_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080102','6080101') and kodevar='BASAH') --PEMBELIAN DARI PIHAK KE III/PLASMA
update #t3 set BS05_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080100')           and kodevar='BASAH') --PENERIMAAN DARI KEBUN SE-INDUK
update #t3 set BS06_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090100')           and kodevar='BASAH') --PENJUALAN KE KEBUN SE-INDUK
update #t3 set BS07_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090101')           and kodevar='BASAH') --PENJUALAN KE PIHAK KE III

update #t3 set BS01_ASBI=0 where BS01_ASBI is null
update #t3 set BS02_ASBI=0 where BS02_ASBI is null
update #t3 set BS03_ASBI=0 where BS03_ASBI is null
update #t3 set BS04_ASBI=0 where BS04_ASBI is null
update #t3 set BS05_ASBI=0 where BS05_ASBI is null
update #t3 set BS06_ASBI=0 where BS06_ASBI is null
update #t3 set BS07_ASBI=0 where BS07_ASBI is null

--ANGGARAN PRODUKSI BASAH BULAN INI DAN SAMPAI DENGAN BULAN INI
update #t3 set BS01_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='X'                      and kodevar='BASAH') --SENDIRI
update #t3 set BS02_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080200')           and kodevar='BASAH') --PEMBELIAN DARI LANCURAN
update #t3 set BS03_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080300')           and kodevar='BASAH') --PEMBELIAN DARI TBM
update #t3 set BS04_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080102','6080101') and kodevar='BASAH') --PEMBELIAN DARI PIHAK KE III/PLASMA
update #t3 set BS05_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080100')           and kodevar='BASAH') --PENERIMAAN DARI KEBUN SE-INDUK
update #t3 set BS06_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090100')           and kodevar='BASAH') --PENJUALAN KE KEBUN SE-INDUK
update #t3 set BS07_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090101')           and kodevar='BASAH') --PENJUALAN KE PIHAK KE III

update #t3 set BS01_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='X'                      and kodevar='BASAH') --SENDIRI
update #t3 set BS02_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080200')           and kodevar='BASAH') --PEMBELIAN DARI LANCURAN
update #t3 set BS03_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080300')           and kodevar='BASAH') --PEMBELIAN DARI TBM
update #t3 set BS04_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080102','6080101') and kodevar='BASAH') --PEMBELIAN DARI PIHAK KE III/PLASMA
update #t3 set BS05_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080100')           and kodevar='BASAH') --PENERIMAAN DARI KEBUN SE-INDUK
update #t3 set BS06_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090100')           and kodevar='BASAH') --PENJUALAN KE KEBUN SE-INDUK
update #t3 set BS07_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090101')           and kodevar='BASAH') --PENJUALAN KE PIHAK KE III

update #t3 set BS01_ABI=0 where BS01_ABI is null
update #t3 set BS02_ABI=0 where BS02_ABI is null
update #t3 set BS03_ABI=0 where BS03_ABI is null
update #t3 set BS04_ABI=0 where BS04_ABI is null
update #t3 set BS05_ABI=0 where BS05_ABI is null
update #t3 set BS06_ABI=0 where BS06_ABI is null
update #t3 set BS07_ABI=0 where BS07_ABI is null
update #t3 set BS01_ASBI=0 where BS01_ASBI is null
update #t3 set BS02_ASBI=0 where BS02_ASBI is null
update #t3 set BS03_ASBI=0 where BS03_ASBI is null
update #t3 set BS04_ASBI=0 where BS04_ASBI is null
update #t3 set BS05_ASBI=0 where BS05_ASBI is null
update #t3 set BS06_ASBI=0 where BS06_ASBI is null
update #t3 set BS07_ASBI=0 where BS07_ASBI is null

--REALIASAI PRODUKSI KERING S/D BULAN LALU
update #t3 set KR01_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='X'                                and kodevar='JADI') --SENDIRI
update #t3 set KR02_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080500'                          and kodevar='JADI') --LANCURAN
update #t3 set KR03_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080600'                          and kodevar='JADI') --TBM
update #t3 set KR04_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080401','6080402')           and kodevar='JADI') --PIHAK KE 3/PLASMA
update #t3 set KR05_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080400'                          and kodevar='JADI') --PENERIMAAN DARI KEBUN SE INDUK
update #t3 set KR06_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090400','6090500','6090402') and kodevar='JADI') --PENJUALAN KE KEBUN SE INDUK DAN Penjualan Kering (Eks Penjualan Basah)
update #t3 set KR07_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6900403'                          and kodevar='JADI') --PENERIMAAN BARANG
update #t3 set KR01_SBI=0 where KR01_SBI is null
update #t3 set KR02_SBI=0 where KR02_SBI is null
update #t3 set KR03_SBI=0 where KR03_SBI is null
update #t3 set KR04_SBI=0 where KR04_SBI is null
update #t3 set KR05_SBI=0 where KR05_SBI is null
update #t3 set KR06_SBI=0 where KR06_SBI is null
update #t3 set KR07_SBI=0 where KR07_SBI is null

--REALIASAI PRODUKSI KERING BULAN INI DAN SAMPAI DENGAN BULAN INI
update #t3 set KR01_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='X'                                and kodevar='JADI') --SENDIRI
update #t3 set KR02_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080500'                          and kodevar='JADI') --LANCURAN
update #t3 set KR03_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080600'                          and kodevar='JADI') --TBM
update #t3 set KR04_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080401','6080402')           and kodevar='JADI') --PIHAK KE 3/PLASMA
update #t3 set KR05_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080400'                          and kodevar='JADI') --PENERIMAAN DARI KEBUN SE INDUK
update #t3 set KR06_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090400','6090500','6090402') and kodevar='JADI') --PENJUALAN KE KEBUN SE INDUK DAN Penjualan Kering (Eks Penjualan Basah)
update #t3 set KR07_BI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6900403'                          and kodevar='JADI') --PENERIMAAN BARANG

update #t3 set KR01_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='X'                                and kodevar='JADI') --SENDIRI
update #t3 set KR02_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080500'                          and kodevar='JADI') --LANCURAN
update #t3 set KR03_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080600'                          and kodevar='JADI') --TBM
update #t3 set KR04_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080401','6080402')           and kodevar='JADI') --PIHAK KE 3/PLASMA
update #t3 set KR05_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080400'                          and kodevar='JADI') --PENERIMAAN DARI KEBUN SE INDUK
update #t3 set KR06_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090400','6090500','6090402') and kodevar='JADI') --PENJUALAN KE KEBUN SE INDUK DAN Penjualan Kering (Eks Penjualan Basah)
update #t3 set KR07_SBI=(select sum(bi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6900403'                          and kodevar='JADI') --PENERIMAAN BARANG
update #t3 set KR01_BI=0 where KR01_BI is null
update #t3 set KR02_BI=0 where KR02_BI is null
update #t3 set KR03_BI=0 where KR03_BI is null
update #t3 set KR04_BI=0 where KR04_BI is null
update #t3 set KR05_BI=0 where KR05_BI is null
update #t3 set KR06_BI=0 where KR06_BI is null
update #t3 set KR07_BI=0 where KR07_BI is null
update #t3 set KR01_SBI=0 where KR01_SBI is null
update #t3 set KR02_SBI=0 where KR02_SBI is null
update #t3 set KR03_SBI=0 where KR03_SBI is null
update #t3 set KR04_SBI=0 where KR04_SBI is null
update #t3 set KR05_SBI=0 where KR05_SBI is null
update #t3 set KR06_SBI=0 where KR06_SBI is null
update #t3 set KR07_SBI=0 where KR07_SBI is null

--ANGGARAN PRODUKSI KERING S/D BULAN LALU
update #t3 set KR01_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='X'                                and kodevar='JADI') --SENDIRI
update #t3 set KR02_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080500'                          and kodevar='JADI') --LANCURAN
update #t3 set KR03_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080600'                          and kodevar='JADI') --TBM
update #t3 set KR04_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080401','6080402')           and kodevar='JADI') --PIHAK KE 3/PLASMA
update #t3 set KR05_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080400'                          and kodevar='JADI') --PENERIMAAN DARI KEBUN SE INDUK
update #t3 set KR06_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090400','6090500','6090402') and kodevar='JADI') --PENJUALAN KE KEBUN SE INDUK DAN Penjualan Kering (Eks Penjualan Basah)
update #t3 set KR07_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglLalu and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6900403'                          and kodevar='JADI') --PENERIMAAN BARANG
update #t3 set KR01_ASBI=0 where KR01_ASBI is null
update #t3 set KR02_ASBI=0 where KR02_ASBI is null
update #t3 set KR03_ASBI=0 where KR03_ASBI is null
update #t3 set KR04_ASBI=0 where KR04_ASBI is null
update #t3 set KR05_ASBI=0 where KR05_ASBI is null
update #t3 set KR06_ASBI=0 where KR06_ASBI is null
update #t3 set KR07_ASBI=0 where KR07_ASBI is null

--ANGGARAN PRODUKSI KERING BULAN INI DAN SAMPAI DENGAN BULAN INI
update #t3 set KR01_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='X'                                and kodevar='JADI') --SENDIRI
update #t3 set KR02_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080500'                          and kodevar='JADI') --LANCURAN
update #t3 set KR03_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080600'                          and kodevar='JADI') --TBM
update #t3 set KR04_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080401','6080402')           and kodevar='JADI') --PIHAK KE 3/PLASMA
update #t3 set KR05_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080400'                          and kodevar='JADI') --PENERIMAAN DARI KEBUN SE INDUK
update #t3 set KR06_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090400','6090500','6090402') and kodevar='JADI') --PENJUALAN KE KEBUN SE INDUK DAN Penjualan Kering (Eks Penjualan Basah)
update #t3 set KR07_ABI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6900403'                          and kodevar='JADI') --PENERIMAAN BARANG

update #t3 set KR01_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='X'                                and kodevar='JADI') --SENDIRI
update #t3 set KR02_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080500'                          and kodevar='JADI') --LANCURAN
update #t3 set KR03_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080600'                          and kodevar='JADI') --TBM
update #t3 set KR04_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6080401','6080402')           and kodevar='JADI') --PIHAK KE 3/PLASMA
update #t3 set KR05_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6080400'                          and kodevar='JADI') --PENERIMAAN DARI KEBUN SE INDUK
update #t3 set KR06_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek in ('6090400','6090500','6090402') and kodevar='JADI') --PENJUALAN KE KEBUN SE INDUK DAN Penjualan Kering (Eks Penjualan Basah)
update #t3 set KR07_ASBI=(select sum(rbi) from AkunProduksiHP where kodeunit=@kdUnit and tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodebud=@kdbud and kodeJenisOlah=@kdolah and norek='6900403'                          and kodevar='JADI') --PENERIMAAN BARANG

update #t3 set KR01_ABI=0 where KR01_ABI is null
update #t3 set KR02_ABI=0 where KR02_ABI is null
update #t3 set KR03_ABI=0 where KR03_ABI is null
update #t3 set KR04_ABI=0 where KR04_ABI is null
update #t3 set KR05_ABI=0 where KR05_ABI is null
update #t3 set KR06_ABI=0 where KR06_ABI is null
update #t3 set KR07_ABI=0 where KR07_ABI is null
update #t3 set KR01_ASBI=0 where KR01_ASBI is null
update #t3 set KR02_ASBI=0 where KR02_ASBI is null
update #t3 set KR03_ASBI=0 where KR03_ASBI is null
update #t3 set KR04_ASBI=0 where KR04_ASBI is null
update #t3 set KR05_ASBI=0 where KR05_ASBI is null
update #t3 set KR06_ASBI=0 where KR06_ASBI is null
update #t3 set KR07_ASBI=0 where KR07_ASBI is null

select * from #t3
where bi+abi+sbi+asbi<>0
order by grup,urut

--set dateformat dmy exec DSB_AKNcr709 '01-06-2017','11','02','0200'


--select * from Ref_JenisOlah where KodeUnit='15'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[DSB_AKNcr710A]
@tanggal datetime,
@kdunit varchar(50)
as
set dateformat dmy
declare @AwalTahun datetime
declare @TglAwal datetime
declare @TglLalu datetime
declare @TglAkhir datetime

set @AwalTahun='01-01-'+cast(year(@tanggal) as varchar(4))
set @TglAwal='01-'+cast(month(@tanggal) as varchar(2))+'-'+cast(year(@tanggal) as varchar(4))
set @TglLalu= @TglAwal-1
set @TglAkhir=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select * into #AkunMemorial    from AkunMemorial   where KodeUnit=@kdunit and YEAR(tanggal)=YEAR(@tanggal)
select * into #kartu           from kartu          where KodeUnit=@kdunit and YEAR(tanggal)=YEAR(@tanggal)
select * into #AkunRKAP        from AkunRKAP       where KodeUnit=@kdunit and YEAR(tanggal)=YEAR(@tanggal)
select * into #AkunProduksiHP  from AkunProduksiHP where KodeUnit=@kdunit and YEAR(tanggal)=YEAR(@tanggal)
select * into #Ref_LM          from Ref_LM         where kodeunit=@kdunit
select top 1 * into #Ref_Kebun from Ref_Kebun      where KodeKebun=@kdunit

--REALIASAI BULAN LALU
select kodeunit,norek,cast(0 as float) as BI,cast(0 as float) as ABI,sum(nilai) as SBI,cast(0 as float) as ASBI
into #t1
from #AkunMemorial where tanggal>=@AwalTahun and tanggal<=@TglLalu and dk='D' and noinput in ('SALDO AWAL') and substring(norek,1,1)='4'
group by kodeunit,norek
union all
select kodeunit,norek,0 as BI,0 as ABI,-1*sum(nilai) as SBI,0 as ASBI
from #AkunMemorial where tanggal>=@AwalTahun and tanggal<=@TglLalu and dk='K' and noinput in ('SALDO AWAL') and substring(norek,1,1)='4'
group by kodeunit,norek
union all
select kodeunit,norek,0 as BI,0 as ABI,sum(Debet-Kredit) as SBI,0 as ASBI
from #kartu where tanggal>=@AwalTahun and tanggal<=@TglLalu and substring(norek,1,1)='4'
group by kodeunit,norek
union all

--REALISASI BULAN INI
select kodeunit,norek,sum(debet-kredit) as BI,0 as ABI,sum(debet-kredit) as SBI,0 as ASBI
from #kartu where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(norek,1,1)='4'
group by kodeunit,norek
union all

--RKAP BULAN INI
select kodeunit,norek,0 as BI,sum(nilai_RKAP) as ABI,0 as SBI,sum(nilai_RKAP) as ASBI
from #AkunRKAP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(norek,1,1)='4'
group by kodeunit,norek
union all

--RKAP S/d BULAN LALU
select kodeunit,norek,0 as BI,0 as ABI,0 as SBI,sum(nilai_RKAP) as ASBI
from #AkunRKAP where tanggal>=@AwalTahun and tanggal<=@TglLalu and substring(norek,1,1)='4'
group by kodeunit,norek

select space(2) as Grup,b.nmgrup,a.kodeunit,b.urut,substring(a.norek,1,3) as Norek,b.uraian,sum(a.bi) as bi,sum(a.abi) as abi,sum(a.sbi) as sbi,sum(a.asbi) as asbi
into #t2
from #t1 a
inner join #ref_lm b on substring(a.norek,1,3)=b.norek and '710'=b.kode and 'YA'=b.tampil and a.KodeUnit=b.kodeunit
where not substring(a.norek,1,3)='490' 
group by a.kodeunit,a.norek,b.uraian,b.urut,b.nmgrup
union all
select space(2) as Grup,b.nmgrup,a.kodeunit,b.urut,substring(a.norek,1,7) as Norek,b.uraian,sum(a.bi) as bi,sum(a.abi) as abi,sum(a.sbi) as sbi,sum(a.asbi) as asbi
from #t1 a
inner join #ref_lm b on substring(a.norek,1,7)=b.norek and '710'=b.kode and 'YA'=b.tampil and a.KodeUnit=b.kodeunit
where substring(a.norek,1,3) in ('490')
group by a.kodeunit,a.norek,b.uraian,b.urut,b.nmgrup
union all
select space(2) as Grup,nmgrup,kodeunit,urut,norek,uraian,0,0,0,0 from ref_lm where kode='710' and tampil='YA' and KodeUnit=@kdunit

update #t2 set grup='01' where substring(norek,1,1)='4' and norek not like '490%'
update #t2 set grup='02' where norek like '490%'

select grup,nmgrup,kodeunit,urut,norek,uraian,sum(bi) as bi,sum(abi) as abi,sum(sbi) as sbi,sum(asbi) as asbi,
cast(0 as float) as pbi,cast(0 as float) as psbi,
cast(0 as float) as pabi,cast(0 as float) as pasbi
into #t3
from #t2
group by grup,nmgrup,kodeunit,urut,norek,uraian

update #t3 set pbi=(select sum(bi)    from #AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodevar='JADI' and substring(norek,1,1)='X')
update #t3 set psbi=(select sum(bi)   from #AkunProduksiHP where tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodevar='JADI' and substring(norek,1,1)='X')

update #t3 set pabi=(select sum(rbi)  from #AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodevar='JADI' and substring(norek,1,1)='X')
update #t3 set pasbi=(select sum(rbi) from #AkunProduksiHP where tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodevar='JADI' and substring(norek,1,1)='X')

select 'Kebun/Unit : '+b.namakebun as nmKebun,a.* 
from #t3 a
inner join #ref_kebun b on a.kodeunit=b.kodekebun
where a.bi+a.abi+a.sbi+a.asbi<>0
order by grup,urut

--set dateformat dmy exec DSB_AKNcr710A '31-07-2017','74'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[DSB_AKNcr710B]
@tanggal datetime,
@kdunit varchar(50),
@kdbud varchar(50)
as
set dateformat dmy
declare @AwalTahun datetime
declare @TglAwal datetime
declare @TglLalu datetime
declare @TglAkhir datetime
declare @nmbud varchar(50)

set @AwalTahun='01-01-'+cast(year(@tanggal) as varchar(4))
set @TglAwal='01-'+cast(month(@tanggal) as varchar(2))+'-'+cast(year(@tanggal) as varchar(4))
set @TglLalu= @TglAwal-1
set @TglAkhir=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @nmbud=(select top 1 'BUDIDAYA '+upper(nm_bud) as nmbud from Ref_Budidaya where KodeUnit=KodeUnit and kd_bud=@kdbud)

select * into #AkunMemorial    from AkunMemorial   where KodeUnit=@kdunit and YEAR(tanggal)=YEAR(@tanggal) and kodebud=@kdbud
select * into #kartu           from kartu          where KodeUnit=@kdunit and YEAR(tanggal)=YEAR(@tanggal) and KodeBudidaya=@kdbud
select * into #AkunRKAP        from AkunRKAP       where KodeUnit=@kdunit and YEAR(tanggal)=YEAR(@tanggal) and kodebud=@kdbud
select * into #AkunProduksiHP  from AkunProduksiHP where KodeUnit=@kdunit and YEAR(tanggal)=YEAR(@tanggal) and kodebud=@kdbud
select * into #Ref_LM          from Ref_LM         where kodeunit=@kdunit
select top 1 * into #Ref_Kebun from Ref_Kebun      where KodeKebun=@kdunit

--REALIASAI BULAN LALU
select kodeunit,norek,cast(0 as float) as BI,cast(0 as float) as ABI,sum(nilai) as SBI,cast(0 as float) as ASBI
into #t1
from #AkunMemorial where tanggal>=@AwalTahun and tanggal<=@TglLalu and dk='D' and noinput in ('SALDO AWAL') and substring(norek,1,1)='4'
group by kodeunit,norek
union all
select kodeunit,norek,0 as BI,0 as ABI,-1*sum(nilai) as SBI,0 as ASBI
from #AkunMemorial where tanggal>=@AwalTahun and tanggal<=@TglLalu and dk='K' and noinput in ('SALDO AWAL') and substring(norek,1,1)='4'
group by kodeunit,norek
union all
select kodeunit,norek,0 as BI,0 as ABI,sum(Debet-Kredit) as SBI,0 as ASBI
from #kartu where tanggal>=@AwalTahun and tanggal<=@TglLalu and substring(norek,1,1)='4'
group by kodeunit,norek
union all

--REALISASI BULAN INI
select kodeunit,norek,sum(debet-kredit) as BI,0 as ABI,sum(debet-kredit) as SBI,0 as ASBI
from #kartu where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(norek,1,1)='4'
group by kodeunit,norek
union all

--RKAP BULAN INI
select kodeunit,norek,0 as BI,sum(nilai_RKAP) as ABI,0 as SBI,sum(nilai_RKAP) as ASBI
from #AkunRKAP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(norek,1,1)='4'
group by kodeunit,norek
union all

--RKAP S/d BULAN LALU
select kodeunit,norek,0 as BI,0 as ABI,0 as SBI,sum(nilai_RKAP) as ASBI
from #AkunRKAP where tanggal>=@AwalTahun and tanggal<=@TglLalu and substring(norek,1,1)='4'
group by kodeunit,norek

select space(2) as Grup,b.nmgrup,a.kodeunit,b.urut,substring(a.norek,1,3) as Norek,b.uraian,sum(a.bi) as bi,sum(a.abi) as abi,sum(a.sbi) as sbi,sum(a.asbi) as asbi
into #t2
from #t1 a
inner join #ref_lm b on substring(a.norek,1,3)=b.norek and '710'=b.kode and 'YA'=b.tampil and a.KodeUnit=b.kodeunit
where not substring(a.norek,1,3)='490' 
group by a.kodeunit,a.norek,b.uraian,b.urut,b.nmgrup
union all
select space(2) as Grup,b.nmgrup,a.kodeunit,b.urut,substring(a.norek,1,7) as Norek,b.uraian,sum(a.bi) as bi,sum(a.abi) as abi,sum(a.sbi) as sbi,sum(a.asbi) as asbi
from #t1 a
inner join #ref_lm b on substring(a.norek,1,7)=b.norek and '710'=b.kode and 'YA'=b.tampil and a.KodeUnit=b.kodeunit
where substring(a.norek,1,3) in ('490')
group by a.kodeunit,a.norek,b.uraian,b.urut,b.nmgrup
union all
select space(2) as Grup,nmgrup,kodeunit,urut,norek,uraian,0,0,0,0 from ref_lm where kode='710' and tampil='YA' and KodeUnit=@kdunit

update #t2 set grup='01' where substring(norek,1,1)='4' and norek not like '490%'
update #t2 set grup='02' where norek like '490%'

select grup,nmgrup,kodeunit,urut,norek,uraian,sum(bi) as bi,sum(abi) as abi,sum(sbi) as sbi,sum(asbi) as asbi,
cast(0 as float) as pbi,cast(0 as float) as psbi,
cast(0 as float) as pabi,cast(0 as float) as pasbi
into #t3
from #t2
group by grup,nmgrup,kodeunit,urut,norek,uraian

update #t3 set pbi=(select sum(bi)    from #AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodevar='JADI' and substring(norek,1,1)='X')
update #t3 set psbi=(select sum(bi)   from #AkunProduksiHP where tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodevar='JADI' and substring(norek,1,1)='X')

update #t3 set pabi=(select sum(rbi)  from #AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodevar='JADI' and substring(norek,1,1)='X')
update #t3 set pasbi=(select sum(rbi) from #AkunProduksiHP where tanggal>=@AwalTahun and tanggal<=@TglAkhir and kodevar='JADI' and substring(norek,1,1)='X')

select 'Kebun/Unit : '+b.namakebun as nmKebun,@nmbud as budidaya,a.* 
from #t3 a
inner join #ref_kebun b on a.kodeunit=b.kodekebun
where a.bi+a.abi+a.sbi+a.asbi<>0
order by grup,urut

--set dateformat dmy exec DSB_AKNcr710B '31-07-2017','11','02'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[DSB_AKNcr713]
@tanggal datetime,
@kdbud varchar(50),
@kdunit varchar(50)
as
set dateformat dmy
declare @AwalThn datetime
declare @TglAwal datetime
declare @TglLalu datetime
declare @TglAkhir datetime

set @TglAkhir=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @AwalThn='01-01-'+cast(year(@tanggal) as varchar(4))
set @TglAwal='01-'+cast(month(@tanggal) as varchar(2))+'-'+cast(year(@tanggal) as varchar(4))
set @TglLalu= @TglAwal-1

--REALIASAI BULAN LALU
select kodeunit,norek,netral,cast(0 as float) as BI,cast(0 as float) as ABI,sum(nilai) as SBI,cast(0 as float) as ASBI
into #t1
from AkunMemorial where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and dk='D' and noinput in ('SALDO AWAL','TRANSAKSI') and (substring(norek,1,1)='6' or substring(norek,1,3)='490') and KodeUnit=@kdunit
group by kodeunit,norek,netral
union all
select kodeunit,norek,netral,0 as BI,0 as ABI,-1*sum(nilai) as SBI,0 as ASBI
from AkunMemorial where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and dk='K' and noinput in ('SALDO AWAL','TRANSAKSI') and (substring(norek,1,1)='6' or substring(norek,1,3)='490') and KodeUnit=@kdunit
group by kodeunit,norek,netral
union all

--REALISASI BULAN INI
select kodeunit,norek,netral,sum(debet-kredit) as BI,0 as ABI,sum(debet-kredit) as SBI,0 as ASBI
from kartu where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebudidaya=@kdbud and (substring(norek,1,1)='6' or substring(norek,1,3)='490') and KodeUnit=@kdunit
group by kodeunit,norek,netral
union all

--RKAP BULAN INI
select kodeunit,norek,netral,0 as BI,sum(nilai_RKAP) as ABI,0 as SBI,sum(nilai_RKAP) as ASBI
from AkunRKAP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and (substring(norek,1,1)='6' or substring(norek,1,3)='490') and KodeUnit=@kdunit
group by kodeunit,norek,netral
union all

--RKAP S/D BULAN LALU
select kodeunit,norek,netral,0 as BI,0 as ABI,0 as SBI,sum(nilai_RKAP) as ASBI
from AkunRKAP where tanggal>=@AwalThn and tanggal<=@TglLalu and kodebud=@kdbud and (substring(norek,1,1)='6' or substring(norek,1,3)='490') and KodeUnit=@kdunit
group by kodeunit,norek,netral

select space(2) as Grup,space(50) as nmgrup,a.kodeunit,SPACE(50) as urut,a.Norek,space(50) as uraian,sum(a.bi) as bi,sum(a.abi) as abi,sum(a.sbi) as sbi,sum(a.asbi) as asbi
into #t2
from #t1 a
where not substring(a.norek,1,3)='490' and a.norek not like '60000%' 
group by a.kodeunit,a.norek
union all
select space(2) as Grup,space(50) as nmgrup,a.kodeunit,SPACE(50) as urut,a.Norek,space(50) as uraian,sum(a.bi) as bi,sum(a.abi) as abi,sum(a.sbi) as sbi,sum(a.asbi) as asbi
from #t1 a
where substring(a.norek,1,3) in ('490','600')
group by a.kodeunit,a.norek

select grup,nmgrup,kodeunit,urut,norek,SPACE(50) as uraian,cast(0 as float) as Luas,sum(bi) as bi,sum(abi) as abi,sum(sbi) as sbi,sum(asbi) as asbi,
cast(0 as float) as BS01_BI,  cast(0 as float) as BS02_BI,  cast(0 as float) as BS03_BI,  cast(0 as float) as BS04_BI,  cast(0 as float) as BS05_BI,  cast(0 as float) as BS06_BI,
cast(0 as float) as BS01_ABI, cast(0 as float) as BS02_ABI, cast(0 as float) as BS03_ABI, cast(0 as float) as BS04_ABI, cast(0 as float) as BS05_ABI, cast(0 as float) as BS06_ABI,
cast(0 as float) as BS01_SBI, cast(0 as float) as BS02_SBI, cast(0 as float) as BS03_SBI, cast(0 as float) as BS04_SBI, cast(0 as float) as BS05_SBI, cast(0 as float) as BS06_SBI,
cast(0 as float) as BS01_ASBI,cast(0 as float) as BS02_ASBI,cast(0 as float) as BS03_ASBI,cast(0 as float) as BS04_ASBI,cast(0 as float) as BS05_ASBI,cast(0 as float) as BS06_ASBI,
cast(0 as float) as KR01_BI,  cast(0 as float) as KR02_BI,  cast(0 as float) as KR03_BI,  cast(0 as float) as KR04_BI,  cast(0 as float) as KR05_BI,  cast(0 as float) as KR06_BI,  cast(0 as float) as KR07_BI,
cast(0 as float) as KR01_ABI, cast(0 as float) as KR02_ABI, cast(0 as float) as KR03_ABI, cast(0 as float) as KR04_ABI, cast(0 as float) as KR05_ABI, cast(0 as float) as KR06_ABI, cast(0 as float) as KR07_ABI,
cast(0 as float) as KR01_SBI, cast(0 as float) as KR02_SBI, cast(0 as float) as KR03_SBI, cast(0 as float) as KR04_SBI, cast(0 as float) as KR05_SBI, cast(0 as float) as KR06_SBI, cast(0 as float) as KR07_SBI,
cast(0 as float) as KR01_ASBI,cast(0 as float) as KR02_ASBI,cast(0 as float) as KR03_ASBI,cast(0 as float) as KR04_ASBI,cast(0 as float) as KR05_ASBI,cast(0 as float) as KR06_ASBI,cast(0 as float) as KR07_ASBI,
cast(0 as float) as ssBI,cast(0 as float) as ssABI,cast(0 as float) as ssSBI,cast(0 as float) as ssASBI,'' as Grup2
into #t3
from #t2
group by grup,kodeunit,urut,norek,nmgrup

update #t3 set Luas=(select sum(luas) from ref_areal where exAreal='Areal1' and kodebudidaya=@kdbud  and KodeUnit=@kdunit)

--PRODUKSI BASAH
--sendiri
set dateformat dmy update #t3 set BS01_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='BASAH' and norek='X' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS01_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='BASAH' and norek='X' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS01_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='BASAH' and norek='X' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS01_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='BASAH' and norek='X' and KodeUnit=@kdunit)
--Lancuran
set dateformat dmy update #t3 set BS02_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='BASAH' and norek='6080200' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS02_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='BASAH' and norek='6080200' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS02_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='BASAH' and norek='6080200' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS02_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='BASAH' and norek='6080200' and KodeUnit=@kdunit)
--TBM
set dateformat dmy update #t3 set BS03_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='BASAH' and norek='6080300' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS03_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='BASAH' and norek='6080300' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS03_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='BASAH' and norek='6080300' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS03_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='BASAH' and norek='6080300' and KodeUnit=@kdunit)
--Pembelian D/Pihak ke III/Plasma
set dateformat dmy update #t3 set BS04_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='BASAH' and norek in ('6080101','6080102') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS04_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='BASAH' and norek in ('6080101','6080102') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS04_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='BASAH' and norek in ('6080101','6080102') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS04_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='BASAH' and norek in ('6080101','6080102') and KodeUnit=@kdunit)
--Pembelian
set dateformat dmy update #t3 set BS05_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='BASAH' and norek='6080100' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS05_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='BASAH' and norek='6080100' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS05_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='BASAH' and norek='6080100' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS05_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='BASAH' and norek='6080100' and KodeUnit=@kdunit)
--Penjualan
set dateformat dmy update #t3 set BS06_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='BASAH' and norek='6090100' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS06_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='BASAH' and norek='6090100' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS06_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='BASAH' and norek='6090100' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set BS06_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='BASAH' and norek='6090100' and KodeUnit=@kdunit)

--PRODUKSI KERING
--sendiri
set dateformat dmy update #t3 set KR01_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='JADI' and norek='X' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR01_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='JADI' and norek='X' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR01_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='JADI' and norek='X' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR01_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='JADI' and norek='X' and KodeUnit=@kdunit)
--Lancuran
set dateformat dmy update #t3 set KR02_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='JADI' and norek='6080500' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR02_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='JADI' and norek='6080500' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR02_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='JADI' and norek='6080500' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR02_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='JADI' and norek='6080500' and KodeUnit=@kdunit)
--TBM
set dateformat dmy update #t3 set KR03_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='JADI' and norek='6080600' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR03_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='JADI' and norek='6080600' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR03_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='JADI' and norek='6080600' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR03_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='JADI' and norek='6080600' and KodeUnit=@kdunit)
--Pembelian D/Pihak ke III/Plasma
set dateformat dmy update #t3 set KR04_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='JADI' and norek in ('6080401','6080402') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR04_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='JADI' and norek in ('6080402','6080402') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR04_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='JADI' and norek in ('6080401','6080402') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR04_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='JADI' and norek in ('6080401','6080402') and KodeUnit=@kdunit)
--Pembelian
set dateformat dmy update #t3 set KR05_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='JADI' and norek='6080400' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR05_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='JADI' and norek='6080400' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR05_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='JADI' and norek='6080400' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR05_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='JADI' and norek='6080400' and KodeUnit=@kdunit)
--Penjualan
set dateformat dmy update #t3 set KR06_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='JADI' and norek in ('6090400','6090500','6090402') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR06_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='JADI' and norek in ('6090400','6090500','6090402') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR06_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='JADI' and norek in ('6090400','6090500','6090402') and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR06_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='JADI' and norek in ('6090400','6090500','6090402') and KodeUnit=@kdunit)
--Pengiriman Untuk Barang Bahan
set dateformat dmy update #t3 set KR07_BI=(select sum(bi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)   and kodebud=@kdbud and kodevar='JADI' and norek='6900403' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR07_ABI=(select sum(rbi) from AkunProduksiHP where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kodebud=@kdbud and kodevar='JADI' and norek='6900403' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR07_SBI=(select sum(bi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud      and kodevar='JADI' and norek='6900403' and KodeUnit=@kdunit)
set dateformat dmy update #t3 set KR07_ASBI=(select sum(rbi) from AkunProduksiHP where tanggal>=@AwalThn and tanggal<=@TglAkhir and kodebud=@kdbud    and kodevar='JADI' and norek='6900403' and KodeUnit=@kdunit)

--update JIKA NULL
set dateformat dmy update #t3 set BS01_BI=0   where BS01_BI is null   
set dateformat dmy update #t3 set BS01_ABI=0  where BS01_ABI is null  
set dateformat dmy update #t3 set BS01_SBI=0  where BS01_SBI is null  
set dateformat dmy update #t3 set BS01_ASBI=0 where BS01_ASBI is null 
set dateformat dmy update #t3 set BS02_BI=0   where BS02_BI is null   
set dateformat dmy update #t3 set BS02_ABI=0  where BS02_ABI is null  
set dateformat dmy update #t3 set BS02_SBI=0  where BS02_SBI is null  
set dateformat dmy update #t3 set BS02_ASBI=0 where BS02_ASBI is null 
set dateformat dmy update #t3 set BS03_BI=0   where BS03_BI is null   
set dateformat dmy update #t3 set BS03_ABI=0  where BS03_ABI is null  
set dateformat dmy update #t3 set BS03_SBI=0  where BS03_SBI is null  
set dateformat dmy update #t3 set BS03_ASBI=0 where BS03_ASBI is null 
set dateformat dmy update #t3 set BS04_BI=0   where BS04_BI is null   
set dateformat dmy update #t3 set BS04_ABI=0  where BS04_ABI is null  
set dateformat dmy update #t3 set BS04_SBI=0  where BS04_SBI is null  
set dateformat dmy update #t3 set BS04_ASBI=0 where BS04_ASBI is null 
set dateformat dmy update #t3 set BS05_BI=0   where BS05_BI is null   
set dateformat dmy update #t3 set BS05_ABI=0  where BS05_ABI is null  
set dateformat dmy update #t3 set BS05_SBI=0  where BS05_SBI is null  
set dateformat dmy update #t3 set BS05_ASBI=0 where BS05_ASBI is null 
set dateformat dmy update #t3 set BS06_BI=0   where BS06_BI is null   
set dateformat dmy update #t3 set BS06_ABI=0  where BS06_ABI is null  
set dateformat dmy update #t3 set BS06_SBI=0  where BS06_SBI is null  
set dateformat dmy update #t3 set BS06_ASBI=0 where BS06_ASBI is null 
set dateformat dmy update #t3 set KR01_BI=0   where KR01_BI is null   
set dateformat dmy update #t3 set KR01_ABI=0  where KR01_ABI is null  
set dateformat dmy update #t3 set KR01_SBI=0  where KR01_SBI is null  
set dateformat dmy update #t3 set KR01_ASBI=0 where KR01_ASBI is null 
set dateformat dmy update #t3 set KR02_BI=0   where KR02_BI is null   
set dateformat dmy update #t3 set KR02_ABI=0  where KR02_ABI is null  
set dateformat dmy update #t3 set KR02_SBI=0  where KR02_SBI is null  
set dateformat dmy update #t3 set KR02_ASBI=0 where KR02_ASBI is null 
set dateformat dmy update #t3 set KR03_BI=0   where KR03_BI is null   
set dateformat dmy update #t3 set KR03_ABI=0  where KR03_ABI is null  
set dateformat dmy update #t3 set KR03_SBI=0  where KR03_SBI is null  
set dateformat dmy update #t3 set KR03_ASBI=0 where KR03_ASBI is null 
set dateformat dmy update #t3 set KR04_BI=0   where KR04_BI is null   
set dateformat dmy update #t3 set KR04_ABI=0  where KR04_ABI is null  
set dateformat dmy update #t3 set KR04_SBI=0  where KR04_SBI is null  
set dateformat dmy update #t3 set KR04_ASBI=0 where KR04_ASBI is null 
set dateformat dmy update #t3 set KR05_BI=0   where KR05_BI is null   
set dateformat dmy update #t3 set KR05_ABI=0  where KR05_ABI is null  
set dateformat dmy update #t3 set KR05_SBI=0  where KR05_SBI is null  
set dateformat dmy update #t3 set KR05_ASBI=0 where KR05_ASBI is null 
set dateformat dmy update #t3 set KR06_BI=0   where KR06_BI is null   
set dateformat dmy update #t3 set KR06_ABI=0  where KR06_ABI is null  
set dateformat dmy update #t3 set KR06_SBI=0  where KR06_SBI is null  
set dateformat dmy update #t3 set KR06_ASBI=0 where KR06_ASBI is null 
set dateformat dmy update #t3 set KR07_BI=0   where KR07_BI is null   
set dateformat dmy update #t3 set KR07_ABI=0  where KR07_ABI is null  
set dateformat dmy update #t3 set KR07_SBI=0  where KR07_SBI is null  
set dateformat dmy update #t3 set KR07_ASBI=0 where KR07_ASBI is null 
update #t3 set ssBI=BI     where norek like '490%'
update #t3 set ssABI=ABI   where norek like '490%'
update #t3 set ssSBI=SBI   where norek like '490%'
update #t3 set ssASBI=ASBI where norek like '490%'


select 'Kebun/Unit : '+b.namakebun as nmKebun,'BUDIDAYA '+upper(c.nm_bud) as nmBud,a.*,d.NamaRekening as uraian1 
into #t4
from #t3 a
inner join ref_kebun b on a.kodeunit=b.kodekebun 
inner join ref_budidaya c on @kdbud=c.kd_bud and @kdunit=c.KodeUnit
inner join Ref_Rekening d on a.Norek=d.Norek and @kdunit=d.KodeUnit
where a.bi+a.abi+a.sbi+a.asbi<>0 order by Grup,urut 

update #t4 set Grup=''
update #t4 set nmGrup=''
update #t4 set Grup='01' where substring(norek,1,7)='6000001'
update #t4 set Grup='01' where substring(norek,1,3) in ('601','602','619')
update #t4 set Grup='01' where substring(norek,1,5)='60214'
update #t4 set Grup='01' where substring(norek,1,9)='490000100'
update #t4 set urut='1'  where substring(norek,1,7)='6000001' and Grup='01'
update #t4 set urut='2'  where substring(norek,1,3) in ('601','602','619') and Grup='01'
update #t4 set urut='3'  where substring(norek,1,9)='490000100' and Grup='01'
update #t4 set nmgrup='TANAMAN' where Grup='01'

update #t4 set Grup='02' where substring(norek,1,7)='6000002'
update #t4 set Grup='02' where substring(norek,1,3) in ('603','604','605')
update #t4 set urut='1'  where substring(norek,1,7)='6000002' and Grup='02'
update #t4 set urut='2'  where substring(norek,1,3) in ('603','604','605') and Grup='02'
update #t4 set nmgrup='PENGOLAHAN' where Grup='02'

update #t4 set Grup='03' where substring(norek,1,3)='608'
update #t4 set urut='1'  where Grup='03'
update #t4 set nmgrup='PEMBELIAN' where Grup='03'

update #t4 set Grup='04' where substring(norek,1,3) in ('609')
update #t4 set urut='1'  where substring(norek,1,3)='609' and Grup='04'
update #t4 set nmgrup='PENJUALAN' where Grup='04'

update #t4 set Grup='05' where substring(norek,1,3) in ('690')
update #t4 set urut='1'  where substring(norek,1,3)='690' and Grup='05'
update #t4 set nmgrup='PENGIRIMAN' where Grup='05'

update #t4 set Grup='06' where norek='490000200'
update #t4 set urut='1'  where Grup='06' 
update #t4 set nmgrup='PENYUSUTAN NON TANAMAN' where Grup='06'
update #t4 set uraian=uraian1

select * from #t4
order by kodeunit,Grup,urut,norek

--set dateformat dmy exec DSB_AKNcr713 '01-01-2018','02','12'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[DSB_AKNcr734]
@tanggal datetime,
@kdunit varchar(50)
as
set dateformat dmy
declare @AwalTahun datetime
declare @TglAwal datetime
declare @TglLalu datetime
declare @TglAkhir datetime

set @AwalTahun='01-01-'+cast(year(@tanggal) as varchar(4))
set @TglAwal='01-'+cast(month(@tanggal) as varchar(2))+'-'+cast(year(@tanggal) as varchar(4))
set @TglLalu= @TglAwal-1
set @TglAkhir=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))


select * into #AkunMemorial    from AkunMemorial   where KodeUnit=@kdunit and YEAR(tanggal)=YEAR(@tanggal)
select * into #kartu           from kartu          where KodeUnit=@kdunit and YEAR(tanggal)=YEAR(@tanggal)
select * into #AkunRKAP        from AkunRKAP       where KodeUnit=@kdunit and YEAR(tanggal)=YEAR(@tanggal)
select * into #AkunProduksiHP  from AkunProduksiHP where KodeUnit=@kdunit and YEAR(tanggal)=YEAR(@tanggal)
select * into #AkunSaldoLL     from AkunSaldoLL    where kodeunit=@kdunit and YEAR(tanggal)=YEAR(@tanggal)
select * into #Ref_LM          from Ref_LM         where kodeunit=@kdunit
select top 1 * into #Ref_Kebun from Ref_Kebun      where KodeKebun=@kdunit


select kodeunit,norek,debet-kredit as NilaiKebun,cast(0 as float) as NilaiKanpus
into #t1
from #kartu 
where norek like '08001%' and Tanggal>=@AwalTahun and Tanggal<=@TglLalu
union all
select kodeunit,norek,nilai as NilaiKebun,cast(0 as float) as NilaiKanpus
from #AkunMemorial
where norek like '08001%' and YEAR(tanggal)=YEAR(@tanggal) and noinput in ('SALDO AWAL') and dk='D'
union all
select kodeunit,norek,-1*nilai as NilaiKebun,cast(0 as float) as NilaiKanpus
from #AkunMemorial
where norek like '08001%' and YEAR(tanggal)=YEAR(@tanggal) and noinput IN ('SALDO AWAL') and dk='K'
union all
select kodeunit,norek,debet-kredit as NilaiKebun,cast(0 as float) as NilaiKanpus
from #kartu 
where norek like '08001%' and MONTH(Tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal)
union all

select kodeunit,norek,cast(0 as float) as NilaiKebun,rk as NilaiKanpus
from #AkunSaldoLL 
where norek like '080%' and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kdtrans='RK'

select kodeunit,sum(NilaiKebun) as NilaiKebun,sum(NilaiKanpus) as NilaiKanpus
into #t2 
from #t1
group by kodeunit

select kodeunit,norek,kdselisihRK,uraian,RK ,cast(0 as float) as Kebun,cast(0 as float) as Kanpus
into #t3
from #AkunSaldoLL 
where kdtrans='PRK' and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)

update #t3 set kebun=(select NilaiKebun from #t2),Kanpus=(select NilaiKanpus from #t2)

select 'Kebun/Unit : '+b.namakebun as nmKebun,dbo.proper(b.namakebun) as ketkbn,a.norek,dbo.proper(a.kdselisihRK) as kdselisihRK,a.uraian,a.rk as NilaiSelisih,a.Kebun as NilaiKebun,a.Kanpus as NilaiKanpus
from #t3 a
inner join #ref_kebun b on a.kodeunit=b.kodekebun

--set dateformat dmy exec DSB_AKNcr734 '01-07-2017','74'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[DSB_AKNcr735]
@tanggal datetime,
@kdUnit varchar(2)
--PENDAPATAN DILUAR KEGIATAN POKOK
as
set dateformat dmy
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime
declare @TglLalu datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @TglLalu=@TglAwal-1

select * into #Ref_Rekening from Ref_Rekening where KodeUnit=@kdUnit

--SALDO AWAL
select 'Kebun/Unit : '+C.namakebun as nmKebun,a.norek,b.namarekening as uraian,a.nilai as sawal,cast(0 as float) as debet,cast(0 as float) as kredit
into #t1
from AkunMemorial a
inner join #Ref_Rekening b on a.norek=b.norek
inner join ref_kebun c on a.kodeunit=c.kodekebun
where substring(a.norek,1,3) in ('970','975') and month(tanggal)=1 and year(tanggal)=year(@tanggal) and dk='D' and noinput in ('SALDO AWAL') and a.KodeUnit=@kdUnit
union all
select 'Kebun/Unit : '+c.namakebun as nmKebun,a.norek,b.namarekening as uraian,-1*a.nilai as sawal,cast(0 as float) as debet,cast(0 as float) as kredit
from AkunMemorial a
inner join #Ref_Rekening b on a.norek=b.norek
inner join ref_kebun c on a.kodeunit=c.kodekebun
where substring(a.norek,1,3) in ('970','975') and month(tanggal)=1 and year(tanggal)=year(@tanggal) and dk='K' and noinput in ('SALDO AWAL') and a.KodeUnit=@kdUnit
union all
select 'Kebun/Unit : '+c.namakebun as nmKebun,a.norek,b.namarekening as uraian,Debet-Kredit as sawal,cast(0 as float) as debet,cast(0 as float) as kredit
from Kartu a
inner join #Ref_Rekening b on a.norek=b.norek
inner join ref_kebun c on a.kodeunit=c.kodekebun
where substring(a.norek,1,3) in ('970','975') and Tanggal>=@AwalTahun and Tanggal<=@TglLalu and a.KodeUnit=@kdUnit
union all

--MUTASI BULAN INI
select 'Kebun/Unit : '+c.namakebun as nmKebun,a.norek,b.namarekening as uraian,0 as sawal,debet as debet,kredit as kredit
from kartu a
inner join #Ref_Rekening b on a.norek=b.norek
inner join ref_kebun c on a.kodeunit=c.kodekebun
where substring(a.norek,1,3) in ('970','975') and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and aplikasi not in ('EAP','ETL') and a.KodeUnit=@kdUnit
union all

--BUAT REKENING 970 DARI REFERENSI REKENING
select 'Kebun/Unit : '+c.namakebun as nmKebun,a.norek,a.namarekening as uraian,0 as sawal,0 as debet,0 as kredit
from #Ref_Rekening a
inner join ref_kebun c on a.kodeunit=c.kodekebun
where substring(a.norek,1,3) in ('970','975') and a.norek not like '%*%'

select nmKebun,substring(norek,1,3) as krbb,norek,uraian,sum(sawal) as sawal,sum(debet) as debet,sum(kredit) as kredit 
from #t1
where sawal+debet+kredit<>0
group by nmKebun,norek,uraian
order by norek

--set dateformat dmy exec DSB_AKNcr735 '01-07-2017','15'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[DSB_AKNcr736]
@tanggal datetime,
@kdUnit varchar(2)
--PENDAPATAN DILUAR KEGIATAN POKOK
as
set dateformat dmy
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime
declare @TglLalu datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @TglLalu=@TglAwal-1

select * into #Ref_Rekening from Ref_Rekening where KodeUnit=@kdUnit
select * into #AkunMemorial from AkunMemorial where KodeUnit=@kdUnit and YEAR(tanggal)=YEAR(@tanggal)
select * into #kartu        from kartu        where KodeUnit=@kdUnit and YEAR(Tanggal)=YEAR(@tanggal)

--SALDO AWAL
select 'Kebun/Unit : '+C.namakebun as nmKebun,a.norek,b.namarekening as uraian,a.nilai as sawal,cast(0 as float) as debet,cast(0 as float) as kredit
into #t1
from #AkunMemorial a
inner join #Ref_Rekening b on a.norek=b.norek
inner join ref_kebun c on a.kodeunit=c.kodekebun
where substring(a.norek,1,3) in ('927','928','929') and month(tanggal)=1 and year(tanggal)=year(@tanggal) and dk='D' and noinput in ('SALDO AWAL')
union all
select 'Kebun/Unit : '+c.namakebun as nmKebun,a.norek,b.namarekening as uraian,-1*a.nilai as sawal,cast(0 as float) as debet,cast(0 as float) as kredit
from #AkunMemorial a
inner join #Ref_Rekening b on a.norek=b.norek
inner join ref_kebun c on a.kodeunit=c.kodekebun
where substring(a.norek,1,3) in ('927','928','929') and month(tanggal)=1 and year(tanggal)=year(@tanggal) and dk='K' and noinput in ('SALDO AWAL')
union all
select 'Kebun/Unit : '+c.namakebun as nmKebun,a.norek,b.namarekening as uraian,Debet-Kredit as sawal,cast(0 as float) as debet,cast(0 as float) as kredit
from #kartu a
inner join #Ref_Rekening b on a.norek=b.norek
inner join ref_kebun c on a.kodeunit=c.kodekebun
where substring(a.norek,1,3) in ('927','928','929') and Tanggal>=@AwalTahun and Tanggal<=@TglLalu
union all

--MUTASI BULAN INI
select 'Kebun/Unit : '+c.namakebun as nmKebun,a.norek,b.namarekening as uraian,0 as sawal,debet as debet,kredit as kredit
from #kartu a
inner join #Ref_Rekening b on a.norek=b.norek
inner join ref_kebun c on a.kodeunit=c.kodekebun
where substring(a.norek,1,3) in ('927','928','929') and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) 
union all

--BUAT REKENING 970 DARI REFERENSI REKENING
select 'Kebun/Unit : '+c.namakebun as nmKebun,a.norek,a.namarekening as uraian,0 as sawal,0 as debet,0 as kredit
from #Ref_Rekening a
inner join ref_kebun c on a.kodeunit=c.kodekebun
where substring(a.norek,1,3) in ('927','928','929') and a.norek not like '%*%'

select nmKebun,substring(norek,1,3) as krbb,norek,uraian,sum(sawal) as sawal,sum(debet) as debet,sum(kredit) as kredit 
from #t1
where sawal+debet+kredit<>0
group by nmKebun,norek,uraian
order by norek

--set dateformat dmy exec DSB_AKNcr736 '01-07-2017','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[DSB_AKT307]
@tanggal datetime,
@kdunit varchar(2)
as
set dateformat dmy
declare @AwalTahun datetime
declare @AkhirBulan datetime
set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @AkhirBulan=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select distinct Norek,uraian into #tabel from Ref_TarifAktiva
union all
select distinct '04'+substring(Norek,3,1),uraian from Ref_TarifAktiva where Norek not in (000,001,002,010,011) 
union all
select distinct '049',uraian from Ref_TarifAktiva where Norek in (011) 

select distinct nobukti into #tb1 from AktivaMaster 
where tgltran>=@AwalTahun and tgltran<=@AkhirBulan and SUBSTRING(nobukti,1,3)='SST' and kodeunit=@kdunit 

--SALDO AWAL
select 'AKTIVA TETAP' as Kelompok,kodeunit,'1' as grup,SUBSTRING(norek,1,3) as krbb,nmaktiva,SPACE(2) as blnsst,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
INTO #T1
from AktivaMaster
where YEAR(tgltran)=YEAR(@tanggal) and nobukti='SALDO AWAL' AND SUBSTRING(norek,1,3) not in (043,044,045,046,047,048,049) and kodeunit=@kdunit
union all
select 'INVESTASI TAHUN BERJALAN' as Kelompok,kodeunit,'2' as grup,SUBSTRING(norek,1,3) as krbb,nmaktiva,SPACE(2) as blnsst,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster
where YEAR(tgltran)=YEAR(@tanggal) and nobukti='SALDO AWAL' AND SUBSTRING(norek,1,3) in (043,044,045,046,047,048,049) and kodeunit=@kdunit
union all


--TRANSAKSI AKTIVA TAHUN BERJALAN
select 'AKTIVA TETAP' as Kelompok,kodeunit,'1' as grup,substring(norek,1,3) as krbb,nmaktiva,SPACE(2) as blnsst,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster 
where nobukti<>'SALDO AWAL' AND SUBSTRING(norek,1,3) not in (043,044,045,046,047,048,049) and tgltran>=@AwalTahun and tgltran<=@AkhirBulan and kodeunit=@kdunit
union all

--TRANSAKSI INVESTASI TAHUN BERJALAN
select 'INVESTASI TAHUN BERJALAN' as Kelompok,kodeunit,'2' as grup,substring(norek,1,3) as krbb,nmaktiva,SPACE(2) as blnsst,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster 
where nobukti<>'SALDO AWAL' and SUBSTRING(norek,1,3) in (043,044,045,046,047,048,049) and tgltran>=@AwalTahun and tgltran<=@AkhirBulan and kodeunit=@kdunit

update #T1 set blnsst=(select COUNT(*) from #tb1)

--REKAPITULASI
select a.kelompok,'KEBUN/UNIT : '+b.NamaKebun as kebun,
'Per : '+cast(substring(convert(varchar(50),@AwalTahun,105),1,10) as varchar(50))as awaltahun,'Per : '+cast(substring(convert(varchar(50),@akhirbulan,105),1,10) as varchar(50))as akhirbulan,
a.grup,a.krbb,d.Uraian as nmaktiva,a.blnsst,
SUM(a.sawalp) as sawalp,SUM(a.auditp) as auditp,SUM(a.rcp) as rcp,SUM(a.hapusp) as hapusp,SUM(a.rekp) as rekp,SUM(a.kbnp) as kbnp,SUM(a.murnip) as murnip,
SUM(a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip) as jmlmutasip,
SUM(a.sawalp+a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip) as jmlperolehan,
SUM(a.sawals) as sawals,SUM(a.audits) as audits,SUM(a.rcs) as rcs,SUM(a.hapuss) as hapuss,SUM(a.reks) as reks,SUM(a.kbns) as kbns,SUM(a.murnis) as murnis,
SUM(a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as jmlmutasis,
SUM(a.sawals+a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as jmlpenyusutan,
SUM(a.sawalp+a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip)-SUM(a.sawals+a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as NilaiBuku
from #T1 a
inner join Ref_Kebun b on a.kodeunit=b.KodeKebun
inner join #tabel d on a.krbb=d.Norek 
group by b.NamaKebun,a.Kelompok,a.grup,a.krbb,d.Uraian,a.blnsst
order by grup,krbb

--set dateformat dmy exec DSB_AKT307 '31-07-2017','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[DSB_AKT307A]
@tanggal datetime,
@kdunit varchar(2),
@kdbud varchar(50)
as
set dateformat dmy
declare @AwalTahun datetime
declare @AkhirBulan datetime
declare @nmBud varchar(50)
set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @AkhirBulan=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @nmBud=(select top 1 'BUDIDAYA '+upper(nm_bud) as nmBud from Ref_Budidaya where KodeUnit=@kdunit and kd_bud=@kdbud)

select distinct Norek,uraian into #tabel from Ref_TarifAktiva where kdbud=@kdbud
union all
select distinct '04'+substring(Norek,3,1),uraian from Ref_TarifAktiva where Norek not in (000,001,002,010,011) and kdbud=@kdbud 
union all
select distinct '049',uraian from Ref_TarifAktiva where Norek in (011) and kdbud=@kdbud 

select distinct nobukti into #tb1 from AktivaMaster 
where tgltran>=@AwalTahun and tgltran<=@AkhirBulan and SUBSTRING(nobukti,1,3)='SST' and kodeunit=@kdunit and kdbud=@kdbud 

--SALDO AWAL
select 'AKTIVA TETAP' as Kelompok,kodeunit,'1' as grup,SUBSTRING(norek,1,3) as krbb,nmaktiva,SPACE(2) as blnsst,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
INTO #T1
from AktivaMaster
where YEAR(tgltran)=YEAR(@tanggal) and nobukti='SALDO AWAL' AND SUBSTRING(norek,1,3) not in (043,044,045,046,047,048,049) and kodeunit=@kdunit and kdbud=@kdbud 
union all
select 'INVESTASI TAHUN BERJALAN' as Kelompok,kodeunit,'2' as grup,SUBSTRING(norek,1,3) as krbb,nmaktiva,SPACE(2) as blnsst,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster
where YEAR(tgltran)=YEAR(@tanggal) and nobukti='SALDO AWAL' AND SUBSTRING(norek,1,3) in (043,044,045,046,047,048,049) and kodeunit=@kdunit and kdbud=@kdbud 
union all


--TRANSAKSI AKTIVA TAHUN BERJALAN
select 'AKTIVA TETAP' as Kelompok,kodeunit,'1' as grup,substring(norek,1,3) as krbb,nmaktiva,SPACE(2) as blnsst,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster 
where nobukti<>'SALDO AWAL' AND SUBSTRING(norek,1,3) not in (043,044,045,046,047,048,049) and tgltran>=@AwalTahun and tgltran<=@AkhirBulan and kodeunit=@kdunit and kdbud=@kdbud 
union all

--TRANSAKSI INVESTASI TAHUN BERJALAN
select 'INVESTASI TAHUN BERJALAN' as Kelompok,kodeunit,'2' as grup,substring(norek,1,3) as krbb,nmaktiva,SPACE(2) as blnsst,
sawalp,auditp,rcp,hapusp,rekp,kbnp,murnip,
sawals,audits,rcs,hapuss,reks,kbns,murnis
from AktivaMaster 
where nobukti<>'SALDO AWAL' and SUBSTRING(norek,1,3) in (043,044,045,046,047,048,049) and tgltran>=@AwalTahun and tgltran<=@AkhirBulan and kodeunit=@kdunit and kdbud=@kdbud 

update #T1 set blnsst=(select COUNT(*) from #tb1)

--REKAPITULASI
select a.kelompok,'KEBUN/UNIT : '+b.NamaKebun as kebun,@nmBud as Budidaya,
'Per : '+cast(substring(convert(varchar(50),@AwalTahun,105),1,10) as varchar(50))as awaltahun,'Per : '+cast(substring(convert(varchar(50),@akhirbulan,105),1,10) as varchar(50))as akhirbulan,
a.grup,a.krbb,d.Uraian as nmaktiva,a.blnsst,
SUM(a.sawalp) as sawalp,SUM(a.auditp) as auditp,SUM(a.rcp) as rcp,SUM(a.hapusp) as hapusp,SUM(a.rekp) as rekp,SUM(a.kbnp) as kbnp,SUM(a.murnip) as murnip,
SUM(a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip) as jmlmutasip,
SUM(a.sawalp+a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip) as jmlperolehan,
SUM(a.sawals) as sawals,SUM(a.audits) as audits,SUM(a.rcs) as rcs,SUM(a.hapuss) as hapuss,SUM(a.reks) as reks,SUM(a.kbns) as kbns,SUM(a.murnis) as murnis,
SUM(a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as jmlmutasis,
SUM(a.sawals+a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as jmlpenyusutan,
SUM(a.sawalp+a.auditp+a.rcp+a.hapusp+a.rekp+a.kbnp+a.murnip)-SUM(a.sawals+a.audits+a.rcs+a.hapuss+a.reks+a.kbns+a.murnis) as NilaiBuku
from #T1 a
inner join Ref_Kebun b on a.kodeunit=b.KodeKebun
inner join #tabel d on a.krbb=d.Norek 
group by b.NamaKebun,a.Kelompok,a.grup,a.krbb,d.Uraian,a.blnsst
order by grup,krbb

--set dateformat dmy exec DSB_AKT307A '31-07-2017','11','36'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[DSB_EAPcr403]
@kdkbn varchar(50),
@tanggal datetime,
@krbb varchar(3)
as
declare @AwalTahun datetime
declare @TglAkhir datetime
set @TglAkhir=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @AwalTahun='01-01-'+cast(year(@tanggal) as varchar(4))

select distinct pemilik,'MILIK KEBUN/UNIT' as nmpemilik into #Pemilik from Ref_Netral where pemilik='01' and status=1 and KodeUnit=@kdkbn
union all
select distinct pemilik,'MILIK PUSKOP/KOPRIM' as nmpemilik from Ref_Netral where pemilik='02' and status=1 and KodeUnit=@kdkbn

select * into #Ref_Netral from Ref_Netral where status=1 and KodeUnit=@kdkbn

--ANGGARAN EAP
select norek,nomor,sum(jmlfisik) as jmlfisikBI,sum(nilai) as nilaiBI,sum(jmlfisik) as jmlfisikSBI,sum(nilai) as nilaiSBI
into #xEAP 
from eap where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kdtrans='EAPABI' and substring(norek,1,3)=@krbb and kodeunit=@kdkbn group by norek,nomor
union all
select norek,nomor,0 as jmlfisikBI,0 as nilaiBI,sum(jmlfisik) as jmlfisikSBI,sum(nilai) as nilaiSBI
from eap where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kdtrans='EAPASBL' and substring(norek,1,3)=@krbb and kodeunit=@kdkbn group by norek,nomor

select norek,nomor,sum(jmlfisikBI) as jmlfisikBI,sum(jmlfisikSBI) as jmlfisikSBI,sum(nilaiBI) as nilaiBI,sum(nilaiSBI) as nilaiSBI 
into #EAP
from #xEAP group by norek,nomor
-------------------END OF ANGGARAN EAP

select 'NOMOR' as Kode,kodeunit,norek,pemilik,nomor,uraian,tahun,
cast(0 as float) as jmlKmBI,cast(0 as float) as qtySolarBI,cast(0 as float) as qtyPremiumBI,cast(0 as float) as BBMRpBI,cast(0 as float) as GajiRpBI,cast(0 as float) as UangSakuRpBI,cast(0 as float) as qtyPelumasBI,cast(0 as float) as PelumasRpBI,cast(0 as float) as BanRpBI,cast(0 as float) as OnderdilRpBI,cast(0 as float) as ReparasiRpBI,cast(0 as float) as SewaRpBI,cast(0 as float) as Lain2RpBI,
cast(0 as float) as jmlKmSBI,cast(0 as float) as qtySolarSBI,cast(0 as float) as qtyPremiumSBI,cast(0 as float) as BBMRpSBI,cast(0 as float) as GajiRpSBI,cast(0 as float) as UangSakuRpSBI,cast(0 as float) as qtyPelumasSBI,cast(0 as float) as PelumasRpSBI,cast(0 as float) as BanRpSBI,cast(0 as float) as OnderdilRpSBI,cast(0 as float) as ReparasiRpSBI,cast(0 as float) as SewaRpSBI,cast(0 as float) as Lain2RpSBI,
cast(0 as float) as jmlKmABI,cast(0 as float) as qtySolarABI,cast(0 as float) as qtyPremiumABI,cast(0 as float) as BBMRpABI,cast(0 as float) as GajiRpABI,cast(0 as float) as UangSakuRpABI,cast(0 as float) as qtyPelumasABI,cast(0 as float) as PelumasRpABI,cast(0 as float) as BanRpABI,cast(0 as float) as OnderdilRpABI,cast(0 as float) as ReparasiRpABI,cast(0 as float) as SewaRpABI,cast(0 as float) as Lain2RpABI,
cast(0 as float) as jmlKmASBI,cast(0 as float) as qtySolarASBI,cast(0 as float) as qtyPremiumASBI,cast(0 as float) as BBMRpASBI,cast(0 as float) as GajiRpASBI,cast(0 as float) as UangSakuRpASBI,cast(0 as float) as qtyPelumasASBI,cast(0 as float) as PelumasRpASBI,cast(0 as float) as BanRpASBI,cast(0 as float) as OnderdilRpASBI,cast(0 as float) as ReparasiRpASBI,cast(0 as float) as SewaRpASBI,cast(0 as float) as Lain2RpASBI
INTO #t1
from #Ref_Netral
where status=1 and norek=@krbb and KodeUnit=@kdkbn
union all

--REALISASI KILOMETER BULAN INI
select 'KM' as Kode,a.kodeunit,b.norek,b.pemilik,a.nomor,b.uraian,b.tahun, 
sum(jmlkm) as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
sum(jmlkm) as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek and 1=b.status
where b.norek=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and  a.noinput like 'EAP%' and a.kodeunit=@kdkbn
group by a.kodeunit,b.norek,b.pemilik,a.nomor,b.uraian,b.tahun
union all

--FAUZY
--REALISASI KILOMETER SAMPAI DENGAN BULAN INI
select distinct 'KM' as Kode,a.kodeunit,b.norek,b.pemilik,a.nomor,b.uraian,b.tahun, 
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
jmlkm as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek and a.kodeunit=b.KodeUnit
where b.norek=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and kdtrans='EAPSBL' and a.jmlkm>0 and a.kodeunit=@kdkbn
union all


--REALISASI PEMAKAIAN FISIK DAN BIAYA PREMIUM BULAN INI
select 'PREMIUM' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.netral as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,sum(jml_fisik) as qtyPremiumBI,sum(debet-kredit) as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,sum(jml_fisik) as qtyPremiumSBI,sum(debet-kredit) as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu a
inner join #Ref_Netral b on a.netral=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.netral<>'' and  b.bbm='01' and a.norek=@krbb+'030000' and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.netral,b.uraian,b.tahun
union all

--REALISASI PEMAKAIAN FISIK DAN BIAYA SOLAR BULAN INI
select 'SOLAR' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.netral as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,sum(jml_fisik) as qtySolarBI,0 as qtyPremiumBI,sum(debet-kredit) as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,sum(jml_fisik) as qtySolarSBI,0 as qtyPremiumSBI,sum(debet-kredit) as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu a
inner join #Ref_Netral b on a.netral=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.netral<>'' and  b.bbm='02' and a.norek=@krbb+'030000' and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.netral,b.uraian,b.tahun
union all

--REALISASI PEMAKAIAN FISIK DAN BIAYA PELUMAS BULAN INI
select 'PELUMAS' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.netral as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,sum(jml_fisik) as qtyPelumasBI,sum(debet-kredit) as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,sum(jml_fisik) as qtyPelumasSBI,sum(debet-kredit) as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu a
inner join #Ref_Netral b on a.netral=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.netral<>'' and  a.norek=@krbb+'040000' and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.netral,b.uraian,b.tahun
union all

--REALISASI GAJI/UPAH BULAN INI
select 'GAJI/UPAH' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.netral as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,sum(debet-kredit) as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,sum(debet-kredit) as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu a
inner join #Ref_Netral b on a.netral=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.netral<>'' and  substring(a.norek,1,5) in (@krbb+'00',@krbb+'01',@krbb+'19') and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.netral,b.uraian,b.tahun
union all

--REALISASI UANG MAKAN/SAKU/PENGINAPAN BULAN INI
select 'UANG MAKAN' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.netral as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,sum(debet-kredit) as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,sum(debet-kredit) as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu a
inner join #Ref_Netral b on a.netral=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.netral<>'' and  a.norek in (@krbb+'020000') and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.netral,b.uraian,b.tahun
union all

--REALISASI BIAYA BAN BULAN INI
select 'BAN' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.netral as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,sum(debet-kredit) as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,sum(debet-kredit) as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu a
inner join #Ref_Netral b on a.netral=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.netral<>'' and  a.norek in (@krbb+'050000') and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.netral,b.uraian,b.tahun
union all

--REALISASI BIAYA ONDERDIL BULAN INI
select 'ONDERDIL' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.netral as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,sum(debet-kredit) as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,sum(debet-kredit) as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu a
inner join #Ref_Netral b on a.netral=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.netral<>'' and  a.norek in (@krbb+'060000') and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.netral,b.uraian,b.tahun
union all

--REALISASI BIAYA REPARASI BULAN INI
select 'REPARASI' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.netral as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,sum(debet-kredit) as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,sum(debet-kredit) as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu a
inner join #Ref_Netral b on a.netral=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.netral<>'' and  a.norek in (@krbb+'070000') and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.netral,b.uraian,b.tahun
union all

--REALISASI BIAYA SEWA BULAN INI
select 'SEWA' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.netral as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,sum(debet-kredit) as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,sum(debet-kredit) as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu a
inner join #Ref_Netral b on a.netral=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.netral<>'' and  a.norek in (@krbb+'100000') and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.netral,b.uraian,b.tahun
union all

--REALISASI BIAYA LAIN2 BULAN INI
select 'LAIN2' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.netral as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,sum(debet-kredit) as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,sum(debet-kredit) as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu a
inner join #Ref_Netral b on a.netral=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.netral<>'' and  a.norek in (@krbb+'080000',@krbb+'090000') and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.netral,b.uraian,b.tahun
union all
---------------------------------------END OF REALISASI BULAN INI

--yudha
--REALISASI S/D BULAN LALU
--REALISASI SOLAR S/D BULAN LALU
select 'GAJI/UPAH' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,sum(jmlfisik) as qtyPremiumSBI,sum(nilai) as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where b.bbm='01' and substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'030000') and a.kdtrans='EAPSBL' and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all
----REALISASI PREMIUM S/D BULAN LALU
select 'GAJI/UPAH' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,sum(jmlfisik) as qtySolarSBI,0 as qtyPremiumSBI,sum(nilai) as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where b.bbm='02' and substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'030000') and a.kdtrans='EAPSBL' and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all
--REALISASI PELUMAS S/D BULAN LALU
select 'GAJI/UPAH' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,sum(jmlfisik) as qtyPelumasSBI,sum(nilai) as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'040000') and a.kdtrans='EAPSBL' and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all
--REALISASI GAJI/UPAH S/D BULAN LALU
select 'GAJI/UPAH' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,sum(nilai) as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and substring(a.norek,1,5) in (@krbb+'00',@krbb+'01',@krbb+'19') and a.kdtrans='EAPSBL' and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all
--REALISASI UANG MAKAN/SAKU/PENGINAPAN S/D BULAN LALU
select 'GAJI/UPAH' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,sum(nilai) as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'020000') and a.kdtrans='EAPSBL' and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all
--REALISASI BAN S/D BULAN LALU
select 'GAJI/UPAH' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,sum(nilai) as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'050000') and a.kdtrans='EAPSBL' and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all
--REALISASI ONDERDIL S/D BULAN LALU
select 'GAJI/UPAH' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,sum(nilai) as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'060000') and a.kdtrans='EAPSBL' and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all
--REALISASI REPARASI S/D BULAN LALU
select 'GAJI/UPAH' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,sum(nilai) as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'070000') and a.kdtrans='EAPSBL' and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all
--REALISASI SEWA S/D BULAN LALU
select 'GAJI/UPAH' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,sum(nilai) as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'100000') and a.kdtrans='EAPSBL' and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all
--REALISASI LAIN2 S/D BULAN LALU
select 'GAJI/UPAH' as Kode,a.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,sum(nilai) as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'080000',@krbb+'090000') and a.kdtrans='EAPSBL' and a.kodeunit=@kdkbn
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all
---------------------------------------END OF REALISASI S/D BULAN LALU

--ANGGARAN KILOMETER BULAN INI
select distinct 'AKM' as Kode,a.kodeunit,b.norek,b.pemilik,a.nomor,b.uraian,b.tahun, 
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
jmlkm as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
jmlkm as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek and a.kodeunit=b.KodeUnit
where b.norek=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and  kdtrans='EAPABI' and a.kodeunit=@kdkbn
union all

--ANGGARAN KILOMETER S/D BULAN LALU
select distinct 'ASKM' as Kode,a.kodeunit,b.norek,b.pemilik,a.nomor,b.uraian,b.tahun, 
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
jmlkm as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek and a.kodeunit=b.KodeUnit
where b.norek=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and  kdtrans='EAPASBL' and a.kodeunit=@kdkbn
union all

--ANGGARAN FISIK DAN BIAYA PREMIUM BULAN LALU DAN S/D BULAN INI XKOREKSI
select 'PREMIUM' as Kode,b.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,sum(a.jmlfisikBI) as qtyPremiumABI,sum(a.nilaiBI) as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,sum(a.jmlfisikSBI) as qtyPremiumASBI,sum(a.nilaiSBI) as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and  b.bbm='01' and a.norek=@krbb+'030000'
group by b.kodeunit,a.norek,b.pemilik,a.nomor,b.uraian,b.tahun
union all

--ANGGARAN FISIK DAN BIAYA SOLAR BULAN LALU DAN S/D BULAN INI
select 'SOLAR' as Kode,b.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,sum(jmlfisikBI) as qtySolarABI,0 as qtyPremiumABI,sum(nilaiBI) as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,sum(jmlfisikSBI) as qtySolarASBI,0 as qtyPremiumASBI,sum(nilaiSBI) as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and  b.bbm='02' and a.norek=@krbb+'030000'
group by b.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all

--ANGGARAN FISIK DAN BIAYA PELUMAS BULAN LALU DAN S/D BULAN INI
select 'SOLAR' as Kode,b.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,sum(jmlfisikBI) as qtyPelumasABI,sum(nilaiBI) as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,sum(jmlfisikSBI) as qtyPelumasASBI,sum(nilaiSBI) as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and  a.norek=@krbb+'040000'
group by b.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all

--ANGGARAN GAJI/UPAH BULAN LALU DAN S/D BULAN INI
select 'SOLAR' as Kode,b.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,sum(nilaiBI) as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,sum(nilaiSBI) as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and  substring(a.norek,1,5) in (@krbb+'00',@krbb+'01',@krbb+'19')
group by b.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all

--ANGGARAN UANG MAKAN BULAN LALU DAN S/D BULAN INI
select 'SOLAR' as Kode,b.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,sum(nilaiBI) as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,sum(nilaiSBI) as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and  a.norek in (@krbb+'020000')
group by b.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all

--ANGGARAN BAN BULAN LALU DAN S/D BULAN INI
select 'SOLAR' as Kode,b.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,sum(nilaiBI) as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,sum(nilaiSBI) as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and  a.norek in (@krbb+'050000')
group by b.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all

--ANGGARAN ONDERDIL BULAN LALU DAN S/D BULAN INI
select 'SOLAR' as Kode,b.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,sum(nilaiBI) as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,sum(nilaiSBI) as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and  a.norek in (@krbb+'060000')
group by b.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all

--ANGGARAN REPARASI BULAN LALU DAN S/D BULAN INI
select 'SOLAR' as Kode,b.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,sum(nilaiBI) as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,sum(nilaiSBI) as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and  a.norek in (@krbb+'070000')
group by b.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all

--ANGGARAN SEWA BULAN LALU DAN S/D BULAN INI
select 'SOLAR' as Kode,b.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,sum(nilaiBI) as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,sum(nilaiSBI) as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and  a.norek in (@krbb+'100000')
group by b.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all

--ANGGARAN LAIN2 BULAN LALU DAN S/D BULAN INI
select 'SOLAR' as Kode,b.kodeunit,substring(a.norek,1,3) as norek,b.pemilik as pemilik,a.nomor as nomor,b.uraian as uraian,b.tahun as tahun,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,sum(nilaiBI) as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,sum(nilaiSBI) as Lain2RpASBI
from #EAP a
inner join #Ref_Netral b on a.nomor=b.nomor and @krbb=b.norek
where substring(a.norek,1,3)=@krbb and  a.norek in (@krbb+'080000',@krbb+'090000') 
group by b.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun

select 'Kebun/Unit : '+b.namakebun as namakebun,a.norek,a.pemilik,c.nmpemilik,a.nomor,a.uraian,a.tahun,
sum(a.jmlKmBI) as jmlKmBI,sum(a.qtySolarBI) as qtySolarBI,sum(a.qtyPremiumBI) as qtyPremiumBI,sum(a.BBMRpBI) as BBMRpBI,sum(a.GajiRpBI) as GajiRpBI,sum(a.UangSakuRpBI) as UangSakuRpBI,sum(a.qtyPelumasBI) as qtyPelumasBI,sum(a.PelumasRpBI) as PelumasRpBI,sum(a.BanRpBI) as BanRpBI,sum(a.OnderdilRpBI) as OnderdilRpBI,sum(a.ReparasiRpBI) as ReparasiRpBI,sum(a.SewaRpBI) as SewaRpBI,sum(a.Lain2RpBI) as Lain2RpBI,sum(a.BBMRpBI+a.GajiRpBI+a.UangSakuRpBI+a.PelumasRpBI+a.BanRpBI+a.OnderdilRpBI+a.ReparasiRpBI+a.SewaRpBI+a.Lain2RpBI) as JumlahRPBI,
sum(a.jmlKmSBI) as jmlKmSBI,sum(a.qtySolarSBI) as qtySolarSBI,sum(a.qtyPremiumSBI) as qtyPremiumSBI,sum(a.BBMRpSBI) as BBMRpSBI,sum(a.GajiRpSBI) as GajiRpSBI,sum(a.UangSakuRpSBI) as UangSakuRpSBI,sum(a.qtyPelumasSBI) as qtyPelumasSBI,sum(a.PelumasRpSBI) as PelumasRpSBI,sum(a.BanRpSBI) as BanRpSBI,sum(a.OnderdilRpSBI) as OnderdilRpSBI,sum(a.ReparasiRpSBI) as ReparasiRpSBI,sum(a.SewaRpSBI) as SewaRpSBI,sum(a.Lain2RpSBI) as Lain2RpSBI,sum(a.BBMRpSBI+a.GajiRpSBI+a.UangSakuRpSBI+a.PelumasRpSBI+a.BanRpSBI+a.OnderdilRpSBI+a.ReparasiRpSBI+a.SewaRpSBI+a.Lain2RpSBI) as JumlahRPSBI,
sum(a.jmlKmABI) as jmlKmABI,sum(a.qtySolarABI) as qtySolarABI,sum(a.qtyPremiumABI) as qtyPremiumABI,sum(a.BBMRpABI) as BBMRpABI,sum(a.GajiRpABI) as GajiRpABI,sum(a.UangSakuRpABI) as UangSakuRpABI,sum(a.qtyPelumasABI) as qtyPelumasABI,sum(a.PelumasRpABI) as PelumasRpABI,sum(a.BanRpABI) as BanRpABI,sum(a.OnderdilRpABI) as OnderdilRpABI,sum(a.ReparasiRpABI) as ReparasiRpABI,sum(a.SewaRpABI) as SewaRpABI,sum(a.Lain2RpABI) as Lain2RpABI,sum(a.BBMRpABI+a.GajiRpABI+a.UangSakuRpABI+a.PelumasRpABI+a.BanRpABI+a.OnderdilRpABI+a.ReparasiRpABI+a.SewaRpABI+a.Lain2RpABI) as JumlahRPABI,
sum(a.jmlKmASBI) as jmlKmASBI,sum(a.qtySolarASBI) as qtySolarASBI,sum(a.qtyPremiumASBI) as qtyPremiumASBI,sum(a.BBMRpASBI) as BBMRpASBI,sum(a.GajiRpASBI) as GajiRpASBI,sum(a.UangSakuRpASBI) as UangSakuRpASBI,sum(a.qtyPelumasASBI) as qtyPelumasASBI,sum(a.PelumasRpASBI) as PelumasRpASBI,sum(a.BanRpASBI) as BanRpASBI,sum(a.OnderdilRpASBI) as OnderdilRpASBI,sum(a.ReparasiRpASBI) as ReparasiRpASBI,sum(a.SewaRpASBI) as SewaRpASBI,sum(a.Lain2RpASBI) as Lain2RpASBI,sum(a.BBMRpASBI+a.GajiRpASBI+a.UangSakuRpASBI+a.PelumasRpASBI+a.BanRpASBI+a.OnderdilRpASBI+a.ReparasiRpASBI+a.SewaRpASBI+a.Lain2RpASBI) as JumlahRPASBI
from #t1 a
inner join ref_kebun b on a.kodeunit=b.kodekebun
inner join #pemilik c on a.pemilik=c.pemilik
group by b.namakebun,a.norek,a.pemilik,c.nmpemilik,a.nomor,a.uraian,a.tahun
order by pemilik,uraian,tahun desc

--set dateformat dmy exec DSB_EAPcr403 '10','01-04-2018','201'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[DSB_Graph_ProduksiBasah]
@tanggal datetime,
@kdbud varchar(2)
as
set dateformat dmy

select * into #Ref_Budidaya from Ref_Budidaya where kd_bud=@kdbud

update #Ref_Budidaya set nm_bud='KELAPA SAWIT' WHERE kd_bud='01'
update #Ref_Budidaya set nm_bud='KARET' WHERE kd_bud='00'
update #Ref_Budidaya set nm_bud='TEH' WHERE kd_bud='02'
update #Ref_Budidaya set nm_bud='KINA' WHERE kd_bud='03'

select 'GRAPHIC PRODUKSI BASAH PER KEBUN BUDIDAYA '+d.nm_bud as budidaya, 'BULAN '+upper(c.namabulan)+' '+cast(YEAR(a.tanggal) as varchar(50)) as Bulan,a.kodekbn,b.NamaKebun,SUM(a.bi) as kg 
into #t1
from AkunProduksiHP a 
inner join Ref_Kebun b on a.kodekbn=b.KodeKebun
inner join Ref_Bulan c on MONTH(a.tanggal)=c.bulan
inner join #Ref_Budidaya d on substring(a.kodebud,1,2)=substring(d.kd_bud,1,2) and a.kodekbn=d.KodeUnit
where a.kodebud=@kdbud and a.kodevar='BASAH' and MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and a.norek='X'
group by c.namabulan,a.kodekbn,b.NamaKebun,YEAR(a.tanggal),d.nm_bud

update #t1 set kg=0 where kg<0

select * from #t1 order by kodekbn

--set dateformat dmy exec DSB_Graph_ProduksiBasah '01-09-2017','01'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[DSB_TUPcr107]
@Tanggal datetime,
@kdunit varchar(2)
as
set dateformat dmy
declare @TglAwal datetime 
declare @TglAkhir datetime 
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select kodeunit,kodebarang,
sum(qty) as sawQty,sum(nilai) as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
into #t1
from tup
where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and noinput='SALDO AWAL' and KodeUnit=@kdunit
group by kodeunit,kodebarang
union all

--MUTASI BULAN INI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal<'01-09-2014' and KodeUnit=@kdunit
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal>='01-11-2014' and KodeUnit=@kdunit
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal<'01-09-2014' and KodeUnit=@kdunit
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal>='01-11-2014' and KodeUnit=@kdunit
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and nilai>0) and tanggal>='01-09-2014' and tanggal<'01-11-2014' and KodeUnit=@kdunit
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=0 and nilai>0 and KodeUnit=@kdunit
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,sum(qty) as klrQty,sum(nilai) as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and KodeUnit=@kdunit
group by kodeunit,kodebarang
union all
 
--KOREKSI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,sum(qty) as korQty,sum(nilai) as korNilai,0 as sakQty,0 as sakNilai
from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR' and KodeUnit=@kdunit
group by kodeunit,kodebarang

select upper('Kebun/Unit :'+d.namakebun) as namakebun,b.norek,c.namarekening,a.kodebarang,b.namabarang,
sum(a.sawQty) as sawQty,sum(a.sawNilai) as sawNilai,sum(a.trmQty) as trmQty,sum(a.trmNilai) as trmNilai,
sum(a.klrQty) as klrQty,sum(a.klrNilai) as klrNilai,sum(a.korQty) as korQty,sum(a.korNilai) as korNilai,
sum(a.sawQty+a.trmQty-a.klrQty+a.korQty) as sakQty,sum(a.sawNilai+a.trmNilai-a.klrNilai+a.korNilai) as sakNilai
into #t2
from #t1 a
inner join SPDK_KBN_MASTER_REF..ref_barang b on a.kodebarang=b.kodebarang
inner join ref_rekening c on b.norek=c.norek and a.KodeUnit=c.KodeUnit
inner join ref_kebun d on a.kodeunit=d.kodekebun
group by d.namakebun,b.norek,c.namarekening,a.kodebarang,b.namabarang

select * from #t2 where sawQty<>0 or sawNilai<>0 or trmQty<>0 or trmNilai<>0 or klrQty<>0 or klrNilai<>0 or korQty<>0 or korNilai<>0

--set dateformat dmy exec DSB_TUPcr107 '01-07-2017','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[DSB_TUPcr107Corporation]
@Tanggal datetime
as
set dateformat dmy
declare @TglAwal datetime 
declare @TglAkhir datetime 
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select distinct Norek,NamaRekening into #Rekening from Ref_Rekening

select kodebarang,
sum(qty) as sawQty,sum(nilai) as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
into #t1
from tup
where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and noinput='SALDO AWAL' 
group by kodebarang
union all

--MUTASI BULAN INI
select kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal<'01-09-2014' 
group by kodebarang
union all
select kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal>='01-11-2014' 
group by kodebarang
union all

select kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal<'01-09-2014' 
group by kodebarang
union all
select kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal>='01-11-2014' 
group by kodebarang
union all

select kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and nilai>0) and tanggal>='01-09-2014' and tanggal<'01-11-2014' 
group by kodebarang
union all
select kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=0 and nilai>0 
group by kodebarang
union all
select kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,sum(qty) as klrQty,sum(nilai) as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' 
group by kodebarang
union all
 
--KOREKSI
select kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,sum(qty) as korQty,sum(nilai) as korNilai,0 as sakQty,0 as sakNilai
from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR' 
group by kodebarang

select b.norek,c.namarekening,a.kodebarang,b.namabarang,
sum(a.sawQty) as sawQty,sum(a.sawNilai) as sawNilai,sum(a.trmQty) as trmQty,sum(a.trmNilai) as trmNilai,
sum(a.klrQty) as klrQty,sum(a.klrNilai) as klrNilai,sum(a.korQty) as korQty,sum(a.korNilai) as korNilai,
sum(a.sawQty+a.trmQty-a.klrQty+a.korQty) as sakQty,sum(a.sawNilai+a.trmNilai-a.klrNilai+a.korNilai) as sakNilai
into #t2
from #t1 a
inner join SPDK_KBN_MASTER_REF..ref_barang b on a.kodebarang=b.kodebarang
inner join #Rekening c on b.norek=c.norek
group by b.norek,c.namarekening,a.kodebarang,b.namabarang

select * from #t2 where sawQty<>0 or sawNilai<>0 or trmQty<>0 or trmNilai<>0 or klrQty<>0 or klrNilai<>0 or korQty<>0 or korNilai<>0
order by NamaBarang

--set dateformat dmy exec DSB_TUPcr107Corporation '01-12-2019'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[DSB_TUPcr108] 
@Tanggal datetime,
@kdunit varchar(2)
as 
set dateformat dmy
declare @TglAwal datetime
declare @TglAkhir datetime 
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select * into #TUP from TUP where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and KodeUnit=@kdunit
 
--SALDO AWAL
select kodeunit,kodebarang,sum(nilai) as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
into #t1 
from #TUP 
where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and noinput='SALDO AWAL'
group by kodeunit,kodebarang 
union all
 
--MUTASI BULAN INI
--PEMBELIAN SENDIRI
select kodeunit,kodebarang,0 as sawNilai,sum(nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=1) and tanggal<'01-09-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,sum((nilai*.1)+nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=2) and tanggal<'01-09-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,sum((nilai*.1)+nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014' 
group by kodeunit,kodebarang 
union all 

select kodeunit,kodebarang,0 as sawNilai,sum(nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,sum((nilai*.1)+nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 

select kodeunit,kodebarang,0 as sawNilai,sum(nilai) as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=0 
group by kodeunit,kodebarang 
union all 
 
--PEMBELIAN DARI KEBUN SE-INDUK
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,sum(nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=1) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,sum((nilai*.1)+nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=2) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,sum((nilai*.1)+nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,sum(nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,sum((nilai*.1)+nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,sum(nilai) as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=0 
group by kodeunit,kodebarang 
union all 
 
--PEMBELIAN DARI KANTOR PUSAT
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum(nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=1) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum((nilai*.1)+nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=2) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum((nilai*.1)+nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum(nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum((nilai*.1)+nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,sum(nilai) as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=0 
group by kodeunit,kodebarang 
union all 
 
--PENERIMAAN LAIN-LAIN
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum(nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=1) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum((nilai*.1)+nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=2) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum((nilai*.1)+nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum(nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum((nilai*.1)+nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum(nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=0 
group by kodeunit,kodebarang 
union all 
 
--PEMAKAIAN SENDIRI
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,sum(nilai) as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and not substring(norek,1,3) in ('080','196') 
group by kodeunit,kodebarang 
union all 
 
--PEMAKAIAN KEBUN SE-INDUK
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,sum(nilai) as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and substring(norek,1,5)='08002' and not substring(norek,1,7)='0800209' 
group by kodeunit,kodebarang 
union all 
 
--PEMAKAIAN KANTOR PUSAT
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,sum(nilai) as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and substring(norek,1,7)='0800209' 
group by kodeunit,kodebarang 
union all 
 
--PEMAKAIAN LAIN-LAIN
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,sum(nilai) as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and substring(norek,1,3) in ('196') 
group by kodeunit,kodebarang 
union all 
 
--KOREKSI KELEBIHAN
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,sum(nilai) as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,0 as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR' and nilai>0 
group by kodeunit,kodebarang 
union all 
 
--KOREKSI KEKURANGAN
select kodeunit,kodebarang,0 as sawNilai,0 as trmSDR,0 as trmKBN,0 as trmDIR,0 as trmLLN,0 as klrSDR,0 as klrKBN,0 as klrDIR,sum(abs(nilai)) as klrLLN 
from #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR' and nilai<0 
group by kodeunit,kodebarang 
 
select @TglAwal-1 as per,substring(b.norek,1,5) as grup,'KEBUN/UNIT : '+c.namakebun as namakebun,b.norek,d.namarekening, 
sum(a.sawNilai) as sawNilai, 
sum(a.trmSDR) as trmSDR, 
sum(a.trmKBN) as trmKBN, 
sum(a.trmDIR) as trmDIR, 
sum(a.trmLLN) as trmLLN, 
sum(a.trmSDR+a.trmKBN+a.trmDIR+a.trmLLN) as trmJML, 
sum(a.klrSDR) as klrSDR, 
sum(a.klrKBN) as klrKBN, 
sum(a.klrDIR) as klrDIR, 
sum(a.klrLLN) as klrLLN, 
sum(a.klrSDR+a.klrKBN+a.klrDIR+a.klrLLN) as klrJML, 
sum(a.sawNilai+a.trmSDR+a.trmKBN+a.trmDIR+a.trmLLN)-sum(a.klrSDR+a.klrKBN+a.klrDIR+a.klrLLN) as sakNilai 
into #t2 
from #t1 a 
inner join SPDK_KBN_MASTER_REF..ref_barang b on a.kodebarang=b.kodebarang 
inner join ref_kebun c on a.kodeunit=c.KodeKebun 
inner join ref_rekening d on b.norek=d.Norek and a.KodeUnit=d.KodeUnit
group by a.kodeunit,b.norek,c.namakebun,d.namarekening 
 
select per,grup,namakebun,norek,namarekening, 
sum(sawNilai) as sawNilai, 
sum(trmSDR) as trmSDR, 
sum(trmKBN) as trmKBN, 
sum(trmDIR) as trmDIR, 
sum(trmLLN) as trmLLN, 
sum(trmJML) as trmJML, 
sum(klrSDR) as klrSDR, 
sum(klrKBN) as klrKBN, 
sum(klrDIR) as klrDIR, 
sum(klrLLN) as klrLLN, 
sum(klrJML) as klrJML, 
sum(sakNilai) as sakNilai 
from #t2 
where sawNilai+trmJML+klrJML<>0 
group by per,grup,namakebun,norek,namarekening 
order by norek 

--set dateformat dmy exec DSB_TUPcr108 '01-07-2017','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[EAPcr413]
@tanggal datetime
as
set dateformat dmy
begin
set nocount on
--TEMP BIAYA
select KodeUnit,substring(Norek,1,5) as Norek,Netral as Nomor,sum(Debet-Kredit) as Nilai,SUM(Jml_fisik) as jmlFisik  into #Kartu      from Kartu where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and substring(norek,1,3) in ('255','256','257') and Aplikasi NOT IN ('EAP','ETL') group by KodeUnit,substring(Norek,1,5),Netral
select KodeUnit,kdtrans,Norek,Nomor,sum(nilai) as Nilai,SUM(jmlfisik) as jmlFisik            into #EAP        from EAP   where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and substring(norek,1,3) in ('255','256','257') group by KodeUnit,kdtrans,norek,Nomor

--TEMP KWH DAN JAM REALISASI
select KodeUnit,kdtrans,Nomor,sum(jmlkm) as JmlKWH,SUM(jmljam) as jmlJAM into #EAPKWHBI   from EAP   where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kdtrans='ETLBI' group by KodeUnit,kdtrans,Nomor
select distinct KodeUnit,kdtrans,Nomor,jmlkm as JmlKWH,jmljam  as jmlJAM into #EAPKWHSBL  from EAP   where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kdtrans='ETLSBL'

--TEMP KWH DAN JAM ANGGARAN
select distinct KodeUnit,kdtrans,Nomor,jmlkm as JmlKWH,jmljam into #EAPKWHABI  from EAP   where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kdtrans='ETLABI' 
select distinct KodeUnit,kdtrans,Nomor,jmlkm as JmlKWH,jmljam into #EAPKWHASBL from EAP   where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kdtrans='ETLASBL'


--BIAYA BULAN INI
--GAJI/UPAH
select 'NILAI GAJI' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,Nilai as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI into #Biaya from #Kartu where substring(norek,1,5) in ('25501','25502','25519')
union all
--BAHAN BAKAR
select 'NILAI BBM' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,Nilai as bi,0 as abi,Nilai as sbi,0 as asbi,jmlFisik as bbmBI,jmlFisik as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #Kartu where substring(norek,1,5) in ('25503')
union all
--PELUMAS
select 'NILAI PELUMAS' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,Nilai as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,jmlFisik as PelumasBI,jmlFisik as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #Kartu where substring(norek,1,5) in ('25504')
union all
--ONDERDIL
select 'NILAI ONDERDIL' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,Nilai as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #Kartu where substring(norek,1,5) in ('25505')
union all
--PERBAIKAN
select 'NILAI PERBAIKAN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,Nilai as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #Kartu where substring(norek,1,5) in ('25506')
union all
--LAIN2/PLN
select 'NILAI LAIN2/PLN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,Nilai as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #Kartu where substring(norek,1,5) in ('25507')
union all

--BIAYA S/D BULAN INI
--GAJI/UPAH
select 'NILAI GAJI' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,sum(Nilai) as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25501','25502','25519') and kdtrans='ETLSBL' group by KodeUnit,substring(norek,1,3),Nomor
union all
--BAHAN BAKAR
select 'NILAI BBM' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,jmlFisik as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25503') and kdtrans='ETLSBL'
union all
--PELUMAS
select 'NILAI PELUMAS' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,jmlFisik as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25504') and kdtrans='ETLSBL'
union all
--ONDERDIL
select 'NILAI ONDERDIL' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25505') and kdtrans='ETLSBL'
union all
--PERBAIKAN
select 'NILAI PERBAIKAN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25506') and kdtrans='ETLSBL'
union all
--LAIN2/PLN
select 'NILAI LAIN2/PLN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25507') and kdtrans='ETLSBL'
union all

--ANGGARAN BULAN INI
--GAJI/UPAH
select 'NILAI GAJI' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,Nilai as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25501','25502','25519') and kdtrans='ETLABI'
union all
--BAHAN BAKAR
select 'NILAI BBM' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,Nilai as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,jmlFisik as bbmABI,jmlFisik as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25503') and kdtrans='ETLABI'
union all
--PELUMAS
select 'NILAI PELUMAS' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,Nilai as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,jmlFisik as PelumasABI,jmlFisik as PelumasASBI from #EAP where substring(norek,1,5) in ('25504') and kdtrans='ETLABI'
union all
--ONDERDIL
select 'NILAI ONDERDIL' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,Nilai as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25505') and kdtrans='ETLABI'
union all
--PERBAIKAN
select 'NILAI PERBAIKAN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,Nilai as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25506') and kdtrans='ETLABI'
union all
--LAIN2/PLN
select 'NILAI LAIN2/PLN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,Nilai as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25507') and kdtrans='ETLABI'
union all

--ANGGARAN S/D BULAN INI
--GAJI/UPAH
select 'NILAI GAJI' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25501','25502','25519') and kdtrans='ETLASBL'
union all
--BAHAN BAKAR
select 'NILAI BBM' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,jmlFisik as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25503') and kdtrans='ETLASBL'
union all
--PELUMAS
select 'NILAI PELUMAS' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,jmlFisik as PelumasASBI from #EAP where substring(norek,1,5) in ('25504') and kdtrans='ETLASBL'
union all
--ONDERDIL
select 'NILAI ONDERDIL' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25505') and kdtrans='ETLASBL'
union all
--PERBAIKAN
select 'NILAI PERBAIKAN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25506') and kdtrans='ETLASBL'
union all
--LAIN2/PLN
select 'NILAI LAIN2/PLN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25507') and kdtrans='ETLASBL'

select Ket,KodeUnit,KRBB,Nomor,
SUM(bi) as BI,SUM(abi) as ABI,SUM(sbi) as SBI,SUM(asbi) as ASBI,
SUM(bbmBI) as bbmBI,SUM(bbmABI) as bbmABI,SUM(bbmSBI) as bbmSBI,SUM(bbmASBI) as bbmASBI,
SUM(PelumasBI) as PelumasBI,SUM(PelumasABI) as PelumasABI,SUM(PelumasSBI) as PelumasSBI,SUM(PelumasASBI) as PelumasASBI,
cast(0 as float) as kwhBI,cast(0 as float) as kwhSBI,cast(0 as float) as kwhABI,cast(0 as float) as kwhASBI,cast(0 as float) as jamBI,cast(0 as float) as jamSBI,cast(0 as float) as jamABI,cast(0 as float) as jamASBI 
into #KWH1 
from #Biaya  
group by Ket,KodeUnit,KRBB,Nomor

update #KWH1 set kwhBI =(select SUM(JmlKWH)  from #EAPKWHBI  where #KWH1.Nomor=#EAPKWHBI.nomor)
update #KWH1 set kwhSBI=(select SUM(JmlKWH)  from #EAPKWHSBL where #KWH1.Nomor=#EAPKWHSBL.nomor)+(select SUM(JmlKWH)  from #EAPKWHBI  where #KWH1.Nomor=#EAPKWHBI.nomor)
update #KWH1 set jamBI =(select SUM(jmlJAM)  from #EAPKWHBI  where #KWH1.Nomor=#EAPKWHBI.nomor)
update #KWH1 set jamSBI=(select SUM(jmlJAM)  from #EAPKWHSBL where #KWH1.Nomor=#EAPKWHSBL.nomor)+(select SUM(jmlJAM)  from #EAPKWHBI  where #KWH1.Nomor=#EAPKWHBI.nomor)

update #KWH1 set kwhABI =(select SUM(JmlKWH) from #EAPKWHABI  where #KWH1.Nomor=#EAPKWHABI.nomor)
update #KWH1 set kwhASBI=(select SUM(JmlKWH) from #EAPKWHASBL where #KWH1.Nomor=#EAPKWHASBL.nomor)+(select SUM(JmlKWH) from #EAPKWHABI  where #KWH1.Nomor=#EAPKWHABI.nomor)
update #KWH1 set jamABI =(select SUM(jmlJAM) from #EAPKWHABI  where #KWH1.Nomor=#EAPKWHABI.nomor)
update #KWH1 set jamASBI=(select SUM(jmlJAM) from #EAPKWHASBL where #KWH1.Nomor=#EAPKWHASBL.nomor)+(select SUM(jmlJAM) from #EAPKWHABI  where #KWH1.Nomor=#EAPKWHABI.nomor)

select distinct KodeUnit,KRBB,Nomor,
kwhBI,kwhSBI,kwhABI,kwhASBI,jamBI,jamSBI,jamABI,jamASBI,
0 as SolarBI,     0 as SolarSBI,     0 as SolarABI,     0 as SolarASBI,
0 as PremiumBI,   0 as PremiumSBI,   0 as PremiumABI,   0 as PremiumASBI,
0 as PelumasBI,   0 as PelumasSBI,   0 as PelumasABI,   0 as PelumasASBI,
0 as GajiBI,      0 as GajiSBI,      0 as GajiABI,      0 as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
0 as bbmRpBI,     0 as bbmRpSBI,     0 as bbmRpABI,     0 as bbmRpASBI,
0 as pelumasRpBI, 0 as pelumasRpSBI, 0 as pelumasRpABI, 0 as pelumasRpASBI,
0 as onderdilRpBI,0 as onderdilRpSBI,0 as onderdilRpABI,0 as onderdilRpASBI,
0 as reparasiRpBI,0 as reparasiRpSBI,0 as reparasiRpABI,0 as reparasiRpASBI,
0 as lainRpBI,    0 as lainRpSBI,    0 as lainRpABI,    0 as lainRpASBI
into #KWH2
from #KWH1
union all

select a.KodeUnit,a.KRBB,a.Nomor,
0 as kwhBI,       0 as kwhSBI,       0 as kwhABI,       0 as kwhASBI,
0 as jamBI,       0 as jamSBI,       0 as jamABI,       0 as jamASBI,
a.bbmBI as SolarBI,a.bbmSBI as SolarSBI,a.bbmABI as SolarABI,a.bbmASBI as SolarASBI,
0 as PremiumBI,   0 as PremiumSBI,   0 as PremiumABI,   0 as PremiumASBI,
0 as PelumasBI,   0 as PelumasSBI,   0 as PelumasABI,   0 as PelumasASBI,
0 as GajiBI,      0 as GajiSBI,      0 as GajiABI,      0 as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
round(bi,0) as bbmRpBI,round(SBI,0) as bbmRpSBI,ABI as bbmRpABI,ASBI as bbmRpASBI,
0 as pelumasRpBI, 0 as pelumasRpSBI, 0 as pelumasRpABI, 0 as pelumasRpASBI,
0 as onderdilRpBI,0 as onderdilRpSBI,0 as onderdilRpABI,0 as onderdilRpASBI,
0 as reparasiRpBI,0 as reparasiRpSBI,0 as reparasiRpABI,0 as reparasiRpASBI,
0 as lainRpBI,    0 as lainRpSBI,    0 as lainRpABI,    0 as lainRpASBI
from #KWH1 a
inner join Ref_Netral b on a.Nomor=b.Nomor and '02'=b.BBM
where a.Ket='NILAI BBM'
union all

select a.KodeUnit,a.KRBB,a.Nomor,
0 as kwhBI,       0 as kwhSBI,       0 as kwhABI,       0 as kwhASBI,
0 as jamBI,       0 as jamSBI,       0 as jamABI,       0 as jamASBI,
0 as SolarBI,     0 as SolarSBI,     0 as SolarABI,     0 as SolarASBI,
a.bbmBI as PremiumBI,a.bbmSBI as PremiumSBI,a.bbmABI as PremiumABI,a.bbmASBI as PremiumASBI,
0 as PelumasBI,   0 as PelumasSBI,   0 as PelumasABI,   0 as PelumasASBI,
0 as GajiBI,      0 as GajiSBI,      0 as GajiABI,      0 as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
round(bi,0) as bbmRpBI,round(SBI,0) as bbmRpSBI,ABI as bbmRpABI,ASBI as bbmRpASBI,
0 as pelumasRpBI, 0 as pelumasRpSBI, 0 as pelumasRpABI, 0 as pelumasRpASBI,
0 as onderdilRpBI,0 as onderdilRpSBI,0 as onderdilRpABI,0 as onderdilRpASBI,
0 as reparasiRpBI,0 as reparasiRpSBI,0 as reparasiRpABI,0 as reparasiRpASBI,
0 as lainRpBI,    0 as lainRpSBI,    0 as lainRpABI,    0 as lainRpASBI
from #KWH1 a
inner join Ref_Netral b on a.Nomor=b.Nomor and '01'=b.BBM
where a.Ket='NILAI BBM'
union all


select KodeUnit,KRBB,Nomor,
0 as kwhBI,       0 as kwhSBI,       0 as kwhABI,       0 as kwhASBI,
0 as jamBI,       0 as jamSBI,       0 as jamABI,       0 as jamASBI,
0 as SolarBI,     0 as SolarSBI,     0 as SolarABI,     0 as SolarASBI,
0 as PremiumBI,   0 as PremiumSBI,   0 as PremiumABI,   0 as PremiumASBI,
0 as PelumasBI,   0 as PelumasSBI,   0 as PelumasABI,   0 as PelumasASBI,
BI as GajiBI,      SBI as GajiSBI,      ABI as GajiABI,      ASBI as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
0 as bbmRpBI,     0 as bbmRpSBI,     0 as bbmRpABI,     0 as bbmRpASBI,
0 as pelumasRpBI, 0 as pelumasRpSBI, 0 as pelumasRpABI, 0 as pelumasRpASBI,
0 as onderdilRpBI,0 as onderdilRpSBI,0 as onderdilRpABI,0 as onderdilRpASBI,
0 as reparasiRpBI,0 as reparasiRpSBI,0 as reparasiRpABI,0 as reparasiRpASBI,
0 as lainRpBI,    0 as lainRpSBI,    0 as lainRpABI,    0 as lainRpASBI
from #KWH1
where Ket='NILAI GAJI'
union all

select KodeUnit,KRBB,Nomor,
0 as kwhBI,       0 as kwhSBI,       0 as kwhABI,       0 as kwhASBI,
0 as jamBI,       0 as jamSBI,       0 as jamABI,       0 as jamASBI,
0 as SolarBI,     0 as SolarSBI,     0 as SolarABI,     0 as SolarASBI,
0 as PremiumBI,   0 as PremiumSBI,   0 as PremiumABI,   0 as PremiumASBI,
PelumasBI as PelumasBI,   PelumasSBI as PelumasSBI,   PelumasABI as PelumasABI,   PelumasASBI as PelumasASBI,
0 as GajiBI,      0 as GajiSBI,      0 as GajiABI,      0 as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
0 as bbmRpBI,     0 as bbmRpSBI,     0 as bbmRpABI,     0 as bbmRpASBI,
BI as pelumasRpBI, SBI as pelumasRpSBI, ABI as pelumasRpABI, ASBI as pelumasRpASBI,
0 as onderdilRpBI,0 as onderdilRpSBI,0 as onderdilRpABI,0 as onderdilRpASBI,
0 as reparasiRpBI,0 as reparasiRpSBI,0 as reparasiRpABI,0 as reparasiRpASBI,
0 as lainRpBI,    0 as lainRpSBI,    0 as lainRpABI,    0 as lainRpASBI
from #KWH1
where Ket='NILAI PELUMAS'
union all

select KodeUnit,KRBB,Nomor,
0 as kwhBI,       0 as kwhSBI,       0 as kwhABI,       0 as kwhASBI,
0 as jamBI,       0 as jamSBI,       0 as jamABI,       0 as jamASBI,
0 as SolarBI,     0 as SolarSBI,     0 as SolarABI,     0 as SolarASBI,
0 as PremiumBI,   0 as PremiumSBI,   0 as PremiumABI,   0 as PremiumASBI,
0 as PelumasBI,   0 as PelumasSBI,   0 as PelumasABI,   0 as PelumasASBI,
0 as GajiBI,      0 as GajiSBI,      0 as GajiABI,      0 as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
0 as bbmRpBI,     0 as bbmRpSBI,     0 as bbmRpABI,     0 as bbmRpASBI,
0 as pelumasRpBI, 0 as pelumasRpSBI, 0 as pelumasRpABI, 0 as pelumasRpASBI,
BI as onderdilRpBI,SBI as onderdilRpSBI,ABI as onderdilRpABI,ASBI as onderdilRpASBI,
0 as reparasiRpBI,0 as reparasiRpSBI,0 as reparasiRpABI,0 as reparasiRpASBI,
0 as lainRpBI,    0 as lainRpSBI,    0 as lainRpABI,    0 as lainRpASBI
from #KWH1
where Ket='NILAI ONDERDIL'
union all

select KodeUnit,KRBB,Nomor,
0 as kwhBI,       0 as kwhSBI,       0 as kwhABI,       0 as kwhASBI,
0 as jamBI,       0 as jamSBI,       0 as jamABI,       0 as jamASBI,
0 as SolarBI,     0 as SolarSBI,     0 as SolarABI,     0 as SolarASBI,
0 as PremiumBI,   0 as PremiumSBI,   0 as PremiumABI,   0 as PremiumASBI,
0 as PelumasBI,   0 as PelumasSBI,   0 as PelumasABI,   0 as PelumasASBI,
0 as GajiBI,      0 as GajiSBI,      0 as GajiABI,      0 as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
0 as bbmRpBI,     0 as bbmRpSBI,     0 as bbmRpABI,     0 as bbmRpASBI,
0 as pelumasRpBI, 0 as pelumasRpSBI, 0 as pelumasRpABI, 0 as pelumasRpASBI,
0 as onderdilRpBI,0 as onderdilRpSBI,0 as onderdilRpABI,0 as onderdilRpASBI,
BI as reparasiRpBI,SBI as reparasiRpSBI,ABI as reparasiRpABI,ASBI as reparasiRpASBI,
0 as lainRpBI,    0 as lainRpSBI,    0 as lainRpABI,    0 as lainRpASBI
from #KWH1
where Ket='NILAI PERBAIKAN'
union all

select KodeUnit,KRBB,Nomor,
0 as kwhBI,       0 as kwhSBI,       0 as kwhABI,       0 as kwhASBI,
0 as jamBI,       0 as jamSBI,       0 as jamABI,       0 as jamASBI,
0 as SolarBI,     0 as SolarSBI,     0 as SolarABI,     0 as SolarASBI,
0 as PremiumBI,   0 as PremiumSBI,   0 as PremiumABI,   0 as PremiumASBI,
0 as PelumasBI,   0 as PelumasSBI,   0 as PelumasABI,   0 as PelumasASBI,
0 as GajiBI,      0 as GajiSBI,      0 as GajiABI,      0 as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
0 as bbmRpBI,     0 as bbmRpSBI,     0 as bbmRpABI,     0 as bbmRpASBI,
0 as pelumasRpBI, 0 as pelumasRpSBI, 0 as pelumasRpABI, 0 as pelumasRpASBI,
0 as onderdilRpBI,0 as onderdilRpSBI,0 as onderdilRpABI,0 as onderdilRpASBI,
0 as reparasiRpBI,0 as reparasiRpSBI,0 as reparasiRpABI,0 as reparasiRpASBI,
BI as lainRpBI,    SBI as lainRpSBI,    ABI as lainRpABI,    ASBI as lainRpASBI
from #KWH1
where Ket='NILAI LAIN2/PLN'

select 'Kebun/Unit : '+b.NamaKebun as nmKebun,a.KRBB,a.Nomor,c.Uraian as Uraian,c.Tahun,
SUM(a.kwhBI)        as kwhBI,       SUM(a.kwhSBI)        as kwhSBI,       SUM(a.kwhABI)        as kwhABI,       SUM(a.kwhASBI)        as kwhASBI, 
SUM(a.jamBI)        as jamBI,       SUM(a.jamSBI)        as jamSBI,       SUM(a.jamABI)        as jamABI,       SUM(a.jamASBI)        as jamASBI, 
SUM(a.SolarBI)      as SolarBI,     SUM(a.SolarSBI)      as SolarSBI,     SUM(a.SolarABI)      as SolarABI,     SUM(a.SolarASBI)      as SolarASBI, 
SUM(a.PremiumBI)    as PremiumBI,   SUM(a.PremiumSBI)    as PremiumSBI,   SUM(a.PremiumABI)    as PremiumABI,   SUM(a.PremiumASBI)    as PremiumASBI, 
SUM(a.PelumasBI)    as PelumasBI,   SUM(a.PelumasSBI)    as PelumasSBI,   SUM(a.PelumasABI)    as PelumasABI,   SUM(a.PelumasASBI)    as PelumasASBI, 
SUM(a.GajiBI)       as GajiBI,      SUM(a.GajiSBI)       as GajiSBI,      SUM(a.GajiABI)       as GajiABI,      SUM(a.GajiASBI)       as GajiASBI, 
SUM(a.umBI)         as umBI,        SUM(a.umSBI)         as umSBI,        SUM(a.umABI)         as umABI,        SUM(a.umASBI)         as umASBI, 
SUM(a.bbmRpBI)      as bbmRpBI,     SUM(a.bbmRpSBI)      as bbmRpSBI,     SUM(a.bbmRpABI)      as bbmRpABI,     SUM(a.bbmRpASBI)      as bbmRpASBI, 
SUM(a.pelumasRpBI)  as pelumasRpBI, SUM(a.pelumasRpSBI)  as pelumasRpSBI, SUM(a.pelumasRpABI)  as pelumasRpABI, SUM(a.pelumasRpASBI)  as pelumasRpASBI, 
SUM(a.onderdilRpBI) as onderRpBI,   SUM(a.onderdilRpSBI) as onderRpSBI,   SUM(a.onderdilRpABI) as onderRpABI,   SUM(a.onderdilRpASBI) as onderRpASBI, 
SUM(a.reparasiRpBI) as reparasiRpBI,SUM(a.reparasiRpSBI) as reparasiRpSBI,SUM(a.reparasiRpABI) as reparasiRpABI,SUM(a.reparasiRpASBI) as reparasiRpASBI, 
SUM(a.lainRpBI)     as lainRpBI,    SUM(a.lainRpSBI)     as lainRpSBI,    SUM(a.lainRpABI)     as lainRpABI,    SUM(a.lainRpASBI)     as lainRpASBI,
SUM(a.GajiBI  +a.umBI  +a.bbmRpBI  +a.pelumasRpBI  +a.onderdilRpBI  +a.reparasiRpBI  +a.lainRpBI)   as jmlBI,
SUM(a.GajiSBI +a.umSBI +a.bbmRpSBI +a.pelumasRpSBI +a.onderdilRpSBI +a.reparasiRpSBI +a.lainRpSBI)  as jmlSBI,
SUM(a.GajiABI +a.umABI +a.bbmRpABI +a.pelumasRpABI +a.onderdilRpABI +a.reparasiRpABI +a.lainRpABI)  as jmlABI,
SUM(a.GajiASBI+a.umASBI+a.bbmRpASBI+a.pelumasRpASBI+a.onderdilRpASBI+a.reparasiRpASBI+a.lainRpASBI) as jmlASBI
from #KWH2 a
inner join Ref_Kebun b on a.KodeUnit=b.KodeKebun
inner join Ref_Netral c on a.Nomor=c.Nomor
group by b.NamaKebun,a.KRBB,a.Nomor,c.Uraian,c.Tahun
set nocount off
end

--set dateformat dmy exec EAPcr413 '01-03-2016'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[EAPcr413EvalETL]
@tanggal datetime
 
as
set dateformat dmy
begin
set nocount on
--TEMP BIAYA
select KodeUnit,substring(Norek,1,5) as Norek,Netral as Nomor,sum(Debet-Kredit) as Nilai,SUM(Jml_fisik) as jmlFisik  into #Kartu      from Kartu where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and substring(norek,1,3) in ('255','256','257') and Aplikasi NOT IN ('EAP','ETL') group by KodeUnit,substring(Norek,1,5),Netral
select KodeUnit,kdtrans,Norek,Nomor,sum(nilai) as Nilai,SUM(jmlfisik) as jmlFisik            into #EAP        from EAP   where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and substring(norek,1,3) in ('255','256','257') group by KodeUnit,kdtrans,norek,Nomor

--TEMP KWH DAN JAM REALISASI
select KodeUnit,kdtrans,Nomor,sum(jmlkm) as JmlKWH,SUM(jmljam) as jmlJAM into #EAPKWHBI   from EAP   where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kdtrans='ETLBI' group by KodeUnit,kdtrans,Nomor
--select  KodeUnit,kdtrans,Nomor,jmlkm as JmlKWH,jmljam as jmlJAM into #EAPKWHBI   from EAP   where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kdtrans='ETLBI' --group by KodeUnit,kdtrans,Nomor
select distinct KodeUnit,kdtrans,Nomor,jmlkm as JmlKWH,jmljam  as jmlJAM into #EAPKWHSBL  from EAP   where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kdtrans='ETLSBL' --group by KodeUnit,kdtrans,Nomor,jmlkm

--TEMP KWH DAN JAM ANGGARAN
select distinct KodeUnit,kdtrans,Nomor,jmlkm as JmlKWH,jmljam into #EAPKWHABI  from EAP   where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kdtrans='ETLABI' 
select distinct KodeUnit,kdtrans,Nomor,jmlkm as JmlKWH,jmljam into #EAPKWHASBL from EAP   where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kdtrans='ETLASBL'


--BIAYA BULAN INI
--GAJI/UPAH
select 'NILAI GAJI' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,Nilai as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI into #Biaya from #Kartu where substring(norek,1,5) in ('25501','25502','25519','25601','25602','25619')
union all
--BAHAN BAKAR
select 'NILAI BBM' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,Nilai as bi,0 as abi,Nilai as sbi,0 as asbi,jmlFisik as bbmBI,jmlFisik as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #Kartu where substring(norek,1,5) in ('25503','25603')
union all
--PELUMAS
select 'NILAI PELUMAS' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,Nilai as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,jmlFisik as PelumasBI,jmlFisik as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #Kartu where substring(norek,1,5) in ('25504','25604')
union all
--ONDERDIL
select 'NILAI ONDERDIL' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,Nilai as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #Kartu where substring(norek,1,5) in ('25505','25605')
union all
--PERBAIKAN
select 'NILAI PERBAIKAN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,Nilai as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #Kartu where substring(norek,1,5) in ('25506','25606')
union all
--LAIN2/PLN
select 'NILAI LAIN2/PLN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,Nilai as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #Kartu where substring(norek,1,5) in ('25507','25607')
--union all

----BIAYA S/D BULAN INI
----GAJI/UPAH
--select 'NILAI GAJI' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,sum(Nilai) as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25501','25502','25519','25601','25602','25619') and kdtrans='ETLSBL' group by KodeUnit,substring(norek,1,3),Nomor
--union all
----BAHAN BAKAR
--select 'NILAI BBM' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,jmlFisik as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25503','25603') and kdtrans='ETLSBL'
--union all
----PELUMAS
--select 'NILAI PELUMAS' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,jmlFisik as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25504','25604') and kdtrans='ETLSBL'
--union all
----ONDERDIL
--select 'NILAI ONDERDIL' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25505','25605') and kdtrans='ETLSBL'
--union all
----PERBAIKAN
--select 'NILAI PERBAIKAN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25506','25606') and kdtrans='ETLSBL'
--union all
----LAIN2/PLN
--select 'NILAI LAIN2/PLN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,Nilai as sbi,0 as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25507','25607') and kdtrans='ETLSBL'
--union all

----ANGGARAN BULAN INI
----GAJI/UPAH
--select 'NILAI GAJI' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,Nilai as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25501','25502','25519','25601','25602','25619') and kdtrans='ETLABI'
--union all
----BAHAN BAKAR
--select 'NILAI BBM' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,Nilai as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,jmlFisik as bbmABI,jmlFisik as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25503','25603') and kdtrans='ETLABI'
--union all
----PELUMAS
--select 'NILAI PELUMAS' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,Nilai as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,jmlFisik as PelumasABI,jmlFisik as PelumasASBI from #EAP where substring(norek,1,5) in ('25504','25604') and kdtrans='ETLABI'
--union all
----ONDERDIL
--select 'NILAI ONDERDIL' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,Nilai as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25505','25605') and kdtrans='ETLABI'
--union all
----PERBAIKAN
--select 'NILAI PERBAIKAN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,Nilai as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25506','25606') and kdtrans='ETLABI'
--union all
----LAIN2/PLN
--select 'NILAI LAIN2/PLN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,Nilai as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25507','25607') and kdtrans='ETLABI'
----union all

----ANGGARAN S/D BULAN INI
----GAJI/UPAH
--select 'NILAI GAJI' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25501','25502','25519','25601','25602','25619') and kdtrans='ETLASBL'
--union all
----BAHAN BAKAR
--select 'NILAI BBM' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,jmlFisik as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25503','25603') and kdtrans='ETLASBL'
--union all
----PELUMAS
--select 'NILAI PELUMAS' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,jmlFisik as PelumasASBI from #EAP where substring(norek,1,5) in ('25504','25604') and kdtrans='ETLASBL'
--union all
----ONDERDIL
--select 'NILAI ONDERDIL' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25505','25605') and kdtrans='ETLASBL'
--union all
----PERBAIKAN
--select 'NILAI PERBAIKAN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25506','25606') and kdtrans='ETLASBL'
--union all
----LAIN2/PLN
--select 'NILAI LAIN2/PLN' as Ket,KodeUnit,substring(norek,1,3) as KRBB,Nomor,0 as bi,0 as abi,0 as sbi,Nilai as asbi,0 as bbmBI,0 as bbmSBI,0 as PelumasBI,0 as PelumasSBI,0 as bbmABI,0 as bbmASBI,0 as PelumasABI,0 as PelumasASBI from #EAP where substring(norek,1,5) in ('25507','25607') and kdtrans='ETLASBL'

select Ket,KodeUnit,KRBB,Nomor,
SUM(bi) as BI,SUM(abi) as ABI,SUM(sbi) as SBI,SUM(asbi) as ASBI,
SUM(bbmBI) as bbmBI,SUM(bbmABI) as bbmABI,SUM(bbmSBI) as bbmSBI,SUM(bbmASBI) as bbmASBI,
SUM(PelumasBI) as PelumasBI,SUM(PelumasABI) as PelumasABI,SUM(PelumasSBI) as PelumasSBI,SUM(PelumasASBI) as PelumasASBI,
cast(0 as float) as kwhBI,cast(0 as float) as kwhSBI,cast(0 as float) as kwhABI,cast(0 as float) as kwhASBI,cast(0 as float) as jamBI,cast(0 as float) as jamSBI,cast(0 as float) as jamABI,cast(0 as float) as jamASBI 
into #KWH1 
from #Biaya  
group by Ket,KodeUnit,KRBB,Nomor

update #KWH1 set kwhBI =(select SUM(JmlKWH)  from #EAPKWHBI  where #KWH1.Nomor=#EAPKWHBI.nomor)
update #KWH1 set kwhBI =0 where kwhBI is null
update #KWH1 set kwhSBI =0 where kwhSBI is null

--YUDHA
update #KWH1 set kwhSBI=(select SUM(JmlKWH)  from #EAPKWHSBL where #KWH1.Nomor=#EAPKWHSBL.nomor)
update #KWH1 set jamSBI=(select SUM(jmlJAM)  from #EAPKWHSBL where #KWH1.Nomor=#EAPKWHSBL.nomor)
update #KWH1 set kwhASBI=(select SUM(JmlKWH) from #EAPKWHASBL where #KWH1.Nomor=#EAPKWHASBL.nomor)
update #KWH1 set jamASBI=(select SUM(jmlJAM) from #EAPKWHASBL where #KWH1.Nomor=#EAPKWHASBL.nomor)

update #KWH1 set kwhSBI=kwhBI where kwhSBI is null
update #KWH1 set kwhASBI=kwhABI where kwhASBI is null
update #KWH1 set jamSBI=jamBI where jamSBI is null
update #KWH1 set jamASBI=jamABI where jamASBI is null

select distinct KodeUnit,KRBB,Nomor,
kwhBI,kwhSBI,kwhABI,kwhASBI,jamBI,jamSBI,jamABI,jamASBI,
0 as SolarBI,     0 as SolarSBI,     0 as SolarABI,     0 as SolarASBI,
0 as PremiumBI,   0 as PremiumSBI,   0 as PremiumABI,   0 as PremiumASBI,
0 as PelumasBI,   0 as PelumasSBI,   0 as PelumasABI,   0 as PelumasASBI,
0 as GajiBI,      0 as GajiSBI,      0 as GajiABI,      0 as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
0 as bbmRpBI,     0 as bbmRpSBI,     0 as bbmRpABI,     0 as bbmRpASBI,
0 as pelumasRpBI, 0 as pelumasRpSBI, 0 as pelumasRpABI, 0 as pelumasRpASBI,
0 as onderdilRpBI,0 as onderdilRpSBI,0 as onderdilRpABI,0 as onderdilRpASBI,
0 as reparasiRpBI,0 as reparasiRpSBI,0 as reparasiRpABI,0 as reparasiRpASBI,
0 as lainRpBI,    0 as lainRpSBI,    0 as lainRpABI,    0 as lainRpASBI
into #KWH2
from #KWH1
union all

select a.KodeUnit,a.KRBB,a.Nomor,
0 as kwhBI,       0 as kwhSBI,       0 as kwhABI,       0 as kwhASBI,
0 as jamBI,       0 as jamSBI,       0 as jamABI,       0 as jamASBI,
a.bbmBI as SolarBI,a.bbmSBI as SolarSBI,a.bbmABI as SolarABI,a.bbmASBI as SolarASBI,
0 as PremiumBI,   0 as PremiumSBI,   0 as PremiumABI,   0 as PremiumASBI,
0 as PelumasBI,   0 as PelumasSBI,   0 as PelumasABI,   0 as PelumasASBI,
0 as GajiBI,      0 as GajiSBI,      0 as GajiABI,      0 as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
round(bi,0) as bbmRpBI,round(SBI,0) as bbmRpSBI,ABI as bbmRpABI,ASBI as bbmRpASBI,
0 as pelumasRpBI, 0 as pelumasRpSBI, 0 as pelumasRpABI, 0 as pelumasRpASBI,
0 as onderdilRpBI,0 as onderdilRpSBI,0 as onderdilRpABI,0 as onderdilRpASBI,
0 as reparasiRpBI,0 as reparasiRpSBI,0 as reparasiRpABI,0 as reparasiRpASBI,
0 as lainRpBI,    0 as lainRpSBI,    0 as lainRpABI,    0 as lainRpASBI
from #KWH1 a
inner join Ref_Netral b on a.Nomor=b.Nomor and '02'=b.BBM and a.KodeUnit = b.KodeUnit
where a.Ket='NILAI BBM'
union all

select a.KodeUnit,a.KRBB,a.Nomor,
0 as kwhBI,       0 as kwhSBI,       0 as kwhABI,       0 as kwhASBI,
0 as jamBI,       0 as jamSBI,       0 as jamABI,       0 as jamASBI,
0 as SolarBI,     0 as SolarSBI,     0 as SolarABI,     0 as SolarASBI,
a.bbmBI as PremiumBI,a.bbmSBI as PremiumSBI,a.bbmABI as PremiumABI,a.bbmASBI as PremiumASBI,
0 as PelumasBI,   0 as PelumasSBI,   0 as PelumasABI,   0 as PelumasASBI,
0 as GajiBI,      0 as GajiSBI,      0 as GajiABI,      0 as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
round(bi,0) as bbmRpBI,round(SBI,0) as bbmRpSBI,ABI as bbmRpABI,ASBI as bbmRpASBI,
0 as pelumasRpBI, 0 as pelumasRpSBI, 0 as pelumasRpABI, 0 as pelumasRpASBI,
0 as onderdilRpBI,0 as onderdilRpSBI,0 as onderdilRpABI,0 as onderdilRpASBI,
0 as reparasiRpBI,0 as reparasiRpSBI,0 as reparasiRpABI,0 as reparasiRpASBI,
0 as lainRpBI,    0 as lainRpSBI,    0 as lainRpABI,    0 as lainRpASBI
from #KWH1 a
inner join Ref_Netral b on a.Nomor=b.Nomor and '01'=b.BBM and a.KodeUnit = b.KodeUnit
where a.Ket='NILAI BBM'
union all


select KodeUnit,KRBB,Nomor,
0 as kwhBI,       0 as kwhSBI,       0 as kwhABI,       0 as kwhASBI,
0 as jamBI,       0 as jamSBI,       0 as jamABI,       0 as jamASBI,
0 as SolarBI,     0 as SolarSBI,     0 as SolarABI,     0 as SolarASBI,
0 as PremiumBI,   0 as PremiumSBI,   0 as PremiumABI,   0 as PremiumASBI,
0 as PelumasBI,   0 as PelumasSBI,   0 as PelumasABI,   0 as PelumasASBI,
BI as GajiBI,      SBI as GajiSBI,      ABI as GajiABI,      ASBI as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
0 as bbmRpBI,     0 as bbmRpSBI,     0 as bbmRpABI,     0 as bbmRpASBI,
0 as pelumasRpBI, 0 as pelumasRpSBI, 0 as pelumasRpABI, 0 as pelumasRpASBI,
0 as onderdilRpBI,0 as onderdilRpSBI,0 as onderdilRpABI,0 as onderdilRpASBI,
0 as reparasiRpBI,0 as reparasiRpSBI,0 as reparasiRpABI,0 as reparasiRpASBI,
0 as lainRpBI,    0 as lainRpSBI,    0 as lainRpABI,    0 as lainRpASBI
from #KWH1
where Ket='NILAI GAJI'
union all

select KodeUnit,KRBB,Nomor,
0 as kwhBI,       0 as kwhSBI,       0 as kwhABI,       0 as kwhASBI,
0 as jamBI,       0 as jamSBI,       0 as jamABI,       0 as jamASBI,
0 as SolarBI,     0 as SolarSBI,     0 as SolarABI,     0 as SolarASBI,
0 as PremiumBI,   0 as PremiumSBI,   0 as PremiumABI,   0 as PremiumASBI,
PelumasBI as PelumasBI,   PelumasSBI as PelumasSBI,   PelumasABI as PelumasABI,   PelumasASBI as PelumasASBI,
0 as GajiBI,      0 as GajiSBI,      0 as GajiABI,      0 as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
0 as bbmRpBI,     0 as bbmRpSBI,     0 as bbmRpABI,     0 as bbmRpASBI,
BI as pelumasRpBI, SBI as pelumasRpSBI, ABI as pelumasRpABI, ASBI as pelumasRpASBI,
0 as onderdilRpBI,0 as onderdilRpSBI,0 as onderdilRpABI,0 as onderdilRpASBI,
0 as reparasiRpBI,0 as reparasiRpSBI,0 as reparasiRpABI,0 as reparasiRpASBI,
0 as lainRpBI,    0 as lainRpSBI,    0 as lainRpABI,    0 as lainRpASBI
from #KWH1
where Ket='NILAI PELUMAS'
union all

select KodeUnit,KRBB,Nomor,
0 as kwhBI,       0 as kwhSBI,       0 as kwhABI,       0 as kwhASBI,
0 as jamBI,       0 as jamSBI,       0 as jamABI,       0 as jamASBI,
0 as SolarBI,     0 as SolarSBI,     0 as SolarABI,     0 as SolarASBI,
0 as PremiumBI,   0 as PremiumSBI,   0 as PremiumABI,   0 as PremiumASBI,
0 as PelumasBI,   0 as PelumasSBI,   0 as PelumasABI,   0 as PelumasASBI,
0 as GajiBI,      0 as GajiSBI,      0 as GajiABI,      0 as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
0 as bbmRpBI,     0 as bbmRpSBI,     0 as bbmRpABI,     0 as bbmRpASBI,
0 as pelumasRpBI, 0 as pelumasRpSBI, 0 as pelumasRpABI, 0 as pelumasRpASBI,
BI as onderdilRpBI,SBI as onderdilRpSBI,ABI as onderdilRpABI,ASBI as onderdilRpASBI,
0 as reparasiRpBI,0 as reparasiRpSBI,0 as reparasiRpABI,0 as reparasiRpASBI,
0 as lainRpBI,    0 as lainRpSBI,    0 as lainRpABI,    0 as lainRpASBI
from #KWH1
where Ket='NILAI ONDERDIL'
union all

select KodeUnit,KRBB,Nomor,
0 as kwhBI,       0 as kwhSBI,       0 as kwhABI,       0 as kwhASBI,
0 as jamBI,       0 as jamSBI,       0 as jamABI,       0 as jamASBI,
0 as SolarBI,     0 as SolarSBI,     0 as SolarABI,     0 as SolarASBI,
0 as PremiumBI,   0 as PremiumSBI,   0 as PremiumABI,   0 as PremiumASBI,
0 as PelumasBI,   0 as PelumasSBI,   0 as PelumasABI,   0 as PelumasASBI,
0 as GajiBI,      0 as GajiSBI,      0 as GajiABI,      0 as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
0 as bbmRpBI,     0 as bbmRpSBI,     0 as bbmRpABI,     0 as bbmRpASBI,
0 as pelumasRpBI, 0 as pelumasRpSBI, 0 as pelumasRpABI, 0 as pelumasRpASBI,
0 as onderdilRpBI,0 as onderdilRpSBI,0 as onderdilRpABI,0 as onderdilRpASBI,
BI as reparasiRpBI,SBI as reparasiRpSBI,ABI as reparasiRpABI,ASBI as reparasiRpASBI,
0 as lainRpBI,    0 as lainRpSBI,    0 as lainRpABI,    0 as lainRpASBI
from #KWH1
where Ket='NILAI PERBAIKAN'
union all

select KodeUnit,KRBB,Nomor,
0 as kwhBI,       0 as kwhSBI,       0 as kwhABI,       0 as kwhASBI,
0 as jamBI,       0 as jamSBI,       0 as jamABI,       0 as jamASBI,
0 as SolarBI,     0 as SolarSBI,     0 as SolarABI,     0 as SolarASBI,
0 as PremiumBI,   0 as PremiumSBI,   0 as PremiumABI,   0 as PremiumASBI,
0 as PelumasBI,   0 as PelumasSBI,   0 as PelumasABI,   0 as PelumasASBI,
0 as GajiBI,      0 as GajiSBI,      0 as GajiABI,      0 as GajiASBI,
0 as umBI,        0 as umSBI,        0 as umABI,        0 as umASBI,
0 as bbmRpBI,     0 as bbmRpSBI,     0 as bbmRpABI,     0 as bbmRpASBI,
0 as pelumasRpBI, 0 as pelumasRpSBI, 0 as pelumasRpABI, 0 as pelumasRpASBI,
0 as onderdilRpBI,0 as onderdilRpSBI,0 as onderdilRpABI,0 as onderdilRpASBI,
0 as reparasiRpBI,0 as reparasiRpSBI,0 as reparasiRpABI,0 as reparasiRpASBI,
BI as lainRpBI,    SBI as lainRpSBI,    ABI as lainRpABI,    ASBI as lainRpASBI
from #KWH1
where Ket='NILAI LAIN2/PLN'

select 'Kebun/Unit : '+b.NamaKebun as nmKebun,a.KRBB,a.Nomor,c.Uraian as Uraian,c.Tahun,
SUM(a.kwhBI)        as kwhBI,            
SUM(a.jamBI)        as jamBI,          
SUM(a.SolarBI)      as SolarBI,        
SUM(a.PremiumBI)    as PremiumBI,     
SUM(a.PelumasBI)    as PelumasBI,   
SUM(a.GajiBI)       as GajiBI,      
SUM(a.umBI)         as umBI,         
SUM(a.bbmRpBI)      as bbmRpBI,     
SUM(a.pelumasRpBI)  as pelumasRpBI,
SUM(a.onderdilRpBI) as onderRpBI,   
SUM(a.reparasiRpBI) as reparasiRpBI,
SUM(a.lainRpBI)     as lainRpBI,   
SUM(a.GajiBI  +a.umBI  +a.bbmRpBI  +a.pelumasRpBI  +a.onderdilRpBI  +a.reparasiRpBI  +a.lainRpBI)   as jmlBI

from #KWH2 a
inner join Ref_Kebun b on a.KodeUnit=b.KodeKebun
inner join Ref_Netral c on a.Nomor=c.Nomor and a.KodeUnit = c.KodeUnit
--WHERE A.KRBB='255'
group by b.NamaKebun,a.KRBB,a.Nomor,c.Uraian,c.Tahun
set nocount off
end

--set dateformat dmy exec EAPcr413EvalETL '01-04-2018'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[EAPEVALTEKPOL]
@tanggal datetime,
@krbb varchar(3)
 
as
set dateformat dmy
Begin
  SET NOCOUNT ON;

declare @AwalTahun datetime
declare @TglAkhir datetime
set @TglAkhir=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @AwalTahun='01-01-'+cast(year(@tanggal) as varchar(4))

--drop table #t1
declare @bulan varchar (50)

 if MONTH(@tanggal) < 10
      set @bulan = '0'+CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal) as varchar(4))
    else
      set @bulan=CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal)as varchar(4))

--ANGGARAN EAP
select kodeunit,norek,nomor,sum(jmlfisik) as jmlfisikBI,sum(nilai) as nilaiBI,sum(jmlfisik) as jmlfisikSBI,sum(nilai) as nilaiSBI
into #xEAP 
from eap where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kdtrans='EAPABI' and substring(norek,1,3)=@krbb group by kodeunit, norek,nomor
union all
select kodeunit,norek,nomor,0 as jmlfisikBI,0 as nilaiBI,sum(jmlfisik) as jmlfisikSBI,sum(nilai) as nilaiSBI
from eap where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kdtrans='EAPASBL' and substring(norek,1,3)=@krbb group by kodeunit,norek,nomor

select kodeunit,norek,nomor,sum(jmlfisikBI) as jmlfisikBI,sum(jmlfisikSBI) as jmlfisikSBI,sum(nilaiBI) as nilaiBI,sum(nilaiSBI) as nilaiSBI 
into #EAP
from #xEAP group by kodeunit, norek,nomor


--select a.* from #EAP a where norek='201030000'

-------------------END OF ANGGARAN EAP

select kodeunit,norek,nomor,
cast(0 as float) as jmlKmBI,cast(0 as float) as qtySolarBI,cast(0 as float) as qtyPremiumBI,cast(0 as float) as BBMRpBI,cast(0 as float) as GajiRpBI,cast(0 as float) as UangSakuRpBI,cast(0 as float) as qtyPelumasBI,cast(0 as float) as PelumasRpBI,cast(0 as float) as BanRpBI,cast(0 as float) as OnderdilRpBI,cast(0 as float) as ReparasiRpBI,cast(0 as float) as SewaRpBI,cast(0 as float) as Lain2RpBI,
cast(0 as float) as jmlKmSBI,cast(0 as float) as qtySolarSBI,cast(0 as float) as qtyPremiumSBI,cast(0 as float) as BBMRpSBI,cast(0 as float) as GajiRpSBI,cast(0 as float) as UangSakuRpSBI,cast(0 as float) as qtyPelumasSBI,cast(0 as float) as PelumasRpSBI,cast(0 as float) as BanRpSBI,cast(0 as float) as OnderdilRpSBI,cast(0 as float) as ReparasiRpSBI,cast(0 as float) as SewaRpSBI,cast(0 as float) as Lain2RpSBI,
cast(0 as float) as jmlKmABI,cast(0 as float) as qtySolarABI,cast(0 as float) as qtyPremiumABI,cast(0 as float) as BBMRpABI,cast(0 as float) as GajiRpABI,cast(0 as float) as UangSakuRpABI,cast(0 as float) as qtyPelumasABI,cast(0 as float) as PelumasRpABI,cast(0 as float) as BanRpABI,cast(0 as float) as OnderdilRpABI,cast(0 as float) as ReparasiRpABI,cast(0 as float) as SewaRpABI,cast(0 as float) as Lain2RpABI,
cast(0 as float) as jmlKmASBI,cast(0 as float) as qtySolarASBI,cast(0 as float) as qtyPremiumASBI,cast(0 as float) as BBMRpASBI,cast(0 as float) as GajiRpASBI,cast(0 as float) as UangSakuRpASBI,cast(0 as float) as qtyPelumasASBI,cast(0 as float) as PelumasRpASBI,cast(0 as float) as BanRpASBI,cast(0 as float) as OnderdilRpASBI,cast(0 as float) as ReparasiRpASBI,cast(0 as float) as SewaRpASBI,cast(0 as float) as Lain2RpASBI
INTO #t1
from ref_netral
where status=1 and norek=@krbb  --and KodeUnit='23'
union all
--drop table #t1
--select * from #t1
----REALISASI KILOMETER BULAN INI
select kodeunit,norek,nomor,
sum(jmlkm) as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
sum(jmlkm) as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP
where krbb=@krbb and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and  kdtrans='eapbi' --and kodeunit='23'
group by kodeunit,norek,nomor
union all

----REALISASI s.d KILOMETER BULAN INI

select distinct kodeunit,krbb,nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
jmlkm as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP 
where krbb=@krbb and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and kdtrans='EAPSBL' and jmlkm>0 --and kodeunit='23'
union all


----REALISASI PEMAKAIAN FISIK DAN BIAYA PREMIUM BULAN INI
select a.kodeunit,substring(a.norek,1,3) as norek,a.netral as nomor,
0 as jmlKmBI,0 as qtySolarBI,sum(jml_fisik)as qtyPremiumBI,sum(debet-kredit) as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,sum(jml_fisik) as qtyPremiumSBI,sum(debet-kredit) as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu a
inner join ref_netral b on a.netral=b.nomor and @krbb=b.norek and a.KodeUnit= b.KodeUnit
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.netral<>'' and  b.bbm='01' and a.norek=@krbb+'030000'
group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.netral

union all

----REALISASI PEMAKAIAN FISIK DAN BIAYA SOLAR BULAN INI

select a.kodeunit,substring(a.norek,1,3) as norek,a.netral as nomor,
0 as jmlKmBI,sum(jml_fisik) as qtySolarBI,0 as qtyPremiumBI,sum(debet-kredit) as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,sum(jml_fisik) as qtySolarSBI,0 as qtyPremiumSBI,sum(debet-kredit) as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu a
inner join ref_netral b on a.netral=b.nomor and @krbb=b.norek and a.KodeUnit= b.KodeUnit
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.netral<>'' and  b.bbm='02' and a.norek=@krbb+'030000'
group by a.kodeunit,substring(a.norek,1,3),a.netral
union all

----REALISASI PEMAKAIAN FISIK DAN BIAYA PELUMAS BULAN INI
select  kodeunit,substring(norek,1,3) as krbb,netral as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,sum(jml_fisik) as qtyPelumasBI,sum(debet-kredit) as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,sum(jml_fisik) as qtyPelumasSBI,sum(debet-kredit) as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu 
where substring(norek,1,3)=@krbb and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and netral<>'' and  norek=@krbb+'040000'
group by kodeunit,substring(norek,1,3),netral
union all

select  kodeunit,substring(norek,1,3) as krbb,netral as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,sum(debet-kredit) as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,sum(debet-kredit) as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu 
where substring(norek,1,3)=@krbb and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and netral<>'' and  substring(norek,1,5) in (@krbb+'00',@krbb+'01',@krbb+'19')
group by kodeunit,substring(norek,1,3),netral
union all

--REALISASI UANG MAKAN/SAKU/PENGINAPAN BULAN INI
select  kodeunit,substring(norek,1,3) as krbb,netral as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,sum(debet-kredit) as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,sum(debet-kredit) as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu 
Where substring(norek,1,3)=@krbb and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and netral<>'' and  norek in (@krbb+'020000')
group by kodeunit,substring(norek,1,3),netral
union all


--REALISASI BIAYA SEWA BULAN INI
select  kodeunit,substring(norek,1,3) as krbb,netral as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,sum(debet-kredit) as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,sum(debet-kredit) as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu 
where substring(norek,1,3)=@krbb and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and netral<>'' and  norek in (@krbb+'100000')
group by kodeunit,substring(norek,1,3),netral
UNION ALL
----REALISASI BIAYA BAN BULAN INI
select  kodeunit,substring(norek,1,3) as krbb,netral as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,sum(debet-kredit) as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,sum(debet-kredit) as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu a
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.netral<>'' and  a.norek in (@krbb+'050000')
group by kodeunit,substring(norek,1,3),netral
union all

----REALISASI BIAYA ONDERDIL BULAN INI
select  kodeunit,substring(norek,1,3) as krbb,netral as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,sum(debet-kredit) as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,sum(debet-kredit) as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu 
where substring(norek,1,3)=@krbb and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and netral<>'' and  norek in (@krbb+'060000')
group by kodeunit,substring(norek,1,3),netral
union all

----REALISASI BIAYA REPARASI BULAN INI
select  kodeunit,substring(norek,1,3) as krbb,netral as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,sum(debet-kredit) as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,sum(debet-kredit) as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu 
where substring(norek,1,3)=@krbb and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and netral<>'' and  norek in (@krbb+'070000')
group by kodeunit,substring(norek,1,3),netral
union all


----REALISASI BIAYA LAIN2 BULAN INI
select  kodeunit,substring(norek,1,3) as krbb,netral as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,sum(debet-kredit) as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,sum(debet-kredit) as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from kartu 
where substring(norek,1,3)=@krbb and month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and netral<>'' and  norek in (@krbb+'080000',@krbb+'090000')
group by kodeunit,substring(norek,1,3),netral
union all
-----------------------------------------END OF REALISASI BULAN INI


----REALISASI S/D BULAN LALU
----REALISASI Premium S/D BULAN LALU
select DISTINCT a.kodeunit,a.krbb,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,jmlfisik as qtyPremiumSBI,nilai as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.KodeUnit= b.KodeUnit
--where b.bbm='01' and substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'030000') and a.kdtrans='EAPSBL'
where b.bbm='01' and a.krbb=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'030000') and a.kdtrans='EAPSBL'
--group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all

----------REALISASI Solar S/D BULAN LALU
select DISTINCT a.kodeunit,a.krbb,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,jmlfisik as qtySolarSBI,0 as qtyPremiumSBI,nilai as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.KodeUnit= b.KodeUnit
--where b.bbm='01' and substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'030000') and a.kdtrans='EAPSBL'
where b.bbm='02' and substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'030000') and a.kdtrans='EAPSBL' 
--group by a.kodeunit,substring(a.norek,1,3)

union all
----REALISASI PELUMAS S/D BULAN LALU
select DISTINCT a.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,jmlfisik as qtyPelumasSBI,nilai as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.KodeUnit= b.KodeUnit
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'040000') and a.kdtrans='EAPSBL'
--group by a.kodeunit,substring(a.norek,1,3),a.nomor
union all
--REALISASI GAJI/UPAH S/D BULAN LALU
select distinct a.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,nilai as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.KodeUnit= b.KodeUnit
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and substring(a.norek,1,5) in (@krbb+'00',@krbb+'01',@krbb+'19') and a.kdtrans='EAPSBL'
--group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all

--REALISASI UANG MAKAN/SAKU/PENGINAPAN S/D BULAN LALU
select a.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,nilai as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.KodeUnit= b.KodeUnit
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'020000') and a.kdtrans='EAPSBL'
--group by a.kodeunit,substring(a.norek,1,3),a.nomor
union all

----REALISASI BAN S/D BULAN LALU
select DISTINCT a.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,nilai as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.KodeUnit= b.KodeUnit
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'050000') and a.kdtrans='EAPSBL'
--group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all
----REALISASI ONDERDIL S/D BULAN LALU
select DISTINCT a.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,nilai as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.KodeUnit= b.KodeUnit
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'060000') and a.kdtrans='EAPSBL'
--group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all
----REALISASI REPARASI S/D BULAN LALU
select DISTINCT a.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,Nilai as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
 from EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.KodeUnit= b.KodeUnit
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'070000') and a.kdtrans='EAPSBL'
--group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all
--REALISASI SEWA S/D BULAN LALU
select a.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,nilai as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.KodeUnit= b.KodeUnit
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'100000') and a.kdtrans='EAPSBL'
--group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all

------REALISASI LAIN2 S/D BULAN LALU
select a.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,nilai as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.KodeUnit= b.KodeUnit
where substring(a.norek,1,3)=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and a.norek in (@krbb+'080000',@krbb+'090000') and a.kdtrans='EAPSBL'
--group by a.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun

union all
-----------------------------------------END OF REALISASI S/D BULAN LALU

----ANGGARAN KILOMETER BULAN INI
select DISTINCT a.kodeunit,b.norek,a.nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
jmlkm as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
jmlkm as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.kodeunit=b.KodeUnit
where b.norek=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and  kdtrans='EAPABI'
--GROUP BY A.kodeunit,B.Norek,A.nomor
union all

----ANGGARAN KILOMETER S/D BULAN LALU
select distinct a.kodeunit,b.norek,a.nomor ,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
jmlkm as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.kodeunit=b.KodeUnit
where b.norek=@krbb and month(a.tanggal)=month(@tanggal) and year(a.tanggal)=year(@tanggal) and  kdtrans='EAPASBL'
union all

----ANGGARAN FISIK DAN BIAYA PREMIUM BULAN LALU DAN S/D BULAN INI XKOREKSI
select DISTINCT b.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,sum(a.jmlfisikBI) as qtyPremiumABI,sum(a.nilaiBI) as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,sum(a.jmlfisikSBI) as qtyPremiumASBI,sum(a.nilaiSBI) as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.kodeunit=b.KodeUnit
where substring(a.norek,1,3)=@krbb and  b.bbm='01' and a.norek=@krbb+'030000'
group by b.kodeunit,a.norek,a.nomor
union all

----ANGGARAN FISIK DAN BIAYA SOLAR BULAN LALU DAN S/D BULAN INI
select DISTINCT b.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,sum(jmlfisikBI) as qtySolarABI,0 as qtyPremiumABI,sum(nilaiBI) as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,sum(jmlfisikSBI) as qtySolarASBI,0 as qtyPremiumASBI,sum(nilaiSBI) as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.kodeunit=b.KodeUnit
where substring(a.norek,1,3)=@krbb and  b.bbm='02' and a.norek=@krbb+'030000'
group by b.kodeunit,substring(a.norek,1,3),a.nomor
union all

----ANGGARAN FISIK DAN BIAYA PELUMAS BULAN LALU DAN S/D BULAN INI
select b.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,sum(jmlfisikBI) as qtyPelumasABI,sum(nilaiBI) as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,sum(jmlfisikSBI) as qtyPelumasASBI,sum(nilaiSBI) as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek  and a.kodeunit=b.KodeUnit
where substring(a.norek,1,3)=@krbb and  a.norek=@krbb+'040000'
group by b.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all

--ANGGARAN GAJI/UPAH BULAN LALU DAN S/D BULAN INI
select b.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,sum(nilaiBI) as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,sum(nilaiSBI) as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.kodeunit=b.KodeUnit
where substring(a.norek,1,3)=@krbb and  substring(a.norek,1,5) in (@krbb+'00',@krbb+'01',@krbb+'19')
group by b.kodeunit,substring(a.norek,1,3),a.nomor
union all

--ANGGARAN UANG MAKAN BULAN LALU DAN S/D BULAN INI
select b.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,sum(nilaiBI) as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,sum(nilaiSBI) as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.kodeunit=b.KodeUnit
where substring(a.norek,1,3)=@krbb and  a.norek in (@krbb+'020000')
group by b.kodeunit,substring(a.norek,1,3),a.nomor
union all


----ANGGARAN BAN BULAN LALU DAN S/D BULAN INI
select b.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,sum(nilaiBI) as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,sum(nilaiSBI) as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.KodeUnit= b.KodeUnit
where substring(a.norek,1,3)=@krbb and  a.norek in (@krbb+'050000') 
group by b.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor,b.uraian,b.tahun
union all

----ANGGARAN ONDERDIL BULAN LALU DAN S/D BULAN INI
select b.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,sum(nilaiBI) as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,sum(nilaiSBI) as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.kodeunit=b.KodeUnit
where substring(a.norek,1,3)=@krbb and  a.norek in (@krbb+'060000') 
group by b.kodeunit,substring(a.norek,1,3),b.pemilik,a.nomor
union all

----ANGGARAN REPARASI BULAN LALU DAN S/D BULAN INI
select b.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,sum(nilaiBI) as ReparasiRpABI,0 as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,sum(nilaiSBI) as ReparasiRpASBI,0 as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.kodeunit=b.KodeUnit
where substring(a.norek,1,3)=@krbb and  a.norek in (@krbb+'070000')
group by b.kodeunit,substring(a.norek,1,3),a.nomor
union all
--ANGGARAN SEWA BULAN LALU DAN S/D BULAN INI
select b.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,sum(nilaiBI) as SewaRpABI,0 as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,sum(nilaiSBI) as SewaRpASBI,0 as Lain2RpASBI
from #EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.kodeunit=b.KodeUnit
where substring(a.norek,1,3)=@krbb and  a.norek in (@krbb+'100000')
group by b.kodeunit,substring(a.norek,1,3),a.nomor

union all
----ANGGARAN LAIN2 BULAN LALU DAN S/D BULAN INI
select b.kodeunit,substring(a.norek,1,3) as norek,a.nomor as nomor,
0 as jmlKmBI,0 as qtySolarBI,0 as qtyPremiumBI,0 as BBMRpBI,0 as GajiRpBI,0 as UangSakuRpBI,0 as qtyPelumasBI,0 as PelumasRpBI,0 as BanRpBI,0 as OnderdilRpBI,0 as ReparasiRpBI,0 as SewaRpBI,0 as Lain2RpBI,
0 as jmlKmSBI,0 as qtySolarSBI,0 as qtyPremiumSBI,0 as BBMRpSBI,0 as GajiRpSBI,0 as UangSakuRpSBI,0 as qtyPelumasSBI,0 as PelumasRpSBI,0 as BanRpSBI,0 as OnderdilRpSBI,0 as ReparasiRpSBI,0 as SewaRpSBI,0 as Lain2RpSBI,
0 as jmlKmABI,0 as qtySolarABI,0 as qtyPremiumABI,0 as BBMRpABI,0 as GajiRpABI,0 as UangSakuRpABI,0 as qtyPelumasABI,0 as PelumasRpABI,0 as BanRpABI,0 as OnderdilRpABI,0 as ReparasiRpABI,0 as SewaRpABI,sum(nilaiBI) as Lain2RpABI,
0 as jmlKmASBI,0 as qtySolarASBI,0 as qtyPremiumASBI,0 as BBMRpASBI,0 as GajiRpASBI,0 as UangSakuRpASBI,0 as qtyPelumasASBI,0 as PelumasRpASBI,0 as BanRpASBI,0 as OnderdilRpASBI,0 as ReparasiRpASBI,0 as SewaRpASBI,sum(nilaiSBI) as Lain2RpASBI
from #EAP a
inner join ref_netral b on a.nomor=b.nomor and @krbb=b.norek and a.kodeunit=b.KodeUnit
where substring(a.norek,1,3)=@krbb and  a.norek in (@krbb+'080000',@krbb+'090000')
group by b.kodeunit,substring(a.norek,1,3),a.nomor



select @bulan as Bulan,a.kodeunit, a.Nomor,c.Tahun,c.Uraian,
sum(a.jmlKmBI) as jmlKmBI,sum(a.qtySolarBI) as qtySolarBI,sum(a.qtyPremiumBI) as qtyPremiumBI,sum(a.BBMRpBI) as BBMRpBI,sum(a.GajiRpBI) as GajiRpBI,sum(a.UangSakuRpBI) as UangSakuRpBI,sum(a.qtyPelumasBI) as qtyPelumasBI,sum(a.PelumasRpBI) as PelumasRpBI,sum(a.BanRpBI) as BanRpBI,sum(a.OnderdilRpBI) as OnderdilRpBI,sum(a.ReparasiRpBI) as ReparasiRpBI,sum(a.SewaRpBI) as SewaRpBI,sum(a.Lain2RpBI) as Lain2RpBI,sum(a.jmlKmSBI) as jmlKmSBI,sum(a.qtySolarSBI) as qtySolarSBI,sum(a.qtyPremiumSBI) as qtyPremiumSBI,sum(a.BBMRpSBI) as BBMRpSBI,sum(a.GajiRpSBI) as GajiRpSBI,sum(a.UangSakuRpSBI) as UangSakuRpSBI,sum(a.qtyPelumasSBI) as qtyPelumasSBI,sum(a.PelumasRpSBI) as PelumasRpSBI,sum(a.BanRpSBI) as BanRpSBI,sum(a.OnderdilRpSBI) as OnderdilRpSBI,sum(a.ReparasiRpSBI) as ReparasiRpSBI,sum(a.SewaRpSBI) as SewaRpSBI,sum(a.Lain2RpSBI) as Lain2RpSBI,
sum(a.jmlKmABI) as jmlKmABI,sum(a.qtySolarABI) as qtySolarABI,sum(a.qtyPremiumABI) as qtyPremiumABI,sum(a.BBMRpABI) as BBMRpABI,sum(a.GajiRpABI) as GajiRpABI,sum(a.UangSakuRpABI) as UangSakuRpABI,sum(a.qtyPelumasABI) as qtyPelumasABI,sum(a.PelumasRpABI) as PelumasRpABI,sum(a.BanRpABI) as BanRpABI,sum(a.OnderdilRpABI) as OnderdilRpABI,sum(a.ReparasiRpABI) as ReparasiRpABI,sum(a.SewaRpABI) as SewaRpABI,sum(a.Lain2RpABI) as Lain2RpABI, sum(a.jmlKmASBI) as jmlKmASBI,sum(a.qtySolarASBI) as qtySolarASBI,sum(a.qtyPremiumASBI) as qtyPremiumASBI,sum(a.BBMRpASBI) as BBMRpASBI,sum(a.GajiRpASBI) as GajiRpASBI,sum(a.UangSakuRpASBI) as UangSakuRpASBI,sum(a.qtyPelumasASBI) as qtyPelumasASBI,sum(a.PelumasRpASBI) as PelumasRpASBI,sum(a.BanRpASBI) as BanRpASBI,sum(a.OnderdilRpASBI) as OnderdilRpASBI,sum(a.ReparasiRpASBI) as ReparasiRpASBI,sum(a.SewaRpASBI) as SewaRpASBI,sum(a.Lain2RpASBI) as Lain2RpASBI
from #t1 a
inner join ref_kebun b on a.kodeunit=b.kodekebun
inner join ref_netral c on a.nomor=c.nomor and @krbb=c.norek and a.kodeunit=c.KodeUnit
--where a.KodeUnit='68'

--inner join #pemilik c on a.pemilik=c.pemilik
--
group by a.KodeUnit,A.Nomor,c.Tahun,c.Uraian
order by a.KodeUnit asc
set nocount off
END
--select 'Kebun/Unit : '+b.k as namakebun,a.norek,
--sum(a.jmlKmBI) as jmlKmBI,sum(a.qtySolarBI) as qtySolarBI,sum(a.qtyPremiumBI) as qtyPremiumBI,sum(a.BBMRpBI) as BBMRpBI,sum(a.GajiRpBI) as GajiRpBI,sum(a.UangSakuRpBI) as UangSakuRpBI,sum(a.qtyPelumasBI) as qtyPelumasBI,sum(a.PelumasRpBI) as PelumasRpBI,sum(a.BanRpBI) as BanRpBI,sum(a.OnderdilRpBI) as OnderdilRpBI,sum(a.ReparasiRpBI) as ReparasiRpBI,sum(a.SewaRpBI) as SewaRpBI,sum(a.Lain2RpBI) as Lain2RpBI,sum(a.BBMRpBI+a.GajiRpBI+a.UangSakuRpBI+a.PelumasRpBI+a.BanRpBI+a.OnderdilRpBI+a.ReparasiRpBI+a.SewaRpBI+a.Lain2RpBI) as JumlahRPBI,
--sum(a.jmlKmSBI) as jmlKmSBI,sum(a.qtySolarSBI) as qtySolarSBI,sum(a.qtyPremiumSBI) as qtyPremiumSBI,sum(a.BBMRpSBI) as BBMRpSBI,sum(a.GajiRpSBI) as GajiRpSBI,sum(a.UangSakuRpSBI) as UangSakuRpSBI,sum(a.qtyPelumasSBI) as qtyPelumasSBI,sum(a.PelumasRpSBI) as PelumasRpSBI,sum(a.BanRpSBI) as BanRpSBI,sum(a.OnderdilRpSBI) as OnderdilRpSBI,sum(a.ReparasiRpSBI) as ReparasiRpSBI,sum(a.SewaRpSBI) as SewaRpSBI,sum(a.Lain2RpSBI) as Lain2RpSBI,sum(a.BBMRpSBI+a.GajiRpSBI+a.UangSakuRpSBI+a.PelumasRpSBI+a.BanRpSBI+a.OnderdilRpSBI+a.ReparasiRpSBI+a.SewaRpSBI+a.Lain2RpSBI) as JumlahRPSBI,
--sum(a.jmlKmABI) as jmlKmABI,sum(a.qtySolarABI) as qtySolarABI,sum(a.qtyPremiumABI) as qtyPremiumABI,sum(a.BBMRpABI) as BBMRpABI,sum(a.GajiRpABI) as GajiRpABI,sum(a.UangSakuRpABI) as UangSakuRpABI,sum(a.qtyPelumasABI) as qtyPelumasABI,sum(a.PelumasRpABI) as PelumasRpABI,sum(a.BanRpABI) as BanRpABI,sum(a.OnderdilRpABI) as OnderdilRpABI,sum(a.ReparasiRpABI) as ReparasiRpABI,sum(a.SewaRpABI) as SewaRpABI,sum(a.Lain2RpABI) as Lain2RpABI,sum(a.BBMRpABI+a.GajiRpABI+a.UangSakuRpABI+a.PelumasRpABI+a.BanRpABI+a.OnderdilRpABI+a.ReparasiRpABI+a.SewaRpABI+a.Lain2RpABI) as JumlahRPABI,
--sum(a.jmlKmASBI) as jmlKmASBI,sum(a.qtySolarASBI) as qtySolarASBI,sum(a.qtyPremiumASBI) as qtyPremiumASBI,sum(a.BBMRpASBI) as BBMRpASBI,sum(a.GajiRpASBI) as GajiRpASBI,sum(a.UangSakuRpASBI) as UangSakuRpASBI,sum(a.qtyPelumasASBI) as qtyPelumasASBI,sum(a.PelumasRpASBI) as PelumasRpASBI,sum(a.BanRpASBI) as BanRpASBI,sum(a.OnderdilRpASBI) as OnderdilRpASBI,sum(a.ReparasiRpASBI) as ReparasiRpASBI,sum(a.SewaRpASBI) as SewaRpASBI,sum(a.Lain2RpASBI) as Lain2RpASBI,sum(a.BBMRpASBI+a.GajiRpASBI+a.UangSakuRpASBI+a.PelumasRpASBI+a.BanRpASBI+a.OnderdilRpASBI+a.ReparasiRpASBI+a.SewaRpASBI+a.Lain2RpASBI) as JumlahRPASBI
--from #t1 a
--inner join ref_kebun b on a.kodeunit=b.kodekebun
--inner join #pemilik c on a.pemilik=c.pemilik
--group by b.namakebun,a.norek


--set dateformat dmy exec EAPevaltekpol '01-02-2019','200'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[EEPJeungFauzy]
as
select b.GOL+'/'+b.MK as GolMK,c.NM_PEND,a.* from Ref_Dik a 
inner join SPDK_KBN_MASTER_REF..Ref_KomponenGaji1 b on a.GOL+a.MK=b.kdGOL+b.MK
inner join SPDK_KBN_MASTER_REF..Ref_Pendidikan c on a.KD_PEND=c.KD_PEND
where MONTH(a.tanggal)=5 and YEAR(a.tanggal)=2016 and KD_KBN='13'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[EvalGaji_SDM]
@tanggal datetime
as
set dateformat dmy
declare @Periode as varchar(50)

if MONTH(@tanggal)<10
set @Periode=cast(YEAR(@tanggal) as varchar(4))+'0'+cast(MONTH(@tanggal) as varchar(2))
else
set @Periode=cast(YEAR(@tanggal) as varchar(4))+cast(MONTH(@tanggal) as varchar(2))


select GOLBARU,GOL,KDGOL 
into #Komponen 
from SPDK_KBN_MASTER_REF..Ref_KomponenGaji1
union all
select 'KLM','KLM','99'

select REG,KD_KBN,GOL+MK as Gol into #DIK from Ref_Dik where MONTH(TANGGAL)=MONTH(@tanggal) and YEAR(TANGGAL)=YEAR(@tanggal)
union all
select REG,KD_KBN,'KLM' as Gol from Ref_DikKLM where MONTH(TANGGAL)=MONTH(@tanggal) and YEAR(TANGGAL)=YEAR(@tanggal)

select * into #Gaji from GajiMaster where MONTH(TANGGAL)=MONTH(@tanggal) and YEAR(TANGGAL)=YEAR(@tanggal)


select a.kdunit,a.register,c.KDGOL,c.GOL,a.GajiPokok,a.UpahHarian+a.UpahBorong+a.UpahRecovery as Upah,a.TTetap,a.TKhusus,a.TSansos,a.TStruktural,a.TJabatan,a.TJamSostek,a.TDapenbun,a.TPPIP,a.TKomunikasi,a.TPeralihan,a.TTransportasi,a.TPPH21,a.Rapel,a.Premi,a.TBPJS,a.TBPJSKes 
into #t1
from #Gaji a 
inner join #DIK b on a.register=b.REG
inner join #Komponen c on b.Gol=c.GOLBARU
where MONTH(a.tanggal)=MONTH(@tanggal) and  YEAR(a.tanggal)=YEAR(@tanggal) order by tanggal

select kdunit,register,KDGOL,GOL,GajiPokok,Upah,TTetap+TKhusus+TSansos+TStruktural+TJabatan+TJamSostek+TDapenbun+TPPIP+TKomunikasi+TPeralihan+TTransportasi+TPPH21+Rapel+Premi+TBPJS+TBPJSKes as Tunjangan,
GajiPokok+Upah+TTetap+TKhusus+TSansos+TStruktural+TJabatan+TJamSostek+TDapenbun+TPPIP+TKomunikasi+TPeralihan+TTransportasi+TPPH21+Rapel+Premi+TBPJS+TBPJSKes as Jumlah 
into #t2
from #t1

select KDGOL,@Periode as Periode,GOL,SUM(Jumlah) as Jumlah from #t2 group by KDGOL,gol order by KDGOL

--set dateformat dmy exec EvalGaji_SDM '01-12-2018'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Procedure [dbo].[EvalMonPersTekpol]
@tanggal datetime
AS
set dateformat dmy
begin
set nocount ON;
 declare @bulan varchar (50)
    
    if MONTH(@tanggal) < 10
      set @bulan = '0'+CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal) as varchar(4))
    else
      set @bulan=CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal)as varchar(4))

--Saldo Awal---
select kodeunit,kodebarang,'Bahan Kimia Pengolahan' as Kelompok, qty as saldoawal,cast(0 as float)as penerimaan,cast(0 as float)as pengeluaran, cast(0 as float)as koreksi into #t1 from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and noinput='saldo awal'  and SUBSTRING(kodebarang,2,2)in ('01')  
union all
select kodeunit,kodebarang,'BBM' as Kelompok, qty as saldoawal,cast(0 as float)as penerimaan,cast(0 as float)as pengeluaran, cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and noinput='saldo awal'  and SUBSTRING(kodebarang,2,4)in ('0301')  
union all
select kodeunit,kodebarang,'Pelumas' as Kelompok, qty as saldoawal,cast(0 as float)as penerimaan,cast(0 as float)as pengeluaran, cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and noinput='saldo awal'  and SUBSTRING(kodebarang,2,4)in ('0302') 
union all
select kodeunit,kodebarang,'Ban-Ban Mesin Pabrik' as Kelompok, qty as saldoawal,cast(0 as float)as penerimaan,cast(0 as float)as pengeluaran, cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and noinput='saldo awal'  and SUBSTRING(kodebarang,2,2)in ('04')
union all
select kodeunit,kodebarang,'Bahan Bangunan' as Kelompok, qty as saldoawal,cast(0 as float)as penerimaan,cast(0 as float)as pengeluaran, cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and noinput='saldo awal'  and SUBSTRING(kodebarang,2,2)in ('05')
union all
select kodeunit,kodebarang,'Alat-Alat Listrik' as Kelompok, qty as saldoawal,cast(0 as float)as penerimaan,cast(0 as float)as pengeluaran, cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and noinput='saldo awal'  and SUBSTRING(kodebarang,2,2)in ('06')
union all
select kodeunit,kodebarang,'Alat-Alat Laboratorium' as Kelompok, qty as saldoawal,cast(0 as float)as penerimaan,cast(0 as float)as pengeluaran, cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and noinput='saldo awal'  and SUBSTRING(kodebarang,2,2)in ('08') 
union all
select kodeunit,kodebarang,'Alat-Alat Pengolahan' as Kelompok, qty as saldoawal,cast(0 as float)as penerimaan,cast(0 as float)as pengeluaran, cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and noinput='saldo awal'  and SUBSTRING(kodebarang,2,2)in ('09') 
union all
select kodeunit,kodebarang,'Alat-Alat Bengkel' as Kelompok, qty as saldoawal,cast(0 as float)as penerimaan,cast(0 as float)as pengeluaran, cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and noinput='saldo awal'  and SUBSTRING(kodebarang,2,2)in ('11') 
union all
select kodeunit,kodebarang,'Alat-Alat Pengepakan' as Kelompok, qty as saldoawal,cast(0 as float)as penerimaan,cast(0 as float)as pengeluaran, cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and noinput='saldo awal'  and SUBSTRING(kodebarang,2,2)in ('12')
union all
select kodeunit,kodebarang,'Suku Cadang Mesin Pabrik' as Kelompok, qty as saldoawal,cast(0 as float)as penerimaan,cast(0 as float)as pengeluaran, cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and noinput='saldo awal'  and SUBSTRING(kodebarang,2,2)in ('14')
union all
select kodeunit,kodebarang,'Suku Cadang Kendaraan' as Kelompok, qty as saldoawal,cast(0 as float)as penerimaan,cast(0 as float)as pengeluaran, cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and noinput='saldo awal'  and SUBSTRING(kodebarang,2,2)in ('15')
union all

--A53---
select kodeunit,kodebarang,'Bahan Kimia Pengolahan' as Kelompok,  0 as saldoawal,qty as penerimaan,cast(0 as float)as pengeluaran,cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='A53'  and SUBSTRING(kodebarang,2,2)in ('01')
union all
select kodeunit,kodebarang,'BBM' as Kelompok,  0 as saldoawal,qty as penerimaan,cast(0 as float)as pengeluaran,cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='A53'  and SUBSTRING(kodebarang,2,4)in ('0301') 
union all
select kodeunit,kodebarang,'Pelumas' as Kelompok,  0 as saldoawal,qty as penerimaan,cast(0 as float)as pengeluaran,cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='A53'  and SUBSTRING(kodebarang,2,4)in ('0302') 
union all
select kodeunit,kodebarang,'Ban-Ban Mesin Pabrik' as Kelompok,  0 as saldoawal,qty as penerimaan,cast(0 as float)as pengeluaran,cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='A53'  and SUBSTRING(kodebarang,2,2)in ('04')
union all
select kodeunit,kodebarang,'Bahan Bangunan' as Kelompok,  0 as saldoawal,qty as penerimaan,cast(0 as float)as pengeluaran,cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='A53'  and SUBSTRING(kodebarang,2,2)in ('05')
union all
select kodeunit,kodebarang,'Alat-Alat Listrik' as Kelompok,  0 as saldoawal,qty as penerimaan,cast(0 as float)as pengeluaran,cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='A53'  and SUBSTRING(kodebarang,2,2)in ('06')
union all
select kodeunit,kodebarang,'Alat-Alat Laboratorium' as Kelompok,  0 as saldoawal,qty as penerimaan,cast(0 as float)as pengeluaran,cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='A53'  and SUBSTRING(kodebarang,2,2)in ('08')
union all
select kodeunit,kodebarang,'Alat-Alat Pengolahan' as Kelompok,  0 as saldoawal,qty as penerimaan,cast(0 as float)as pengeluaran,cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='A53'  and SUBSTRING(kodebarang,2,2)in ('09') --and kodebarang in ('00202255','00201101','00201103')
union all
select kodeunit,kodebarang,'Alat-Alat Bengkel' as Kelompok,  0 as saldoawal,qty as penerimaan,cast(0 as float)as pengeluaran,cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='A53'  and SUBSTRING(kodebarang,2,2)in ('11')
union all
select kodeunit,kodebarang,'Alat-Alat Pengepakan' as Kelompok,  0 as saldoawal,qty as penerimaan,cast(0 as float)as pengeluaran,cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='A53'  and SUBSTRING(kodebarang,2,2)in ('12')
union all
select kodeunit,kodebarang,'Suku Cadang Mesin Pabrik' as Kelompok,  0 as saldoawal,qty as penerimaan,cast(0 as float)as pengeluaran,cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='A53'  and SUBSTRING(kodebarang,2,2)in ('14')
union all
select kodeunit,kodebarang,'Suku Cadang Kendaraan' as Kelompok,  0 as saldoawal,qty as penerimaan,cast(0 as float)as pengeluaran,cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='A53'  and SUBSTRING(kodebarang,2,2)in ('15')
union all

--A58---
select kodeunit,kodebarang,'Bahan Kimia Pengolahan' as Kelompok,  0 as saldoawal,0 as penerimaan,qty as pengeluaran,cast(0 as float)as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='A58' and SUBSTRING(kodebarang,2,2)in ('01') 
union all
select kodeunit,kodebarang,'BBM' as Kelompok,  0 as saldoawal,0 as penerimaan,qty as pengeluaran,cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='A58'  and SUBSTRING(kodebarang,2,4)in ('0301')
union all
select kodeunit,kodebarang,'Pelumas' as Kelompok,  0 as saldoawal,0 as penerimaan,qty as pengeluaran,cast(0 as float)as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='A58'  and SUBSTRING(kodebarang,2,4)in ('0302')
union all
select kodeunit,kodebarang,'Ban-Ban Mesin Pabrik' as Kelompok,  0 as saldoawal,0 as penerimaan,qty as pengeluaran,cast(0 as float)as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='A58' and SUBSTRING(kodebarang,2,2)in ('04') 
union all
select kodeunit,kodebarang,'Bahan Bangunan' as Kelompok,  0 as saldoawal,0 as penerimaan,qty as pengeluaran,cast(0 as float)as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='A58' and SUBSTRING(kodebarang,2,2)in ('05') 
union all
select kodeunit,kodebarang,'Alat-Alat Listrik' as Kelompok,  0 as saldoawal,0 as penerimaan,qty as pengeluaran,cast(0 as float)as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='A58' and SUBSTRING(kodebarang,2,2)in ('06') 
union all
select kodeunit,kodebarang,'Alat-Alat Laboratorium' as Kelompok,  0 as saldoawal,0 as penerimaan,qty as pengeluaran,cast(0 as float)as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='A58' and SUBSTRING(kodebarang,2,2)in ('08') 
union all
select kodeunit,kodebarang,'Alat-Alat Pengolahan' as Kelompok,  0 as saldoawal,0 as penerimaan,qty as pengeluaran,cast(0 as float)as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='A58' and SUBSTRING(kodebarang,2,2)in ('09') 
union all
select kodeunit,kodebarang,'Alat-Alat Bengkel' as Kelompok,  0 as saldoawal,0 as penerimaan,qty as pengeluaran,cast(0 as float)as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='A58' and SUBSTRING(kodebarang,2,2)in ('11') 
union all
select kodeunit,kodebarang,'Alat-Alat Pengepakan' as Kelompok,  0 as saldoawal,0 as penerimaan,qty as pengeluaran,cast(0 as float)as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='A58' and SUBSTRING(kodebarang,2,2)in ('12') 
union all
select kodeunit,kodebarang,'Suku Cadang Mesin Pabrik' as Kelompok,  0 as saldoawal,0 as penerimaan,qty as pengeluaran,cast(0 as float)as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='A58' and SUBSTRING(kodebarang,2,2)in ('14') 
union all
select kodeunit,kodebarang,'Suku Cadang Kendaraan' as Kelompok,  0 as saldoawal,0 as penerimaan,qty as pengeluaran,cast(0 as float)as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='A58' and SUBSTRING(kodebarang,2,2)in ('15') 
union all
--- Koreksi---
select kodeunit,kodebarang,'Bahan Kimia Pengolahan' as Kelompok,  0 as saldoawal,0 as penerimaan,0 as pengeluaran,qty as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='kor' and SUBSTRING(kodebarang,2,2)in ('01') 
union all
select kodeunit,kodebarang,'BBM' as Kelompok,  0 as saldoawal,0 as penerimaan,0 as pengeluaran,qty as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='kor'  and SUBSTRING(kodebarang,2,4)in ('0301')
union all
select kodeunit,kodebarang,'Pelumas' as Kelompok,  0 as saldoawal,0 as penerimaan,0 as pengeluaran,qty as koreksi  from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(noinput,1,3)='kor'  and SUBSTRING(kodebarang,2,4)in ('0302')
union all
select kodeunit,kodebarang,'Ban-Ban Mesin Pabrik' as Kelompok,  0 as saldoawal,0 as penerimaan,0 as pengeluaran,qty as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='kor' and SUBSTRING(kodebarang,2,2)in ('04') 
union all
select kodeunit,kodebarang,'Bahan Bangunan' as Kelompok,  0 as saldoawal,0 as penerimaan,0 as pengeluaran,qty as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='kor' and SUBSTRING(kodebarang,2,2)in ('05') 
union all
select kodeunit,kodebarang,'Alat-Alat Listrik' as Kelompok,  0 as saldoawal,0 as penerimaan,0 as pengeluaran,qty as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='kor' and SUBSTRING(kodebarang,2,2)in ('06') 
union all
select kodeunit,kodebarang,'Alat-Alat Laboratorium' as Kelompok,  0 as saldoawal,0 as penerimaan,0 as pengeluaran,qty as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='kor' and SUBSTRING(kodebarang,2,2)in ('08') 
union all
select kodeunit,kodebarang,'Alat-Alat Pengolahan' as Kelompok,  0 as saldoawal,0 as penerimaan,0 as pengeluaran,qty as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='kor' and SUBSTRING(kodebarang,2,2)in ('09') 
union all
select kodeunit,kodebarang,'Alat-Alat Bengkel' as Kelompok,  0 as saldoawal,0 as penerimaan,0 as pengeluaran,qty as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='kor' and SUBSTRING(kodebarang,2,2)in ('11') 
union all
select kodeunit,kodebarang,'Alat-Alat Pengepakan' as Kelompok,  0 as saldoawal,0 as penerimaan,0 as pengeluaran,qty as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='kor' and SUBSTRING(kodebarang,2,2)in ('12') 
union all
select kodeunit,kodebarang,'Suku Cadang Mesin Pabrik' as Kelompok,  0 as saldoawal,0 as penerimaan,0 as pengeluaran,qty as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='kor' and SUBSTRING(kodebarang,2,2)in ('14') 
union all
select kodeunit,kodebarang,'Suku Cadang Kendaraan' as Kelompok,  0 as saldoawal,0 as penerimaan,0 as pengeluaran,qty as koreksi  from tup
where  month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)and SUBSTRING(noinput,1,3)='kor' and SUBSTRING(kodebarang,2,2)in ('15') 


select @bulan as bulan,'Kebun/Unit : ' + c.NamaKebun as NamaKebun,a.KodeUnit,a.KodeUnit+a.kodebarang+b.NamaBarang+a.Kelompok as LINK,a.Kelompok,a.kodebarang,b.NamaBarang,SUM(a.saldoawal) as saldoawal,SUM(a.penerimaan)as penerimaan,SUM(a.Pengeluaran)as pengeluaran, sum(a.koreksi) as koreksi ,sum(a.saldoawal+a.penerimaan-a.pengeluaran+a.koreksi) as SaldoAkhir from #t1 a
inner join SPDK_KBN_MASTER_REF .. Ref_Barang b on a.kodebarang=b.KodeBarang
inner join Ref_Kebun c on a.KodeUnit = c.KodeKebun
where   a.saldoawal <> 0 or a.penerimaan <>0 or a.pengeluaran <> 0 --a.kodebarang='00202255' 
group by c.NamaKebun,a.KodeUnit,a.kodebarang,b.NamaBarang,a.Kelompok
order by a.KodeUnit asc
 
-- set dateformat dmy exec EvalMonPersTekpol '01-12-2016'







set nocount off


END

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[File_B]
@tanggal datetime
as
set dateformat dmy 
BEGIN
SET NOCOUNT ON;

--INVESTASI TANAMAN 040,041,042

select kodeunit,kodeafd,kodebud,netral,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='D' and SUBSTRING(norek,1,3) in ('040','041','042')
union all
select kodeunit,kodeafd,kodebud,netral,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='K' and SUBSTRING(norek,1,3) in ('040','041','042')

select kodeunit,kodeafd,kodebud,netral,norek,sum(nilai) as nilai 
into #t1 
from #Sawal 
group by kodeunit,kodeafd,kodebud,netral,norek

select kodeunit,kodeafd,kodebud,netral,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,kodeafd,kodebud,netral,norek
union all
select kodeunit,kodeafd,kodebud,netral,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,kodeafd,kodebud,netral,norek
union all
select kodeunit,KodeAfdeling,KodeBudidaya,netral,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from kartu
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and SUBSTRING(norek,1,3) in ('040','041','042')
group by kodeunit,KodeAfdeling,KodeBudidaya,netral,norek

select kodeunit,kodeafd,kodebud,netral,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,kodeafd,kodebud,netral,norek

select kodeunit,kodeafd,kodebud,netral,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,kodeafd,kodebud,netral,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select a.kodeunit,'' as kodeafd,a.kodebud,a.netral,substring(a.norek,1,3)+'000000' as norek,cast('' as varchar(50)) as nm_aktiva,cast(0 as float) as LUAS,SPACE(50) as exareal,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
into #t5
from #t4 a
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null
group by a.kodeunit,a.kodebud,a.netral,substring(a.norek,1,3)

update #t5 set netral='2016' where netral=''
update #t5 set netral=substring(netral,1,4)
update #t5 set nm_aktiva='TTAD' where norek like '040%'
update #t5 set nm_aktiva='TTI'  where norek like '041%'
update #t5 set nm_aktiva='TBM'  where norek like '042%'

update #t5 set exareal='Areal5' where norek like '040%'
update #t5 set exareal='Areal4' where norek like '041%' and kodebud<'10'
update #t5 set exareal='Areal8' where norek like '041%' and kodebud>'09'
update #t5 set exareal='Areal2' where norek like '042%'

select kodekebun,kodebudidaya,tahuntanam,exareal,SUM(luas) as Luas into #Ref_Areal 
from Ref_Areal 
--where exareal in ('Areal2','Areal5','Areal8')
where exareal in ('Areal2','Areal8')
group by kodekebun,kodebudidaya,tahuntanam,exareal


select KodeUnit,kodebud as kdbud,exareal,substring(norek,1,3) as norek,sum(LUAS) as LUAS,netral as TAHUN,
round(sum(sakDebet-sakKredit),0) as TANAMAN,0 as BIUMKBN,0 as BIUMKDR
into #t6
from #t5
group by KodeUnit,kodebud,netral,norek,exareal

--delete SPDK_KBN_LAYANAN_BAGIAN..File_B
--insert SPDK_KBN_LAYANAN_BAGIAN..File_B
select a.KodeUnit,a.kdbud,a.TAHUN,a.norek,b.LUAS,a.TANAMAN,a.BIUMKBN,a.BIUMKDR
into #t7 
from #t6 a
full outer join #Ref_Areal b on a.KodeUnit=b.kodekebun and a.kdbud=b.kodebudidaya and a.TAHUN=b.tahuntanam and a.exareal=b.exareal
where a.TANAMAN>0 

--select KodeUnit,kdbud,TAHUN,COUNT(tanaman) as nilai from #t7 group by KodeUnit,kdbud,TAHUN
select * from #t7
--select * from #t5 where KodeUnit='19'
SET NOCOUNT OFF;
end

--set dateformat dmy exec File_B '01-12-2017'

--select * from Ref_Rekening where Norek like '04%' order by Norek

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[FILE_M]
@tanggal datetime
as
set dateformat dmy
declare @AwalTahun datetime
declare @AkhirBulan datetime
set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @AkhirBulan=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))


--SALDO AWAL
select kodeunit as kodeunit,noaktiva as noaktiva,kdafd as kdafd,kdbud as kdbud,
norek as norek,tglbeli as tglbeli,0 as n_beli,nmaktiva as nmaktiva,jmlunit as jmlunit,'' as nobukti,'' as leveransir,
sawalp as sawalp,auditp as auditp,rcp as rcp,hapusp as hapusp,kbnp as mutasip,rekp as rekp,murnip as murnip,
sawals as sawals,audits as audits,rcs as rcs,hapuss as hapuss,kbns as mutasis,reks as reks,murnis as murnis
INTO #T1
from aktivamaster
where YEAR(tgltran)=YEAR(@tanggal) and nobukti='SALDO AWAL'
union all

--TRANSAKSI AKTIVA TAHUN BERJALAN
select kodeunit as kodeunit,noaktiva as noaktiva,kdafd as kdafd,kdbud as kdbud,
norek as norek,tglbeli as tglbeli,0 as n_beli,nmaktiva as nmaktiva,jmlunit as jmlunit,'' as nobukti,'' as leveransir,
sawalp as sawalp,auditp as auditp,rcp as rcp,hapusp as hapusp,kbnp as mutasip,rekp as rekp,murnip as murnip,
sawals as sawals,audits as audits,rcs as rcs,hapuss as hapuss,kbns as mutasis,reks as reks,murnis as murnis
from aktivamaster 
where nobukti<>'SALDO AWAL' and SUBSTRING(norek,1,3) not in (043,044,045,046,047,048,049) and tgltran>=@AwalTahun and tgltran<=@AkhirBulan
union all


select kodeunit as kodeunit,noaktiva as noaktiva,kdafd as kdafd,kdbud as kdbud,
norek as norek,tglbeli as tglbeli,0 as n_beli,nmaktiva as nmaktiva,jmlunit as jmlunit,'' as nobukti,'' as leveransir,
sawalp as sawalp,auditp as auditp,rcp as rcp,hapusp as hapusp,kbnp as mutasip,rekp as rekp,murnip as murnip,
sawals as sawals,audits as audits,rcs as rcs,hapuss as hapuss,kbns as mutasis,reks as reks,murnis as murnis
from aktivamaster 
where nobukti<>'SALDO AWAL' and SUBSTRING(norek,1,3) in (043,044,045,046,047,048,049) and tgltran>=@AwalTahun and tgltran<=@AkhirBulan

select kodeunit as kodeunit,noaktiva as noaktiva,kdafd as kdafd,kdbud as kdbud,
norek as norek,tglbeli as tglbeli,sum(n_beli) as n_beli,nmaktiva as nmaktiva,sum(jmlunit) as jmlunit,nobukti as nobukti,leveransir as leveransir,
sum(sawalp) as sawalp,sum(auditp) as auditp,sum(rcp) as rcp,sum(hapusp) as hapusp,sum(mutasip) as mutasip,sum(rekp) as rekp,sum(murnip) as murnip,
sum(sawals) as sawals,sum(audits) as audits,sum(rcs) as rcs,sum(hapuss) as hapuss,sum(mutasis) as mutasis,sum(reks) as reks,sum(murnis) as murnis
from #T1 a
group by kodeunit,noaktiva,kdafd,kdbud,norek,tglbeli,nmaktiva,nobukti,leveransir
order by kodeunit,norek

--set dateformat dmy exec File_M '01-06-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[File_N]
@tanggal datetime

as
begin
set dateformat dmy 
set nocount on
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@tglakhir

select kodeunit,kodebud as kd_bud,norek,netral,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D'
union all
select kodeunit,kodebud as kd_bud,norek,netral,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K'
union all
select KodeUnit,kodebudidaya as kd_bud,Norek,netral,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal

select kodeunit,kd_bud,norek,netral,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,kd_bud,norek,netral

select kodeunit,kd_bud,norek,netral,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,kd_bud,norek,netral
union all
select kodeunit,kd_bud,norek,netral,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,kd_bud,norek,netral
union all
select kodeunit,kodebudidaya as kd_bud,norek,netral,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where Tanggal>=@TglAwal and Tanggal<=@tglakhir
group by kodeunit,kodebudidaya,norek,netral

select kodeunit,kd_bud,norek,netral,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,kd_bud,norek,netral

select kodeunit,kd_bud,norek,netral,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,kd_bud,norek,netral,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select kodeunit,kd_bud,norek,netral,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit
from #t4 a
group by a.kodeunit,kd_bud,norek,netral
order by kodeunit,norek
end

--set dateformat dmy exec File_N '01-11-2018'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[File_U]
@tanggal datetime
as
set dateformat dmy
BEGIN
SET NOCOUNT ON;

declare @AwalTahun datetime
declare @AkhirBulan datetime
set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @AkhirBulan=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

--delete SPDK_KBN_LAYANAN_BAGIAN..FILE_U
--insert SPDK_KBN_LAYANAN_BAGIAN..FILE_U
select KODEUNIT,TANGGAL,NoBukti as NO_BUKTI,NoInput as NO_INPUT,KodeBudidaya as KD_BUD,KodeAfdeling as KD_AFD,Norek as NOREK,Netral as NETRAL,
KodeBarang as kd_brg,KodeUnsur as kd_unsur,Uraian as uraian,Jml_fisik,cast(0 as float) as JMLHK_A,cast(0 as float) as JMLHSL_A,cast(0 as float) as JMLKARY_A,cast(0 as float) as JMLHK_B,cast(0 as float) as JMLHSL_B,
cast(0 as float) as JMLKARY_B,cast(0 as float) as JMLHK_C,cast(0 as float) as JMLHSL_C,cast(0 as float) as JMLKARY_C,DEBET,KREDIT
from Kartu where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal)
SET NOCOUNT OFF;
END

--set dateformat dmy exec File_U '01-01-2018'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[File_xB]
@tanggal datetime
as
set dateformat dmy 
BEGIN
SET NOCOUNT ON;
declare @zero float
declare @uraian varchar(50)
set @tanggal='01-09-2017'
set @zero=0
set @uraian=''

select kodekebun,kodebudidaya,tahuntanam,status,SUM(luas) as luas into #Ref_Areal from Ref_Areal where status in ('TTI','TTAD','TBM') group by kodekebun,kodebudidaya,tahuntanam,status

select KodeUnit,kodeafd,kodebud,norek,netral,thntnm,@uraian as uraian,nilai as sawDebet,@zero as sawKredit,@zero as Debet,@zero as Kredit into #t1 from AkunMemorial where SUBSTRING(norek,1,3) in ('040','041','042') and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and DK='D'
union all
select KodeUnit,kodeafd,kodebud,norek,netral,thntnm,@uraian as uraian,@zero as sawDebet,abs(nilai) as sawKredit,@zero as Debet,@zero as Kredit from AkunMemorial where SUBSTRING(norek,1,3) in ('040','041','042') and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and DK='K'
union all
select KodeUnit,KodeAfdeling,KodeBudidaya,Norek,Netral,@uraian as uraian,'' as thntnm,@zero,@zero,Debet,Kredit from kartu where SUBSTRING(norek,1,3) in ('040','041','042') and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) 

update #t1 set thntnm=netral where thntnm=''
update #t1 set uraian='TTAD' where norek like '040%'
update #t1 set uraian='TTI' where norek like '041%'
update #t1 set uraian='TBM' where norek like '042%'

select KodeUnit,kodeafd,kodebud,SUBSTRING(norek,1,3) as norek,uraian,thntnm,sawDebet,sawKredit,Debet,Kredit into #t2 from #t1

select a.KodeUnit,a.kodebud as kdbud,a.uraian,a.thntnm as TAHUN,a.norek,b.luas as LUAS,round(SUM(a.sawDebet+a.Debet-a.sawKredit-a.Kredit),0) as TANAMAN,@zero as BIUMKBN,@zero as BIUMKDR 
from #t2 a
inner join #Ref_Areal b on a.KodeUnit=b.kodekebun and a.kodebud=b.kodebudidaya and a.thntnm=b.tahuntanam and a.uraian=b.status
group by a.KodeUnit,a.kodebud,a.norek,a.uraian,a.thntnm,b.luas
order by KodeUnit,norek

--select * from #Ref_Areal where kodekebun='10'
SET NOCOUNT OFF;
end

--set dateformat dmy exec File_xB '01-01-2018'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[GJIcr627]
@tanggal datetime
--with encryption
as
set dateformat dmy
begin
set nocount on
declare @PctJamsostekPr float
declare @PctJamsostekPb float
declare @PctTotal float
set @PctJamsostekPr=(select top 1 pct_jamsos_persh from Ref_PctJamsostek)
set @PctJamsostekPb=(select top 1 pct_jamsos_prib  from Ref_PctJamsostek)
set @PctTotal=(select top 1 pct_jamsos_prib+pct_jamsos_persh from Ref_PctJamsostek)

select a.kdunit,a.kodeafd,a.register,b.NAMA,cast('' as varchar(50)) as nmGol,b.GOL+b.MK as Gol,c.GOL+'/'+c.MK as Gol1,c.GPO+c.T_TETAP as Gaji,d.UMK,
round((c.GPO+c.T_TETAP)*@PctJamsostekPr,0) as [JamPersh],round((c.GPO+c.T_TETAP)*@PctJamsostekPb,0) as [JamPrib],round((c.GPO+c.T_TETAP)*@PctTotal,0) as [JamTotal],
cast(0 as float) as JamPersh1,cast(0 as float) as JamPrib1,cast(0 as float) as JamTotal1,
c.B_PERSH as DapPersh,c.B_PRIB as DapPrib,c.B_PERSH+c.B_PRIB as DapTotal,
a.TBPJS as JpPersh,a.PBPJS-a.TBPJS as JpPrib,a.PBPJS as JpTotal,
cast(0 as float) as JpPersh1,cast(0 as float) as JpPrib1,cast(0 as float) as JpTotal1,
a.TBPJSKes as KsPersh,a.PBPJSKes-a.TBPJSKes as KsPrib,a.PBPJSKes as KsTotal,'' as Grup
into #t1
from GajiMaster a
inner join Ref_Dik b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and YEAR(a.tanggal)=YEAR(b.TANGGAL)
inner join Ref_KomponenGaji1 c on b.GOL+b.MK=c.KDGOL+c.MK
inner join Ref_UMK d on a.kdunit=d.KodeKebun
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal)

--update #t1 set JamPersh=-1*JamPersh,JamPrib=-1*JamPrib,JamTotal=-1*JamTotal where SUBSTRING(Gol,1,2)<'09'
update #t1 set JamPersh=JamPersh,JamPrib=JamPrib,JamTotal=JamTotal
update #t1 set Grup='1' where SUBSTRING(Gol,1,2)>='09'
update #t1 set Grup='2' where SUBSTRING(Gol,1,2)<'09'

--update #t1 set JamPersh1=JamPersh where JamPersh < 0
--update #t1 set JamPrib1 =JamPrib  where JamPrib  < 0
--update #t1 set JamTotal1=JamTotal where JamTotal < 0

--update #t1 set JamPersh=0 where JamPersh < 0
--update #t1 set JamPrib =0 where JamPrib  < 0
--update #t1 set JamTotal=0 where JamTotal < 0

----------------
--update #t1 set JpPersh1=-1*JpPersh,JpPrib1=-1*JpPrib,JpTotal1=-1*JpTotal where SUBSTRING(Gol,1,2)<'09'
update #t1 set JpPersh1=JpPersh,JpPrib1=JpPrib,JpTotal1=JpTotal 

--update #t1 set JpPersh1=JpPersh where JpPersh < 0
--update #t1 set JpPrib1 =JpPrib  where JpPrib  < 0
--update #t1 set JpTotal1=JpTotal where JpTotal < 0

--update #t1 set JpPersh=0 where SUBSTRING(Gol,1,2)<'09'
--update #t1 set JpPrib =0 where SUBSTRING(Gol,1,2)<'09'
--update #t1 set JpTotal=0 where SUBSTRING(Gol,1,2)<'09'

update #t1 set nmGol='GOL.IIIA - IVD' where SUBSTRING(Gol,1,2)>='09'
update #t1 set nmGol='GOL.IA - IID' where SUBSTRING(Gol,1,2)<'09'

select 'Kebun/Unit : '+b.NamaKebun as nmKebun,'BULAN : '+upper(c.namabulan)+' '+cast(YEAR(@tanggal) as varchar(4)) as Bulan,
a.nmGol,a.Grup,a.kodeafd,a.register,a.NAMA as Nama,a.Gol,a.Gol1,a.Gaji,a.UMK,
a.JamPersh,a.JamPrib,a.JamTotal,
a.JamPersh1,a.JamPrib1,a.JamTotal1,
a.DapPersh,a.DapPrib,a.DapTotal,
a.JpPersh,a.JpPrib,a.JpTotal,
a.JpPersh1,a.JpPrib1,a.JpTotal1,
a.KsPersh,a.KsPrib,a.KsTotal,
a.JamPersh+a.DapPersh+a.JpPersh+a.KsPersh as JmlPersh,
a.JamPrib+a.DapPrib+a.JpPrib+a.KsPrib as JmlPrib,
a.JamPersh+a.DapPersh+a.JpPersh+a.KsPersh+a.JamPrib+a.DapPrib+a.JpPrib+a.KsPrib as Total
into #t2
from #t1 a
inner join Ref_Kebun b on a.kdunit=b.KodeKebun
inner join Ref_Bulan c on MONTH(@tanggal)=c.bulan
order by grup,GOL desc,NAMA

select * from #t2

set nocount off
end

--set dateformat dmy exec GJIcr627_KEU '01-01-2018'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[GJIcr627_KEU]
@tanggal datetime
--with encryption
as
set dateformat dmy
begin
set nocount on
declare @PctJamsostekPr float
declare @PctJamsostekPb float
declare @PctTotal float
set @PctJamsostekPr=(select top 1 pct_jamsos_persh from Ref_PctJamsostek)
set @PctJamsostekPb=(select top 1 pct_jamsos_prib  from Ref_PctJamsostek)
set @PctTotal=(select top 1 pct_jamsos_prib+pct_jamsos_persh from Ref_PctJamsostek)

select a.kdunit,a.kodeafd,a.register,b.NAMA,cast('' as varchar(50)) as nmGol,b.GOL+b.MK as Gol,c.GOL+'/'+c.MK as Gol1,c.GPO+c.T_TETAP as Gaji,d.UMK,
round((c.GPO+c.T_TETAP)*@PctJamsostekPr,0) as [JamPersh],round((c.GPO+c.T_TETAP)*@PctJamsostekPb,0) as [JamPrib],round((c.GPO+c.T_TETAP)*@PctTotal,0) as [JamTotal],
cast(0 as float) as JamPersh1,cast(0 as float) as JamPrib1,cast(0 as float) as JamTotal1,
c.B_PERSH as DapPersh,c.B_PRIB as DapPrib,c.B_PERSH+c.B_PRIB as DapTotal,
a.TBPJS as JpPersh,a.PBPJS-a.TBPJS as JpPrib,a.PBPJS as JpTotal,
cast(0 as float) as JpPersh1,cast(0 as float) as JpPrib1,cast(0 as float) as JpTotal1,
a.TBPJSKes as KsPersh,a.PBPJSKes-a.TBPJSKes as KsPrib,a.PBPJSKes as KsTotal,'' as Grup
into #t1
from GajiMaster a
inner join Ref_Dik b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and YEAR(a.tanggal)=YEAR(b.TANGGAL) and a.kdunit=b.KD_KBN
inner join Ref_KomponenGaji1 c on b.GOL+b.MK=c.KDGOL+c.MK
inner join Ref_UMK d on a.kdunit=d.KodeKebun
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal)

--update #t1 set JamPersh=-1*JamPersh,JamPrib=-1*JamPrib,JamTotal=-1*JamTotal where SUBSTRING(Gol,1,2)<'09'
update #t1 set JamPersh=JamPersh,JamPrib=JamPrib,JamTotal=JamTotal
update #t1 set Grup='1' where SUBSTRING(Gol,1,2)>='09'
update #t1 set Grup='2' where SUBSTRING(Gol,1,2)<'09'

--update #t1 set JamPersh1=JamPersh where JamPersh < 0
--update #t1 set JamPrib1 =JamPrib  where JamPrib  < 0
--update #t1 set JamTotal1=JamTotal where JamTotal < 0

--update #t1 set JamPersh=0 where JamPersh < 0
--update #t1 set JamPrib =0 where JamPrib  < 0
--update #t1 set JamTotal=0 where JamTotal < 0

----------------
--update #t1 set JpPersh1=-1*JpPersh,JpPrib1=-1*JpPrib,JpTotal1=-1*JpTotal where SUBSTRING(Gol,1,2)<'09'
update #t1 set JpPersh1=JpPersh,JpPrib1=JpPrib,JpTotal1=JpTotal 

--update #t1 set JpPersh1=JpPersh where JpPersh < 0
--update #t1 set JpPrib1 =JpPrib  where JpPrib  < 0
--update #t1 set JpTotal1=JpTotal where JpTotal < 0

--update #t1 set JpPersh=0 where SUBSTRING(Gol,1,2)<'09'
--update #t1 set JpPrib =0 where SUBSTRING(Gol,1,2)<'09'
--update #t1 set JpTotal=0 where SUBSTRING(Gol,1,2)<'09'

update #t1 set nmGol='GOL.IIIA - IVD' where SUBSTRING(Gol,1,2)>='09'
update #t1 set nmGol='GOL.IA - IID' where SUBSTRING(Gol,1,2)<'09'

select a.kdunit,'Kebun/Unit : '+b.NamaKebun as nmKebun,'BULAN : '+upper(c.namabulan)+' '+cast(YEAR(@tanggal) as varchar(4)) as Bulan,
a.nmGol,a.Grup,a.kodeafd,a.register,a.NAMA as Nama,a.Gol,a.Gol1,a.Gaji,a.UMK,
a.JamPersh,a.JamPrib,a.JamTotal,
a.JamPersh1,a.JamPrib1,a.JamTotal1,
a.DapPersh,a.DapPrib,a.DapTotal,
a.JpPersh,a.JpPrib,a.JpTotal,
a.JpPersh1,a.JpPrib1,a.JpTotal1,
a.KsPersh,a.KsPrib,a.KsTotal,
a.JamPersh+a.DapPersh+a.JpPersh+a.KsPersh as JmlPersh,
a.JamPrib+a.DapPrib+a.JpPrib+a.KsPrib as JmlPrib,
a.JamPersh+a.DapPersh+a.JpPersh+a.KsPersh+a.JamPrib+a.DapPrib+a.JpPrib+a.KsPrib as Total
into #t2
from #t1 a
inner join Ref_Kebun b on a.kdunit=b.KodeKebun
inner join Ref_Bulan c on MONTH(@tanggal)=c.bulan
order by kdunit,grup,GOL desc,NAMA

delete PotonganRemiseKebun
insert PotonganRemiseKebun
select * from #t2

set nocount off
end

--set dateformat dmy exec GJIcr627_KEU '01-01-2018'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[GJIcr628_KEU]
@tanggal datetime
--with encryption
as
set dateformat dmy
begin
set nocount on
declare @PctJamsostekPr float
declare @PctJamsostekPb float
declare @PctTotal float
set @PctJamsostekPr=(select top 1 pct_jamsos_persh from Ref_PctJamsostek)
set @PctJamsostekPb=(select top 1 pct_jamsos_prib  from Ref_PctJamsostek)
set @PctTotal=(select top 1 pct_jamsos_prib+pct_jamsos_persh from Ref_PctJamsostek)

select a.kdunit,a.kodeafd,a.register,b.NAMA,b.GOL+b.MK as Gol,c.GOL+'/'+c.MK as Gol1,c.GPO+c.T_TETAP as Gaji,d.UMK,
round((c.GPO+c.T_TETAP)*@PctJamsostekPr,0) as [JamPersh],round((c.GPO+c.T_TETAP)*@PctJamsostekPb,0) as [JamPrib],round((c.GPO+c.T_TETAP)*@PctTotal,0) as [JamTotal],
c.B_PERSH as DapPersh,c.B_PRIB as DapPrib,c.B_PERSH+c.B_PRIB as DapTotal,
a.TBPJS as JpPersh,a.PBPJS-a.TBPJS as JpPrib,a.PBPJS as JpTotal,
a.TBPJSKes as KsPersh,a.PBPJSKes-a.TBPJSKes as KsPrib,a.PBPJSKes as KsTotal
into #t1
from GajiMaster a
inner join Ref_Dik b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and YEAR(a.tanggal)=YEAR(b.TANGGAL) and a.kdunit=b.KD_KBN
inner join Ref_KomponenGaji1 c on b.GOL+b.MK=c.KDGOL+c.MK
inner join Ref_UMK d on a.kdunit=d.KodeKebun
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and regmdr=''
union all
select a.kdunit,a.kodeafd,a.register,b.NAMA,b.GOL+b.MK as Gol,c.GOL+'/'+c.MK as Gol1,c.GPO+c.T_TETAP as Gaji,d.UMK,
round((c.GPO+c.T_TETAP)*@PctJamsostekPr,0) as [JamPersh],round((c.GPO+c.T_TETAP)*@PctJamsostekPb,0) as [JamPrib],round((c.GPO+c.T_TETAP)*@PctTotal,0) as [JamTotal],
c.B_PERSH as DapPersh,c.B_PRIB as DapPrib,c.B_PERSH+c.B_PRIB as DapTotal,
a.TBPJS as JpPersh,a.PBPJS-a.TBPJS as JpPrib,a.PBPJS as JpTotal,
a.TBPJSKes as KsPersh,a.PBPJSKes-a.TBPJSKes as KsPrib,a.PBPJSKes as KsTotal
from GajiMaster a
inner join Ref_Dik b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and YEAR(a.tanggal)=YEAR(b.TANGGAL)
inner join Ref_KomponenGaji1 c on b.GOL+b.MK=c.KDGOL+c.MK
inner join Ref_UMK d on a.kdunit=d.KodeKebun
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and regmdr<>'' and b.GOL='01'
union all
select a.kdunit,a.kodeafd,a.register,b.NAMA,'00'+b.MK as Gol,c.GOL+'/'+c.MK as Gol1,c.GPO+c.T_TETAP as Gaji,d.UMK,
round((c.GPO+c.T_TETAP)*@PctJamsostekPr,0) as [JamPersh],round((c.GPO+c.T_TETAP)*@PctJamsostekPb,0) as [JamPrib],round((c.GPO+c.T_TETAP)*@PctTotal,0) as [JamTotal],
c.B_PERSH as DapPersh,c.B_PRIB as DapPrib,c.B_PERSH+c.B_PRIB as DapTotal,
a.TBPJS as JpPersh,a.PBPJS-a.TBPJS as JpPrib,a.PBPJS as JpTotal,
a.TBPJSKes as KsPersh,a.PBPJSKes-a.TBPJSKes as KsPrib,a.PBPJSKes as KsTotal
from GajiMaster a
inner join Ref_Dik b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and YEAR(a.tanggal)=YEAR(b.TANGGAL)
inner join Ref_KomponenGaji1 c on b.GOL+b.MK=c.KDGOL+c.MK
inner join Ref_UMK d on a.kdunit=d.KodeKebun
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and regmdr<>'' and b.GOL>'01' and b.GOL<'09'

--update #t1 set JamPersh=-1*JamPersh,JamPrib=-1*JamPrib,JamTotal=-1*JamTotal where SUBSTRING(Gol,1,2)<'09'
--update #t1 set JpPersh=-1*JpPersh,JpPrib=-1*JpPrib,JpTotal=-1*JpTotal where SUBSTRING(Gol,1,2)<'09'

update #t1 set JamPersh=JamPersh,JamPrib=JamPrib,JamTotal=JamTotal
update #t1 set JpPersh=JpPersh,JpPrib=JpPrib,JpTotal=JpTotal


select a.kdunit,'Kebun/Unit : '+b.NamaKebun as nmKebun,@tanggal as Tanggal,'BULAN : '+upper(c.namabulan)+' '+cast(YEAR(@tanggal) as varchar(4)) as Bulan,
a.kodeafd,a.register,a.NAMA as Nama,'' as Grup,cast('' as varchar(50)) as nmGrup,a.Gol,a.Gol1,a.Gaji,a.UMK,
a.JamPersh,a.JamPrib,a.JamTotal,
cast(0 as float) as JamPersh1,cast(0 as float) as JamPrib1,cast(0 as float) as JamTotal1,
cast(0 as float) as JpPersh1,cast(0 as float) as JpPrib1,cast(0 as float) as JpTotal1,
a.DapPersh,a.DapPrib,a.DapTotal,
a.JpPersh,a.JpPrib,a.JpTotal,
a.KsPersh,a.KsPrib,a.KsTotal,
a.JamPersh+a.DapPersh+a.JpPersh+a.KsPersh as JmlPersh,
a.JamPrib+a.DapPrib+a.JpPrib+a.KsPrib as JmlPrib,
a.JamPersh+a.DapPersh+a.JpPersh+a.KsPersh+a.JamPrib+a.DapPrib+a.JpPrib+a.KsPrib as Total
into #t2
from #t1 a
inner join Ref_Kebun b on a.kdunit=b.KodeKebun
inner join Ref_Bulan c on MONTH(@tanggal)=c.bulan
order by kodeafd,GOL desc,NAMA

Update #t2 set Gol1=REPLACE(Gol1,'/','')
Update #t2 set Gol1=REPLACE(Gol1,'0','')
Update #t2 set Gol1=REPLACE(Gol1,'1','')
Update #t2 set Gol1=REPLACE(Gol1,'2','')
Update #t2 set Gol1=REPLACE(Gol1,'3','')
Update #t2 set Gol1=REPLACE(Gol1,'4','')
Update #t2 set Gol1=REPLACE(Gol1,'5','')
Update #t2 set Gol1=REPLACE(Gol1,'6','')
Update #t2 set Gol1=REPLACE(Gol1,'7','')
Update #t2 set Gol1=REPLACE(Gol1,'8','')
Update #t2 set Gol1=REPLACE(Gol1,'9','')

Update #t2 set Grup='1' where substring(Gol,1,2)>='09'
Update #t2 set Grup='2' where substring(Gol,1,2)>='02' and substring(Gol,1,2)<'09'
Update #t2 set Grup='3' where substring(Gol,1,2)<'01'
Update #t2 set Grup='4' where substring(Gol,1,2)>'00' and substring(Gol,1,2)<'02'

Update #t2 set nmGrup='GOL.IIIA - IVD'  where substring(Gol,1,2)>='09'
Update #t2 set nmGrup='GOL.IB - IID'    where substring(Gol,1,2)>='02' and substring(Gol,1,2)<'09'
Update #t2 set nmGrup='GOL.IB - IID=IA *)' where substring(Gol,1,2)<'01'
Update #t2 set nmGrup='GOL.IA'          where substring(Gol,1,2)>'00' and substring(Gol,1,2)<'02'

--update #t2 set JamPersh1 = JamPersh where JamPersh < 0
--update #t2 set JamPrib1  = 0  where JamPrib  < 0
--update #t2 set JamTotal1 = JamTotal-JamPrib where JamTotal < 0

--update #t2 set JamPersh = 0 where JamPersh < 0
--update #t2 set JamPrib  = 0 where JamPrib  < 0
--update #t2 set JamTotal = 0 where JamTotal < 0

--update #t2 set JpPersh1 = JpPersh        where JpPersh < 0
--update #t2 set JpPrib1  = 0              where JpPrib  < 0
--update #t2 set JpTotal1 = JpTotal-JpPrib where JpTotal < 0

--update #t2 set JpPersh = 0 where JpPersh < 0
--update #t2 set JpPrib  = 0 where JpPrib  < 0
--update #t2 set JpTotal = 0 where JpTotal < 0

--update #t2 set JamPersh1=0 where JamPersh1<0 and Grup='2'
--update #t2 set JamPersh1=0 where JamPersh1<0 and Grup='2'
--update #t2 set JpPersh1=0 where JpPersh1<0 and Grup='2'

--update #t2 set JamPersh1=abs(JamPersh1) where JamPersh1<0 and Grup in ('3','4')
--update #t2 set DapPersh=0 where Grup in ('3','4')
--update #t2 set JpPersh1=ABS(JpPersh1) where Grup in ('3','4')
--update #t2 set KsPersh=0 where Grup in ('3','4')

--update #t2 set JamTotal1=ABS(JamTotal1) where Grup in ('3','4')
--update #t2 set DapTotal=abs(DapPrib) where Grup in ('3','4')

select kdunit,nmKebun,Bulan,Grup,nmGrup,substring(Gol,1,2) as Gol,'- '+Gol1+' ('+cast(COUNT(*) as varchar(3))+' Org)' as Gol1,UMK,
SUM(Gaji) as Gaji,
SUM(JamPersh) as JamPersh,SUM(JamPrib) as JamPrib,SUM(JamTotal) as JamTotal,
SUM(JamPersh1) as JamPersh1,SUM(JamPrib1) as JamPrib1,SUM(JamTotal1) as JamTotal1,
SUM(DapPersh) as DapPersh,SUM(DapPrib) as DapPrib,SUM(DapTotal) as DapTotal,
SUM(JpPersh) as JpPersh,SUM(JpPrib) as JpPrib,SUM(JpTotal) as JpTotal,
SUM(JpPersh1) as JpPersh1,SUM(JpPrib1) as JpPrib1,SUM(JpTotal1) as JpTotal1,
SUM(KsPersh) as KsPersh,SUM(KsPrib) as KsPrib,SUM(KsTotal) as KsTotal,
SUM(JamPersh+DapPersh+JpPersh+KsPersh) as JmlPersh,SUM(JamPrib+DapPrib+JpPrib+KsPrib) as JmlPrib,
SUM(JamPersh+DapPersh+JpPersh+KsPersh+JamPrib+DapPrib+JpPrib+KsPrib) as Total
into #t3
from #t2
group by kdunit,nmKebun,Bulan,substring(Gol,1,2),Gol1,UMK,Grup,nmGrup

select * into PotonganRemiseKebunRekap from #t3
order by Grup,Gol desc

set nocount off
end

--set dateformat dmy exec GJIcr628_KEU '01-01-2018'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[GJIcr628_KEU_Print]
as
select kdunit,nmKebun,Bulan,nmGrup,UMK,
SUM(Gaji) as Gaji,
sum(JamPersh) as JamPersh,
sum(JamPrib) as JamPrib,
sum(JamTotal) as JamTotal,
sum(DapPersh) as DapPersh,
sum(DapPrib) as DapPrib,
sum(DapTotal) as DapTotal,
sum(JpPersh) as JpPersh,
sum(JpPrib) as JpPrib,
sum(JpTotal) as JpTotal,
sum(KsPersh) as KsPersh,
sum(KsPrib) as KsPrib,
sum(KsTotal) as KsTotal,
sum(JmlPersh) as JmlPersh,
sum(JmlPrib) as JmlPrib,
sum(Total) as Total
into #t1
from PotonganRemiseKebunRekap
group by kdunit,nmKebun,Bulan,nmGrup,UMK
order by kdunit,nmGrup

update #t1 set nmkebun=replace(nmkebun,'Kebun/Unit : ','')
select * from #t1

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[Graph_BasahTeh]
@tanggal datetime,
@kdbud varchar(2)
as
set dateformat dmy
select 'BULAN '+upper(c.namabulan)+' '+cast(YEAR(a.tanggal) as varchar(50)) as Bulan,a.kodekbn,b.NamaKebun,SUM(a.bi) as kg from AkunProduksiHP a 
inner join Ref_Kebun b on a.kodekbn=b.KodeKebun
inner join Ref_Bulan c on MONTH(a.tanggal)=c.bulan
where a.kodebud=@kdbud and a.kodevar='BASAH' and MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and a.norek='X'
group by c.namabulan,a.kodekbn,b.NamaKebun,YEAR(a.tanggal)
order by kodekbn

--set dateformat dmy exec Graph_BasahTeh '01-09-2017','00'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Hitung_THRKLM2019]
@kebun varchar(2)
AS
BEGIN
	DELETE [SPDK_KanpusEF].[dbo].[THRKLM2019] where KodeKebun=@kebun
	INSERT INTO [dbo].[THRKLM2019]
		SELECT distinct kodeunit,kodeafd,register,upper(nama),0,0,0,0,0,0,0,0,0,0,0,0,0,0
		FROM [dbo].[GajiAbsensi]
		WHERE MONTH(tanggal)=5 and YEAR(tanggal)=2019 and sts='KL' and kodeabs in ('1','2') and kodeunit=@kebun

	DECLARE @KodeKebun varchar(2)
	DECLARE @Reg varchar(10)
	DECLARE @Nama varchar(50)
	DECLARE @HKJuni2018 int
	DECLARE @HKJuli2018 int
	DECLARE @HKAgustus2018 int
	DECLARE @HKSeptember2018 int
	DECLARE @HKOktober2018 int
	DECLARE @HKNopember2018 int
	DECLARE @HKDesember2018 int
	DECLARE @HKJanuari2019 int
	DECLARE @HKFebruari2019 int
	DECLARE @HKMaret2019 int
	DECLARE @HKApril2019 int
	DECLARE @HKMei2019 int

	DECLARE cursTHR CURSOR FOR 
	SELECT KodeKebun,Reg,Nama FROM [SPDK_KanpusEF].[dbo].[THRKLM2019] WHERE KodeKebun=@kebun
	OPEN cursTHR
	FETCH NEXT FROM cursTHR INTO @KodeKebun,@Reg,@Nama 
	WHILE @@FETCH_STATUS=0
	BEGIN
		
		SET @HKJuni2018 = (SELECT count(*) FROM [dbo].[GajiAbsensi] WHERE MONTH(tanggal)=6 and YEAR(tanggal)=2018 and kodeabs in ('1','2') and kodeunit=@KodeKebun and register=@Reg and upper(nama)=@Nama )
		SET @HKJuli2018 = (SELECT count(*) FROM [dbo].[GajiAbsensi] WHERE MONTH(tanggal)=7 and YEAR(tanggal)=2018 and kodeabs in ('1','2') and kodeunit=@KodeKebun and register=@Reg and upper(nama)=@Nama )
		SET @HKAgustus2018 = (SELECT count(*) FROM [dbo].[GajiAbsensi] WHERE MONTH(tanggal)=8 and YEAR(tanggal)=2018 and kodeabs in ('1','2') and kodeunit=@KodeKebun and register=@Reg and upper(nama)=@Nama )
		SET @HKSeptember2018 = (SELECT count(*) FROM [dbo].[GajiAbsensi] WHERE MONTH(tanggal)=9 and YEAR(tanggal)=2018 and kodeabs in ('1','2') and kodeunit=@KodeKebun and register=@Reg and upper(nama)=@Nama )
		SET @HKOktober2018 = (SELECT count(*) FROM [dbo].[GajiAbsensi] WHERE MONTH(tanggal)=10 and YEAR(tanggal)=2018 and kodeabs in ('1','2') and kodeunit=@KodeKebun and register=@Reg and upper(nama)=@Nama )
		SET @HKNopember2018 = (SELECT count(*) FROM [dbo].[GajiAbsensi] WHERE MONTH(tanggal)=11 and YEAR(tanggal)=2018 and kodeabs in ('1','2') and kodeunit=@KodeKebun and register=@Reg and upper(nama)=@Nama )
		SET @HKDesember2018 = (SELECT count(*) FROM [dbo].[GajiAbsensi] WHERE MONTH(tanggal)=12 and YEAR(tanggal)=2018 and kodeabs in ('1','2') and kodeunit=@KodeKebun and register=@Reg and upper(nama)=@Nama )
		SET @HKJanuari2019 = (SELECT count(*) FROM [dbo].[GajiAbsensi] WHERE MONTH(tanggal)=1 and YEAR(tanggal)=2019 and kodeabs in ('1','2') and kodeunit=@KodeKebun and register=@Reg and upper(nama)=@Nama )
		SET @HKFebruari2019 = (SELECT count(*) FROM [dbo].[GajiAbsensi] WHERE MONTH(tanggal)=2 and YEAR(tanggal)=2019 and kodeabs in ('1','2') and kodeunit=@KodeKebun and register=@Reg and upper(nama)=@Nama )
		SET @HKMaret2019 = (SELECT count(*) FROM [dbo].[GajiAbsensi] WHERE MONTH(tanggal)=3 and YEAR(tanggal)=2019 and kodeabs in ('1','2') and kodeunit=@KodeKebun and register=@Reg and upper(nama)=@Nama )
		SET @HKApril2019 = (SELECT count(*) FROM [dbo].[GajiAbsensi] WHERE MONTH(tanggal)=4 and YEAR(tanggal)=2019 and kodeabs in ('1','2') and kodeunit=@KodeKebun and register=@Reg and upper(nama)=@Nama )
		SET @HKMei2019 = (SELECT count(*) FROM [dbo].[GajiAbsensi] WHERE MONTH(tanggal)=5 and YEAR(tanggal)=2019 and kodeabs in ('1','2') and kodeunit=@KodeKebun and register=@Reg and upper(nama)=@Nama )

		UPDATE [dbo].[THRKLM2019]
		SET HKJuni2018=@HKJuni2018,
			HKJuli2018=@HKJuli2018,
			HKAgustus2018=@HKAgustus2018,
			HKSeptember2018=@HKSeptember2018,
			HKOktober2018=@HKOktober2018,
			HKNopember2018=@HKNopember2018,
			HKDesember2018=@HKDesember2018,
			HKJanuari2019=@HKJanuari2019,
			HKFebruari2019=@HKFebruari2019,
			HKMaret2019=@HKMaret2019,
			HKApril2019=@HKApril2019,
			HKMei2019=@HKMei2019,
			JumlahHK=@HKJuni2018+@HKJuli2018+@HKAgustus2018+@HKSeptember2018+@HKOktober2018+@HKNopember2018+@HKDesember2018+@HKJanuari2019+@HKFebruari2019+@HKMaret2019+@HKApril2019+@HKMei2019,
			NilaiTHR=case when (@HKJuni2018+@HKJuli2018+@HKAgustus2018+@HKSeptember2018+@HKOktober2018+@HKNopember2018+@HKDesember2018+@HKJanuari2019+@HKFebruari2019+@HKMaret2019+@HKApril2019+@HKMei2019)>=288 then 1716000 else ((@HKJuni2018+@HKJuli2018+@HKAgustus2018+@HKSeptember2018+@HKOktober2018+@HKNopember2018+@HKDesember2018+@HKJanuari2019+@HKFebruari2019+@HKMaret2019+@HKApril2019+@HKMei2019)/288)*1716000 end
		WHERE CURRENT OF cursTHR

		FETCH NEXT FROM cursTHR INTO @KodeKebun,@Reg,@Nama 
	END
	CLOSE cursTHR
	DEALLOCATE cursTHR
END

-- exec Hitung_THRKLM2019 '10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[HPS_CekRekening150]
@tanggal datetime
as
set dateformat dmy

select * into #Norek from SPDK_KBN_MASTER_REF..Ref_Rekening where Norek like '150%'

select norek,nilai as sawal,0 as debet,0 as kredit into #t1 from AkunMemorial 
where norek LIKE '150%' and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=year(@tanggal) and NoInput in ('SALDO AWAL','TRANSAKSI') and DK='D'
union all
select norek,-1*nilai as sawal,0 as debet,0 as kredit from AkunMemorial 
where norek LIKE '150%' and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=year(@tanggal) and NoInput in ('SALDO AWAL','TRANSAKSI') and DK='K'
union all

select norek,0 as sawal,Debet as debet,Kredit as kredit from kartu
where norek LIKE '150%' and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=year(@tanggal)

select @tanggal as tanggal,a.norek,b.NamaRekening,SUM(a.sawal) as sawal,SUM(a.debet) as debet,SUM(a.kredit) as kredit,SUM(a.sawal+a.debet-a.kredit) as akhir
from #t1 a
inner join #Norek b on a.norek=b.Norek
group by a.norek,b.NamaRekening
order by norek

--set dateformat dmy exec HPS_CekRekening150 '01-01-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[HPS_Rekening150]
as
select KodeUnit,Norek,NamaRekening into #Norek from SPDK_KBN_MASTER_REF..Ref_Rekening where Norek like '150%'

select KodeUnit,norek,SUM(nilai) as sawal into #t1 from AkunMemorial where YEAR(tanggal)=2017 and MONTH(tanggal)=1 and norek like '150%' and DK='D' and NoInput='SALDO AWAL' group by KodeUnit,norek
union all
select KodeUnit,norek,-1*SUM(nilai) as sawal from AkunMemorial where YEAR(tanggal)=2017 and MONTH(tanggal)=1 and norek like '150%' and DK='K' and NoInput='SALDO AWAL' group by KodeUnit,norek

select KodeUnit,norek,SUM(sawal) as sawal,0 as B01,0 as B02,0 as B03,0 as B04,0 as B05,0 as B06,0 as B07,0 as B08,0 as B09,0 as B10,0 as B11,0 as B12 into #t2 from #t1 group by KodeUnit,norek 
union all
--Jan
select KodeUnit,norek,0 as sawal,SUM(Debet-Kredit) as B01,0 as B02,0 as B03,0 as B04,0 as B05,0 as B06,0 as B07,0 as B08,0 as B09,0 as B10,0 as B11,0 as B12 from kartu where YEAR(Tanggal)=2017 and MONTH(Tanggal)=1 and Norek like '150%' group by KodeUnit,norek
union all
--Peb
select KodeUnit,norek,0 as sawal,0 as B01,SUM(Debet-Kredit) as B02,0 as B03,0 as B04,0 as B05,0 as B06,0 as B07,0 as B08,0 as B09,0 as B10,0 as B11,0 as B12 from kartu where YEAR(Tanggal)=2017 and MONTH(Tanggal)=2 and Norek like '150%' group by KodeUnit,norek
union all
--Mar
select KodeUnit,norek,0 as sawal,0 as B01,0 as B02,SUM(Debet-Kredit) as B03,0 as B04,0 as B05,0 as B06,0 as B07,0 as B08,0 as B09,0 as B10,0 as B11,0 as B12 from kartu where YEAR(Tanggal)=2017 and MONTH(Tanggal)=3 and Norek like '150%' group by KodeUnit,norek
union all
--Apr
select KodeUnit,norek,0 as sawal,0 as B01,0 as B02,0 as B03,SUM(Debet-Kredit) as B04,0 as B05,0 as B06,0 as B07,0 as B08,0 as B09,0 as B10,0 as B11,0 as B12 from kartu where YEAR(Tanggal)=2017 and MONTH(Tanggal)=4 and Norek like '150%' group by KodeUnit,norek
union all
--Mei
select KodeUnit,norek,0 as sawal,0 as B01,0 as B02,0 as B03,0 as B04,SUM(Debet-Kredit) as B05,0 as B06,0 as B07,0 as B08,0 as B09,0 as B10,0 as B11,0 as B12 from kartu where YEAR(Tanggal)=2017 and MONTH(Tanggal)=5 and Norek like '150%' group by KodeUnit,norek
union all
--Jun
select KodeUnit,norek,0 as sawal,0 as B01,0 as B02,0 as B03,0 as B04,0 as B05,SUM(Debet-Kredit) as B06,0 as B07,0 as B08,0 as B09,0 as B10,0 as B11,0 as B12 from kartu where YEAR(Tanggal)=2017 and MONTH(Tanggal)=6 and Norek like '150%' group by KodeUnit,norek
union all
--Jul
select KodeUnit,norek,0 as sawal,0 as B01,0 as B02,0 as B03,0 as B04,0 as B05,0 as B06,SUM(Debet-Kredit) as B07,0 as B08,0 as B09,0 as B10,0 as B11,0 as B12 from kartu where YEAR(Tanggal)=2017 and MONTH(Tanggal)=7 and Norek like '150%' group by KodeUnit,norek

select a.KodeUnit,c.NamaKebun,a.norek,b.NamaRekening,SUM(a.sawal) as sawal,
SUM(a.B01) as Jan, 
SUM(a.B02) as Pab, 
SUM(a.B03) as Mar, 
SUM(a.B04) as Apr, 
SUM(a.B05) as Mei, 
SUM(a.B06) as Jun, 
SUM(a.B07) as Jul, 
SUM(a.B08) as Ags, 
SUM(a.B09) as Sep, 
SUM(a.B10) as Okt, 
SUM(a.B11) as Nop, 
SUM(a.B12) as Des,
SUM(a.B01+a.B02+a.B03+a.B04+a.B05+a.B06+a.B07+a.B08+a.B09+a.B10+a.B11+a.B12) as total
from #t2 a 
inner join #Norek b on a.norek=b.Norek
inner join SPDK_KBN_MASTER_REF..Ref_Kebun c on a.KodeUnit=c.KodeKebun
group by a.KodeUnit,a.norek,b.NamaRekening,c.NamaKebun
order by norek,KodeUnit

--exec HPS_Rekening150

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[InvestigasiGL]
@tahun datetime,
@kbn varchar(50)
as
set dateformat dmy
declare @zero float
set @zero=0
select KodeUnit,norek,
sum(nilai) as dbSA,@zero as krSA,
@zero as db01,@zero as dkr01,
@zero as db02,@zero as dkr02,
@zero as db03,@zero as dkr03, 
@zero as db04,@zero as dkr04, 
@zero as db05,@zero as dkr05, 
@zero as db06,@zero as dkr06, 
@zero as db07,@zero as dkr07, 
@zero as db08,@zero as dkr08, 
@zero as db09,@zero as dkr09, 
@zero as db10,@zero as dkr10, 
@zero as db11,@zero as dkr11, 
@zero as db12,@zero as dkr12 
into #T1
from AkunMemorial where NoInput='SALDO AWAL' AND YEAR(tanggal)=2016 AND DK='D' and KodeUnit=@kbn group by KodeUnit,norek
union all
select KodeUnit,norek,
@zero as dbSA,sum(nilai) as krSA,
@zero as db01,@zero as dkr01,
@zero as db02,@zero as dkr02,
@zero as db03,@zero as dkr03, 
@zero as db04,@zero as dkr04, 
@zero as db05,@zero as dkr05, 
@zero as db06,@zero as dkr06, 
@zero as db07,@zero as dkr07, 
@zero as db08,@zero as dkr08, 
@zero as db09,@zero as dkr09, 
@zero as db10,@zero as dkr10, 
@zero as db11,@zero as dkr11, 
@zero as db12,@zero as dkr12 
from AkunMemorial where NoInput='SALDO AWAL' AND YEAR(tanggal)=2016 AND DK='K' and KodeUnit=@kbn group by KodeUnit,norek
union all
select KodeUnit,Norek,
@zero as dbSA,@zero as dkrSA,
sum(Debet) as db01,sum(Kredit) as kr01,
@zero as db02,@zero as dkr02,
@zero as db03,@zero as dkr03, 
@zero as db04,@zero as dkr04, 
@zero as db05,@zero as dkr05, 
@zero as db06,@zero as dkr06, 
@zero as db07,@zero as dkr07, 
@zero as db08,@zero as dkr08, 
@zero as db09,@zero as dkr09, 
@zero as db10,@zero as dkr10, 
@zero as db11,@zero as dkr11, 
@zero as db12,@zero as dkr12 
from Kartu where MONTH(Tanggal)=1 and YEAR(Tanggal)=YEAR(@tahun) and KodeUnit=@kbn group by KodeUnit,Norek
union all
select KodeUnit,Norek,
@zero as dbSA,@zero as dkrSA,
@zero as db01,@zero as dkr01,
sum(Debet) as db02,sum(Kredit) as kr02,
@zero as db03,@zero as dkr03, 
@zero as db04,@zero as dkr04, 
@zero as db05,@zero as dkr05, 
@zero as db06,@zero as dkr06, 
@zero as db07,@zero as dkr07, 
@zero as db08,@zero as dkr08, 
@zero as db09,@zero as dkr09, 
@zero as db10,@zero as dkr10, 
@zero as db11,@zero as dkr11, 
@zero as db12,@zero as dkr12 
from Kartu where MONTH(Tanggal)=2 and YEAR(Tanggal)=YEAR(@tahun) and KodeUnit=@kbn group by KodeUnit,Norek
union all
select KodeUnit,Norek,
@zero as dbSA,@zero as dkrSA,
@zero as db01,@zero as dkr01,
@zero as db02,@zero as dkr02,
sum(Debet) as db03,sum(Kredit) as kr03,
@zero as db04,@zero as dkr04, 
@zero as db05,@zero as dkr05, 
@zero as db06,@zero as dkr06, 
@zero as db07,@zero as dkr07, 
@zero as db08,@zero as dkr08, 
@zero as db09,@zero as dkr09, 
@zero as db10,@zero as dkr10, 
@zero as db11,@zero as dkr11, 
@zero as db12,@zero as dkr12 
from Kartu where MONTH(Tanggal)=3 and YEAR(Tanggal)=YEAR(@tahun) and KodeUnit=@kbn group by KodeUnit,Norek
union all
select KodeUnit,Norek,
@zero as dbSA,@zero as dkrSA,
@zero as db01,@zero as dkr01,
@zero as db02,@zero as dkr02,
@zero as db03,@zero as dkr03, 
sum(Debet) as db04,sum(Kredit) as kr04,
@zero as db05,@zero as dkr05, 
@zero as db06,@zero as dkr06, 
@zero as db07,@zero as dkr07, 
@zero as db08,@zero as dkr08, 
@zero as db09,@zero as dkr09, 
@zero as db10,@zero as dkr10, 
@zero as db11,@zero as dkr11, 
@zero as db12,@zero as dkr12 
from Kartu where MONTH(Tanggal)=4 and YEAR(Tanggal)=YEAR(@tahun) and KodeUnit=@kbn group by KodeUnit,Norek
union all
select KodeUnit,Norek,
@zero as dbSA,@zero as dkrSA,
@zero as db01,@zero as dkr01,
@zero as db02,@zero as dkr02,
@zero as db03,@zero as dkr03, 
@zero as db04,@zero as kr04,
sum(Debet) as db05,sum(Kredit) as kr05,
@zero as db06,@zero as dkr06, 
@zero as db07,@zero as dkr07, 
@zero as db08,@zero as dkr08, 
@zero as db09,@zero as dkr09, 
@zero as db10,@zero as dkr10, 
@zero as db11,@zero as dkr11, 
@zero as db12,@zero as dkr12 
from Kartu where MONTH(Tanggal)=5 and YEAR(Tanggal)=YEAR(@tahun) and KodeUnit=@kbn group by KodeUnit,Norek
union all
select KodeUnit,Norek,
@zero as dbSA,@zero as dkrSA,
@zero as db01,@zero as dkr01,
@zero as db02,@zero as dkr02,
@zero as db03,@zero as dkr03, 
@zero as db04,@zero as kr04,
@zero as db05,@zero as kr05,
sum(Debet) as db06,sum(Kredit) as kr06,
@zero as db07,@zero as dkr07, 
@zero as db08,@zero as dkr08, 
@zero as db09,@zero as dkr09, 
@zero as db10,@zero as dkr10, 
@zero as db11,@zero as dkr11, 
@zero as db12,@zero as dkr12 
from Kartu where MONTH(Tanggal)=6 and YEAR(Tanggal)=YEAR(@tahun) and KodeUnit=@kbn group by KodeUnit,Norek
union all
select KodeUnit,Norek,
@zero as dbSA,@zero as dkrSA,
@zero as db01,@zero as dkr01,
@zero as db02,@zero as dkr02,
@zero as db03,@zero as dkr03, 
@zero as db04,@zero as kr04,
@zero as db05,@zero as kr05,
@zero as db06,@zero as kr06,
sum(Debet) as db07,sum(Kredit) as kr07,
@zero as db08,@zero as dkr08, 
@zero as db09,@zero as dkr09, 
@zero as db10,@zero as dkr10, 
@zero as db11,@zero as dkr11, 
@zero as db12,@zero as dkr12 
from Kartu where MONTH(Tanggal)=7 and YEAR(Tanggal)=YEAR(@tahun) and KodeUnit=@kbn group by KodeUnit,Norek
union all
select KodeUnit,Norek,
@zero as dbSA,@zero as dkrSA,
@zero as db01,@zero as dkr01,
@zero as db02,@zero as dkr02,
@zero as db03,@zero as dkr03, 
@zero as db04,@zero as kr04,
@zero as db05,@zero as kr05,
@zero as db05,@zero as kr05,
@zero as db06,@zero as kr06,
sum(Debet) as db08,sum(Kredit) as kr08,
@zero as db09,@zero as dkr09, 
@zero as db10,@zero as dkr10, 
@zero as db11,@zero as dkr11, 
@zero as db12,@zero as dkr12 
from Kartu where MONTH(Tanggal)=8 and YEAR(Tanggal)=YEAR(@tahun) and KodeUnit=@kbn group by KodeUnit,Norek
union all
select KodeUnit,Norek,
@zero as dbSA,@zero as dkrSA,
@zero as db01,@zero as dkr01,
@zero as db02,@zero as dkr02,
@zero as db03,@zero as dkr03, 
@zero as db04,@zero as kr04,
@zero as db05,@zero as kr05,
@zero as db06,@zero as kr06,
@zero as db07,@zero as kr07,
@zero as db08,@zero as kr08,
sum(Debet) as db09,sum(Kredit) as kr09,
@zero as db10,@zero as dkr10, 
@zero as db11,@zero as dkr11, 
@zero as db12,@zero as dkr12 
from Kartu where MONTH(Tanggal)=9 and YEAR(Tanggal)=YEAR(@tahun) and KodeUnit=@kbn group by KodeUnit,Norek
union all
select KodeUnit,Norek,
@zero as dbSA,@zero as dkrSA,
@zero as db01,@zero as dkr01,
@zero as db02,@zero as dkr02,
@zero as db03,@zero as dkr03, 
@zero as db04,@zero as kr04,
@zero as db05,@zero as kr05,
@zero as db06,@zero as kr06,
@zero as db07,@zero as kr07,
@zero as db08,@zero as kr08,
@zero as db06,@zero as kr09,
sum(Debet) as db10,sum(Kredit) as kr10,
@zero as db11,@zero as dkr11, 
@zero as db12,@zero as dkr12 
from Kartu where MONTH(Tanggal)=10 and YEAR(Tanggal)=YEAR(@tahun) and KodeUnit=@kbn group by KodeUnit,Norek
union all
select KodeUnit,Norek,
@zero as dbSA,@zero as dkrSA,
@zero as db01,@zero as dkr01,
@zero as db02,@zero as dkr02,
@zero as db03,@zero as dkr03, 
@zero as db04,@zero as kr04,
@zero as db05,@zero as kr05,
@zero as db06,@zero as kr06,
@zero as db07,@zero as kr07,
@zero as db08,@zero as kr08,
@zero as db06,@zero as kr09,
@zero as db10,@zero as kr10,
sum(Debet) as db11,sum(Kredit) as kr11,
@zero as db12,@zero as dkr12 
from Kartu where MONTH(Tanggal)=11 and YEAR(Tanggal)=YEAR(@tahun) and KodeUnit=@kbn group by KodeUnit,Norek
union all
select KodeUnit,Norek,
@zero as dbSA,@zero as dkrSA,
@zero as db01,@zero as dkr01,
@zero as db02,@zero as dkr02,
@zero as db03,@zero as dkr03, 
@zero as db04,@zero as kr04,
@zero as db05,@zero as kr05,
@zero as db06,@zero as kr06,
@zero as db07,@zero as kr07,
@zero as db08,@zero as kr08,
@zero as db06,@zero as kr09,
@zero as db10,@zero as kr10,
@zero as db11,@zero as kr11,
sum(Debet) as db12,sum(Kredit) as kr12
from Kartu where MONTH(Tanggal)=12 and YEAR(Tanggal)=YEAR(@tahun) and KodeUnit=@kbn group by KodeUnit,Norek

select a.KodeUnit,c.NamaKebun,'#'+a.Norek as norek,b.NamaRekening,
sum(a.dbSA)  as  dbSA,sum(a.krSA)  as  krSA,
sum(a.db01)  as  db01,sum(a.dkr01) as  dkr01,sum(a.db02) as  db02,sum(a.dkr02) as  dkr02,sum(a.db03) as  db03,
sum(a.dkr03) as  dkr03,sum(a.db04) as  db04,sum(a.dkr04) as  dkr04,sum(a.db05) as  db05,sum(a.dkr05) as  dkr05,
sum(a.db06)  as  db06,sum(a.dkr06) as  dkr06,sum(a.db07) as  db07,sum(a.dkr07) as  dkr07,sum(a.db08) as  db08,
sum(a.dkr08) as  dkr08,sum(a.db09) as  db09,sum(a.dkr09) as  dkr09,sum(a.db10) as  db10,sum(a.dkr10) as  dkr10,
sum(a.db11)  as  db11,sum(a.dkr11) as  dkr11,sum(a.db12) as  db12,sum(a.dkr12) as  dkr12,
sum(a.dbSA+a.db01+a.db02+a.db03+a.db04+a.db05+a.db06+a.db07+a.db08+a.db09+a.db10+a.db11+a.db12) as dbAK,
sum(a.krSA+a.dkr01+a.dkr02+a.dkr03+a.dkr04+a.dkr05+a.dkr06+a.dkr07+a.dkr08+a.dkr09+a.dkr10+a.dkr11+a.dkr12) as krAK
from #t1 a
inner join Ref_Rekening b on a.KodeUnit=b.KodeUnit and a.norek=b.Norek
inner join Ref_Kebun c on a.KodeUnit=c.KodeKebun
group by a.KodeUnit,a.Norek,c.NamaKebun,b.NamaRekening


--set dateformat dmy exec InvestigasiGL '2016','11'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create proc [dbo].[KartuClipper_Delete] 
@Kebun varchar(2),
@Bulan varchar(6)
as 
delete KartuClipper where kodeunit=@Kebun and Bulan=@Bulan

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[KartuClipper_Insert] 
@Kebun varchar(6),
@Bulan varchar(6),
@no_bkt varchar(50), 
@kd_bud varchar(50), 
@kd_afd varchar(50), 
@norek varchar(50), 
@netral varchar(50), 
@uraian varchar(max), 
@debet float,
@kredit float
as 
set dateformat dmy
declare @tanggal datetime
set @tanggal='01-'+SUBSTRING(@Bulan,5,2)+'-'+SUBSTRING(@Bulan,1,4)

insert into KartuClipper(KodeUnit,bulan,tanggal,no_bukti,kd_bud,kd_afd,norek,netral,uraian,debet,kredit) 
values(@Kebun,@Bulan,@tanggal,@no_bkt,@kd_bud,@kd_afd,@norek,@netral,@uraian,@debet,@kredit)
--values(@Kebun,@Bulan,cast('01-01-1900' as datetime),@no_bkt,@kd_bud,@kd_afd,@norek,@netral,@uraian,@debet,@kredit)

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[KartuToDBF]
@tanggal datetime
as
set dateformat dmy
select KodeUnit as kd_kbn,Tanggal,NoBukti as No_Bukti,NoInput as No_Input,KodeBudidaya as kd_bud,KodeAfdeling as kd_afd,Norek,Netral,KodeBarang as kd_brg,KodeUnsur as kd_unsur,Uraian,Jml_fisik,0 as JMLHK_A,0 as JMLHSL_A,0 as JMLKARY_A,0 as JMLHK_B,0 as JMLHSL_B,0 as JMLKARY_B,0 as JMLHK_C,0 as JMLHSL_C,0 as JMLKARY_C,round(Debet,2) as debet,round(Kredit,2) as Kredit,'0' as stat_rec 
from kartu 
where month(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)

--set dateformat dmy exec KartuToDBF '31-01-2016'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[KertasKerjaPPH21Excel_Konsol]
@tanggal datetime
--with encryption
as
begin
set nocount off
set dateformat dmy
select distinct REG as Register,KELAMIN into #DIK from Ref_Dik
union all
select distinct REG as Register,KELAMIN from Ref_DikKLM

--select NPP,NPWP into #SDM01 from SDM01

select a.KodeUnit,a.register,a.NAMA,a.NPWP,a.status,
sum(a.Gaji) as Gaji,
sum(a.Sansos) as Sansos,
sum(a.Jabatan) as Jabatan,
sum(a.Struktural) as Struktural,
sum(a.Tetap) as Tetap,
sum(a.Jamsostek) as Jamsostek,
sum(a.Dapenbun) as Dapenbun,
sum(a.bonus) as bonus,
sum(a.thr) as thr,
sum(a.tantiem) as tantiem,
sum(a.cuti) as cuti,
sum(a.jubileum) as jubileum,
sum(a.Rapel) as Rapel,
sum(a.Premi) as Premi,
sum(a.IuranPensiun) as IuranPensiun,
sum(a.JHT) as JHT,
sum(a.GajiSBI) as GajiSBI,
sum(a.SansosSBI) as SansosSBI,
sum(a.JabatanSBI) as JabatanSBI,
sum(a.StrukturalSBI) as StrukturalSBI,
sum(a.TetapSBI) as TetapSBI,
sum(a.JamsostekSBI) as JamsostekSBI,
sum(a.DapenbunSBI) as DapenbunSBI,
sum(a.bonusSBI) as bonusSBI,
sum(a.thrSBI) as thrSBI,
sum(a.tantiemSBI) as tantiemSBI,
sum(a.cutiSBI) as cutiSBI,
sum(a.jubileumSBI) as jubileumSBI,
sum(a.RapelSBI) as RapelSBI,
sum(a.PremiSBI) as PremiSBI,
sum(a.IuranPensiunSBI) as IuranPensiunSBI,
sum(a.JHTSBI) as JHTSBI,
sum(a.TunjanganPajak) as TunjanganPajak,
sum(a.TunjanganPajakSBI) as TunjanganPajakSBI,
sum(a.Lain2) as Lain2,
sum(a.Lain2SBI) as Lain2SBI,
a.Tanggal,
b.Kelamin
into #t1
from PPH21Bulanan a
inner join #DIK b on a.register=b.Register
--inner join #SDM01 c on a.register=c.NPP
where MONTH(a.Tanggal)=MONTH(@tanggal) and YEAR(a.Tanggal)=YEAR(@tanggal)
group by a.KodeUnit,a.register,a.NAMA,a.NPWP,a.status,a.Tanggal,b.Kelamin

update #t1 set NPWP=SUBSTRING(NPWP,2,2)+'.'+SUBSTRING(NPWP,3,3)+'.'+SUBSTRING(NPWP,6,3)+'.'+SUBSTRING(NPWP,9,1)+'-'+SUBSTRING(NPWP,10,3)+'.'+SUBSTRING(NPWP,13,3) where len(NPWP)>15
update #t1 set NPWP=SUBSTRING(NPWP,1,2)+'.'+SUBSTRING(NPWP,3,3)+'.'+SUBSTRING(NPWP,6,3)+'.'+SUBSTRING(NPWP,9,1)+'-'+SUBSTRING(NPWP,10,3)+'.'+SUBSTRING(NPWP,13,3) where len(NPWP)=15

delete KertasKerjaPPH21
insert KertasKerjaPPH21
select * from #t1 order by NAMA,register
set nocount on
end
--set dateformat dmy exec KertasKerjaPPH21Excel_Konsol '01-08-2016'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[LoadPPH23]
@tanggal datetime
as
set dateformat dmy 
begin
set nocount on

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='D'
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL','TRANSAKSI') and dk='K'

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from kartu
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select a.kodeunit,c.NamaKebun as NamaKebun,a.norek,b.namarekening,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
from #t4 a
full outer join ref_rekening b on a.norek=b.norek and a.KodeUnit=b.KodeUnit
inner join Ref_Kebun c on a.KodeUnit=c.KodeKebun
where a.norek like '166%' and a.sawDebet+a.sawKredit+a.debet+a.kredit+a.sakDebet+a.sakKredit is not null
group by a.kodeunit,a.norek,b.namarekening,c.NamaKebun
order by norek
set nocount off
end

--set dateformat dmy exec LoadPPH23 '01-05-2016'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[Mapping_Rek154]
@kebun varchar(2),
@BulanKas int
as
set dateformat dmy
declare @TahunGaji INT
declare @BulanGaji INT
declare @TahunKas INT
declare @TahunBulan varchar(50)

set @TahunGaji=2018
set @BulanGaji=@BulanKas-1
--set @BulanGaji=12

set @TahunKas=2018

if @BulanKas<10
set @TahunBulan=cast(@TahunKas as varchar(4))+'0'+cast(@BulanKas as varchar(2))
else
set @TahunBulan=cast(@TahunKas as varchar(4))+cast(@BulanKas as varchar(2))


select Norek,NamaRekening into #Ref_Rekening from Ref_Rekening where KodeUnit=@kebun and Norek like '154%'

select @TahunBulan as Bulan,norek,nilai as Gaji,0 as Kas,0 as JLL into #t1 from GajiJurnal where MONTH(tanggal)=@BulanGaji and YEAR(tanggal)=@TahunGaji and DK='D' and norek like '154%' and kodeunit=@kebun
union all
select @TahunBulan as Bulan,norek,-1*nilai,0 as Kas,0 as JLL from GajiJurnal where MONTH(tanggal)=@BulanGaji and YEAR(tanggal)=@TahunGaji and DK='K' and norek like '154%' and kodeunit=@kebun
union all
select @TahunBulan as Bulan,Norek,0 as Gaji,Nilai,0 as JLL from KasBank where MONTH(Tanggal)=@BulanKas and YEAR(Tanggal)=@TahunKas and Norek like '154%' and kodeunit=@kebun
--union all
--select @TahunBulan as Bulan,norek,0 as Gaji,0 as Kas,nilai as JLL from AkunMemorial where NoInput like 'JLL%' and MONTH(tanggal)=@BulanGaji and YEAR(tanggal)=@TahunGaji and norek like '154%' and DK='D' and KodeUnit=@kebun
--union all
--select @TahunBulan as Bulan,norek,0 as Gaji,0 as Kas,-1*nilai as JLL from AkunMemorial where NoInput like 'JLL%' and MONTH(tanggal)=@BulanGaji and YEAR(tanggal)=@TahunGaji and norek like '154%' and DK='K' and KodeUnit=@kebun

--RESULT
select a.Bulan,SUBSTRING(a.norek,1,3)+'.'+SUBSTRING(a.norek,4,2)+'.'+SUBSTRING(a.norek,6,2)+'.'+SUBSTRING(a.norek,8,2) as Norek,b.NamaRekening,
SUM(a.Gaji) as Gaji,SUM(a.Kas) as Kas 
from #t1 a 
full outer join #Ref_Rekening b on a.norek=b.Norek
where a.norek is not null
group by a.bulan,a.norek,b.NamaRekening
order by a.norek


--exec Mapping_Rek154 '12',1

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[Mapping_Rek154_SaldoAwal]
@kodeunit varchar(2)
as
select norek,nilai into #t1 from AkunMemorial where KodeUnit=@kodeunit and MONTH(tanggal)=2 and YEAR(tanggal)=2016 and norek like '154%' and DK='D' and NoInput='SALDO AWAL'
union all
select norek,-1*nilai from AkunMemorial where KodeUnit=@kodeunit and MONTH(tanggal)=2 and YEAR(tanggal)=2016 and norek like '154%' and DK='K' and NoInput='SALDO AWAL'

select SUBSTRING(a.norek,1,3)+'.'+SUBSTRING(a.norek,4,2)+'.'+SUBSTRING(a.norek,6,2)+'.'+SUBSTRING(a.norek,8,2) as Norek,b.NamaRekening,SUM(a.nilai) as Nilai from #t1 a
inner join Ref_Rekening b on a.norek=b.Norek and @kodeunit=b.KodeUnit
group by a.norek,b.NamaRekening
order by norek

--exec Mapping_Rek154_SaldoAwal '12'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[Mapping_Rek154Neraca]
@tanggal datetime,
@kdunit varchar(2)
as
begin
set dateformat dmy 
set nocount on
declare @NamaKebun varchar(50)
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime
declare @thn varchar(50)

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @NamaKebun=(select top 1 NamaKebun from Ref_Kebun where KodeKebun=@kdunit)
if MONTH(@tanggal)<10
set @thn=cast(YEAR(@tanggal) as varchar(4))+'0'+cast(MONTH(@tanggal) as varchar(2))
else
set @thn=cast(YEAR(@tanggal) as varchar(4))+cast(MONTH(@tanggal) as varchar(2))

select * into #Ref_Rekening from Ref_Rekening where KodeUnit=@kdunit
select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@TglAkhir and KodeUnit=@kdunit 

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=2 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D' and KodeUnit=@kdunit
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=2 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K' and KodeUnit=@kdunit
union all
select KodeUnit,Norek,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where Tanggal>=@TglAwal and Tanggal<=@tglakhir and KodeUnit=@kdunit and Aplikasi<>'GUP'
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select a.kodeunit,@thn as blth,a.norek,b.namarekening,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
from #t4 a
full outer join #Ref_Rekening b on a.norek=b.norek
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null  and a.norek like '154%'
group by a.kodeunit,a.norek,b.namarekening
order by norek

end

--set dateformat dmy exec Mapping_Rek154Neraca '01-02-2016','44'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[MonitoringBiayaAkselerasi]
@Tanggal datetime,
@kodeunit varchar(2)
as
set dateformat dmy
drop table xyz
declare @AwalTahun datetime
declare @AkhirTahun datetime
set @AwalTahun='01-01-'+cast(YEAR(@Tanggal) as varchar(4))
set @AkhirTahun='31-12-'+cast(YEAR(@Tanggal) as varchar(4))

select Tanggal,KodeUnit,Norek,'L' as Unsur,Nilai,'KAS' as Aplikasi    into #t1 from KasBank where KMK='02' and Tanggal>=@AwalTahun and Tanggal<=@AkhirTahun and Nilai<>0 and noinput<>'SALDO AWAL' and KodeUnit=@kodeunit and KT in ('KK','BK') and SUBSTRING(Norek,1,3) in ('601','602','604')
union all
select tanggal,KodeUnit,Norek,'B' as Unsur,Nilai,'TUP' as Aplikasi    from TUP where KMK='02' and Tanggal>=@AwalTahun and Tanggal<=@AkhirTahun and nilai<>0 and noinput like 'A58%' and KodeUnit=@kodeunit and SUBSTRING(Norek,1,3) in ('601','602','604')
union all
select tanggal,KodeUnit,Norek,'L' as Unsur,Nilai,'AKN' as Aplikasi    from AkunMemorial where KMK='02' and NoInput like 'JLL' and Tanggal>=@AwalTahun and Tanggal<=@AkhirTahun and nilai<>0 and DK='D' and KodeUnit=@kodeunit and SUBSTRING(Norek,1,3) in ('601','602','604')
union all
select tanggal,KodeUnit,Norek,'L' as Unsur,-1*Nilai,'AKN' as Aplikasi    from AkunMemorial where KMK='02' and NoInput like 'JLL' and Tanggal>=@AwalTahun and Tanggal<=@AkhirTahun and nilai<>0 and DK='K' and KodeUnit=@kodeunit and SUBSTRING(Norek,1,3) in ('601','602','604')
union all
select tanggal,kodeunit,norek,'G' as Unsur,jmlupah,'GUP' as Aplikasi  from GajiAbsensi where KMK='02' and jmlupah<>0 and Tanggal>=@AwalTahun and Tanggal<=@AkhirTahun and KodeUnit=@kodeunit and SUBSTRING(Norek,1,3) in ('601','602','604')
union all
select tanggal,kodeunit,norek,'G' as Unsur,nilai,'GUP' as Aplikasi    from GajiKulir where KMK='02' and nilai<>0 and Tanggal>=@AwalTahun and Tanggal<=@AkhirTahun and KodeUnit=@kodeunit and SUBSTRING(Norek,1,3) in ('601','602','604')
union all
select tanggal,kodeunit,norek,'G' as Unsur,nilai,'GUP' as Aplikasi    from GajiPremi where KMK='02' and nilai<>0 and Tanggal>=@AwalTahun and Tanggal<=@AkhirTahun and KodeUnit=@kodeunit and SUBSTRING(Norek,1,3) in ('601','602','604')
union all
select tanggal,kodeunit,norek,'G' as Unsur,jmlpremi,'GUP' as Aplikasi from GajiPremiPanen where KMK='02' and jmlpremi<>0 and Tanggal>=@AwalTahun and Tanggal<=@AkhirTahun and KodeUnit=@kodeunit and SUBSTRING(Norek,1,3) in ('601','602','604')
union all
select tanggal,kodeunit,norek,'G' as Unsur,jmlupah,'GUP' as Aplikasi   from GajiSPKHonor where KMK='02' and jmlupah<>0 and Tanggal>=@AwalTahun and Tanggal<=@AkhirTahun and KodeUnit=@kodeunit and SUBSTRING(Norek,1,3) in ('601','602','604')
union all
select tanggal,kodeunit,norek,'G' as Unsur,nilai_PMK,'PKB' as Aplikasi   from AkunRKAP where KMK='02' and nilai_PMK<>0 and unsur='GU' and Tanggal>=@AwalTahun and Tanggal<=@AkhirTahun and KodeUnit=@kodeunit and SUBSTRING(Norek,1,3) in ('601','602','604')
union all
select tanggal,kodeunit,norek,'B' as Unsur,nilai_PMK,'PKB' as Aplikasi   from AkunRKAP where KMK='02' and nilai_PMK<>0 and unsur='BB' and Tanggal>=@AwalTahun and Tanggal<=@AkhirTahun and KodeUnit=@kodeunit and SUBSTRING(Norek,1,3) in ('601','602','604')
union all
select tanggal,kodeunit,norek,'L' as Unsur,nilai_PMK,'PKB' as Aplikasi   from AkunRKAP where KMK='02' and nilai_PMK<>0 and unsur='LL' and Tanggal>=@AwalTahun and Tanggal<=@AkhirTahun and KodeUnit=@kodeunit and SUBSTRING(Norek,1,3) in ('601','602','604')

--PROSES PER UNSUR BI
select Norek,Nilai as GUPBI,0 as BBBI,0 as LLBI,0 as GUPSBI,0 as BBSBI,0 as LLSBI,0 as GUPABI,0 as BBABI,0 AS LLABI,0 AS GUPASBI,0 AS BBASBI,0 AS LLASBI into #t2 from #t1 where MONTH(Tanggal)=MONTH(@Tanggal) and YEAR(Tanggal)=YEAR(@Tanggal) and Unsur='G'
union all
select Norek,0 as GUPBI,Nilai as BBBI,0 as LLBI,0 as GUPSBI,0 as BBSBI,0 as LLSBI,0 as GUPABI,0 as BBABI,0 AS LLABI,0 AS GUPASBI,0 AS BBASBI,0 AS LLASBI from #t1 where MONTH(Tanggal)=MONTH(@Tanggal) and YEAR(Tanggal)=YEAR(@Tanggal) and Unsur='B'
union all
select Norek,0 as GUPBI,0 as BBBI,Nilai as LLBI,0 as GUPSBI,0 as BBSBI,0 as LLSBI,0 as GUPABI,0 as BBABI,0 AS LLABI,0 AS GUPASBI,0 AS BBASBI,0 AS LLASBI from #t1 where MONTH(Tanggal)=MONTH(@Tanggal) and YEAR(Tanggal)=YEAR(@Tanggal) and Unsur='L'
union all

--PROSES PER UNSUR SBI
select Norek,0 as GUPBI,0 as BBBI,0 as LLBI,Nilai as GUPSBI,0 as BBSBI,0 as LLSBI,0 as GUPABI,0 as BBABI,0 AS LLABI,0 AS GUPASBI,0 AS BBASBI,0 AS LLASBI from #t1 where Tanggal>=@AwalTahun and Tanggal<=@Tanggal and Unsur='G'
union all
select Norek,0 as GUPBI,0 as BBBI,0 as LLBI,0 as GUPSBI,Nilai as BBSBI,0 as LLSBI,0 as GUPABI,0 as BBABI,0 AS LLABI,0 AS GUPASBI,0 AS BBASBI,0 AS LLASBI from #t1 where Tanggal>=@AwalTahun and Tanggal<=@Tanggal and Unsur='B'
union all
select Norek,0 as GUPBI,0 as BBBI,0 as LLBI,0 as GUPSBI,0 as BBSBI,Nilai as LLSBI,0 as GUPABI,0 as BBABI,0 AS LLABI,0 AS GUPASBI,0 AS BBASBI,0 AS LLASBI from #t1 where Tanggal>=@AwalTahun and Tanggal<=@Tanggal and Unsur='L'
union all

--PROSES PER UNSUR ABI
select Norek,0 as GUPBI,0 as BBBI,0 as LLBI,0 as GUPSBI,0 as BBSBI,0 as LLSBI,Nilai as GUPABI,0 as BBABI,0 AS LLABI,0 AS GUPASBI,0 AS BBASBI,0 AS LLASBI from #t1 where MONTH(Tanggal)=MONTH(@Tanggal) and YEAR(Tanggal)=YEAR(@Tanggal) and Unsur='G'
union all
select Norek,0 as GUPBI,0 as BBBI,0 as LLBI,0 as GUPSBI,0 as BBSBI,0 as LLSBI,0 as GUPABI,Nilai as BBABI,0 AS LLABI,0 AS GUPASBI,0 AS BBASBI,0 AS LLASBI from #t1 where MONTH(Tanggal)=MONTH(@Tanggal) and YEAR(Tanggal)=YEAR(@Tanggal) and Unsur='B'
union all
select Norek,0 as GUPBI,0 as BBBI,0 as LLBI,0 as GUPSBI,0 as BBSBI,0 as LLSBI,0 as GUPABI,0 as BBABI,Nilai AS LLABI,0 AS GUPASBI,0 AS BBASBI,0 AS LLASBI from #t1 where MONTH(Tanggal)=MONTH(@Tanggal) and YEAR(Tanggal)=YEAR(@Tanggal) and Unsur='L'
union all

--PROSES PER UNSUR ASBI
select Norek,0 as GUPBI,0 as BBBI,0 as LLBI,0 as GUPSBI,0 as BBSBI,0 as LLSBI,0 as GUPABI,0 as BBABI,0 AS LLABI,Nilai AS GUPASBI,0 AS BBASBI,0 AS LLASBI from #t1 where Tanggal>=@AwalTahun and Tanggal<=@Tanggal and Unsur='G'
union all
select Norek,0 as GUPBI,0 as BBBI,0 as LLBI,0 as GUPSBI,0 as BBSBI,0 as LLSBI,0 as GUPABI,0 as BBABI,0 AS LLABI,0 AS GUPASBI,Nilai AS BBASBI,0 AS LLASBI from #t1 where Tanggal>=@AwalTahun and Tanggal<=@Tanggal and Unsur='B'
union all
select Norek,0 as GUPBI,0 as BBBI,0 as LLBI,0 as GUPSBI,0 as BBSBI,0 as LLSBI,0 as GUPABI,0 as BBABI,0 AS LLABI,0 AS GUPASBI,0 AS BBASBI,Nilai AS LLASBI from #t1 where Tanggal>=@AwalTahun and Tanggal<=@Tanggal and Unsur='L'

select a.Norek,b.NamaRekening,
sum(a.GUPBI) as GUPBI,sum(a.BBBI) as BBBI,sum(a.LLBI) as LLBI,SUM(a.GUPBI+a.BBBI+a.LLBI) as JMLBI,
sum(a.GUPSBI) as GUPSBI,sum(a.BBSBI) as BBSBI,sum(a.LLSBI) as LLSBI,SUM(a.GUPSBI+a.BBSBI+a.LLSBI) as JMLSBI,
sum(a.GUPABI) as GUPABI,sum(a.BBABI) as BBABI,sum(a.LLABI) as LLABI,SUM(a.GUPABI+a.BBABI+a.LLABI) as JMLABI,
sum(a.GUPASBI) as GUPASBI,sum(a.BBASBI) as BBASBI,sum(a.LLASBI) as LLASBI,SUM(a.GUPASBI+a.BBASBI+a.LLASBI) as JMLASBI
into xyz
from #t2 a
inner join Ref_Rekening b on a.Norek=b.Norek and @kodeunit=b.KodeUnit
group by a.Norek,b.NamaRekening order by Norek


--set dateformat dmy exec MonitoringBiayaAkselerasi '31-12-2016','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create proc [dbo].[NeracaSaldo]
@tanggal datetime,
@kdunit varchar(2)
as
begin
set dateformat dmy 
set nocount on
declare @NamaKebun varchar(50)
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @NamaKebun=(select top 1 NamaKebun from Ref_Kebun where KodeKebun=@kdunit)

select * into #Ref_Rekening from Ref_Rekening where KodeUnit=@kdunit
select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@tglakhir and KodeUnit=@kdunit

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D' and KodeUnit=@kdunit
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K' and KodeUnit=@kdunit
union all
select KodeUnit,Norek,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where Tanggal>=@TglAwal and Tanggal<=@tglakhir and KodeUnit=@kdunit
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select a.kodeunit,a.norek,b.namarekening,'Kebun/Unit : '+@NamaKebun as NamaKebun,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
from #t4 a
full outer join #Ref_Rekening b on a.norek=b.norek
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null 
group by a.kodeunit,a.norek,b.namarekening
order by norek
end

--set dateformat dmy exec DSB_AKNcr700 '01-08-2017','40'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[NeracaSaldoKanpus]
@tanggal datetime,
@kdunit varchar(2)
as
begin
set dateformat dmy 
set nocount on
declare @NamaKebun varchar(50)
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @NamaKebun=(select top 1 NamaKebun from Ref_Kebun where KodeKebun=@kdunit)

select * into #Ref_Rekening from Ref_Rekening where KodeUnit=@kdunit
select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@tglakhir and KodeUnit=@kdunit

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D' and KodeUnit=@kdunit
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K' and KodeUnit=@kdunit
union all
select KodeUnit,Norek,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal and KodeUnit=@kdunit

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal where KodeUnit=@kdunit group by kodeunit,norek 

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0 and KodeUnit=@kdunit
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0 and KodeUnit=@kdunit
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where Tanggal>=@TglAwal and Tanggal<=@tglakhir and KodeUnit=@kdunit
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select a.kodeunit,a.norek,b.namarekening,'Kebun/Unit : '+@NamaKebun as NamaKebun,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
into #N1
from #t4 a
full outer join #Ref_Rekening b on a.norek=b.norek
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null 
group by a.kodeunit,a.norek,b.namarekening
order by norek

select SUM(sawDebet) as sawDebet,SUM(sawKredit) as sawKredit from #N1
end

--set dateformat dmy exec NeracaSaldoKanpus '01-05-2017','40'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[PersediaanAkhirBarang]
@Tanggal datetime
as
set dateformat dmy
declare @TglAwal datetime 
declare @TglAkhir datetime 
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select kodeunit,kodebarang,
sum(qty) as sawQty,sum(nilai) as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
into #t1
from tup
where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and noinput='SALDO AWAL'
group by kodeunit,kodebarang
union all

--MUTASI BULAN INI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal<'01-09-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal>='01-11-2014'
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal<'01-09-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal>='01-11-2014'
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and nilai>0) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=0 and nilai>0
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,sum(qty) as klrQty,sum(nilai) as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58'
group by kodeunit,kodebarang
union all
 
--KOREKSI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,sum(qty) as korQty,sum(nilai) as korNilai,0 as sakQty,0 as sakNilai
from tup
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR'
group by kodeunit,kodebarang

select a.KodeUnit,d.namakebun,b.norek,c.namarekening,a.kodebarang,b.namabarang,
sum(a.sawQty) as sawQty,sum(a.sawNilai) as sawNilai,sum(a.trmQty) as trmQty,sum(a.trmNilai) as trmNilai,
sum(a.klrQty) as klrQty,sum(a.klrNilai) as klrNilai,sum(a.korQty) as korQty,sum(a.korNilai) as korNilai,
sum(a.sawQty+a.trmQty-a.klrQty+a.korQty) as sakQty,sum(a.sawNilai+a.trmNilai-a.klrNilai+a.korNilai) as sakNilai
into #t2
from #t1 a
inner join SPDK_KBN_MASTER_REF..ref_barang b on a.kodebarang=b.kodebarang
inner join SPDK_KBN_MASTER_REF..ref_rekening c on b.norek=c.norek
inner join SPDK_KBN_MASTER_REF..ref_kebun d on a.kodeunit=d.kodekebun
where a.kodebarang='00301002'
group by a.KodeUnit,d.namakebun,b.norek,c.namarekening,a.kodebarang,b.namabarang

select * from #t2 --where KodeUnit in ('17','29','37','46','50','74')


--set dateformat dmy exec PersediaanAkhirBarang '01-01-2016'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[PersediaanAkhirBarang2015]
@Tanggal datetime
as
set dateformat dmy
declare @TglAwal datetime 
declare @TglAkhir datetime 
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select kodeunit,kodebarang,
sum(qty) as sawQty,sum(nilai) as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
into #t1
from TUP2015
where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and noinput='SALDO AWAL'
group by kodeunit,kodebarang
union all

--MUTASI BULAN INI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from TUP2015
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal<'01-09-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from TUP2015
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal>='01-11-2014'
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from TUP2015
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal<'01-09-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from TUP2015
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal>='01-11-2014'
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from TUP2015
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and nilai>0) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from TUP2015
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=0 and nilai>0
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,sum(qty) as klrQty,sum(nilai) as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from TUP2015
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58'
group by kodeunit,kodebarang
union all
 
--KOREKSI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,sum(qty) as korQty,sum(nilai) as korNilai,0 as sakQty,0 as sakNilai
from TUP2015
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR'
group by kodeunit,kodebarang

select a.KodeUnit,d.namakebun,b.norek,c.namarekening,a.kodebarang,b.namabarang,
sum(a.sawQty) as sawQty,sum(a.sawNilai) as sawNilai,sum(a.trmQty) as trmQty,sum(a.trmNilai) as trmNilai,
sum(a.klrQty) as klrQty,sum(a.klrNilai) as klrNilai,sum(a.korQty) as korQty,sum(a.korNilai) as korNilai,
sum(a.sawQty+a.trmQty-a.klrQty+a.korQty) as sakQty,sum(a.sawNilai+a.trmNilai-a.klrNilai+a.korNilai) as sakNilai
into #t2
from #t1 a
inner join SPDK_KBN_MASTER_REF..ref_barang b on a.kodebarang=b.kodebarang
inner join SPDK_KBN_MASTER_REF..ref_rekening c on b.norek=c.norek
inner join SPDK_KBN_MASTER_REF..ref_kebun d on a.kodeunit=d.kodekebun
where a.kodebarang='00301002'
group by a.KodeUnit,d.namakebun,b.norek,c.namarekening,a.kodebarang,b.namabarang

select @Tanggal as Tanggal,* from #t2 --where KodeUnit in ('17','29','37','46','50','74')


--set dateformat dmy exec PersediaanAkhirBarang2015 '01-06-2015'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[PivotPersediaan]
@Tanggal datetime
as
set dateformat dmy
set nocount on
begin
Declare @t VARCHAR(10)
Declare @A VARCHAR(1000)
Declare @B VARCHAR(1000)

declare @TglAwal datetime 
declare @TglAkhir datetime 
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select * into #TUP from TUP where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) order by KodeUnit

select kodeunit,kodebarang,
sum(qty) as sawQty,sum(nilai) as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
into #t1
from #TUP
where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and noinput='SALDO AWAL'
group by kodeunit,kodebarang
union all

--MUTASI BULAN INI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal<'01-09-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal>='01-11-2014'
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal<'01-09-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal>='01-11-2014'
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and nilai>0) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=0 and nilai>0
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,sum(qty) as klrQty,sum(nilai) as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58'
group by kodeunit,kodebarang
union all
 
--KOREKSI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,sum(qty) as korQty,sum(nilai) as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR'
group by kodeunit,kodebarang

select a.KodeUnit,b.norek,c.namarekening,a.kodebarang,b.namabarang,
sum(a.sawQty) as sawQty,sum(a.sawNilai) as sawNilai,sum(a.trmQty) as trmQty,sum(a.trmNilai) as trmNilai,
sum(a.klrQty) as klrQty,sum(a.klrNilai) as klrNilai,sum(a.korQty) as korQty,sum(a.korNilai) as korNilai,
sum(a.sawQty+a.trmQty-a.klrQty+a.korQty) as sakQty,sum(a.sawNilai+a.trmNilai-a.klrNilai+a.korNilai) as sakNilai
into #t2
from #t1 a
inner join SPDK_KBN_MASTER_REF..ref_barang b   on a.kodebarang=b.kodebarang
inner join SPDK_KBN_MASTER_REF..ref_rekening c on b.norek=c.norek
inner join SPDK_KBN_MASTER_REF..ref_kebun d    on a.kodeunit=d.kodekebun
group by a.KodeUnit,b.norek,c.namarekening,a.kodebarang,b.namabarang
order by a.KodeUnit

select KodeUnit,kodebarang,NamaBarang,sakQty,sakNilai into #t3 from #t2 order by KodeUnit,NamaBarang 

drop table xxxx

set @A='SELECT NamaBarang'
SET @B='('
SELECT @A=@A+',['+substring(KodeUnit,1,2)+'] as [' +substring(KodeUnit,1,2)+']',@B=@B+'['+substring(KodeUnit,1,2)+'],'
FROM (SELECT DISTINCT KodeUnit FROM #t3 ) cur
SET @B=SUBSTRING(@B,1,LEN(@B)-1)
SET @A=@A+ + ' into xxxx FROM (SELECT NamaBarang, sakQty, substring(KodeUnit,1,2) as KodeUnit FROM #t3 ) s  

PIVOT 
(sum(sakQty) FOR KodeUnit IN ' +@B+')) p ORDER BY [namabarang]; '
exec(@A)

set nocount off
end


--set dateformat dmy exec PivotPersediaan '01-01-2017'

--select top 10 * from TUP where MONTH(tanggal)=1 and YEAR(tanggal)=2017

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[PivotPersediaan2]
@Tanggal datetime
as
set dateformat dmy
set nocount on
begin
Declare @t VARCHAR(10)
Declare @A VARCHAR(1000)
Declare @B VARCHAR(1000)

declare @TglAwal datetime 
declare @TglAkhir datetime 
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select * into #TUP from TUP where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) order by KodeUnit

select kodeunit,kodebarang,
sum(qty) as sawQty,sum(nilai) as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
into #t1
from #TUP
where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and noinput='SALDO AWAL'
group by kodeunit,kodebarang
union all

--MUTASI BULAN INI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal<'01-09-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal>='01-11-2014'
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal<'01-09-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal>='01-11-2014'
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and nilai>0) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=0 and nilai>0
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,sum(qty) as klrQty,sum(nilai) as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58'
group by kodeunit,kodebarang
union all
 
--KOREKSI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,sum(qty) as korQty,sum(nilai) as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR'
group by kodeunit,kodebarang

select a.KodeUnit,b.norek,c.namarekening,a.kodebarang,b.namabarang,
sum(a.sawQty) as sawQty,sum(a.sawNilai) as sawNilai,sum(a.trmQty) as trmQty,sum(a.trmNilai) as trmNilai,
sum(a.klrQty) as klrQty,sum(a.klrNilai) as klrNilai,sum(a.korQty) as korQty,sum(a.korNilai) as korNilai,
sum(a.sawQty+a.trmQty-a.klrQty+a.korQty) as sakQty,sum(a.sawNilai+a.trmNilai-a.klrNilai+a.korNilai) as sakNilai
into #t2
from #t1 a
inner join SPDK_KBN_MASTER_REF..ref_barang b   on a.kodebarang=b.kodebarang
inner join SPDK_KBN_MASTER_REF..ref_rekening c on b.norek=c.norek
inner join SPDK_KBN_MASTER_REF..ref_kebun d    on a.kodeunit=d.kodekebun
group by a.KodeUnit,b.norek,c.namarekening,a.kodebarang,b.namabarang
order by a.KodeUnit

select KodeUnit,kodebarang,NamaBarang,sakNilai/sakQty as sakQty
into #t3 
from #t2
where sakQty>0 


drop table PivotBBTemp,PivotBBHrg

set @A='SELECT NamaBarang'
SET @B='('
SELECT @A=@A+',['+substring(KodeUnit,1,2)+'] as [' +substring(KodeUnit,1,2)+']',@B=@B+'['+substring(KodeUnit,1,2)+'],' FROM (SELECT DISTINCT KodeUnit FROM #t3) cur
SET @B=SUBSTRING(@B,1,LEN(@B)-1)
SET @A=@A+ + ' into PivotBBTemp FROM (SELECT NamaBarang, sakQty, KodeUnit as KodeUnit FROM #t3) s  PIVOT (sum(sakQty) FOR KodeUnit IN ' +@B+')) p ORDER BY [namabarang]; '
exec(@A)

update PivotBBTemp set[10]=0 where [10] is null
update PivotBBTemp set[11]=0 where [11] is null
update PivotBBTemp set[12]=0 where [12] is null
update PivotBBTemp set[13]=0 where [13] is null
update PivotBBTemp set[14]=0 where [14] is null
update PivotBBTemp set[15]=0 where [15] is null
update PivotBBTemp set[16]=0 where [16] is null
update PivotBBTemp set[17]=0 where [17] is null
update PivotBBTemp set[18]=0 where [18] is null
update PivotBBTemp set[19]=0 where [19] is null
update PivotBBTemp set[20]=0 where [20] is null
update PivotBBTemp set[21]=0 where [21] is null
update PivotBBTemp set[22]=0 where [22] is null
update PivotBBTemp set[23]=0 where [23] is null
update PivotBBTemp set[24]=0 where [24] is null
update PivotBBTemp set[25]=0 where [25] is null
update PivotBBTemp set[28]=0 where [28] is null
update PivotBBTemp set[29]=0 where [29] is null
update PivotBBTemp set[31]=0 where [31] is null
update PivotBBTemp set[32]=0 where [32] is null
update PivotBBTemp set[33]=0 where [33] is null
update PivotBBTemp set[34]=0 where [34] is null
update PivotBBTemp set[35]=0 where [35] is null
update PivotBBTemp set[36]=0 where [36] is null
update PivotBBTemp set[37]=0 where [37] is null
update PivotBBTemp set[39]=0 where [39] is null
update PivotBBTemp set[40]=0 where [40] is null
update PivotBBTemp set[41]=0 where [41] is null
update PivotBBTemp set[42]=0 where [42] is null
update PivotBBTemp set[43]=0 where [43] is null
update PivotBBTemp set[44]=0 where [44] is null
update PivotBBTemp set[45]=0 where [45] is null
update PivotBBTemp set[46]=0 where [46] is null
update PivotBBTemp set[47]=0 where [47] is null
update PivotBBTemp set[49]=0 where [49] is null
update PivotBBTemp set[50]=0 where [50] is null
update PivotBBTemp set[62]=0 where [62] is null
update PivotBBTemp set[64]=0 where [64] is null
update PivotBBTemp set[65]=0 where [65] is null
update PivotBBTemp set[68]=0 where [68] is null
update PivotBBTemp set[69]=0 where [69] is null
update PivotBBTemp set[71]=0 where [71] is null
update PivotBBTemp set[72]=0 where [72] is null
update PivotBBTemp set[74]=0 where [74] is null

select @Tanggal as tanggal,namabarang,
[10] as KB10,
[11] as KB11,
[12] as KB12,
[13] as KB13,
[14] as KB14,
[15] as KB15,
[16] as KB16,
[17] as KB17,
[18] as KB18,
[19] as KB19,
[20] as KB20,
[21] as KB21,
[22] as KB22,
[23] as KB23,
[24] as KB24,
[25] as KB25,
[28] as KB28,
[29] as KB29,
[31] as KB31,
[32] as KB32,
[33] as KB33,
[34] as KB34,
[35] as KB35,
[36] as KB36,
[37] as KB37,
[39] as KB39,
[40] as KB40,
[41] as KB41,
[42] as KB42,
[43] as KB43,
[44] as KB44,
[45] as KB45,
[46] as KB46,
[47] as KB47,
[49] as KB49,
[50] as KB50,
[62] as KB62,
[64] as KB64,
[65] as KB65,
[68] as KB68,
[69] as KB69,
[71] as KB71,
[72] as KB72,
[74] as KB74
into PivotBBHrg
from PivotBBTemp


set nocount off
end


--set dateformat dmy exec PivotPersediaan2 '01-02-2017'

--select top 10 * from TUP where MONTH(tanggal)=1 and YEAR(tanggal)=2017

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[PivotPersediaanadhoc]
@Tanggal datetime
as
set dateformat dmy
set nocount on
begin
Declare @t VARCHAR(10)
Declare @A VARCHAR(1000)
Declare @B VARCHAR(1000)

declare @TglAwal datetime 
declare @TglAkhir datetime 
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select * into #TUP from TUP where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) order by KodeUnit

select kodeunit,kodebarang,
sum(qty) as sawQty,sum(nilai) as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
into #t1
from #TUP
where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and noinput='SALDO AWAL'
group by kodeunit,kodebarang
union all

--MUTASI BULAN INI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal<'01-09-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal>='01-11-2014'
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal<'01-09-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal>='01-11-2014'
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and nilai>0) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=0 and nilai>0
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,sum(qty) as klrQty,sum(nilai) as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58'
group by kodeunit,kodebarang
union all
 
--KOREKSI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,sum(qty) as korQty,sum(nilai) as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR'
group by kodeunit,kodebarang

select a.KodeUnit,b.norek,c.namarekening,a.kodebarang,b.namabarang,
sum(a.sawQty) as sawQty,sum(a.sawNilai) as sawNilai,sum(a.trmQty) as trmQty,sum(a.trmNilai) as trmNilai,
sum(a.klrQty) as klrQty,sum(a.klrNilai) as klrNilai,sum(a.korQty) as korQty,sum(a.korNilai) as korNilai,
sum(a.sawQty+a.trmQty-a.klrQty+a.korQty) as sakQty,sum(a.sawNilai+a.trmNilai-a.klrNilai+a.korNilai) as sakNilai
into #t2
from #t1 a
inner join SPDK_KBN_MASTER_REF..ref_barang b   on a.kodebarang=b.kodebarang
inner join SPDK_KBN_MASTER_REF..ref_rekening c on b.norek=c.norek
inner join SPDK_KBN_MASTER_REF..ref_kebun d    on a.kodeunit=d.kodekebun
group by a.KodeUnit,b.norek,c.namarekening,a.kodebarang,b.namabarang
order by a.KodeUnit

select KodeUnit,kodebarang,NamaBarang,sawQty,trmQty,klrQty,korqty,sakQty
into #t3 
from #t2
where sakQty>0 and kodebarang like '00201%'


--drop table Pivotnilai,PivotBBHrg
select * from #t3
--set @A='SELECT NamaBarang'
--SET @B='('
--SELECT @A=@A+',['+substring(KodeUnit,1,2)+'] as [' +substring(KodeUnit,1,2)+']',@B=@B+'['+substring(KodeUnit,1,2)+'],' FROM (SELECT DISTINCT KodeUnit FROM #t3) cur
--SET @B=SUBSTRING(@B,1,LEN(@B)-1)
--SET @A=@A+ + ' into Pivotnilai  FROM (SELECT NamaBarang, saknilai, KodeUnit as KodeUnit FROM #t3) s  PIVOT (sum(saknilai) FOR KodeUnit IN ' +@B+')) p ORDER BY [namabarang]; '
--exec(@A)

--update Pivotnilai set[10]=0 where [10] is null
--update Pivotnilai set[11]=0 where [11] is null
--update Pivotnilai set[12]=0 where [12] is null
--update Pivotnilai set[13]=0 where [13] is null
--update Pivotnilai set[14]=0 where [14] is null
--update Pivotnilai set[15]=0 where [15] is null
--update Pivotnilai set[16]=0 where [16] is null
--update Pivotnilai set[17]=0 where [17] is null
--update Pivotnilai set[18]=0 where [18] is null
--update Pivotnilai set[19]=0 where [19] is null
--update Pivotnilai set[20]=0 where [20] is null
--update Pivotnilai set[21]=0 where [21] is null
--update Pivotnilai set[22]=0 where [22] is null
--update Pivotnilai set[23]=0 where [23] is null
--update Pivotnilai set[24]=0 where [24] is null
--update Pivotnilai set[25]=0 where [25] is null
--update Pivotnilai set[28]=0 where [28] is null
--update Pivotnilai set[29]=0 where [29] is null
--update Pivotnilai set[31]=0 where [31] is null
--update Pivotnilai set[32]=0 where [32] is null
--update Pivotnilai set[33]=0 where [33] is null
--update Pivotnilai set[34]=0 where [34] is null
--update Pivotnilai set[35]=0 where [35] is null
--update Pivotnilai set[36]=0 where [36] is null
--update Pivotnilai set[37]=0 where [37] is null
--update Pivotnilai set[39]=0 where [39] is null
--update Pivotnilai set[40]=0 where [40] is null
--update Pivotnilai set[41]=0 where [41] is null
--update Pivotnilai set[42]=0 where [42] is null
--update Pivotnilai set[43]=0 where [43] is null
--update Pivotnilai set[44]=0 where [44] is null
--update Pivotnilai set[45]=0 where [45] is null
--update Pivotnilai set[46]=0 where [46] is null
--update Pivotnilai set[47]=0 where [47] is null
--update Pivotnilai set[49]=0 where [49] is null
--update Pivotnilai set[50]=0 where [50] is null
--update Pivotnilai set[62]=0 where [62] is null
--update Pivotnilai set[64]=0 where [64] is null
--update Pivotnilai set[65]=0 where [65] is null
--update Pivotnilai set[68]=0 where [68] is null
--update Pivotnilai set[69]=0 where [69] is null
--update Pivotnilai set[71]=0 where [71] is null
--update Pivotnilai set[72]=0 where [72] is null
--update Pivotnilai set[74]=0 where [74] is null

----select @Tanggal as tanggal,namabarang,
----[10] as KB10,
--[11] as KB11,
--[12] as KB12,
--[13] as KB13,
--[14] as KB14,
--[15] as KB15,
--[16] as KB16,
--[17] as KB17,
--[18] as KB18,
--[19] as KB19,
--[20] as KB20,
--[21] as KB21,
--[22] as KB22,
--[23] as KB23,
--[24] as KB24,
--[25] as KB25,
--[28] as KB28,
--[29] as KB29,
--[31] as KB31,
--[32] as KB32,
--[33] as KB33,
--[34] as KB34,
--[35] as KB35,
--[36] as KB36,
--[37] as KB37,
--[39] as KB39,
--[40] as KB40,
--[41] as KB41,
--[42] as KB42,
--[43] as KB43,
--[44] as KB44,
--[45] as KB45,
--[46] as KB46,
--[47] as KB47,
--[49] as KB49,
--[50] as KB50,
--[62] as KB62,
--[64] as KB64,
--[65] as KB65,
--[68] as KB68,
--[69] as KB69,
--[71] as KB71,
--[72] as KB72,
--[74] as KB74
--into PivotBBHrg
--from PivotBBTemp


set nocount off
end


--set dateformat dmy exec PivotPersediaanadhoc '01-12-2016'

--select top 10 * from TUP where MONTH(tanggal)=1 and YEAR(tanggal)=2017

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[PivotPersediaanNilai]
@Tanggal datetime
as
set dateformat dmy
set nocount on
begin
Declare @t VARCHAR(10)
Declare @A VARCHAR(1000)
Declare @B VARCHAR(1000)

declare @TglAwal datetime 
declare @TglAkhir datetime 
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select * into #TUP from TUP where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) order by KodeUnit

select kodeunit,kodebarang,
sum(qty) as sawQty,sum(nilai) as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
into #t1
from #TUP
where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and noinput='SALDO AWAL'
group by kodeunit,kodebarang
union all

--MUTASI BULAN INI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal<'01-09-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=1 and nilai>0) and tanggal>='01-11-2014'
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal<'01-09-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and status=2 and nilai>0) and tanggal>='01-11-2014'
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum((nilai*.1)+nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=1 and nilai>0) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,sum(nilai) as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and ppn=0 and nilai>0
group by kodeunit,kodebarang
union all
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,sum(qty) as klrQty,sum(nilai) as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58'
group by kodeunit,kodebarang
union all
 
--KOREKSI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,sum(qty) as korQty,sum(nilai) as korNilai,0 as sakQty,0 as sakNilai
from #TUP
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR'
group by kodeunit,kodebarang

select a.KodeUnit,b.norek,c.namarekening,a.kodebarang,b.namabarang,
sum(a.sawQty) as sawQty,sum(a.sawNilai) as sawNilai,sum(a.trmQty) as trmQty,sum(a.trmNilai) as trmNilai,
sum(a.klrQty) as klrQty,sum(a.klrNilai) as klrNilai,sum(a.korQty) as korQty,sum(a.korNilai) as korNilai,
sum(a.sawQty+a.trmQty-a.klrQty+a.korQty) as sakQty,sum(a.sawNilai+a.trmNilai-a.klrNilai+a.korNilai) as sakNilai
into #t2
from #t1 a
inner join SPDK_KBN_MASTER_REF..ref_barang b   on a.kodebarang=b.kodebarang
inner join SPDK_KBN_MASTER_REF..ref_rekening c on b.norek=c.norek
inner join SPDK_KBN_MASTER_REF..ref_kebun d    on a.kodeunit=d.kodekebun
group by a.KodeUnit,b.norek,c.namarekening,a.kodebarang,b.namabarang
order by a.KodeUnit

select KodeUnit,kodebarang,NamaBarang,sakNilai ,sakQty
into #t3 
from #t2
where sakQty>0 


--drop table Pivotnilai,PivotBBHrg
select * from #t3
--set @A='SELECT NamaBarang'
--SET @B='('
--SELECT @A=@A+',['+substring(KodeUnit,1,2)+'] as [' +substring(KodeUnit,1,2)+']',@B=@B+'['+substring(KodeUnit,1,2)+'],' FROM (SELECT DISTINCT KodeUnit FROM #t3) cur
--SET @B=SUBSTRING(@B,1,LEN(@B)-1)
--SET @A=@A+ + ' into Pivotnilai  FROM (SELECT NamaBarang, saknilai, KodeUnit as KodeUnit FROM #t3) s  PIVOT (sum(saknilai) FOR KodeUnit IN ' +@B+')) p ORDER BY [namabarang]; '
--exec(@A)

--update Pivotnilai set[10]=0 where [10] is null
--update Pivotnilai set[11]=0 where [11] is null
--update Pivotnilai set[12]=0 where [12] is null
--update Pivotnilai set[13]=0 where [13] is null
--update Pivotnilai set[14]=0 where [14] is null
--update Pivotnilai set[15]=0 where [15] is null
--update Pivotnilai set[16]=0 where [16] is null
--update Pivotnilai set[17]=0 where [17] is null
--update Pivotnilai set[18]=0 where [18] is null
--update Pivotnilai set[19]=0 where [19] is null
--update Pivotnilai set[20]=0 where [20] is null
--update Pivotnilai set[21]=0 where [21] is null
--update Pivotnilai set[22]=0 where [22] is null
--update Pivotnilai set[23]=0 where [23] is null
--update Pivotnilai set[24]=0 where [24] is null
--update Pivotnilai set[25]=0 where [25] is null
--update Pivotnilai set[28]=0 where [28] is null
--update Pivotnilai set[29]=0 where [29] is null
--update Pivotnilai set[31]=0 where [31] is null
--update Pivotnilai set[32]=0 where [32] is null
--update Pivotnilai set[33]=0 where [33] is null
--update Pivotnilai set[34]=0 where [34] is null
--update Pivotnilai set[35]=0 where [35] is null
--update Pivotnilai set[36]=0 where [36] is null
--update Pivotnilai set[37]=0 where [37] is null
--update Pivotnilai set[39]=0 where [39] is null
--update Pivotnilai set[40]=0 where [40] is null
--update Pivotnilai set[41]=0 where [41] is null
--update Pivotnilai set[42]=0 where [42] is null
--update Pivotnilai set[43]=0 where [43] is null
--update Pivotnilai set[44]=0 where [44] is null
--update Pivotnilai set[45]=0 where [45] is null
--update Pivotnilai set[46]=0 where [46] is null
--update Pivotnilai set[47]=0 where [47] is null
--update Pivotnilai set[49]=0 where [49] is null
--update Pivotnilai set[50]=0 where [50] is null
--update Pivotnilai set[62]=0 where [62] is null
--update Pivotnilai set[64]=0 where [64] is null
--update Pivotnilai set[65]=0 where [65] is null
--update Pivotnilai set[68]=0 where [68] is null
--update Pivotnilai set[69]=0 where [69] is null
--update Pivotnilai set[71]=0 where [71] is null
--update Pivotnilai set[72]=0 where [72] is null
--update Pivotnilai set[74]=0 where [74] is null

----select @Tanggal as tanggal,namabarang,
----[10] as KB10,
--[11] as KB11,
--[12] as KB12,
--[13] as KB13,
--[14] as KB14,
--[15] as KB15,
--[16] as KB16,
--[17] as KB17,
--[18] as KB18,
--[19] as KB19,
--[20] as KB20,
--[21] as KB21,
--[22] as KB22,
--[23] as KB23,
--[24] as KB24,
--[25] as KB25,
--[28] as KB28,
--[29] as KB29,
--[31] as KB31,
--[32] as KB32,
--[33] as KB33,
--[34] as KB34,
--[35] as KB35,
--[36] as KB36,
--[37] as KB37,
--[39] as KB39,
--[40] as KB40,
--[41] as KB41,
--[42] as KB42,
--[43] as KB43,
--[44] as KB44,
--[45] as KB45,
--[46] as KB46,
--[47] as KB47,
--[49] as KB49,
--[50] as KB50,
--[62] as KB62,
--[64] as KB64,
--[65] as KB65,
--[68] as KB68,
--[69] as KB69,
--[71] as KB71,
--[72] as KB72,
--[74] as KB74
--into PivotBBHrg
--from PivotBBTemp


set nocount off
end


--set dateformat dmy exec PivotPersediaannilai '01-12-2017'

--select top 10 * from TUP where MONTH(tanggal)=1 and YEAR(tanggal)=2017

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[PivotPersediaanNilaisap]
@Tanggal datetime
as
set dateformat dmy
set nocount on
begin
Declare @t VARCHAR(10)
Declare @A VARCHAR(1000)
Declare @B VARCHAR(1000)

declare @TglAwal datetime 
declare @TglAkhir datetime 
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select * into #TUP1 from TUP where YEAR(tanggal)=YEAR(@Tanggal)  order by KodeUnit

select kodeunit,kodebarang,
sum(qty) as sawQty,sum(nilai) as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
into #te1
from #TUP1
where MONTH(tanggal)=1 and YEAR(tanggal)=2018 and noinput='SALDO AWAL'
group by kodeunit,kodebarang
union all

--MUTASI BULAN INI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,sum(qty) as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP1
where  substring(noinput,1,3)='A53' and year(tanggal)=2018
group by kodeunit,kodebarang
union all

select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,sum(qty) as klrQty,0 as klrNilai,0 as korQty,0 as korNilai,0 as sakQty,0 as sakNilai
from #TUP1
where  substring(noinput,1,3)='A58' and YEAR(tanggal)=2018
group by kodeunit,kodebarang
union all
 
--KOREKSI
select kodeunit,kodebarang,0 as sawQty,0 as sawNilai,0 as trmQty,0 as trmNilai,0 as klrQty,0 as klrNilai,sum(qty) as korQty,sum(nilai) as korNilai,0 as sakQty,0 as sakNilai
from #TUP1
where  substring(noinput,1,3)='KOR'
group by kodeunit,kodebarang

select a.KodeUnit,b.norek,c.namarekening,a.kodebarang,b.namabarang,
sum(a.sawQty) as sawQty,sum(a.sawNilai) as sawNilai,sum(a.trmQty) as trmQty,sum(a.trmNilai) as trmNilai,
sum(a.klrQty) as klrQty,sum(a.klrNilai) as klrNilai,sum(a.korQty) as korQty,sum(a.korNilai) as korNilai,
sum(a.sawQty+a.trmQty-a.klrQty+a.korQty) as sakQty,sum(a.sawNilai+a.trmNilai-a.klrNilai+a.korNilai) as sakNilai
into #te2
from #te1 a
inner join SPDK_KBN_MASTER_REF..ref_barang b   on a.kodebarang=b.kodebarang
inner join SPDK_KBN_MASTER_REF..ref_rekening c on b.norek=c.norek
inner join SPDK_KBN_MASTER_REF..ref_kebun d    on a.kodeunit=d.kodekebun
group by a.KodeUnit,b.norek,c.namarekening,a.kodebarang,b.namabarang
order by a.KodeUnit

select kodebarang,NamaBarang,sawQty,sawNilai,trmQty,trmNilai,klrQty,klrNilai,sakNilai ,sakQty
into #te3 
from #te2


--drop table Pivotnilai,PivotBBHrg
select * from #te3
--set @A='SELECT NamaBarang'
--SET @B='('
--SELECT @A=@A+',['+substring(KodeUnit,1,2)+'] as [' +substring(KodeUnit,1,2)+']',@B=@B+'['+substring(KodeUnit,1,2)+'],' FROM (SELECT DISTINCT KodeUnit FROM #t3) cur
--SET @B=SUBSTRING(@B,1,LEN(@B)-1)
--SET @A=@A+ + ' into Pivotnilai  FROM (SELECT NamaBarang, saknilai, KodeUnit as KodeUnit FROM #t3) s  PIVOT (sum(saknilai) FOR KodeUnit IN ' +@B+')) p ORDER BY [namabarang]; '
--exec(@A)

--update Pivotnilai set[10]=0 where [10] is null
--update Pivotnilai set[11]=0 where [11] is null
--update Pivotnilai set[12]=0 where [12] is null
--update Pivotnilai set[13]=0 where [13] is null
--update Pivotnilai set[14]=0 where [14] is null
--update Pivotnilai set[15]=0 where [15] is null
--update Pivotnilai set[16]=0 where [16] is null
--update Pivotnilai set[17]=0 where [17] is null
--update Pivotnilai set[18]=0 where [18] is null
--update Pivotnilai set[19]=0 where [19] is null
--update Pivotnilai set[20]=0 where [20] is null
--update Pivotnilai set[21]=0 where [21] is null
--update Pivotnilai set[22]=0 where [22] is null
--update Pivotnilai set[23]=0 where [23] is null
--update Pivotnilai set[24]=0 where [24] is null
--update Pivotnilai set[25]=0 where [25] is null
--update Pivotnilai set[28]=0 where [28] is null
--update Pivotnilai set[29]=0 where [29] is null
--update Pivotnilai set[31]=0 where [31] is null
--update Pivotnilai set[32]=0 where [32] is null
--update Pivotnilai set[33]=0 where [33] is null
--update Pivotnilai set[34]=0 where [34] is null
--update Pivotnilai set[35]=0 where [35] is null
--update Pivotnilai set[36]=0 where [36] is null
--update Pivotnilai set[37]=0 where [37] is null
--update Pivotnilai set[39]=0 where [39] is null
--update Pivotnilai set[40]=0 where [40] is null
--update Pivotnilai set[41]=0 where [41] is null
--update Pivotnilai set[42]=0 where [42] is null
--update Pivotnilai set[43]=0 where [43] is null
--update Pivotnilai set[44]=0 where [44] is null
--update Pivotnilai set[45]=0 where [45] is null
--update Pivotnilai set[46]=0 where [46] is null
--update Pivotnilai set[47]=0 where [47] is null
--update Pivotnilai set[49]=0 where [49] is null
--update Pivotnilai set[50]=0 where [50] is null
--update Pivotnilai set[62]=0 where [62] is null
--update Pivotnilai set[64]=0 where [64] is null
--update Pivotnilai set[65]=0 where [65] is null
--update Pivotnilai set[68]=0 where [68] is null
--update Pivotnilai set[69]=0 where [69] is null
--update Pivotnilai set[71]=0 where [71] is null
--update Pivotnilai set[72]=0 where [72] is null
--update Pivotnilai set[74]=0 where [74] is null

----select @Tanggal as tanggal,namabarang,
----[10] as KB10,
--[11] as KB11,
--[12] as KB12,
--[13] as KB13,
--[14] as KB14,
--[15] as KB15,
--[16] as KB16,
--[17] as KB17,
--[18] as KB18,
--[19] as KB19,
--[20] as KB20,
--[21] as KB21,
--[22] as KB22,
--[23] as KB23,
--[24] as KB24,
--[25] as KB25,
--[28] as KB28,
--[29] as KB29,
--[31] as KB31,
--[32] as KB32,
--[33] as KB33,
--[34] as KB34,
--[35] as KB35,
--[36] as KB36,
--[37] as KB37,
--[39] as KB39,
--[40] as KB40,
--[41] as KB41,
--[42] as KB42,
--[43] as KB43,
--[44] as KB44,
--[45] as KB45,
--[46] as KB46,
--[47] as KB47,
--[49] as KB49,
--[50] as KB50,
--[62] as KB62,
--[64] as KB64,
--[65] as KB65,
--[68] as KB68,
--[69] as KB69,
--[71] as KB71,
--[72] as KB72,
--[74] as KB74
--into PivotBBHrg
--from PivotBBTemp


set nocount off
end


--set dateformat dmy exec PivotPersediaanNilaisap '01-08-2018'

--select top 10 * from TUP where MONTH(tanggal)=1 and YEAR(tanggal)=2017

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[PostingFilePPH_Konsol]
@tanggal datetime
--With Encryption
as
set dateformat dmy
delete PPH21 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) or tanggal is null

--GAJI MASTER KARYAWAN TETAP
--JHT NON REG.MANDOR
select a.kdunit as kodeunit,@tanggal as Tanggal,a.register,b.NAMA,c.NPWP,b.SIPIL+'/'+cast(b.TANGGUNG as varchar(1)) as status,b.KELAMIN,a.GajiPokok+a.UpahHarian+a.UpahBorong+a.UpahRecovery as Gaji,
a.TPPH21 as TunjanganPajak,a.TSansos as Sansos,a.TJabatan as Jabatan,a.TStruktural+a.TKhusus as Struktural,a.TTetap as Tetap,a.TJamSostek+a.TBPJS+a.TBPJSKes as Jamsostek,
a.TDapenbun+a.TPPIP as Dapenbun,
0 as bonus,0 as thr,0 as tantiem,0 as cuti,0 as jubileum,a.Rapel,a.Premi,0 as lain2,
a.PDapenbun+a.PPPIP as IuranPensiun,(a.PJamsostek+a.PBPJS)-(a.TJamSostek+a.TBPJS) as JHT
into #t1
from GajiMaster a 
inner join Ref_Dik b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and year(a.tanggal)=year(b.TANGGAL)
inner join SDM01 c on a.register=c.NPP and a.kdunit=c.KodeUnit
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and a.sts<>'KL' and a.regmdr='' and c.StatusKerja<>'P'
union all
--JHT REG.MANDOR
select a.kdunit,@tanggal as Tanggal,a.register,b.NAMA,c.NPWP,b.SIPIL+'/'+cast(b.TANGGUNG as varchar(1)) as status,b.KELAMIN,a.GajiPokok+a.UpahHarian+a.UpahBorong+a.UpahRecovery as Gaji,
a.TPPH21 as TunjanganPajak,a.TSansos as Sansos,a.TJabatan as Jabatan,a.TStruktural+a.TKhusus as Struktural,a.TTetap as Tetap,a.TJamSostek+a.TBPJS+a.TBPJSKes as Jamsostek,
a.TDapenbun+a.TPPIP as Dapenbun,
0 as bonus,0 as thr,0 as tantiem,0 as cuti,0 as jubileum,a.Rapel,a.Premi,0 as lain2,
a.PDapenbun+a.PPPIP as IuranPensiun,(a.PJamsostek+a.PBPJS)-(a.TBPJS) as JHT
from GajiMaster a 
inner join Ref_Dik b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and year(a.tanggal)=year(b.TANGGAL)
inner join SDM01 c on a.register=c.NPP and a.kdunit=c.KodeUnit
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and a.sts<>'KL' and a.regmdr<>'' and c.StatusKerja<>'P'
union all

--GAJI MASTER KARYAWAN LEPAS
select a.kdunit,@tanggal as Tanggal,a.register,b.NAMA,'' as NPWP,b.SIPIL+'/0' as status,b.KELAMIN,a.GajiPokok+a.UpahHarian+a.UpahBorong+a.UpahRecovery as Gaji,
a.TPPH21 as TunjanganPajak,a.TSansos as Sansos,a.TJabatan as Jabatan,a.TStruktural+a.TKhusus as Struktural,a.TTetap as Tetap,a.TJamSostek+a.TBPJS+a.TBPJSKes as Jamsostek,
a.TDapenbun+a.TPPIP as Dapenbun,
0 as bonus,0 as thr,0 as tantiem,0 as cuti,0 as jubileum,a.Rapel,a.Premi,0 as lain2,
a.PDapenbun+a.PPPIP as IuranPensiun,(a.PJamsostek+a.PBPJS)-(a.TJamSostek+a.TBPJS) as JHT
from GajiMaster a 
inner join Ref_DikKLM b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and year(a.tanggal)=year(b.TANGGAL)
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and a.sts='KL'
union all

--BONUS KARYAWAN TETAP
select a.kodeunit,@tanggal as Tanggal,a.register,b.NAMA,c.NPWP,b.SIPIL+'/'+cast(b.TANGGUNG as varchar(1)) as status,b.KELAMIN,
0 as Gaji,0 as TunjanganPajak,0 as Sansos,0 as Jabatan,
0 as Struktural,0 as Tetap,0 as Jamsostek,0 as Dapenbun,
a.nilai as bonus,0 as thr,0 as tantiem,0 as cuti,0 as jubileum,
0 as Rapel,0 as Premi,0 as lain2,0 as IuranPensiun,0 as JHT
from PendapatanTidakTeratur a 
inner join Ref_Dik b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and year(a.tanggal)=year(b.TANGGAL)
inner join SDM01 c on a.register=c.NPP and a.kodeunit=c.KodeUnit
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and a.sts<>'KL' and a.kodetrans='Bonus' and c.StatusKerja<>'P'
union all
--BONUS KARYAWAN LEPAS
select a.kodeunit,@tanggal as Tanggal,a.register,b.NAMA,'' as NPWP,b.SIPIL+'/0' as status,b.KELAMIN,
0 as Gaji,0 as TunjanganPajak,0 as Sansos,0 as Jabatan,
0 as Struktural,0 as Tetap,0 as Jamsostek,0 as Dapenbun,
a.nilai as bonus,0 as thr,0 as tantiem,0 as cuti,0 as jubileum,
0 as Rapel,0 as Premi,0 as lain2,0 as IuranPensiun,0 as JHT
from PendapatanTidakTeratur a 
inner join Ref_DikKLM b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and year(a.tanggal)=year(b.TANGGAL)
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and a.sts='KL' and a.kodetrans='Bonus'
union all

--CUTI
select a.kodeunit,@tanggal as Tanggal,a.register,b.NAMA,c.NPWP,b.SIPIL+'/'+cast(b.TANGGUNG as varchar(1)) as status,b.KELAMIN,
0 as Gaji,0 as TunjanganPajak,0 as Sansos,0 as Jabatan,
0 as Struktural,0 as Tetap,0 as Jamsostek,0 as Dapenbun,
0 as bonus,0 as thr,0 as tantiem,a.nilai as cuti,0 as jubileum,
0 as Rapel,0 as Premi,0 as lain2,0 as IuranPensiun,0 as JHT
from PendapatanTidakTeratur a 
inner join Ref_Dik b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and year(a.tanggal)=year(b.TANGGAL)
inner join SDM01 c on a.register=c.NPP and a.kodeunit=c.KodeUnit
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and a.sts<>'KL' and a.kodetrans='Cuti' and c.StatusKerja<>'P'
union all

--Jubelium
select a.kodeunit,@tanggal as Tanggal,a.register,b.NAMA,c.NPWP,b.SIPIL+'/'+cast(b.TANGGUNG as varchar(1)) as status,b.KELAMIN,
0 as Gaji,0 as TunjanganPajak,0 as Sansos,0 as Jabatan,
0 as Struktural,0 as Tetap,0 as Jamsostek,0 as Dapenbun,
0 as bonus,0 as thr,0 as tantiem,0 as cuti,a.nilai as jubileum,
0 as Rapel,0 as Premi,0 as lain2,0 as IuranPensiun,0 as JHT
from PendapatanTidakTeratur a 
inner join Ref_Dik b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and year(a.tanggal)=year(b.TANGGAL)
inner join SDM01 c on a.register=c.NPP and a.kodeunit=c.KodeUnit
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and a.sts<>'KL' and a.kodetrans='Jubelium' and c.StatusKerja<>'P'
union all

--LAIN-LAIN KARYAWAN TETAP
select a.kodeunit,@tanggal as Tanggal,a.register,b.NAMA,c.NPWP,b.SIPIL+'/'+cast(b.TANGGUNG as varchar(1)) as status,b.KELAMIN,
0 as Gaji,0 as TunjanganPajak,0 as Sansos,0 as Jabatan,
0 as Struktural,0 as Tetap,0 as Jamsostek,0 as Dapenbun,
0 as bonus,0 as thr,0 as tantiem,0 as cuti,0 as jubileum,
0 as Rapel,0 as Premi,a.nilai as lain2,0 as IuranPensiun,0 as JHT
from PendapatanTidakTeratur a 
inner join Ref_Dik b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and year(a.tanggal)=year(b.TANGGAL)
inner join SDM01 c on a.register=c.NPP and a.kodeunit=c.KodeUnit
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and a.sts<>'KL' and a.kodetrans='Lainnya' and c.StatusKerja<>'P'
union all
--LAIN-LAIN KARYAWAN LEPAS
select a.kodeunit,@tanggal as Tanggal,a.register,b.NAMA,'' as NPWP,b.SIPIL+'/0' as status,b.KELAMIN,
0 as Gaji,0 as TunjanganPajak,0 as Sansos,0 as Jabatan,
0 as Struktural,0 as Tetap,0 as Jamsostek,0 as Dapenbun,
0 as bonus,0 as thr,0 as tantiem,0 as cuti,0 as jubileum,
0 as Rapel,0 as Premi,a.nilai as lain2,0 as IuranPensiun,0 as JHT
from PendapatanTidakTeratur a 
inner join Ref_DikKLM b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and year(a.tanggal)=year(b.TANGGAL)
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and a.sts='KL' and a.kodetrans='Lainnya'
union all

--Tantiem
select a.kodeunit,@tanggal as Tanggal,a.register,b.NAMA,c.NPWP,b.SIPIL+'/'+cast(b.TANGGUNG as varchar(1)) as status,b.KELAMIN,
0 as Gaji,0 as TunjanganPajak,0 as Sansos,0 as Jabatan,
0 as Struktural,0 as Tetap,0 as Jamsostek,0 as Dapenbun,
0 as bonus,0 as thr,a.nilai as tantiem,0 as cuti,0 as jubileum,
0 as Rapel,0 as Premi,0 as lain2,0 as IuranPensiun,0 as JHT
from PendapatanTidakTeratur a 
inner join Ref_Dik b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and year(a.tanggal)=year(b.TANGGAL)
inner join SDM01 c on a.register=c.NPP and a.kodeunit=c.KodeUnit
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and a.sts<>'KL' and a.kodetrans='Tantiem' and c.StatusKerja<>'P'
union all

--THR KARYAWAN TETAP
select a.kodeunit,@tanggal as Tanggal,a.register,b.NAMA,c.NPWP,b.SIPIL+'/'+cast(b.TANGGUNG as varchar(1)) as status,b.KELAMIN,
0 as Gaji,0 as TunjanganPajak,0 as Sansos,0 as Jabatan,
0 as Struktural,0 as Tetap,0 as Jamsostek,0 as Dapenbun,
0 as bonus,a.nilai as thr,0 as tantiem,0 as cuti,0 as jubileum,
0 as Rapel,0 as Premi,0 as lain2,0 as IuranPensiun,0 as JHT
from PendapatanTidakTeratur a 
inner join Ref_Dik b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and year(a.tanggal)=year(b.TANGGAL)
inner join SDM01 c on a.register=c.NPP and a.kodeunit=c.KodeUnit
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and a.sts<>'KL' and a.kodetrans='THR' and c.StatusKerja<>'P'
union all
--THR KARYAWAN LEPAS
select a.kodeunit,@tanggal as Tanggal,a.register,b.NAMA,'' as NPWP,b.SIPIL+'/0' as status,b.KELAMIN,
0 as Gaji,0 as TunjanganPajak,0 as Sansos,0 as Jabatan,
0 as Struktural,0 as Tetap,0 as Jamsostek,0 as Dapenbun,
0 as bonus,a.nilai as thr,0 as tantiem,0 as cuti,0 as jubileum,
0 as Rapel,0 as Premi,0 as lain2,0 as IuranPensiun,0 as JHT
from PendapatanTidakTeratur a 
inner join Ref_DikKLM b on a.register=b.REG and MONTH(a.tanggal)=MONTH(b.TANGGAL) and year(a.tanggal)=year(b.TANGGAL)
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and a.sts='KL' and a.kodetrans='THR'

update #t1 set NPWP='000000000000000' where NPWP=''

insert PPH21
select kodeunit,Tanggal,register,NAMA,replace(replace(replace(NPWP,'.',''),'-',''),',','') as NPWP,status,
sum(Gaji) as Gaji,sum(TunjanganPajak) as TunjanganPajak,sum(Sansos) as Sansos,sum(Jabatan) as Jabatan,
sum(Struktural) as Struktural,sum(Tetap) as Tetap,sum(Jamsostek) as Jamsostek,sum(Dapenbun) as Dapenbun,
sum(bonus) as bonus,sum(thr) as thr,sum(tantiem) as tantiem,sum(cuti) as cuti,sum(jubileum) as jubileum,
sum(Rapel) as Rapel,sum(Premi) as Premi,sum(IuranPensiun) as IuranPensiun,sum(JHT) as JHT,SUM(lain2) as Lain2,KELAMIN
from #t1
group by kodeunit,tanggal,register,NAMA,NPWP,status,KELAMIN
order by register

--set dateformat dmy exec PostingFilePPH_Konsol '01-07-2016'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[PostingPPHBulanan_Konsol]
@tanggal datetime
--with encryption
as
set dateformat dmy
declare @AwalTahun datetime
set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))

delete PPH21Bulanan 

set dateformat dmy exec PostingFilePPH_Konsol @tanggal

select kodeunit,register,NAMA,NPWP,status,kelamin,
sum(Gaji) as Gaji,sum(TunjanganPajak) as TunjanganPajak,sum(Sansos) as Sansos,sum(Jabatan) as Jabatan,
sum(Struktural) as Struktural,sum(Tetap) as Tetap,sum(Jamsostek) as Jamsostek,sum(Dapenbun) as Dapenbun,
sum(bonus) as bonus,sum(thr) as thr,sum(tantiem) as tantiem,sum(cuti) as cuti,sum(jubileum) as jubileum,
sum(Rapel) as Rapel,sum(Premi) as Premi,sum(IuranPensiun) as IuranPensiun,sum(JHT) as JHT,sum(Lain2) as Lain2,
0 as GajiSBI,0 as TunjanganPajakSBI,0 as SansosSBI,0 as JabatanSBI,
0 as StrukturalSBI,0 as TetapSBI,0 as JamsostekSBI,0 as DapenbunSBI,
0 as bonusSBI,0 as thrSBI,0 as tantiemSBI,0 as cutiSBI,0 as jubileumSBI,
0 as RapelSBI,0 as PremiSBI,0 as IuranPensiunSBI,0 as JHTSBI,0 as Lain2SBI
into #t1
from PPH21
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)
group by kodeunit,register,NAMA,NPWP,status,Kelamin
union all

--S/D
select kodeunit,register,NAMA,NPWP,status,kelamin,
0 as Gaji,0 as TunjanganPajak,0 as Sansos,0 as Jabatan,
0 as Struktural,0 as Tetap,0 as Jamsostek,0 as Dapenbun,
0 as bonus,0 as thr,0 as tantiem,0 as cuti,0 as jubileum,
0 as Rapel,0 as Premi,0 as IuranPensiun,0 as JHT,0 as Lain2,
sum(Gaji) as GajiSBI,sum(TunjanganPajak) as TunjanganPajakSBI,sum(Sansos) as SansosSBI,sum(Jabatan) as JabatanSBI,
sum(Struktural) as StrukturalSBI,sum(Tetap) as TetapSBI,sum(Jamsostek) as JamsostekSBI,sum(Dapenbun) as DapenbunSBI,
sum(bonus) as bonusSBI,sum(thr) as thrSBI,sum(tantiem) as tantiemSBI,sum(cuti) as cutiSBI,sum(jubileum) as jubileumSBI,
sum(Rapel) as RapelSBI,sum(Premi) as PremiSBI,sum(IuranPensiun) as IuranPensiunSBI,sum(JHT) as JHTSBI,sum(lain2) as LAIN2SBI
from PPH21
where tanggal>=@AwalTahun and tanggal<=@tanggal
group by kodeunit,register,NAMA,NPWP,status,Kelamin

select kodeunit,register,NAMA, NPWP,status,
sum(Gaji) as Gaji,sum(Sansos) as Sansos,sum(Jabatan) as Jabatan,
sum(Struktural) as Struktural,sum(Tetap) as Tetap,sum(Jamsostek) as Jamsostek,sum(Dapenbun) as Dapenbun,
sum(bonus) as bonus,sum(thr) as thr,sum(tantiem) as tantiem,sum(cuti) as cuti,sum(jubileum) as jubileum,
sum(Rapel) as Rapel,sum(Premi) as Premi,sum(IuranPensiun) as IuranPensiun,sum(JHT) as JHT,
sum(GajiSBI) as GajiSBI,sum(SansosSBI) as SansosSBI,
sum(JabatanSBI) as JabatanSBI,sum(StrukturalSBI) as StrukturalSBI,sum(TetapSBI) as TetapSBI,
sum(JamsostekSBI) as JamsostekSBI,sum(DapenbunSBI) as DapenbunSBI,sum(bonusSBI) as bonusSBI,sum(thrSBI) as thrSBI,
sum(tantiemSBI) as tantiemSBI,sum(cutiSBI) as cutiSBI,sum(jubileumSBI) as jubileumSBI,sum(RapelSBI) as RapelSBI,
sum(PremiSBI) as PremiSBI,sum(IuranPensiunSBI) as IuranPensiunSBI,sum(JHTSBI) as JHTSBI,sum(TunjanganPajak) as TunjanganPajak,
sum(TunjanganPajakSBI) as TunjanganPajakSBI,SUM(lain2) as Lain2,SUM(lain2SBI) as Lain2SBI,@tanggal as Tanggal,kelamin
into #t2
from #t1
group by kodeunit,register,NAMA,NPWP,status,Kelamin
order by nama,register

update #t2 set [status]='TK/'+right(status,1) where substring(status,1,1) in ('D','J','T')
update #t2 set [status]='K /'+right(status,1) where substring(status,1,1)='K'
update #t2 set NPWP=REPLACE(REPLACE(REPLACE(NPWP,'.',''),',',''),'-','')
update #t2 set NPWP='000000000000000' where NPWP=''
update #t2 set NPWP='000000000000000' where len(NPWP)<15
update #t2 set NPWP=SUBSTRING(NPWP,1,15) where len(NPWP)>15

insert PPH21Bulanan
--select * from #t2 order by nama
select kodeunit,register,Nama,replace(NPWP,'000000000000000','''000000000000000') as NPWP,status,
sum(Gaji) as Gaji,sum(Sansos) as Sansos,sum(Jabatan) as Jabatan,
sum(Struktural) as Struktural,sum(Tetap) as Tetap,sum(Jamsostek) as Jamsostek,sum(Dapenbun) as Dapenbun,
sum(bonus) as bonus,sum(thr) as thr,sum(tantiem) as tantiem,sum(cuti) as cuti,sum(jubileum) as jubileum,
sum(Rapel) as Rapel,sum(Premi) as Premi,sum(IuranPensiun) as IuranPensiun,sum(JHT) as JHT,
sum(GajiSBI) as GajiSBI,sum(SansosSBI) as SansosSBI,
sum(JabatanSBI) as JabatanSBI,sum(StrukturalSBI) as StrukturalSBI,sum(TetapSBI) as TetapSBI,
sum(JamsostekSBI) as JamsostekSBI,sum(DapenbunSBI) as DapenbunSBI,sum(bonusSBI) as bonusSBI,sum(thrSBI) as thrSBI,
sum(tantiemSBI) as tantiemSBI,sum(cutiSBI) as cutiSBI,sum(jubileumSBI) as jubileumSBI,sum(RapelSBI) as RapelSBI,
sum(PremiSBI) as PremiSBI,sum(IuranPensiunSBI) as IuranPensiunSBI,sum(JHTSBI) as JHTSBI,sum(TunjanganPajak) as TunjanganPajak,
sum(TunjanganPajakSBI) as TunjanganPajakSBI,SUM(lain2) as Lain2,SUM(lain2SBI) as Lain2SBI,@tanggal as Tanggal,kelamin
from #t2
group by kodeunit,register,NAMA,NPWP,status,Kelamin
order by NAMA

--set dateformat dmy exec PostingPPHBulanan_Konsol '01-07-2016'

--SELECT * FROM PPH21Bulanan ORDER BY NPWP

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[ProduksiKeuangan]
@tanggal datetime
as
begin
set nocount off
set dateformat dmy
select distinct rekJadi,uraian into #Ref_AsalProd from Ref_AsalProd where uraian not in ('Penerimaan','Penjualan')

select '  ' as Urut,a.kodekbn,b.NamaKebun,a.kodebud,upper(d.nm_bud) as Budidaya,a.norek,upper(c.uraian) as uraian,SUM(a.bi) as [REAL BI],SUM(a.rbi) as [RKAP BI],SUM(a.pbi) as [PKB BI]
into #t1
from AkunProduksiHP a
inner join Ref_Kebun b on a.kodekbn=b.KodeKebun
inner join #Ref_AsalProd c on a.norek=c.rekJadi
inner join Ref_Budidaya d on a.kodebud=d.kd_bud and a.kodekbn=d.KodeUnit
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and a.norek in ('6080600','6080500','6090402','6080400','6090500','6080401','6900403','6090401','6090400','6080402','6090400','6080400','X') and a.kodevar='JADI'
group by a.kodekbn,a.kodebud,a.norek,b.NamaKebun,c.uraian,d.nm_bud

--Penerimaan d/ Kebun Sendiri
update #t1 set Urut='01' where norek='X'
--Penerimaan d/ Kebun Seinduk
update #t1 set Urut='02' where norek='6080400'
--Penerimaan d/ Kebun Lancuran
update #t1 set Urut='03' where norek='6080500'
--Penerimaan d/ TBM
update #t1 set Urut='04' where norek='6080600'
--Penerimaan d/ TBM
update #t1 set Urut='05' where norek='6080600'
--Penerimaan d/ Pihak ke III
update #t1 set Urut='06' where norek='6080402'
 
--Penjualan Ke Kebun Seinduk
update #t1 set Urut='07' where norek='6090400'
--Penjualan Ke Kebun IHT
update #t1 set Urut='08' where norek='6900403'
--PENJUALAN KERING (EKS PENJUALAN BASAH)
update #t1 set Urut='09' where norek='6090500'
--PENJUALAN KE BLENDING PLAN/BPT
update #t1 set Urut='10' where norek='6090402'

select * from #t1 order by kodekbn,kodebud,urut
set nocount on
end

--set dateformat dmy exec ProduksiKeuangan '01-04-2016'

--select * from AkunProduksiHP where kodeunit='24' and kodebud='01' and MONTH(tanggal)=4 and kodevar='JADI'
--select * from AkunProduksiHP where kodeunit='35' and kodebud='02' and MONTH(tanggal)=4 and kodevar='JADI'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[Proses_Gaji_2]
@tanggal datetime
as
set dateformat dmy
set nocount on
declare @TglAkhir datetime
declare @zero float
declare @Periode varchar(50)

set @TglAkhir=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
set @zero=0
if MONTH(@tanggal)<10
set @Periode=cast(YEAR(@tanggal) as varchar(4))+'0'+cast(MONTH(@tanggal) as varchar(2))
else
set @Periode=cast(YEAR(@tanggal) as varchar(4))+cast(MONTH(@tanggal) as varchar(2))

select *
into #dik 
from ref_dik where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal)

--SALDO AWAL POTONGAN
select kodeunit,kodeafd,regmdr,register,sts,0 as nilai,SUM(nilai) as SisaKBN,0 as SisaKOP
into #sawalHTG
from GajiPotongan
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and keterangan='SALDO AWAL' and jnsptg='Kebun' and nilai>0
group by kodeunit,kodeafd,regmdr,register,sts
union all
select kodeunit,kodeafd,regmdr,register,sts,0 as nilai,0 as SisaKBN,SUM(nilai) as SisaKOP
from GajiPotongan
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and keterangan='SALDO AWAL' and jnsptg='Koperasi' and nilai>0
group by kodeunit,kodeafd,regmdr,register,sts

--TAMBAHAN HUTANG Kebun BULAN INI
select kodeunit,kodeafd,regmdr,register,sts,sum(nilai) as nilai,'Kebun' as jnsptg
into #tambahHTGKebun
from GajiPotongan
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and keterangan='MUTASI' and jnsptg='Kebun' and nilai>0
group by kodeunit,kodeafd,regmdr,register,sts

--TAMBAHAN HUTANG KOPERASI BULAN INI
select kodeunit,kodeafd,regmdr,register,sts,sum(nilai) as nilai,'Koperasi' as jnsptg
into #tambahHTGKoperasi
from GajiPotongan
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and keterangan='MUTASI' and jnsptg='Koperasi' and nilai>0
group by kodeunit,kodeafd,regmdr,register,sts

--POTONGAN Kebun BULAN INI
select kodeunit,kodeafd,regmdr,register,sts,sum(potongan) as potonganKBN,sum(nilai) as SisaKBN
into #potonganKebunBIxx
from GajiPotongan
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and keterangan='MUTASI' and jnsptg='Kebun' and nilai>0
group by kodeunit,kodeafd,regmdr,register,sts
union all
select kodeunit,kodeafd,regmdr,register,sts,0 as potonganKBN,0 as SisaKBN
from GajiPotongan
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and keterangan='MUTASI' and jnsptg='Koperasi' and nilai>0
group by kodeunit,kodeafd,regmdr,register,sts


--POTONGAN KOPERASI BULAN INI
select kodeunit,kodeafd,regmdr,register,sts,sum(potongan) as potonganKOP,sum(nilai) as SisaKOP
into #potonganKoperasiBIxx
from GajiPotongan
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and keterangan='MUTASI' and jnsptg='Koperasi' and nilai>0
group by kodeunit,kodeafd,regmdr,register,sts
union all
select kodeunit,kodeafd,regmdr,register,sts,0 as potonganKOP,0 as SisaKOP
from GajiPotongan
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and keterangan='MUTASI' and jnsptg='Kebun' and nilai>0

select kodeunit,kodeafd,regmdr,register,sts,sum(potonganKBN) as potonganKBN,sum(SisaKBN) as SisaKBN
into #potonganKebunBI
from #potonganKebunBIxx
group by kodeunit,kodeafd,regmdr,register,sts

select kodeunit,kodeafd,regmdr,register,sts,sum(potonganKOP) as potonganKOP,sum(SisaKOP) as SisaKOP
into #potonganKoperasiBI
from #potonganKoperasiBIxx
group by kodeunit,kodeafd,regmdr,register,sts

select a.kdunit,a.kodeafd,a.sts,d.NamaKebun as Kebun,a.Register,b.NAMA as Nama,cast(b.NAMA_JAB as varchar(max)) as Jabatan,c.GOL+'/'+b.MK as Gol,
a.UpahHarian,a.UpahBorong,a.UpahRecovery,a.TSansos,a.Premi,a.Rapel,
a.UpahHarian+a.UpahBorong+a.UpahRecovery+a.TSansos+a.Premi+a.Rapel as JmlUpah,
0 as SisaBL,a.PJamsostek+(a.PBPJS-a.TBPJS)+(a.PBPJSKes-a.TBPJSKes) as PJamsostek,a.PDapenbun+a.PPPIP as PDapenbun,a.PKebun,a.PKoperasi
into #t1
from GajiMaster a
inner join #dik b on a.register=b.REG
inner join SPDK_KBN..Ref_KomponenGaji1 c on b.GOL+b.mk=c.KDGOL+c.MK
inner join SPDK_KBN..Ref_Kebun d on a.kdunit=d.KodeKebun
where a.sts='KB' and MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and b.gol>='05' and b.gol<'09' and a.regmdr<>''

select a.sts,a.kdunit,a.Kebun,a.kodeafd,a.register,a.Nama,a.Jabatan,a.Gol,
sum(a.UpahHarian) as UpahHarian,sum(a.UpahBorong) as UpahBorong,sum(a.UpahRecovery) as UpahRecovery,sum(a.TSansos) as TSansos,sum(a.Premi) as Premi,sum(a.Rapel) as Rapel,sum(a.JmlUpah) as JmlUpah,
sum(a.PJamsostek) as PJamsostek,sum(a.PDapenbun) as PDapenbun,
sum(c.nilai) as PKebun,
sum(d.nilai) as PKoperasi,
sum(a.PJamsostek+a.PDapenbun+d.nilai+c.nilai) as HTSBI,
sum(a.PJamsostek+a.PDapenbun+e.potonganKBN+f.potonganKOP) as PTBI,
sum(a.UpahHarian+a.UpahBorong+a.UpahRecovery+a.TSansos+a.Premi+a.Rapel)-sum(a.PJamsostek+a.PDapenbun+e.potonganKBN+f.potonganKOP) as THP,sum(e.potonganKBN) as PotonganKBN,sum(f.potonganKOP) as PotonganKOP
into #t2a
from #T1 a
full outer join #tambahHTGKebun     c on a.kdunit=c.kodeunit and a.kodeafd=c.kodeafd and a.register=c.register and a.sts=c.sts and 'Kebun'=c.jnsptg
full outer join #tambahHTGKoperasi  d on a.kdunit=d.kodeunit and a.kodeafd=d.kodeafd and a.register=d.register and a.sts=d.sts and 'Koperasi'=d.jnsptg
full outer join #potonganKebunBI    e on a.kdunit=e.kodeunit and a.kodeafd=e.kodeafd and a.register=e.register and a.sts=e.sts --and MONTH(a.Tanggal)=MONTH(@tanggal) and YEAR(a.Tanggal)=YEAR(@tanggal)
full outer join #potonganKoperasiBI f on a.kdunit=f.kodeunit and a.kodeafd=f.kodeafd and a.register=f.register and a.sts=f.sts --and MONTH(a.Tanggal)=MONTH(@tanggal) and YEAR(a.Tanggal)=YEAR(@tanggal)
where a.sts is not null
group by a.sts,a.kdunit,a.Kebun,a.kodeafd,a.register,a.Nama,a.Jabatan,a.Gol

update #t2a set PKebun=@zero where PKebun is null
update #t2a set PKoperasi=@zero where PKoperasi is null
update #t2a set HTSBI=@zero where HTSBI is null
update #t2a set PTBI=@zero where PTBI is null
update #t2a set THP=@zero where THP is null

select * into #t2 from #t2a

select @Periode as Periode,kdunit,'Dipersamakan Ke Gol.I' as Ket,kodeafd,register,Nama,Jabatan,Gol,
@zero as GajiPokok,
UpahHarian+UpahBorong+UpahRecovery as Upah,
TSansos,
@zero as TStruktural,
@zero as TJabatan,
@zero as TTetap,
@zero as TPeralihan,
@zero as TKomunikasi,
@zero as TJamsostek,
@zero as TDapenbun,
@zero as TPPIP,
@zero as TPPH21,
@zero as JmlGjTj,
@zero as RapelLain2,
JmlUpah as JmlGj,
PJamsostek,PDapenbun,@zero as PPPIP,
PKebun,
PKoperasi,
PJamsostek+PDapenbun+PKebun+PKoperasi as JmlPtg,
JmlUpah-(PJamsostek+PDapenbun+PKebun+PKoperasi) as THP
from #t2
where kdunit is not null
order by kdunit

--set dateformat dmy exec Proses_Gaji_2 '01-11-2018'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[PrsBiayaInvestasiTanaman_2017A]
@tanggal datetime
as
set dateformat dmy
set nocount on
begin
declare @AwalTahun datetime
declare @AkhirBulan datetime
set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @AkhirBulan=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select * into #AkunMemorialTemp   from AkunMemorial   where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) 
select * into #AkunRKAPTemp       from AkunRKAP       where YEAR(tanggal)=YEAR(@tanggal) 
select * into #kartuTemp          from kartu          where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) 
select * into #AkunProduksiHPTemp from AkunProduksiHP where YEAR(tanggal)=YEAR(@tanggal) 
select kodekebun,kodebudidaya,tahuntanam,SUM(luas) as luas into #Ref_Areal from Ref_Areal where status like '%TBM%' group by kodekebun,kodebudidaya,tahuntanam
select distinct Norek,NamaRekening into #Ref_Rekening from Ref_Rekening where SUBSTRING(norek,1,3) in ('040','041','042','052','050')


select tanggal,KodeUnit,kodebud,Norek,netral,unsur,nilai as debet,0 as kredit
into #AkunMemorial 
from #AkunMemorialTemp 
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and NoInput in ('SALDO AWAL','TRANSAKSI') and DK='D' and SUBSTRING(norek,1,3) in ('040','041','042','052','050')
union all
select tanggal,KodeUnit,kodebud,Norek,netral,unsur,0 as debet,nilai as kredit
from #AkunMemorialTemp 
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and NoInput in ('SALDO AWAL','TRANSAKSI') and DK='K' and SUBSTRING(norek,1,3) in ('040','041','042','052','050')

--RKAP BULAN INI
--RKAP UPAH
select '2' as grup,kodeunit,kodebud,norek,netral,
nilai_RKAP as rkapUBI,0 as rkapBBI,0 as rkapLBI,nilai_RKAP as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
nilai_PMK  as pkbUBI, 0 as pkbBBI, 0 as pkbLBI, nilai_PMK  as JmlpkbBI, 0 as pkbUSBI, 0 as pkbBSBI, 0 as pkbLSBI, 0 as JmlpkbSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,0   as JmlrealSBI
into #t1
from #AkunRKAPTemp
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3) in ('040','041','042','052','050') and unsur='GU'
--RKAP BARANG BAHAN
union all
select '2' as grup,kodeunit,kodebud,norek,netral,
0 as rkapUBI,nilai_RKAP as rkapBBI,0 as rkapLBI,nilai_RKAP as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as pkbUBI, nilai_PMK  as pkbBBI, 0 as pkbLBI, nilai_PMK  as JmlpkbBI, 0 as pkbUSBI, 0 as pkbBSBI, 0 as pkbLSBI, 0 as JmlpkbSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,0   as JmlrealSBI
from #AkunRKAPTemp
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3) in ('040','041','042','052','050') and unsur='BB'
--RKAP LAIN2
union all
select '2' as grup,kodeunit,kodebud,norek,netral,
0 as rkapUBI,0 as rkapBBI,nilai_RKAP as rkapLBI,nilai_RKAP as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as pkbUBI, 0 as pkbBBI, nilai_PMK  as pkbLBI, nilai_PMK  as JmlpkbBI, 0 as pkbUSBI, 0 as pkbBSBI, 0 as pkbLSBI, 0 as JmlpkbSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,0   as JmlrealSBI
from #AkunRKAPTemp
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3) in ('040','041','042','052','050') and unsur not in ('GU','BB')
UNION ALL

--RKAP S/D BULAN INI
--RKAP UPAH
select '2' as grup,kodeunit,kodebud,norek,netral,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,nilai_RKAP as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,nilai_RKAP as JmlrkapSBI,
0 as pkbUBI, 0 as pkbBBI, 0  as pkbLBI,0  as JmlpkbBI,nilai_PMK  as pkbUSBI, 0 as pkbBSBI, 0 as pkbLSBI, nilai_PMK as JmlpkbSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,0   as JmlrealSBI
from #AkunRKAPTemp
where tanggal>=@AwalTahun and tanggal<=@AkhirBulan and SUBSTRING(norek,1,3) in ('040','041','042','052','050') and unsur='GU'
--RKAP BARANG BAHAN
union all
select '2' as grup,kodeunit,kodebud,norek,netral,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,nilai_RKAP as rkapBSBI,0 as rkapLSBI,nilai_RKAP as JmlrkapSBI,
0 as pkbUBI, 0 as pkbBBI, 0  as pkbLBI,0  as JmlpkbBI,0  as pkbUSBI,nilai_PMK as pkbBSBI, 0 as pkbLSBI, nilai_PMK as JmlpkbSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,0   as JmlrealSBI
from #AkunRKAPTemp
where tanggal>=@AwalTahun and tanggal<=@AkhirBulan and SUBSTRING(norek,1,3) in ('040','041','042','052','050') and unsur='BB'
--RKAP LAIN2
union all
select '2' as grup,kodeunit,kodebud,norek,netral,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,nilai_RKAP as rkapLSBI,nilai_RKAP as JmlrkapSBI,
0 as pkbUBI, 0 as pkbBBI, 0  as pkbLBI,0  as JmlpkbBI,0  as pkbUSBI,0 as pkbBSBI, nilai_PMK as pkbLSBI, nilai_PMK as JmlpkbSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,0   as JmlrealSBI
from #AkunRKAPTemp
where tanggal>=@AwalTahun and tanggal<=@AkhirBulan and SUBSTRING(norek,1,3) in ('040','041','042','052','050') and unsur not in ('GU','BB')
UNION ALL

--REALISASI BULAN INI
--UPAH
select '2' as grup,kodeunit,KodeBudidaya,norek,netral,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI,
sum(Debet-kredit) as realUBI,0 as realBBI,0 as realLBI,sum(Debet-kredit) as JmlrealBI,sum(Debet-kredit) as realUSBI,0 as realBSBI,0 as realLSBI,sum(Debet-kredit) as JmlrealSBI
from #kartuTemp
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3) in ('040','041','042','052','050') and Aplikasi='GUP'
group by kodeunit,KodeBudidaya,norek,netral
--BARANG BAHAN
union all
select '2' as grup,kodeunit,KodeBudidaya,norek,netral,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI,
0 as realUBI,sum(Debet-kredit) as realBBI,0 as realLBI,sum(Debet-kredit) as JmlrealBI,0 as realUSBI,sum(Debet-kredit) as realBSBI,0 as realLSBI,sum(Debet-kredit) as JmlrealSBI
from #kartuTemp
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3) in ('040','041','042','052','050') and Aplikasi='TUP'
group by kodeunit,KodeBudidaya,norek,netral
--LAIN2
union all
select '2' as grup,kodeunit,KodeBudidaya,norek,netral,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI,
0 as realUBI,0 as realBBI,sum(Debet-kredit) as realLBI,sum(Debet-kredit) as JmlrealBI,0 as realUSBI,0 as realBSBI,sum(Debet-kredit) as realLSBI,sum(Debet-kredit) as JmlrealSBI
from #kartuTemp
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3) in ('040','041','042','052','050') and Aplikasi not in ('GUP','TUP')
group by kodeunit,KodeBudidaya,norek,netral
UNION ALL

--REALISASI SAMPAI DENGAN BULAN INI
--UPAH
select '2' as grup,kodeunit,kodebud,norek,netral,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,sum(Debet-kredit) as realUSBI,0 as realBSBI,0 as realLSBI,sum(Debet-kredit) as JmlrealSBI
from #AkunMemorial
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3) in ('040','041','042','052','050') and unsur='G'
group by kodeunit,kodebud,norek,netral
--BARANG BAHAN
union all
select '2' as grup,kodeunit,kodebud,norek,netral,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,sum(Debet-kredit) as realBSBI,0 as realLSBI,sum(Debet-kredit) as JmlrealSBI
from #AkunMemorial
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3) in ('040','041','042','052','050') and unsur='B'
group by kodeunit,kodebud,norek,netral
--LAIN2
union all
select '2' as grup,kodeunit,kodebud,norek,netral,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,sum(Debet-kredit) as realLSBI,sum(Debet-kredit) as JmlrealSBI
from #AkunMemorial
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,3) in ('040','041','042','052','050') and unsur not in ('G','B')
group by kodeunit,kodebud,norek,netral

select a.grup,a.kodeunit,a.kodebud,substring(a.norek,1,5) as norek,a.netral,
sum(a.rkapUBI) as rkapUBI,sum(a.rkapBBI) as rkapBBI,sum(a.rkapLBI) as rkapLBI,sum(a.JmlrkapBI) as JmlrkapBI,
sum(a.pkbUBI) as pkbUBI,sum(a.pkbBBI) as pkbBBI,sum(a.pkbLBI) as pkbLBI,sum(a.JmlpkbBI) as JmlpkbBI,
sum(a.realUBI) as realUBI,sum(a.realBBI) as realBBI,sum(a.realLBI) as realLBI,sum(a.JmlrealBI) as JmlrealBI,
sum(a.rkapUSBI) as rkapUSBI,sum(a.rkapBSBI) as rkapBSBI,sum(a.rkapLSBI) as rkapLSBI,sum(a.JmlrkapSBI) as JmlrkapSBI,
sum(a.pkbUSBI) as pkbUSBI,sum(a.pkbBSBI) as pkbBSBI,sum(a.pkbLSBI) as pkbLSBI,sum(a.JmlpkbSBI) as JmlpkbSBI,
sum(a.realUSBI) as realUSBI,sum(a.realBSBI) as realBSBI,sum(a.realLSBI) as realLSBI,sum(a.JmlrealSBI) as JmlrealSBI,
cast(0 as float) as Luas,'' as nmBudidaya,'' as nmKebun,'' as Judul
into #t2
from #t1 a
where len(a.netral)=4
group by a.grup,a.kodeunit,a.kodebud,substring(a.norek,1,5),a.netral

--set ARITHABORT OFF
--set ANSI_WARNINGS OFF

update #t2 set Luas=(select Luas from #Ref_Areal where #t2.kodeunit=#Ref_Areal.kodekebun and #t2.kodebud=#Ref_Areal.kodebudidaya and #t2.netral=#Ref_Areal.tahuntanam) where len(netral)=4
update #t2 set Luas=0 where Luas is null

select a.kodeunit+a.kodebud+a.norek+a.netral as vLookUp,a.kodeunit+a.kodebud+substring(a.norek,1,3)+a.netral as vAreal,a.kodeunit+a.kodebud+substring(a.norek,1,3) as vlookUp2,a.kodebud,a.kodeunit,a.norek,a.netral as ThnTnm,
sum(a.JmlrkapBI) as JmlrkapBI,
sum(a.JmlpkbBI)  as JmlpkbBI, 
sum(a.JmlrealBI) as JmlrealBI,
sum(a.JmlrkapSBI) as JmlrkapSBI,
sum(a.JmlpkbSBI)  as JmlpkbSBI,
sum(a.JmlrealSBI) as JmlrealSBI,
a.Luas,a.nmBudidaya,'KEBUN : '+upper(b.NamaKebun) as  nmKebun,'BIAYA PEMELIHARAAN TBM '+upper(c.nm_bud) as Judul,upper(d.namabulan)+' TAHUN '+CAST(YEAR(@tanggal) as varchar(4)) as Bulan
into #t3
from #t2 a
inner join Ref_Kebun b on a.kodeunit=b.KodeKebun
inner join Ref_Budidaya c on a.kodeunit=c.KodeUnit and a.kodebud=c.kd_bud
inner join Ref_Bulan d on MONTH(@tanggal)=d.bulan
group by a.kodeunit,a.kodebud,norek,a.netral,a.Luas,a.nmBudidaya,a.nmKebun,a.Judul,b.NamaKebun,c.nm_bud,d.namabulan
order by a.kodeunit,a.kodebud,ThnTnm,a.norek

--Delete SPDK_KBN_LAYANAN_BAGIAN..FileG2
--insert SPDK_KBN_LAYANAN_BAGIAN..FileG2
select * into SPDK_KBN_LAYANAN_BAGIAN..FileG2_202007 from #t3
set nocount off
end

--set dateformat dmy exec PrsBiayaInvestasiTanaman_2017A '01-07-2020'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[PrsBiayaProduksi_2017A]
@tanggal datetime
as
set dateformat dmy
SET NOCOUNT ON;
BEGIN
declare @AwalTahun datetime
declare @AkhirBulan datetime
declare @AwalBulan datetime
set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @AwalBulan='01-'+cast(MONTH(@tanggal) as varchar(2))+'-'+cast(YEAR(@tanggal) as varchar(4))
set @AkhirBulan=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

set dateformat dmy exec SaldoAwal_BukuBesar @tanggal

select *                              into #AkunMemorialTemp   from SawKRBB         where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) 
--select *                              into #AkunMemorialTemp   from AkunMemorial    where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) 
select *                              into #AkunRKAPTemp       from AkunRKAP        where YEAR(tanggal)=YEAR(@tanggal) 
select *                              into #kartuTemp          from kartu           where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) 
select *                              into #AkunProduksiHPTemp from AkunProduksiHP  where YEAR(tanggal)=YEAR(@tanggal) 
select kodebudidaya,sum(luas) as Luas into #RekapAreal         from Ref_Areal       where status='TM' group by kodebudidaya
select distinct Norek,NamaRekening    into #Ref_Rekening       from Ref_Rekening    where SUBSTRING(norek,1,1)='6' or SUBSTRING(norek,1,3)='490'

select distinct a.KodeUnit,a.KodeBudidaya,b.kdasal,b.rekJadi as norek,b.uraian 
into #ref_asalprod
from #kartuTemp a
full outer join Ref_AsalProd b on '6'=SUBSTRING(b.rekJadi,1,1)
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and SUBSTRING(a.norek,1,1)='6'
order by a.KodeUnit,b.kdasal

select distinct a.KodeUnit,a.KodeBudidaya,b.kdasal,b.rekJadi as norek,b.uraian 
into #ref_asalprod1
from #kartuTemp a
full outer join Ref_AsalProd b on '6'=SUBSTRING(b.rekBasah,1,1)
where MONTH(a.tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and SUBSTRING(a.norek,1,1)='6'
order by a.KodeUnit,b.kdasal

select tanggal,KodeUnit,kodebud,Norek,unsur,nilai as debet,0 as kredit
into #AkunMemorial
from #AkunMemorialTemp 
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and NoInput in ('SALDO AWAL','TRANSAKSI') and DK='D'
union all
select tanggal,KodeUnit,kodebud,Norek,unsur,0 as debet,nilai as kredit
from #AkunMemorialTemp 
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and NoInput in ('SALDO AWAL','TRANSAKSI') and DK='K'

--RKAP BULAN INI
--RKAP UPAH
select '2' as grup,kodeunit,kodebud,norek,
nilai_RKAP as rkapUBI,0 as rkapBBI,0 as rkapLBI,nilai_RKAP as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,0   as JmlrealSBI,
nilai_PMK as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0   as JmlpkbSBI
into #PrsBiayaTanaman1
from #AkunRKAPTemp
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,1) in ('6') and unsur='GU'
--RKAP BARANG BAHAN
union all
select '2' as grup,kodeunit,kodebud,norek,
0 as rkapUBI,nilai_RKAP as rkapBBI,0 as rkapLBI,nilai_RKAP as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,0   as JmlrealSBI,
0 as pkbUBI,nilai_PMK as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0   as JmlpkbSBI
from #AkunRKAPTemp
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,1) in ('6') and unsur='BB'
--RKAP LAIN2
union all
select '2' as grup,kodeunit,kodebud,norek,
0 as rkapUBI,0 as rkapBBI,nilai_RKAP as rkapLBI,nilai_RKAP as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,0   as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,nilai_PMK as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0   as JmlpkbSBI
from #AkunRKAPTemp
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)='6' or SUBSTRING(norek,1,3)='490') and unsur not in ('GU','BB')
UNION ALL

--RKAP S/D BULAN INI
--RKAP UPAH
select '2' as grup,kodeunit,kodebud,norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,nilai_RKAP as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,nilai_RKAP as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,0   as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,nilai_PMK as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0   as JmlpkbSBI
from #AkunRKAPTemp
where tanggal>=@AwalTahun and tanggal<=@AkhirBulan and SUBSTRING(norek,1,1) in ('6') and unsur='GU'
--RKAP BARANG BAHAN
union all
select '2' as grup,kodeunit,kodebud,norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,nilai_RKAP as rkapBSBI,0 as rkapLSBI,nilai_RKAP as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,0   as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,nilai_PMK as pkbBSBI,0 as pkbLSBI,0   as JmlpkbSBI
from #AkunRKAPTemp
where tanggal>=@AwalTahun and tanggal<=@AkhirBulan and SUBSTRING(norek,1,1) in ('6') and unsur='BB'
--RKAP LAIN2
union all
select '2' as grup,kodeunit,kodebud,norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,nilai_RKAP as rkapLSBI,nilai_RKAP as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,0   as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,nilai_PMK as pkbLSBI,0   as JmlpkbSBI
from #AkunRKAPTemp
where tanggal>=@AwalTahun and tanggal<=@AkhirBulan and (SUBSTRING(norek,1,1)='6' or SUBSTRING(norek,1,3)='490') and unsur not in ('GU','BB')
UNION ALL

--REALISASI BULAN INI
--UPAH
select '2' as grup,kodeunit,KodeBudidaya,norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
sum(Debet-kredit) as realUBI,0 as realBBI,0 as realLBI,sum(Debet-kredit) as JmlrealBI,sum(Debet-kredit) as realUSBI,0 as realBSBI,0 as realLSBI,sum(Debet-kredit) as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI
from #kartuTemp
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,1) in ('6') and Aplikasi='GUP'
group by kodeunit,KodeBudidaya,norek
--BARANG BAHAN
union all
select '2' as grup,kodeunit,KodeBudidaya,norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,sum(Debet-kredit) as realBBI,0 as realLBI,sum(Debet-kredit) as JmlrealBI,0 as realUSBI,sum(Debet-kredit) as realBSBI,0 as realLSBI,sum(Debet-kredit) as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI
from #kartuTemp
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,1) in ('6') and Aplikasi='TUP'
group by kodeunit,KodeBudidaya,norek
--LAIN2
union all
select '2' as grup,kodeunit,KodeBudidaya,norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,0 as realBBI,sum(Debet-kredit) as realLBI,sum(Debet-kredit) as JmlrealBI,0 as realUSBI,0 as realBSBI,sum(Debet-kredit) as realLSBI,sum(Debet-kredit) as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI
from #kartuTemp
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)='6' or SUBSTRING(norek,1,3)='490') and Aplikasi not in ('GUP','TUP')
group by kodeunit,KodeBudidaya,norek
UNION ALL

--REALISASI SAMPAI DENGAN BULAN INI
--UPAH
select '2' as grup,kodeunit,KodeBud,norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,sum(nilai) as realUSBI,0 as realBSBI,0 as realLSBI,sum(nilai) as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI
from #AkunMemorialTemp
where NoInput in ('saldo awal','transaksi') and unsur='G' and DK='D' and SUBSTRING(norek,1,1) in ('6')
group by kodeunit,KodeBud,norek
union all
select '2' as grup,kodeunit,KodeBud,norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,-1*sum(nilai) as realUSBI,0 as realBSBI,0 as realLSBI,-1*sum(nilai) as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI
from #AkunMemorialTemp
where NoInput in ('saldo awal','transaksi') and unsur='G' and DK='K' and SUBSTRING(norek,1,1) in ('6')
group by kodeunit,KodeBud,norek
union all
select '2' as grup,kodeunit,KodeBudidaya,norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,sum(Debet-kredit) as realUSBI,0 as realBSBI,0 as realLSBI,sum(Debet-kredit) as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI
from #kartuTemp
--where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and SUBSTRING(norek,1,1) in ('6') and unsur='G'
where tanggal>=@AwalTahun and tanggal<@AwalBulan and SUBSTRING(norek,1,1) in ('6') and Aplikasi='GUP'
group by kodeunit,KodeBudidaya,norek
union all

--BARANG BAHAN
select '2' as grup,kodeunit,KodeBud,norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,SUM(nilai) as realBSBI,0 as realLSBI,sum(nilai) as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI
from #AkunMemorialTemp
where NoInput in ('saldo awal','transaksi') and unsur='B' and DK='D' and SUBSTRING(norek,1,1) in ('6')
group by kodeunit,KodeBud,norek
union all
select '2' as grup,kodeunit,KodeBud,norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,-1*sum(nilai) as realBSBI,0 as realLSBI,-1*sum(nilai) as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI
from #AkunMemorialTemp
where NoInput in ('saldo awal','transaksi') and unsur='B' and DK='K' and SUBSTRING(norek,1,1) in ('6')
group by kodeunit,KodeBud,norek
union all
select '2' as grup,kodeunit,KodeBudidaya,norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,sum(Debet-kredit) as realBSBI,0 as realLSBI,sum(Debet-kredit) as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI
from #kartuTemp
where tanggal>=@AwalTahun and tanggal<@AwalBulan and SUBSTRING(norek,1,1) in ('6') and Aplikasi='TUP'
group by kodeunit,KodeBudidaya,norek
union all
--LAIN2
select '2' as grup,kodeunit,KodeBud,norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,SUM(nilai) as realLSBI,sum(nilai) as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI
from #AkunMemorialTemp
where NoInput in ('saldo awal','transaksi') and unsur not in ('B','G') and DK='D' and (SUBSTRING(norek,1,1)='6' or SUBSTRING(norek,1,3)='490')
group by kodeunit,KodeBud,norek
union all
select '2' as grup,kodeunit,KodeBud,norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,-1*sum(nilai) as realLSBI,-1*sum(nilai) as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI
from #AkunMemorialTemp
where NoInput in ('saldo awal','transaksi') and unsur not in ('B','G') and DK='K' and (SUBSTRING(norek,1,1)='6' or SUBSTRING(norek,1,3)='490')
group by kodeunit,KodeBud,norek
union all
select '2' as grup,kodeunit,KodeBudidaya,norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,sum(Debet-kredit) as realLSBI,sum(Debet-kredit) as JmlrealSBI,
0 as pkbUBI,0 as pkbBBI,0 as pkbLBI,0 as JmlpkbBI,0 as pkbUSBI,0 as pkbBSBI,0 as pkbLSBI,0 as JmlpkbSBI
from #kartuTemp
where tanggal>=@AwalTahun and tanggal<@AwalBulan and (SUBSTRING(norek,1,1)='6' or SUBSTRING(norek,1,3)='490') and Aplikasi not in ('GUP','TUP')
group by kodeunit,KodeBudidaya,norek

select a.grup,a.kodeunit,a.kodebud,a.norek,
sum(a.rkapUBI) as rkapUBI,sum(a.rkapBBI) as rkapBBI,sum(a.rkapLBI) as rkapLBI,sum(a.JmlrkapBI) as JmlrkapBI,
sum(a.rkapUSBI) as rkapUSBI,sum(a.rkapBSBI) as rkapBSBI,sum(a.rkapLSBI) as rkapLSBI,sum(a.JmlrkapSBI) as JmlrkapSBI,
sum(a.realUBI) as realUBI,sum(a.realBBI) as realBBI,sum(a.realLBI) as realLBI,sum(a.JmlrealBI) as JmlrealBI,
sum(a.realUSBI) as realUSBI,sum(a.realBSBI) as realBSBI,sum(a.realLSBI) as realLSBI,sum(a.JmlrealSBI) as JmlrealSBI,
sum(a.pkbUBI) as pkbUBI,sum(a.pkbBBI) as pkbBBI,sum(a.pkbLBI) as pkbLBI,sum(a.JmlpkbBI) as JmlpkbBI,
sum(a.pkbUSBI) as pkbUSBI,sum(a.pkbBSBI) as pkbBSBI,sum(a.pkbLSBI) as pkbLSBI,sum(a.JmlpkbSBI) as JmlpkbSBI
into #InfoBPR
from #PrsBiayaTanaman1 a
group by a.grup,a.kodeunit,a.kodebud,a.norek

----PROSES FISIK PRODUKSI
--PRODUKSI RKAP BASAH YUDHA
select '00' as grup,kodeunit,kodebud,'B'+norek as norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,rbi as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,bi  as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,0 as JmlrealSBI,
0 as pkbUBI, 0 as pkbBBI, 0 as pkbLBI, pbi as JmlpkbBI, 0 as pkbUSBI, 0 as pkbBSBI, 0 as pkbLSBI, 0 as JmlpkbSBI
into #PrsFisikProduksi1
from #AkunProduksiHPTemp
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kodevar='BASAH'
union all
select '00' as grup,kodeunit,kodebud,'B'+norek as norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,rbi as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,bi   as JmlrealSBI,
0 as pkbUBI, 0 as pkbBBI, 0 as pkbLBI, 0 as JmlpkbBI, 0 as pkbUSBI, 0 as pkbBSBI, 0 as pkbLSBI, pbi as JmlpkbSBI
from #AkunProduksiHPTemp
where tanggal>=@AwalTahun and tanggal<=@AkhirBulan and kodevar='BASAH'
union all

--PRODUKSI RKAP JADI
select '01' as grup,kodeunit,kodebud,'J'+norek as norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,rbi as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,0 as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,bi  as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,0 as JmlrealSBI,
0 as pkbUBI, 0 as pkbBBI, 0 as pkbLBI, pbi as JmlpkbBI, 0 as pkbUSBI, 0 as pkbBSBI, 0 as pkbLSBI, 0 as JmlpkbSBI
from #AkunProduksiHPTemp
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and kodevar='JADI'
union all
select '00' as grup,kodeunit,kodebud,'J'+norek as norek,
0 as rkapUBI,0 as rkapBBI,0 as rkapLBI,0 as JmlrkapBI,0 as rkapUSBI,0 as rkapBSBI,0 as rkapLSBI,rbi as JmlrkapSBI,
0 as realUBI,0 as realBBI,0 as realLBI,0 as JmlrealBI,0 as realUSBI,0 as realBSBI,0 as realLSBI,bi   as JmlrealSBI,
0 as pkbUBI, 0 as pkbBBI, 0 as pkbLBI, 0 as JmlpkbBI, 0 as pkbUSBI, 0 as pkbBSBI, 0 as pkbLSBI, pbi as JmlpkbSBI
from #AkunProduksiHPTemp
where tanggal>=@AwalTahun and tanggal<=@AkhirBulan and kodevar='JADI'

--PRODUKSI BASAH/JADI
select a.grup,a.kodeunit,a.kodebud,a.norek,
sum(a.rkapUBI) as rkapUBI,sum(a.rkapBBI) as rkapBBI,sum(a.rkapLBI) as rkapLBI,sum(a.JmlrkapBI) as JmlrkapBI,
sum(a.rkapUSBI) as rkapUSBI,sum(a.rkapBSBI) as rkapBSBI,sum(a.rkapLSBI) as rkapLSBI,sum(a.JmlrkapSBI) as JmlrkapSBI,
sum(a.realUBI) as realUBI,sum(a.realBBI) as realBBI,sum(a.realLBI) as realLBI,sum(a.JmlrealBI) as JmlrealBI,
sum(a.realUSBI) as realUSBI,sum(a.realBSBI) as realBSBI,sum(a.realLSBI) as realLSBI,sum(a.JmlrealSBI) as JmlrealSBI,
sum(a.pkbUBI) as pkbUBI,sum(a.pkbBBI) as pkbBBI,sum(a.pkbLBI) as pkbLBI,sum(a.JmlpkbBI) as JmlpkbBI,
sum(a.pkbUSBI) as pkbUSBI,sum(a.pkbBSBI) as pkbBSBI,sum(a.pkbLSBI) as pkbLSBI,sum(a.JmlpkbSBI) as JmlpkbSBI
into #PrsFisikProduksi2
from #PrsFisikProduksi1 a
group by a.grup,a.kodeunit,a.kodebud,a.norek

--PRODUKDI BASAH
select '101' as Grup,kodeunit,kodebud,cast('BX' as varchar(50)) as norek,kodeunit+kodebud+'BX' as vLookUp,cast('Sendiri/Murni' as varchar(100)) as uraian,
sum(rkapUBI) as rkapUBI,sum(rkapBBI) as rkapBBI,sum(rkapLBI) as rkapLBI,sum(JmlrkapBI) as JmlrkapBI,
sum(rkapUSBI) as rkapUSBI,sum(rkapBSBI) as rkapBSBI,sum(rkapLSBI) as rkapLSBI,sum(JmlrkapSBI) as JmlrkapSBI,
sum(realUBI) as realUBI,sum(realBBI) as realBBI,sum(realLBI) as realLBI,sum(JmlrealBI) as JmlrealBI,
sum(realUSBI) as realUSBI,sum(realBSBI) as realBSBI,sum(realLSBI) as realLSBI,sum(JmlrealSBI) as JmlrealSBI,
sum(pkbUBI) as pkbUBI,sum(pkbBBI) as pkbBBI,sum(pkbLBI) as pkbLBI,sum(JmlpkbBI) as JmlpkbBI,
sum(pkbUSBI) as pkbUSBI,sum(pkbBSBI) as pkbBSBI,sum(pkbLSBI) as pkbLSBI,sum(JmlpkbSBI) as JmlpkbSBI
into #PrsFisikProduksiFinal
from #PrsFisikProduksi2
where norek='BX'
group by kodeunit,kodebud
union all
select '102' as Grup,kodeunit,kodebud,'B6080200' as norek,kodeunit+kodebud+'B6080200' as vLookUp,'Lancuran/TBM' as uraian,
sum(rkapUBI) as rkapUBI,sum(rkapBBI) as rkapBBI,sum(rkapLBI) as rkapLBI,sum(JmlrkapBI) as JmlrkapBI,
sum(rkapUSBI) as rkapUSBI,sum(rkapBSBI) as rkapBSBI,sum(rkapLSBI) as rkapLSBI,sum(JmlrkapSBI) as JmlrkapSBI,
sum(realUBI) as realUBI,sum(realBBI) as realBBI,sum(realLBI) as realLBI,sum(JmlrealBI) as JmlrealBI,
sum(realUSBI) as realUSBI,sum(realBSBI) as realBSBI,sum(realLSBI) as realLSBI,sum(JmlrealSBI) as JmlrealSBI,
sum(pkbUBI) as pkbUBI,sum(pkbBBI) as pkbBBI,sum(pkbLBI) as pkbLBI,sum(JmlpkbBI) as JmlpkbBI,
sum(pkbUSBI) as pkbUSBI,sum(pkbBSBI) as pkbBSBI,sum(pkbLSBI) as pkbLSBI,sum(JmlpkbSBI) as JmlpkbSBI
from #PrsFisikProduksi2
where norek in ('B6080200','B6080300')
group by kodeunit,kodebud
union all
select '103' as Grup,kodeunit,kodebud,'B6080101' as norek,kodeunit+kodebud+'B6080101' as vLookUp,'dari Pihak Ke III' as uraian,
sum(rkapUBI) as rkapUBI,sum(rkapBBI) as rkapBBI,sum(rkapLBI) as rkapLBI,sum(JmlrkapBI) as JmlrkapBI,
sum(rkapUSBI) as rkapUSBI,sum(rkapBSBI) as rkapBSBI,sum(rkapLSBI) as rkapLSBI,sum(JmlrkapSBI) as JmlrkapSBI,
sum(realUBI) as realUBI,sum(realBBI) as realBBI,sum(realLBI) as realLBI,sum(JmlrealBI) as JmlrealBI,
sum(realUSBI) as realUSBI,sum(realBSBI) as realBSBI,sum(realLSBI) as realLSBI,sum(JmlrealSBI) as JmlrealSBI,
sum(pkbUBI) as pkbUBI,sum(pkbBBI) as pkbBBI,sum(pkbLBI) as pkbLBI,sum(JmlpkbBI) as JmlpkbBI,
sum(pkbUSBI) as pkbUSBI,sum(pkbBSBI) as pkbBSBI,sum(pkbLSBI) as pkbLSBI,sum(JmlpkbSBI) as JmlpkbSBI
from #PrsFisikProduksi2
where norek in ('B6080101','B6080102')
group by kodeunit,kodebud
union all
select '104' as Grup,kodeunit,kodebud,'B6080100' as norek,kodeunit+kodebud+'B6080100' as vLookUp,'Pembelian antar Kebun' as uraian,
sum(rkapUBI) as rkapUBI,sum(rkapBBI) as rkapBBI,sum(rkapLBI) as rkapLBI,sum(JmlrkapBI) as JmlrkapBI,
sum(rkapUSBI) as rkapUSBI,sum(rkapBSBI) as rkapBSBI,sum(rkapLSBI) as rkapLSBI,sum(JmlrkapSBI) as JmlrkapSBI,
sum(realUBI) as realUBI,sum(realBBI) as realBBI,sum(realLBI) as realLBI,sum(JmlrealBI) as JmlrealBI,
sum(realUSBI) as realUSBI,sum(realBSBI) as realBSBI,sum(realLSBI) as realLSBI,sum(JmlrealSBI) as JmlrealSBI,
sum(pkbUBI) as pkbUBI,sum(pkbBBI) as pkbBBI,sum(pkbLBI) as pkbLBI,sum(JmlpkbBI) as JmlpkbBI,
sum(pkbUSBI) as pkbUSBI,sum(pkbBSBI) as pkbBSBI,sum(pkbLSBI) as pkbLSBI,sum(JmlpkbSBI) as JmlpkbSBI
from #PrsFisikProduksi2
where norek in ('B6080100')
group by kodeunit,kodebud
union all
select '105' as Grup,kodeunit,kodebud,'B6090100' as norek,kodeunit+kodebud+'B6090100' as vLookUp,'Penjualan antar Kebun' as uraian,
sum(rkapUBI) as rkapUBI,sum(rkapBBI) as rkapBBI,sum(rkapLBI) as rkapLBI,sum(JmlrkapBI) as JmlrkapBI,
sum(rkapUSBI) as rkapUSBI,sum(rkapBSBI) as rkapBSBI,sum(rkapLSBI) as rkapLSBI,sum(JmlrkapSBI) as JmlrkapSBI,
sum(realUBI) as realUBI,sum(realBBI) as realBBI,sum(realLBI) as realLBI,sum(JmlrealBI) as JmlrealBI,
sum(realUSBI) as realUSBI,sum(realBSBI) as realBSBI,sum(realLSBI) as realLSBI,sum(JmlrealSBI) as JmlrealSBI,
sum(pkbUBI) as pkbUBI,sum(pkbBBI) as pkbBBI,sum(pkbLBI) as pkbLBI,sum(JmlpkbBI) as JmlpkbBI,
sum(pkbUSBI) as pkbUSBI,sum(pkbBSBI) as pkbBSBI,sum(pkbLSBI) as pkbLSBI,sum(JmlpkbSBI) as JmlpkbSBI
from #PrsFisikProduksi2
where norek in ('B6090100')
group by kodeunit,kodebud
union all

--PRODUKDI JADI
select '101' as Grup,kodeunit,kodebud,cast('JX' as varchar(50)) as norek,kodeunit+kodebud+'JX' as vLookUp,cast('Sendiri/Murni' as varchar(100)) as uraian,
sum(rkapUBI) as rkapUBI,sum(rkapBBI) as rkapBBI,sum(rkapLBI) as rkapLBI,sum(JmlrkapBI) as JmlrkapBI,
sum(rkapUSBI) as rkapUSBI,sum(rkapBSBI) as rkapBSBI,sum(rkapLSBI) as rkapLSBI,sum(JmlrkapSBI) as JmlrkapSBI,
sum(realUBI) as realUBI,sum(realBBI) as realBBI,sum(realLBI) as realLBI,sum(JmlrealBI) as JmlrealBI,
sum(realUSBI) as realUSBI,sum(realBSBI) as realBSBI,sum(realLSBI) as realLSBI,sum(JmlrealSBI) as JmlrealSBI,
sum(pkbUBI) as pkbUBI,sum(pkbBBI) as pkbBBI,sum(pkbLBI) as pkbLBI,sum(JmlpkbBI) as JmlpkbBI,
sum(pkbUSBI) as pkbUSBI,sum(pkbBSBI) as pkbBSBI,sum(pkbLSBI) as pkbLSBI,sum(JmlpkbSBI) as JmlpkbSBI
from #PrsFisikProduksi2
where norek='JX'
group by kodeunit,kodebud
union all
select '102' as Grup,kodeunit,kodebud,'J6080500' as norek,kodeunit+kodebud+'J6080500' as vLookUp,'Lancuran/TBM' as uraian,
sum(rkapUBI) as rkapUBI,sum(rkapBBI) as rkapBBI,sum(rkapLBI) as rkapLBI,sum(JmlrkapBI) as JmlrkapBI,
sum(rkapUSBI) as rkapUSBI,sum(rkapBSBI) as rkapBSBI,sum(rkapLSBI) as rkapLSBI,sum(JmlrkapSBI) as JmlrkapSBI,
sum(realUBI) as realUBI,sum(realBBI) as realBBI,sum(realLBI) as realLBI,sum(JmlrealBI) as JmlrealBI,
sum(realUSBI) as realUSBI,sum(realBSBI) as realBSBI,sum(realLSBI) as realLSBI,sum(JmlrealSBI) as JmlrealSBI,
sum(pkbUBI) as pkbUBI,sum(pkbBBI) as pkbBBI,sum(pkbLBI) as pkbLBI,sum(JmlpkbBI) as JmlpkbBI,
sum(pkbUSBI) as pkbUSBI,sum(pkbBSBI) as pkbBSBI,sum(pkbLSBI) as pkbLSBI,sum(JmlpkbSBI) as JmlpkbSBI
from #PrsFisikProduksi2
where norek in ('J6080500','J6080600')
group by kodeunit,kodebud
union all
select '103' as Grup,kodeunit,kodebud,'J6080402' as norek,kodeunit+kodebud+'J6080402' as vLookUp,'dari Pihak Ke III' as uraian,
sum(rkapUBI) as rkapUBI,sum(rkapBBI) as rkapBBI,sum(rkapLBI) as rkapLBI,sum(JmlrkapBI) as JmlrkapBI,
sum(rkapUSBI) as rkapUSBI,sum(rkapBSBI) as rkapBSBI,sum(rkapLSBI) as rkapLSBI,sum(JmlrkapSBI) as JmlrkapSBI,
sum(realUBI) as realUBI,sum(realBBI) as realBBI,sum(realLBI) as realLBI,sum(JmlrealBI) as JmlrealBI,
sum(realUSBI) as realUSBI,sum(realBSBI) as realBSBI,sum(realLSBI) as realLSBI,sum(JmlrealSBI) as JmlrealSBI,
sum(pkbUBI) as pkbUBI,sum(pkbBBI) as pkbBBI,sum(pkbLBI) as pkbLBI,sum(JmlpkbBI) as JmlpkbBI,
sum(pkbUSBI) as pkbUSBI,sum(pkbBSBI) as pkbBSBI,sum(pkbLSBI) as pkbLSBI,sum(JmlpkbSBI) as JmlpkbSBI
from #PrsFisikProduksi2
where norek in ('J6080402','J6080401')
group by kodeunit,kodebud
union all
select '104' as Grup,kodeunit,kodebud,'J6080400' as norek,kodeunit+kodebud+'J6080400' as vLookUp,'Pembelian antar Kebun' as uraian,
sum(rkapUBI) as rkapUBI,sum(rkapBBI) as rkapBBI,sum(rkapLBI) as rkapLBI,sum(JmlrkapBI) as JmlrkapBI,
sum(rkapUSBI) as rkapUSBI,sum(rkapBSBI) as rkapBSBI,sum(rkapLSBI) as rkapLSBI,sum(JmlrkapSBI) as JmlrkapSBI,
sum(realUBI) as realUBI,sum(realBBI) as realBBI,sum(realLBI) as realLBI,sum(JmlrealBI) as JmlrealBI,
sum(realUSBI) as realUSBI,sum(realBSBI) as realBSBI,sum(realLSBI) as realLSBI,sum(JmlrealSBI) as JmlrealSBI,
sum(pkbUBI) as pkbUBI,sum(pkbBBI) as pkbBBI,sum(pkbLBI) as pkbLBI,sum(JmlpkbBI) as JmlpkbBI,
sum(pkbUSBI) as pkbUSBI,sum(pkbBSBI) as pkbBSBI,sum(pkbLSBI) as pkbLSBI,sum(JmlpkbSBI) as JmlpkbSBI
from #PrsFisikProduksi2
where norek in ('J6080400')
group by kodeunit,kodebud
union all
select '105' as Grup,kodeunit,kodebud,'J6090400' as norek,kodeunit+kodebud+'J6090400' as vLookUp,'Penjualan antar Kebun' as uraian,
sum(rkapUBI) as rkapUBI,sum(rkapBBI) as rkapBBI,sum(rkapLBI) as rkapLBI,sum(JmlrkapBI) as JmlrkapBI,
sum(rkapUSBI) as rkapUSBI,sum(rkapBSBI) as rkapBSBI,sum(rkapLSBI) as rkapLSBI,sum(JmlrkapSBI) as JmlrkapSBI,
sum(realUBI) as realUBI,sum(realBBI) as realBBI,sum(realLBI) as realLBI,sum(JmlrealBI) as JmlrealBI,
sum(realUSBI) as realUSBI,sum(realBSBI) as realBSBI,sum(realLSBI) as realLSBI,sum(JmlrealSBI) as JmlrealSBI,
sum(pkbUBI) as pkbUBI,sum(pkbBBI) as pkbBBI,sum(pkbLBI) as pkbLBI,sum(JmlpkbBI) as JmlpkbBI,
sum(pkbUSBI) as pkbUSBI,sum(pkbBSBI) as pkbBSBI,sum(pkbLSBI) as pkbLSBI,sum(JmlpkbSBI) as JmlpkbSBI
from #PrsFisikProduksi2
where norek in ('J6090400','J6090500','J6090402')
group by kodeunit,kodebud
union all
select '106' as Grup,kodeunit,kodebud,'J6900403' as norek,kodeunit+kodebud+'J6900403' as vLookUp,'Penjualan Barang Hasil Jadi' as uraian,
sum(rkapUBI) as rkapUBI,sum(rkapBBI) as rkapBBI,sum(rkapLBI) as rkapLBI,sum(JmlrkapBI) as JmlrkapBI,
sum(rkapUSBI) as rkapUSBI,sum(rkapBSBI) as rkapBSBI,sum(rkapLSBI) as rkapLSBI,sum(JmlrkapSBI) as JmlrkapSBI,
sum(realUBI) as realUBI,sum(realBBI) as realBBI,sum(realLBI) as realLBI,sum(JmlrealBI) as JmlrealBI,
sum(realUSBI) as realUSBI,sum(realBSBI) as realBSBI,sum(realLSBI) as realLSBI,sum(JmlrealSBI) as JmlrealSBI,
sum(pkbUBI) as pkbUBI,sum(pkbBBI) as pkbBBI,sum(pkbLBI) as pkbLBI,sum(JmlpkbBI) as JmlpkbBI,
sum(pkbUSBI) as pkbUSBI,sum(pkbBSBI) as pkbBSBI,sum(pkbLSBI) as pkbLSBI,sum(JmlpkbSBI) as JmlpkbSBI
from #PrsFisikProduksi2
where norek in ('J6900403')
group by kodeunit,kodebud
select * into #InfoPRD from #PrsFisikProduksiFinal

select kodekebun,kodebudidaya,SUM(luas) as luas into #Ref_Areal from Ref_Areal where status='TM' group by kodekebun,kodebudidaya

select '201' as grup,a.kodeunit,a.kodebud,substring(a.norek,1,7) as Norek,a.kodeunit+a.kodebud+SUBSTRING(a.norek,1,7) as vLookUp,'' as uraian,
sum(a.rkapUBI) as rkapUBI,sum(a.rkapBBI) as rkapBBI,sum(a.rkapLBI) as rkapLBI,sum(a.JmlrkapBI) as JmlrkapBI,
sum(a.rkapUSBI) as rkapUSBI,sum(a.rkapBSBI) as rkapBSBI,sum(a.rkapLSBI) as rkapLSBI,sum(a.JmlrkapSBI) as JmlrkapSBI,
sum(a.realUBI) as realUBI,sum(a.realBBI) as realBBI,sum(a.realLBI) as realLBI,sum(a.JmlrealBI) as JmlrealBI,
sum(a.realUSBI) as realUSBI,sum(a.realBSBI) as realBSBI,sum(a.realLSBI) as realLSBI,sum(a.JmlrealSBI) as JmlrealSBI,
sum(a.pkbUBI) as pkbUBI,sum(a.pkbBBI) as pkbBBI,sum(a.pkbLBI) as pkbLBI,sum(a.JmlpkbBI) as JmlpkbBI,
sum(a.pkbUSBI) as pkbUSBI,sum(a.pkbBSBI) as pkbBSBI,sum(a.pkbLSBI) as pkbLSBI,sum(a.JmlpkbSBI) as JmlpkbSBI
into #t1
from #InfoBPR a
where SUBSTRING(a.norek,1,7) in ('6000001','6000002')
group by a.grup,a.kodeunit,a.kodebud,substring(a.norek,1,7)
union all
select '202' as grup,a.kodeunit,a.kodebud,substring(a.norek,1,5) as Norek,a.kodeunit+a.kodebud+SUBSTRING(a.norek,1,5) as vLookUp,'' as uraian,
sum(a.rkapUBI) as rkapUBI,sum(a.rkapBBI) as rkapBBI,sum(a.rkapLBI) as rkapLBI,sum(a.JmlrkapBI) as JmlrkapBI,
sum(a.rkapUSBI) as rkapUSBI,sum(a.rkapBSBI) as rkapBSBI,sum(a.rkapLSBI) as rkapLSBI,sum(a.JmlrkapSBI) as JmlrkapSBI,
sum(a.realUBI) as realUBI,sum(a.realBBI) as realBBI,sum(a.realLBI) as realLBI,sum(a.JmlrealBI) as JmlrealBI,
sum(a.realUSBI) as realUSBI,sum(a.realBSBI) as realBSBI,sum(a.realLSBI) as realLSBI,sum(a.JmlrealSBI) as JmlrealSBI,
sum(a.pkbUBI) as pkbUBI,sum(a.pkbBBI) as pkbBBI,sum(a.pkbLBI) as pkbLBI,sum(a.JmlpkbBI) as JmlpkbBI,
sum(a.pkbUSBI) as pkbUSBI,sum(a.pkbBSBI) as pkbBSBI,sum(a.pkbLSBI) as pkbLSBI,sum(a.JmlpkbSBI) as JmlpkbSBI
from #InfoBPR a
where SUBSTRING(a.norek,1,3)='601'
group by a.grup,a.kodeunit,a.kodebud,substring(a.norek,1,5)
union all
select '203' as grup,a.kodeunit,a.kodebud,substring(a.norek,1,5) as Norek,a.kodeunit+a.kodebud+SUBSTRING(a.norek,1,5) as vLookUp,'' as uraian,
sum(a.rkapUBI) as rkapUBI,sum(a.rkapBBI) as rkapBBI,sum(a.rkapLBI) as rkapLBI,sum(a.JmlrkapBI) as JmlrkapBI,
sum(a.rkapUSBI) as rkapUSBI,sum(a.rkapBSBI) as rkapBSBI,sum(a.rkapLSBI) as rkapLSBI,sum(a.JmlrkapSBI) as JmlrkapSBI,
sum(a.realUBI) as realUBI,sum(a.realBBI) as realBBI,sum(a.realLBI) as realLBI,sum(a.JmlrealBI) as JmlrealBI,
sum(a.realUSBI) as realUSBI,sum(a.realBSBI) as realBSBI,sum(a.realLSBI) as realLSBI,sum(a.JmlrealSBI) as JmlrealSBI,
sum(a.pkbUBI) as pkbUBI,sum(a.pkbBBI) as pkbBBI,sum(a.pkbLBI) as pkbLBI,sum(a.JmlpkbBI) as JmlpkbBI,
sum(a.pkbUSBI) as pkbUSBI,sum(a.pkbBSBI) as pkbBSBI,sum(a.pkbLSBI) as pkbLSBI,sum(a.JmlpkbSBI) as JmlpkbSBI
from #InfoBPR a
where SUBSTRING(a.norek,1,3)='602'
group by a.grup,a.kodeunit,a.kodebud,substring(a.norek,1,5)
union all
select '205' as grup,a.kodeunit,a.kodebud,substring(a.norek,1,7) as Norek,a.kodeunit+a.kodebud+SUBSTRING(a.norek,1,7) as vLookUp,'' as uraian,
sum(a.rkapUBI) as rkapUBI,sum(a.rkapBBI) as rkapBBI,sum(a.rkapLBI) as rkapLBI,sum(a.JmlrkapBI) as JmlrkapBI,
sum(a.rkapUSBI) as rkapUSBI,sum(a.rkapBSBI) as rkapBSBI,sum(a.rkapLSBI) as rkapLSBI,sum(a.JmlrkapSBI) as JmlrkapSBI,
sum(a.realUBI) as realUBI,sum(a.realBBI) as realBBI,sum(a.realLBI) as realLBI,sum(a.JmlrealBI) as JmlrealBI,
sum(a.realUSBI) as realUSBI,sum(a.realBSBI) as realBSBI,sum(a.realLSBI) as realLSBI,sum(a.JmlrealSBI) as JmlrealSBI,
sum(a.pkbUBI) as pkbUBI,sum(a.pkbBBI) as pkbBBI,sum(a.pkbLBI) as pkbLBI,sum(a.JmlpkbBI) as JmlpkbBI,
sum(a.pkbUSBI) as pkbUSBI,sum(a.pkbBSBI) as pkbBSBI,sum(a.pkbLSBI) as pkbLSBI,sum(a.JmlpkbSBI) as JmlpkbSBI
from #InfoBPR a
where SUBSTRING(a.norek,1,7)='4900001'
group by a.grup,a.kodeunit,a.kodebud,substring(a.norek,1,7)
union all
select '207' as grup,a.kodeunit,a.kodebud,'603-607' as Norek,a.kodeunit+a.kodebud+'603-607' as vLookUp,'' as uraian,
sum(a.rkapUBI) as rkapUBI,sum(a.rkapBBI) as rkapBBI,sum(a.rkapLBI) as rkapLBI,sum(a.JmlrkapBI) as JmlrkapBI,
sum(a.rkapUSBI) as rkapUSBI,sum(a.rkapBSBI) as rkapBSBI,sum(a.rkapLSBI) as rkapLSBI,sum(a.JmlrkapSBI) as JmlrkapSBI,
sum(a.realUBI) as realUBI,sum(a.realBBI) as realBBI,sum(a.realLBI) as realLBI,sum(a.JmlrealBI) as JmlrealBI,
sum(a.realUSBI) as realUSBI,sum(a.realBSBI) as realBSBI,sum(a.realLSBI) as realLSBI,sum(a.JmlrealSBI) as JmlrealSBI,
sum(a.pkbUBI) as pkbUBI,sum(a.pkbBBI) as pkbBBI,sum(a.pkbLBI) as pkbLBI,sum(a.JmlpkbBI) as JmlpkbBI,
sum(a.pkbUSBI) as pkbUSBI,sum(a.pkbBSBI) as pkbBSBI,sum(a.pkbLSBI) as pkbLSBI,sum(a.JmlpkbSBI) as JmlpkbSBI
from #InfoBPR a
where SUBSTRING(a.norek,1,3)>='603' and SUBSTRING(a.norek,1,3)<='607' 
group by a.grup,a.kodeunit,a.kodebud
union all
select '208' as grup,a.kodeunit,a.kodebud,SUBSTRING(a.norek,1,5) as Norek,a.kodeunit+a.kodebud+SUBSTRING(a.norek,1,5) as vLookUp,'' as uraian,
sum(a.rkapUBI) as rkapUBI,sum(a.rkapBBI) as rkapBBI,sum(a.rkapLBI) as rkapLBI,sum(a.JmlrkapBI) as JmlrkapBI,
sum(a.rkapUSBI) as rkapUSBI,sum(a.rkapBSBI) as rkapBSBI,sum(a.rkapLSBI) as rkapLSBI,sum(a.JmlrkapSBI) as JmlrkapSBI,
sum(a.realUBI) as realUBI,sum(a.realBBI) as realBBI,sum(a.realLBI) as realLBI,sum(a.JmlrealBI) as JmlrealBI,
sum(a.realUSBI) as realUSBI,sum(a.realBSBI) as realBSBI,sum(a.realLSBI) as realLSBI,sum(a.JmlrealSBI) as JmlrealSBI,
sum(a.pkbUBI) as pkbUBI,sum(a.pkbBBI) as pkbBBI,sum(a.pkbLBI) as pkbLBI,sum(a.JmlpkbBI) as JmlpkbBI,
sum(a.pkbUSBI) as pkbUSBI,sum(a.pkbBSBI) as pkbBSBI,sum(a.pkbLSBI) as pkbLSBI,sum(a.JmlpkbSBI) as JmlpkbSBI
from #InfoBPR a
where SUBSTRING(a.norek,1,3)='608'
group by a.grup,a.kodeunit,a.kodebud,SUBSTRING(a.norek,1,5)
union all
select '209' as grup,a.kodeunit,a.kodebud,SUBSTRING(a.norek,1,3) as Norek,a.kodeunit+a.kodebud+SUBSTRING(a.norek,1,3) as vLookUp,'' as uraian,
sum(a.rkapUBI) as rkapUBI,sum(a.rkapBBI) as rkapBBI,sum(a.rkapLBI) as rkapLBI,sum(a.JmlrkapBI) as JmlrkapBI,
sum(a.rkapUSBI) as rkapUSBI,sum(a.rkapBSBI) as rkapBSBI,sum(a.rkapLSBI) as rkapLSBI,sum(a.JmlrkapSBI) as JmlrkapSBI,
sum(a.realUBI) as realUBI,sum(a.realBBI) as realBBI,sum(a.realLBI) as realLBI,sum(a.JmlrealBI) as JmlrealBI,
sum(a.realUSBI) as realUSBI,sum(a.realBSBI) as realBSBI,sum(a.realLSBI) as realLSBI,sum(a.JmlrealSBI) as JmlrealSBI,
sum(a.pkbUBI) as pkbUBI,sum(a.pkbBBI) as pkbBBI,sum(a.pkbLBI) as pkbLBI,sum(a.JmlpkbBI) as JmlpkbBI,
sum(a.pkbUSBI) as pkbUSBI,sum(a.pkbBSBI) as pkbBSBI,sum(a.pkbLSBI) as pkbLSBI,sum(a.JmlpkbSBI) as JmlpkbSBI
from #InfoBPR a
where SUBSTRING(a.norek,1,3)='609'
group by a.grup,a.kodeunit,a.kodebud,SUBSTRING(a.norek,1,3)
union all
select '210' as grup,a.kodeunit,a.kodebud,substring(a.norek,1,7) as Norek,a.kodeunit+a.kodebud+SUBSTRING(a.norek,1,7) as vLookUp,'' as uraian,
sum(a.rkapUBI) as rkapUBI,sum(a.rkapBBI) as rkapBBI,sum(a.rkapLBI) as rkapLBI,sum(a.JmlrkapBI) as JmlrkapBI,
sum(a.rkapUSBI) as rkapUSBI,sum(a.rkapBSBI) as rkapBSBI,sum(a.rkapLSBI) as rkapLSBI,sum(a.JmlrkapSBI) as JmlrkapSBI,
sum(a.realUBI) as realUBI,sum(a.realBBI) as realBBI,sum(a.realLBI) as realLBI,sum(a.JmlrealBI) as JmlrealBI,
sum(a.realUSBI) as realUSBI,sum(a.realBSBI) as realBSBI,sum(a.realLSBI) as realLSBI,sum(a.JmlrealSBI) as JmlrealSBI,
sum(a.pkbUBI) as pkbUBI,sum(a.pkbBBI) as pkbBBI,sum(a.pkbLBI) as pkbLBI,sum(a.JmlpkbBI) as JmlpkbBI,
sum(a.pkbUSBI) as pkbUSBI,sum(a.pkbBSBI) as pkbBSBI,sum(a.pkbLSBI) as pkbLSBI,sum(a.JmlpkbSBI) as JmlpkbSBI
from #InfoBPR a
where SUBSTRING(a.norek,1,7)='4900002'
group by a.grup,a.kodeunit,a.kodebud,substring(a.norek,1,7)
union all
select '211' as grup,a.kodeunit,a.kodebud,substring(a.norek,1,3) as Norek,a.kodeunit+a.kodebud+SUBSTRING(a.norek,1,3) as vLookUp,'' as uraian,
sum(a.rkapUBI) as rkapUBI,sum(a.rkapBBI) as rkapBBI,sum(a.rkapLBI) as rkapLBI,sum(a.JmlrkapBI) as JmlrkapBI,
sum(a.rkapUSBI) as rkapUSBI,sum(a.rkapBSBI) as rkapBSBI,sum(a.rkapLSBI) as rkapLSBI,sum(a.JmlrkapSBI) as JmlrkapSBI,
sum(a.realUBI) as realUBI,sum(a.realBBI) as realBBI,sum(a.realLBI) as realLBI,sum(a.JmlrealBI) as JmlrealBI,
sum(a.realUSBI) as realUSBI,sum(a.realBSBI) as realBSBI,sum(a.realLSBI) as realLSBI,sum(a.JmlrealSBI) as JmlrealSBI,
sum(a.pkbUBI) as pkbUBI,sum(a.pkbBBI) as pkbBBI,sum(a.pkbLBI) as pkbLBI,sum(a.JmlpkbBI) as JmlpkbBI,
sum(a.pkbUSBI) as pkbUSBI,sum(a.pkbBSBI) as pkbBSBI,sum(a.pkbLSBI) as pkbLSBI,sum(a.JmlpkbSBI) as JmlpkbSBI
from #InfoBPR a
where SUBSTRING(a.norek,1,3)='690'
group by a.grup,a.kodeunit,a.kodebud,substring(a.norek,1,3)

select a.Grup,a.kodeunit,a.kodebud,a.norek,a.vLookUp,a.kodeunit+a.kodebud vLooUp2,a.uraian,
a.rkapUBI,a.rkapBBI,a.rkapLBI,a.JmlrkapBI,a.pkbUBI,a.pkbBBI,a.pkbLBI,a.JmlpkbBI,a.realUBI,a.realBBI,a.realLBI,a.JmlrealBI,
a.rkapUSBI,a.rkapBSBI,a.rkapLSBI,a.JmlrkapSBI,a.pkbUSBI,a.pkbBSBI,a.pkbLSBI,a.JmlpkbSBI,a.realUSBI,a.realBSBI,a.realLSBI,a.JmlrealSBI,
'KEBUN : '+UPPER(b.NamaKebun) as nmKebun,'BULAN : '+upper(c.namabulan)+' '+cast(YEAR(@tanggal) as varchar(4)) as bulan,'BIAYA PRODUKSI '+upper(d.nm_bud)+' (PER UNSUR BIAYA)' as judul,CAST(0 as float) as Areal 
into #t2 
from #InfoPRD a
inner join Ref_Kebun b on a.kodeunit=b.KodeKebun
inner join Ref_Bulan c on MONTH(@tanggal)=c.bulan
inner join Ref_Budidaya d on a.kodeunit=d.KodeUnit and a.kodebud=d.kd_bud
union all
select a.Grup,a.kodeunit,a.kodebud,a.norek,a.vLookUp,a.kodeunit+a.kodebud vLooUp2,a.uraian,
a.rkapUBI,a.rkapBBI,a.rkapLBI,a.JmlrkapBI,a.pkbUBI,a.pkbBBI,a.pkbLBI,a.JmlpkbBI,a.realUBI,a.realBBI,a.realLBI,a.JmlrealBI,
a.rkapUSBI,a.rkapBSBI,a.rkapLSBI,a.JmlrkapSBI,a.pkbUSBI,a.pkbBSBI,a.pkbLSBI,a.JmlpkbSBI,a.realUSBI,a.realBSBI,a.realLSBI,a.JmlrealSBI,
'KEBUN : '+UPPER(b.NamaKebun) as nmKebun,'BULAN : '+upper(c.namabulan)+' '+cast(YEAR(@tanggal) as varchar(4)) as bulan,'BIAYA PRODUKSI '+upper(d.nm_bud)+' (PER UNSUR BIAYA)' as judul,CAST(0 as float) as Areal 
from #t1 a
inner join Ref_Kebun b on a.kodeunit=b.KodeKebun
inner join Ref_Bulan c on MONTH(@tanggal)=c.bulan
inner join Ref_Budidaya d on a.kodeunit=d.KodeUnit and a.kodebud=d.kd_bud

select Grup,'' as kodeunit,kodebud,norek,'R'+kodebud+norek as vLookUp,'R'+kodebud as vLooUp2,'' as uraian,
SUM(rkapUBI) as rkapUBI,SUM(rkapBBI) as rkapBBI,SUM(rkapLBI) as rkapLBI,SUM(JmlrkapBI) as JmlrkapBI, 
SUM(pkbUBI) as pkbUBI,SUM(pkbBBI) as pkbBBI,SUM(pkbLBI) as pkbLBI,SUM(JmlpkbBI) as JmlpkbBI, 
SUM(realUBI) as realUBI,SUM(realBBI) as realBBI,SUM(realLBI) as realLBI,SUM(JmlrealBI) as JmlrealBI, 
SUM(rkapUSBI) as rkapUSBI,SUM(rkapBSBI) as rkapBSBI,SUM(rkapLSBI) as rkapLSBI,SUM(JmlrkapSBI) as JmlrkapSBI, 
SUM(pkbUSBI) as pkbUSBI,SUM(pkbBSBI) as pkbBSBI,SUM(pkbLSBI) as pkbLSBI,SUM(JmlpkbSBI) as JmlpkbSBI, 
SUM(realUSBI) as realUSBI,SUM(realBSBI) as realBSBI,SUM(realLSBI) as realLSBI,SUM(JmlrealSBI) as JmlrealSBI, 
'REKAPITULASI' as nmKebun,bulan,judul,cast(0 as float) as areal
into #RBProd
from #t2
group by Grup,kodebud,norek,bulan,judul

update #t2 set Areal=(select SUM(luas) from #Ref_Areal where #t2.kodeunit=#Ref_Areal.kodekebun and #t2.kodebud=#Ref_Areal.kodebudidaya)
update #t2 set Areal=0 where Areal is null
update #RBProd set areal=(select Luas from #RekapAreal where #RBProd.kodebud=#RekapAreal.kodebudidaya)
update #RBProd set areal=0 where areal is null

drop table SPDK_KBN_LAYANAN_BAGIAN..FileG1_202007
select * into SPDK_KBN_LAYANAN_BAGIAN..FileG1_202007 from #t2
union all 
select * from #RBProd
--select * from #t2 where kodeunit='14' and norek like '601%' and kodebud='02'
--union all 
--select * from #RBProd where kodeunit='14' and norek like '601%' and kodebud='02'

SET NOCOUNT OFF;
END

--set dateformat dmy exec PrsBiayaProduksi_2017A '01-07-2020'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[PrsBudidaya]
@tanggal datetime
as
begin
set nocount on
select distinct a.KodeUnit,a.KodeBudidaya+' - '+upper(b.nm_bud) as nmBud from kartu a 
inner join Ref_Budidaya b on a.KodeBudidaya=b.kd_bud and a.KodeUnit=b.KodeUnit
where month(a.Tanggal)=MONTH(@tanggal) and YEAR(a.tanggal)=YEAR(@tanggal) and (SUBSTRING(a.Norek,1,1) in ('4','6') or SUBSTRING(a.Norek,1,3) in ('040','041','042'))
set nocount off
end

--set dateformat dmy exec PrsBudidaya '01-03-2016'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[PrsGabungan]
@tanggal datetime
as
set dateformat dmy exec PrsBiayaProduksi @tanggal
set dateformat dmy exec PrsBiayaInvestasiTanaman @tanggal

--set dateformat dmy exec PrsGabungan '01-02-2016'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		Fauzy
-- Create date: 21 April 2016
-- Description: Untuk Evaluasi Bagian Tekpol
-- =============================================
CREATE PROCEDURE [dbo].[Rek410425Tekpol]
	-- Add the parameters for the stored procedure here
	@tanggal datetime
AS
set dateformat dmy
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    declare @AwalTahun datetime
	declare @AkhirBulan datetime
    set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
    set @AkhirBulan=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
    declare @bulan varchar (50)
    
    if MONTH(@tanggal) < 10
      set @bulan = '0'+CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal) as varchar(4))
    else
      set @bulan=CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal)as varchar(4))
    
 select  kodeunit, norek, cast(0 as float)as bi,cast(0 as float)as abi,nilai as sbi,cast(0 as float)as asbi 
 into #t1
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  
 union all
 select kodeunit, norek, cast(0 as float)as bi,cast(0 as float)as abi,-1 * nilai as sbi,cast(0 as float)as asbi from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi')  and DK='K'  
 union all

-- RKAP bulan ini
select kodeunit,norek, cast(0 as float) as bi,sum(nilai_RKAP)  as  abi,cast(0 as float)as sbi,cast(0 as float) as asbi
from AkunRKAP 
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal)
group by kodeunit,norek
union all

--RKAP s.d bulan ini
select kodeunit,norek, cast(0 as float) as bi,cast(0 as float) as  abi,cast(0 as float)as sbi,sum(nilai_RKAP) as asbi
from AkunRKAP
where tanggal>=@AwalTahun and tanggal<=@AkhirBulan --tanggal >= '01-01-2016' and tanggal <= '29-02-2016'
group by kodeunit,norek

union all

--Realisasi Bulan ini dan s.d bulan ini
select kodeunit,Norek, (debet-kredit) as bi,cast(0 as float)as abi,(Debet-Kredit)as sbi,cast(0 as float)as asbi 
from Kartu 
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal)
--union all

---- Realisasi Produksi bln ini 
-- select kodeunit,kodebud,kodeJenisOlah as kodeolah,kodeunit+kodebud+kodeJenisOlah+'prd' as norek,sum(bi) as bi, sum(rbi)as abi, 0 as sbi,0 as asbi 
-- from AkunProduksiHP where  kodevar='JADI' and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) --and (norek='x' or SUBSTRING(norek,1,5) in ('60804','60904'))                    -- and kodebud='02' and kodeJenisOlah='0200' and (norek='x' or SUBSTRING(norek,1,5) in ('60805','60806'))
-- group by KodeUnit,KodeBud,kodeJenisOlah
-- union all
---- s.d Produksi
-- select kodeunit,kodebud,kodeJenisOlah,kodeunit+kodebud+kodeJenisOlah+'prd' as norek,0 as bi, 0 as abi, sum(bi)as sbi, sum(rbi) as asbi 
-- from AkunProduksiHP where   kodevar='JADI' and tanggal>=@AwalTahun  and tanggal <=@AkhirBulan --and (norek='x' or SUBSTRING(norek,1,5) in ('60804','60904')) --and kodebud='02'-- and kodeJenisOlah='0200' and (norek='x' or SUBSTRING(norek,1,5) in ('60805','60806'))
-- group by KodeUnit,KodeBud,kodeJenisOlah

 --update #t1 set norek='600000200' where norek like '6000002%'
 ---UPDATE #t1 set netral='0200' where netral ='0202'
 --update #t1 set netral='0000' where netral = '0000NG00'
 
 select kodeunit,'410-PemelBangunanRumah' as norek,sum(bi) as bi, sum(abi) as abi, SUM(sbi) as sbi,SUM(asbi) as asbi  into #t2 
 from #t1
 where  substring(norek,1,3)in ('410010000') -- and KodeUnit='13' 
 group by kodeunit,norek
 --union all
 
 --select kodeunit,'411-PemelbangunanPerusahaan' as norek,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,3) in ('411')--and  KodeUnit='13' 
 --group by KodeUnit
 --union all
 
 --select kodeunit,'412-PemelMesin&Instalasi' as norek,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,3) in ('412')--and  KodeUnit='13'
 --group by KodeUnit
 --union all
 
 --select kodeunit,'413-PemelJalanJembatan&SaluranAir' as norek,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,3) in ('413')--and  KodeUnit='13'
 --group by KodeUnit
 --union all
 
 --select kodeunit,'414-AlatPertanian&InventarisKecil' as norek,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,3) in ('414')--and  KodeUnit='13'
 --group by KodeUnit
 --union all
 
 --select kodeunit,'424-AlatPertanian&InventarisKecil' as norek,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,3) in ('424')--and  KodeUnit='13'
 --group by KodeUnit
 --union all
 --select kodeunit,'425-BiayaAir' as norek,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,3) in ('425')--and  KodeUnit='13'
 --group by KodeUnit
 
 --union all
 --select kodeunit,KodeUnit+kodebud+netral+'PRD' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where norek like '%prd%'
 --group by KodeUnit,KodeBud,Netral	
 

	
 select @bulan as bulan,kodeunit,kodeunit+norek as link,norek,SUM(bi) as bi,SUM (abi) as abi, SUM(sbi) as sbi, SUM (asbi) as asbi 
 from #t1
where bi+abi+sbi+asbi > 0 
 group by KodeUnit,norek
 order by norek
 


set nocount off
END
--select * from #t1

-- set dateformat dmy exec Rek410425Tekpol'01-03-2018'
--select * from AkunMemorial where KodeUnit='23' and norek like '603%' order by netral 

--select * from AkunProduksiHP where kodevar='JADI' and MONTH(tanggal)=4 and kodebud='02' and kodeJenisOlah='0200' and (norek='x' or SUBSTRING(norek,1,5) in ('60805','60806'))
-- select sum(bi) from AkunProduksiHP where kodevar='Jadi' and  MONTH(tanggal)=4 and kodebud='02'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Rek603606Tekpol]
@tanggal datetime
AS
set dateformat dmy
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
declare @AwalTahun datetime
declare @AkhirBulan datetime
set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @AkhirBulan=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
declare @bulan varchar (50)

if MONTH(@tanggal) < 10
  set @bulan = '0'+CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal) as varchar(4))
else
  set @bulan=CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal)as varchar(4))

 select  kodeunit,kodebud,netral, norek, cast(0 as float)as bi,cast(0 as float)as abi,nilai as sbi,cast(0 as float)as asbi 
 into #t1
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  
 union all
 select kodeunit,kodebud,netral, norek, cast(0 as float)as bi,cast(0 as float)as abi,-1 * nilai as sbi,cast(0 as float)as asbi from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi')  and DK='K'  
 union all

-- RKAP bulan ini
select kodeunit,kodebud as kodebudidaya,netral,norek, cast(0 as float) as bi,sum(nilai_RKAP)  as  abi,cast(0 as float)as sbi,cast(0 as float) as asbi
from AkunRKAP 
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal)
group by kodeunit,kodebud,netral,norek
union all

--RKAP s.d bulan ini
select kodeunit,kodebud as kodebudidaya,netral,norek, cast(0 as float) as bi,cast(0 as float) as  abi,cast(0 as float)as sbi,sum(nilai_RKAP) as asbi
from AkunRKAP
where tanggal>=@AwalTahun and tanggal<=@AkhirBulan --tanggal >= '01-01-2016' and tanggal <= '29-02-2016'
group by kodeunit,kodebud,netral,norek
union all

--Realisasi Bulan ini dan s.d bulan ini
select kodeunit,kodebudidaya,netral,norek, (debet-kredit) as bi,cast(0 as float)as abi,(Debet-Kredit)as sbi,cast(0 as float)as asbi 
from Kartu 
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal)
union all

-- Realisasi Produksi bln ini 
 select kodeunit,kodebud,kodeJenisOlah as kodeolah,kodeunit+kodebud+kodeJenisOlah+'prd' as norek,sum(bi) as bi, sum(rbi)as abi, 0 as sbi,0 as asbi 
 from AkunProduksiHP where  kodevar='JADI' and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) --and (norek='x' or SUBSTRING(norek,1,5) in ('60804','60904'))-- and kodebud='02' and kodeJenisOlah='0200' and (norek='x' or SUBSTRING(norek,1,5) in ('60805','60806'))
 group by KodeUnit,KodeBud,kodeJenisOlah
 union all
 
-- s.d Produksi
 select kodeunit,kodebud,kodeJenisOlah,kodeunit+kodebud+kodeJenisOlah+'prd' as norek,0 as bi, 0 as abi, sum(bi)as sbi, sum(rbi) as asbi 
 from AkunProduksiHP where   kodevar='JADI' and tanggal>=@AwalTahun  and tanggal <=@AkhirBulan --and (norek='x' or SUBSTRING(norek,1,5) in ('60804','60904')) --and kodebud='02'-- and kodeJenisOlah='0200' and (norek='x' or SUBSTRING(norek,1,5) in ('60805','60806'))
 group by KodeUnit,KodeBud,kodeJenisOlah

 update #t1 set norek='600000200' where norek like '6000002%'
 
 select kodeunit,'6000002-GajiStafPeng' as norek,kodebud,netral,sum(bi) as bi, sum(abi) as abi, SUM(sbi) as sbi,SUM(asbi) as asbi  into #t2 
 from #t1
 where  substring(norek,1,7)in ('6000002') -- and KodeUnit='13' 
 group by kodeunit,norek,kodebud,netral
 union all
 
 select kodeunit,'603-GajiUpah' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 from #t1 where SUBSTRING(norek,1,5) in ('60301','60302','60303','60304','60305','60306','60319')--and  KodeUnit='13' 
 group by KodeUnit,KodeBud,Netral
 union all
 
 select kodeunit,'603-Bahan Kimia' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 from #t1 where SUBSTRING(norek,1,5) in ('60307')--and  KodeUnit='13'
 group by KodeUnit,KodeBud,Netral
 union all
 
 select kodeunit,'603-AlatAlat' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 from #t1 where SUBSTRING(norek,1,5) in ('60308','60309')--and  KodeUnit='13'
 group by KodeUnit,KodeBud,Netral
 union all
 
 select kodeunit,'603-Listrik' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 from #t1 where SUBSTRING(norek,1,5) in ('60311')--and  KodeUnit='13'
 group by KodeUnit,KodeBud,Netral
 union all
 
 select kodeunit,'603-KayuBakar' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 from #t1 where SUBSTRING(norek,1,7) in ('6031003')--and  KodeUnit='13'
 group by KodeUnit,KodeBud,Netral
 union all
 select kodeunit,'603-BBM' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 from #t1 where SUBSTRING(norek,1,7) in ('6031001','6031002','6031004','6031005','6031006')--and  KodeUnit='13'
 group by KodeUnit,KodeBud,Netral
 union all
 select kodeunit,'60401-PemelBangPab' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 from #t1 where SUBSTRING(norek,1,5) in ('60401','60403','60404','60405','60406')--and  KodeUnit='13'
 group by KodeUnit,KodeBud,Netral
 union all
 select kodeunit,'60402-PemelMesin' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 from #t1 where SUBSTRING(norek,1,5) in ('60402')--and  KodeUnit='13'
 group by KodeUnit,KodeBud,Netral
 union all
 select kodeunit,'60419-TunjanganSosial' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 from #t1 where SUBSTRING(norek,1,5) in ('60419')--and  KodeUnit='13'
 group by KodeUnit,KodeBud,Netral
 union all
 select kodeunit,'605-Pengepakan' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 from #t1 where SUBSTRING(norek,1,5) in ('60504','60505')--and  KodeUnit='13'
 group by KodeUnit,KodeBud,Netral
 union all
 select kodeunit,'605-Upah' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 from #t1 where SUBSTRING(norek,1,5) in ('60501','60502','60503','60506','60507','60519')--and  KodeUnit='13'
 group by KodeUnit,KodeBud,Netral
 union all
 select kodeunit,'606-Asuransi' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 from #t1 where SUBSTRING(norek,1,5) in ('60600')--and  KodeUnit='13'
 group by KodeUnit,KodeBud,Netral
 union all
 select kodeunit,KodeUnit+kodebud+netral+'PRD' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 from #t1 where norek like '%prd%'
 group by KodeUnit,KodeBud,Netral
 


 select @bulan as bulan,kodeunit,kodeunit+kodebud+netral+norek as link,norek,kodebud,netral,SUM(bi) as bi,SUM (abi) as abi, SUM(sbi) as sbi, SUM (asbi) as asbi 
 from #t2
--where bi+abi+sbi+asbi > 0 
 group by KodeUnit,norek,kodebud,netral
 order by norek
 
set nocount off
END



--select * from #t1

-- set dateformat dmy exec Rek603606Tekpol'01-02-2017'
--select * from AkunMemorial where KodeUnit='23' and norek like '603%' order by netral 

--select * from AkunProduksiHP where kodevar='JADI' and MONTH(tanggal)=4 and kodebud='02' and kodeJenisOlah='0200' and (norek='x' or SUBSTRING(norek,1,5) in ('60805','60806'))
-- select sum(bi) from AkunProduksiHP where kodevar='Jadi' and  MONTH(tanggal)=4 and kodebud='02'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[Rek603606Tekpol2]
@tanggal datetime
AS
set dateformat dmy
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
declare @AwalTahun datetime
declare @AkhirBulan datetime
set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @AkhirBulan=DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
declare @bulan varchar (50)

if MONTH(@tanggal) < 10
  set @bulan = '0'+CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal) as varchar(4))
else
  set @bulan=CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal)as varchar(4))

 select  kodeunit,kodebud,netral, norek, cast(0 as float)as bi,cast(0 as float)as abi,nilai as sbi,cast(0 as float)as asbi 
 into #t1
 from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi') and DK='D'  
 union all
 select kodeunit,kodebud,netral, norek, cast(0 as float)as bi,cast(0 as float)as abi,-1 * nilai as sbi,cast(0 as float)as asbi from AkunMemorial
 where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal) and NoInput in ('Saldo Awal','Transaksi')  and DK='K'  
 union all

-- RKAP bulan ini
select kodeunit,kodebud as kodebudidaya,netral,norek, cast(0 as float) as bi,sum(nilai_RKAP)  as  abi,cast(0 as float)as sbi,cast(0 as float) as asbi
from AkunRKAP 
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal)
group by kodeunit,kodebud,netral,norek
union all

--RKAP s.d bulan ini
select kodeunit,kodebud as kodebudidaya,netral,norek, cast(0 as float) as bi,cast(0 as float) as  abi,cast(0 as float)as sbi,sum(nilai_RKAP) as asbi
from AkunRKAP
where tanggal>=@AwalTahun and tanggal<=@AkhirBulan --tanggal >= '01-01-2016' and tanggal <= '29-02-2016'
group by kodeunit,kodebud,netral,norek
union all

--Realisasi Bulan ini dan s.d bulan ini
select kodeunit,kodebudidaya,netral,norek, (debet-kredit) as bi,cast(0 as float)as abi,(Debet-Kredit)as sbi,cast(0 as float)as asbi 
from Kartu 
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(Tanggal)=YEAR(@tanggal)
union all

-- Realisasi Produksi bln ini 
 select kodeunit,kodebud,kodeJenisOlah as kodeolah,kodeunit+kodebud+kodeJenisOlah+'prd' as norek,sum(bi) as bi, sum(rbi)as abi, 0 as sbi,0 as asbi 
 from AkunProduksiHP where  kodevar='JADI' and MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) --and (norek='x' or SUBSTRING(norek,1,5) in ('60804','60904'))-- and kodebud='02' and kodeJenisOlah='0200' and (norek='x' or SUBSTRING(norek,1,5) in ('60805','60806'))
 group by KodeUnit,KodeBud,kodeJenisOlah
 union all
 
-- s.d Produksi
 select kodeunit,kodebud,kodeJenisOlah,kodeunit+kodebud+kodeJenisOlah+'prd' as norek,0 as bi, 0 as abi, sum(bi)as sbi, sum(rbi) as asbi 
 from AkunProduksiHP where   kodevar='JADI' and tanggal>=@AwalTahun  and tanggal <=@AkhirBulan --and (norek='x' or SUBSTRING(norek,1,5) in ('60804','60904')) --and kodebud='02'-- and kodeJenisOlah='0200' and (norek='x' or SUBSTRING(norek,1,5) in ('60805','60806'))
 group by KodeUnit,KodeBud,kodeJenisOlah

 update #t1 set norek='600000200' where norek like '6000002%'
 
 select kodeunit,'6000002-GajiStafPeng' as norek,kodebud,netral,sum(bi) as bi, sum(abi) as abi, SUM(sbi) as sbi,SUM(asbi) as asbi  into #t2 
 from #t1
 where  substring(norek,1,7)in ('6000002')  and KodeUnit='46' 
 group by kodeunit,norek,kodebud,netral
 union all
 
 --select kodeunit,'603-GajiUpah' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,5) in ('60301','60302','60303','60304','60305','60306','60319')--and  KodeUnit='13' 
 --group by KodeUnit,KodeBud,Netral
 --union all
 
 --select kodeunit,'603-Bahan Kimia' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,5) in ('60307')--and  KodeUnit='13'
 --group by KodeUnit,KodeBud,Netral
 --union all
 
 select kodeunit,'603-AlatAlat' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 from #t1 where SUBSTRING(norek,1,5) in ('60308','60309')and  KodeUnit='46'
 group by KodeUnit,KodeBud,Netral
 --union all
 
 --select kodeunit,'603-Listrik' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,5) in ('60311')--and  KodeUnit='13'
 --group by KodeUnit,KodeBud,Netral
 --union all
 
 --select kodeunit,'603-KayuBakar' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,7) in ('6031003')--and  KodeUnit='13'
 --group by KodeUnit,KodeBud,Netral
 --union all
 --select kodeunit,'603-BBM' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,7) in ('6031001','6031002','6031004','6031005','6031006')--and  KodeUnit='13'
 --group by KodeUnit,KodeBud,Netral
 --union all
 --select kodeunit,'60401-PemelBangPab' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,5) in ('60401','60403','60404','60405','60406')--and  KodeUnit='13'
 --group by KodeUnit,KodeBud,Netral
 --union all
 --select kodeunit,'60402-PemelMesin' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,5) in ('60402')--and  KodeUnit='13'
 --group by KodeUnit,KodeBud,Netral
 --union all
 --select kodeunit,'60419-TunjanganSosial' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,5) in ('60419')--and  KodeUnit='13'
 --group by KodeUnit,KodeBud,Netral
 --union all
 --select kodeunit,'605-Pengepakan' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,5) in ('60504','60505')--and  KodeUnit='13'
 --group by KodeUnit,KodeBud,Netral
 --union all
 --select kodeunit,'605-Upah' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,5) in ('60501','60502','60503','60507','60519')--and  KodeUnit='13'
 --group by KodeUnit,KodeBud,Netral
 --union all
 --select kodeunit,'606-Asuransi' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 --from #t1 where SUBSTRING(norek,1,5) in ('60600')--and  KodeUnit='13'
 --group by KodeUnit,KodeBud,Netral
 union all
 select kodeunit,KodeUnit+kodebud+netral+'PRD' as norek,kodebud,netral,sum(bi) as bi, sum(abi)as abi, SUM(sbi) as sbi,SUM(asbi) as asbi 
 from #t1 where norek like '%prd%' and KodeUnit='46'
 group by KodeUnit,KodeBud,Netral
 


 select @bulan as bulan,kodeunit,kodeunit+kodebud+netral+norek as link,norek,kodebud,netral,SUM(bi) as bi,SUM (abi) as abi, SUM(sbi) as sbi, SUM (asbi) as asbi 
 from #t2
--where bi+abi+sbi+asbi > 0 
 group by KodeUnit,norek,kodebud,netral
 order by norek
 
set nocount off
END



--select * from #t2

-- set dateformat dmy exec Rek603606Tekpol2'01-02-2017'
--select * from AkunMemorial where KodeUnit='23' and norek like '603%' order by netral 

--select * from AkunProduksiHP where kodevar='JADI' and MONTH(tanggal)=4 and kodebud='02' and kodeJenisOlah='0200' and (norek='x' or SUBSTRING(norek,1,5) in ('60805','60806'))
-- select sum(bi) from AkunProduksiHP where kodevar='Jadi' and  MONTH(tanggal)=4 and kodebud='02'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[SaldoAwal_BukuBesar]
@tanggal datetime
as
set dateformat dmy
declare @tglAwal datetime
declare @tglAkhir datetime

set @tglAwal='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @tglAkhir='01-'+cast(MONTH(@tanggal) as varchar(2))+'-'+cast(YEAR(@tanggal) as varchar(4))

delete sawKRBB
insert sawKRBB
select KodeUnit,@tanggal as tanggal,'TRANSAKSI' as NoInput,'' as NoBukti,'' as Keterangan,'' as NoUrut,KodeAfdeling as kodeafd,KodeBudidaya as kodebud,Norek,Netral,kdblok,Netral as thntnm,'' as uraian,KodeUnsur as unsur,'D' as DK,sum(Debet) as Nilai,sum(Jml_fisik) as Jml_Fisik,'01-01-2017' as TglInput,'' as kmk 
from kartu 
where Tanggal>=@tglAwal and Tanggal<@tglAkhir and SUBSTRING(Norek,1,1) in ('4','6') and Debet<>0
group by KodeUnit,KodeAfdeling,KodeBudidaya,Norek,Netral,kdblok,KodeUnsur
union all
select KodeUnit,@tanggal as tanggal,'TRANSAKSI' as NoInput,'' as NoBukti,'' as Keterangan,'' as NoUrut,KodeAfdeling as kodeafd,KodeBudidaya as kodebud,Norek,Netral,kdblok,Netral as thntnm,'' as uraian,KodeUnsur as unsur,'K' as DK,sum(Kredit) as Nilai,sum(Jml_fisik) as Jml_Fisik,'01-01-2017' as TglInput,'' as kmk 
from kartu 
where Tanggal>=@tglAwal and Tanggal<@tglAkhir and SUBSTRING(Norek,1,1) in ('4','6') and Kredit<>0
group by KodeUnit,KodeAfdeling,KodeBudidaya,Norek,Netral,kdblok,KodeUnsur
--select * from SawKRBB

--set dateformat dmy exec SaldoAwal_BukuBesar '01-12-2019'



--select top 1 * from AkunMemorial where NoInput='SALDO AWAL' AND YEAR(tanggal)=2017

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[SaldoAwalAkun]
@tanggal datetime
as
set dateformat dmy
set nocount off
begin

declare @tanggalAwalBulan datetime
set @tanggalAwalBulan=DATEADD(dd,-DAY(DATEADD(m,1,@tanggal)),DATEADD(m,1,@tanggal))+1

delete AkunSawal where MONTH(tanggal)=MONTH(@tanggalAwalBulan) and YEAR(tanggal)=YEAR(@tanggalAwalBulan)

select KodeUnit,kodeafd,kodebud,norek,netral,kdblok,thntnm,unsur,sum(nilai) as Debet,0 as Kredit 
into #Sawal
from AkunMemorial 
where MONTH(tanggal)=1 and YEAR(tanggal)=YEAR(@tanggal) and NoInput='SALDO AWAL' and DK='D'
group by KodeUnit,kodeafd,kodebud,norek,netral,kdblok,thntnm,unsur
union all
select KodeUnit,kodeafd,kodebud,norek,netral,kdblok,thntnm,unsur,0 as Debet,sum(nilai) as Kredit 
from AkunMemorial 
where MONTH(tanggal)=1 and YEAR(tanggal)=YEAR(@tanggal) and NoInput='SALDO AWAL' and DK='K'
group by KodeUnit,kodeafd,kodebud,norek,netral,kdblok,thntnm,unsur
union all

--KARTU
select KodeUnit,KodeAfdeling,KodeBudidaya,norek,netral,kdblok,'' as thntnm,KodeUnsur,sum(Debet) as Debet,sum(Kredit) as Kredit 
from Kartu
where MONTH(tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)
group by KodeUnit,KodeAfdeling,KodeBudidaya,norek,netral,kdblok,KodeUnsur

Insert AkunSawal
select @tanggalAwalBulan as tanggal,KodeUnit,kodeafd,kodebud,norek,netral,kdblok,thntnm,unsur,SUM(Debet) as Debet,sum(Kredit) as Kredit 
from #Sawal
group by KodeUnit,kodeafd,kodebud,norek,netral,kdblok,thntnm,unsur
order by KodeUnit,norek
set nocount off
end

--set dateformat dmy exec SaldoAwalAkun '01-01-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[SAW_GL]
@tanggal datetime
as
begin
set dateformat dmy 
set nocount on
declare @NamaKebun varchar(50)
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

select * into #Ref_Rekening from Ref_Rekening 
select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@TglAkhir 

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D' 
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K' 
union all
select KodeUnit,Norek,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where Tanggal>=@TglAwal and Tanggal<=@tglakhir 
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select a.kodeunit,a.norek,b.namarekening,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit
--,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
into GLSAW201701
from #t4 a
full outer join #Ref_Rekening b on a.norek=b.norek and a.KodeUnit=b.KodeUnit
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null 
group by a.kodeunit,a.norek,b.namarekening
order by KodeUnit,norek

end

--set dateformat dmy exec SAW_GL '01-01-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[SPstockPBJ] 
@Tanggal datetime 
as 
set dateformat dmy
declare @TglAwal datetime
declare @TglAkhir datetime 
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))

declare @bulan varchar (50)

if MONTH(@tanggal) < 10
  set @bulan = '0'+CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal) as varchar(4))
else
  set @bulan=CAST(month(@tanggal) as varchar(2))+'-'+CAST(year(@tanggal)as varchar(4))

select * into #TUP          From TUP where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal)
select * into #Ref_Barang   From SPDK_KBN_MASTER_REF..Ref_Barang
select * into #Ref_Rekening From SPDK_KBN_MASTER_REF..Ref_Rekening
 
--SALDO AWAL
select kodeunit,kodebarang,sum(qty) as qtyawal ,sum(nilai) as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN
into #t1 
From #TUP 
where MONTH(tanggal)=MONTH(@Tanggal) and YEAR(tanggal)=YEAR(@Tanggal) and noinput='SALDO AWAL' 
group by kodeunit,kodebarang 
union all
 
--MUTASI BULAN INI
--PEMBELIAN SENDIRI
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,SUM(qty) as qtytrmSDR,sum(nilai) as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=1) and tanggal<'01-09-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,SUM(qty) as qtytrmSDR,sum((nilai*.1)+nilai) as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=2) and tanggal<'01-09-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,SUM(qty) as qtytrmSDR,sum((nilai*.1)+nilai) as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014' 
group by kodeunit,kodebarang 
union all 

select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,SUM(qty) as qtytrmSDR,sum(nilai) as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,SUM(qty) as qtytrmSDR,sum((nilai*.1)+nilai) as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 

select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,SUM(qty) as qtytrmSDR,sum(nilai) as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5) not in ('15000','08002') and not substring(norek,1,3)='196' and ppn=0 
group by kodeunit,kodebarang 
union all 
 
--PEMBELIAN DARI KEBUN SE-INDUK
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,SUM(qty) as qtytrmKBN,sum(nilai) as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=1) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,SUM(qty) as qtytrmKBN,sum((nilai*.1)+nilai) as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as qtyklrLLN,0 as klrDIR,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=2) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,SUM(qty) as qtytrmKBN,sum((nilai*.1)+nilai) as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,SUM(qty) as qtytrmKBN,sum(nilai) as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,SUM(qty) as qtytrmKBN,sum((nilai*.1)+nilai) as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,SUM(qty) as qtytrmKBN,sum(nilai) as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)=('08002') and ppn=0 
group by kodeunit,kodebarang 
union all 
 
--PEMBELIAN DARI KANTOR PUSAT
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,SUM(qty) as qtytrmDIR,sum(nilai) as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=1) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,SUM(qty) as qtytrmDIR,sum((nilai*.1)+nilai) as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=2) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,SUM(qty) as qtytrmDIR,sum((nilai*.1)+nilai) as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,SUM(qty) as qtytrmDIR,sum(nilai) as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,SUM(qty) as qtytrmDIR,sum((nilai*.1)+nilai) as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,SUM(qty) as qtytrmDIR,sum(nilai) as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and substring(norek,1,5)='15000' and ppn=0 
group by kodeunit,kodebarang 
union all 
 
--PENERIMAAN LAIN-LAIN
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,SUM(qty) as qtytrmLLN,sum(nilai) as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=1) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,SUM(qty) as qtytrmLLN,sum((nilai*.1)+nilai) as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=2) and tanggal<'01-09-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,SUM(qty) as qtytrmLLN,sum((nilai*.1)+nilai) as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1) and tanggal>='01-09-2014' and tanggal<'01-11-2014'
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,SUM(qty) as qtytrmLLN,sum(nilai) as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=1) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,SUM(qty) as qtytrmLLN,sum((nilai*.1)+nilai) as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where (month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=1 and status=2) and tanggal>='01-11-2014' 
group by kodeunit,kodebarang 
union all 
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,SUM(qty) as qtytrmLLN,sum(nilai) as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A53' and not substring(norek,1,3) in ('150','080','148') and ppn=0 
group by kodeunit,kodebarang 
union all 
 
--PEMAKAIAN SENDIRI
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,SUM(qty) as qtyklrSDR,sum(nilai) as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and not substring(norek,1,3) in ('080','196') 
group by kodeunit,kodebarang 
union all 
 
--PEMAKAIAN KEBUN SE-INDUK
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,SUM(qty) as qtyklrKBN,sum(nilai) as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and substring(norek,1,5)='08002' and not substring(norek,1,7)='0800209' 
group by kodeunit,kodebarang 
union all 
 
--PEMAKAIAN KANTOR PUSAT
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,SUM(qty) as qtyklrDIR,sum(nilai) as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and substring(norek,1,7)='0800209' 
group by kodeunit,kodebarang 
union all 
 
--PEMAKAIAN LAIN-LAIN
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,SUM(qty) as qtyklrLLN,sum(nilai) as klrLLN 
From #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='A58' and substring(norek,1,3) in ('196') 
group by kodeunit,kodebarang 
union all 
 
--KOREKSI KELEBIHAN
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,SUM(qty) as qtytrmLLN,sum(nilai) as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,0 as qtyklrLLN,0 as klrLLN 
From #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR' and nilai>0 
group by kodeunit,kodebarang 
union all 
 
--KOREKSI KEKURANGAN
select kodeunit,kodebarang,0 as qtyawal,0 as sawNilai,0 as qtytrmSDR,0 as trmSDR,0 as qtytrmKBN,0 as trmKBN,0 as qtytrmDIR,0 as trmDIR,0 as qtytrmLLN,0 as trmLLN,0 as qtyklrSDR,0 as klrSDR,0 as qtyklrKBN,0 as klrKBN,0 as qtyklrDIR,0 as klrDIR,SUM(abs(qty)) as qtyklrLLN,sum(abs(nilai)) as klrLLN 
From #TUP 
where month(tanggal)=month(@tanggal) and year(tanggal)=year(@tanggal) and substring(noinput,1,3)='KOR' and nilai<0 
group by kodeunit,kodebarang 
 
select @bulan as Bulan,a.KodeUnit,c.namakebun as namakebun,b.norek,d.namarekening,a.kodebarang,b.NamaBarang, 
SUM(a.qtyawal) as qtyawal,
sum(a.sawNilai) as sawNilai, 
SUM(a.qtytrmSDR) as qtytrmSDR,
sum(a.trmSDR) as trmSDR, 
SUM(a.qtytrmKBN) as qtytrmKBN,
sum(a.trmKBN) as trmKBN, 
SUM(a.qtytrmDIR) as qtytrmDIR,
sum(a.trmDIR) as trmDIR, 
sum(a.qtytrmLLN) as qtytrmLLN,
sum(a.trmLLN) as trmLLN,
SUM(a.qtytrmSDR+a.qtytrmKBN+a.qtytrmDIR+a.qtytrmLLN) as qtytrmJML, 
sum(a.trmSDR+a.trmKBN+a.trmDIR+a.trmLLN) as trmJML,
SUM(a.qtyklrSDR) as qtyklrSDR,
sum(a.klrSDR) as klrSDR, 
SUM(a.qtyklrKBN) as qtyklrKBN, 
sum(a.klrKBN) as klrKBN,
SUM(a.qtyklrDIR) as  qtyklrDIR ,
sum(a.klrDIR) as klrDIR, 
SUM(a.qtyklrLLN) as qtyklrLLN,
sum(a.klrLLN) as klrLLN, 
SUM(a.qtyklrSDR+a.qtyklrKBN+a.qtyklrDIR+a.qtyklrLLN) as qtyklrJML,
sum(a.klrSDR+a.klrKBN+a.klrDIR+a.klrLLN) as klrJML, 
SUM(a.qtyawal+a.qtytrmSDR+a.qtytrmKBN+a.qtytrmDIR+a.qtytrmLLN)-sum(a.qtyklrSDR+a.qtyklrKBN+a.qtyklrDIR+a.qtyklrLLN) as qakNilai,
sum(a.sawNilai+a.trmSDR+a.trmKBN+a.trmDIR+a.trmLLN)-sum(a.klrSDR+a.klrKBN+a.klrDIR+a.klrLLN) as sakNilai 
into #t2 
from #t1 a 
inner join #Ref_Barang b on a.kodebarang=b.kodebarang 
inner join ref_kebun c on a.kodeunit=c.KodeKebun 
inner join #Ref_Rekening d on b.norek=d.Norek 
group by a.kodeunit,b.norek,c.namakebun,d.namarekening,a.kodebarang,b.NamaBarang

select KodeUnit,kodebarang,NamaBarang,qakNilai,sakNilai
into #t3 
from #t2 


select * from #t3
--SELECT SPDK_KBN_MASTER_REF..Ref_Barang 
 
--select norek,namarekening,kodebarang,namabarang, 
--sum(sawNilai) as sawNilai, 
--sum(trmSDR) as trmSDR, 
--sum(trmKBN) as trmKBN, 
--sum(trmDIR) as trmDIR, 
--sum(trmLLN) as trmLLN, 
--sum(trmJML) as trmJML, 
--sum(klrSDR) as klrSDR, 
--sum(klrKBN) as klrKBN, 
--sum(klrDIR) as klrDIR, 
--sum(klrLLN) as klrLLN, 
--sum(klrJML) as klrJML, 
--sum(sakNilai) as sakNilai 
--from #t2 
--where sawNilai+trmJML+klrJML<>0 
--group by norek,namarekening,kodebarang,namabarang
--order by norek 

--set dateformat dmy exec  SPstockPBJ '01-02-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[TIMK_AnalisiBiayaUmum]
@tanggal datetime
as
select kodeunit,SUM(Debet-Kredit) as B01,0 as B02,0 as B03,
0 as B04,0 as B05,0 as B06,0 as B07,0 as B08,0 as B09,0 as B10,0 as B11,0 as B12
into #t1 
from kartu where MONTH(Tanggal)=1 and YEAR(Tanggal)=YEAR(@tanggal) and Norek LIKE '4%' AND NOT SUBSTRING(Norek,1,3)='490' group by KodeUnit
union all
select kodeunit,0 as B01,SUM(Debet-Kredit) as B02,0 as B03,
0 as B04,0 as B05,0 as B06,0 as B07,0 as B08,0 as B09,0 as B10,0 as B11,0 as B12
from kartu 
where MONTH(Tanggal)=2 and YEAR(Tanggal)=YEAR(@tanggal) and Norek LIKE '4%' AND NOT SUBSTRING(Norek,1,3)='490' group by KodeUnit
union all
select kodeunit,0 as B01,0 as B02,SUM(Debet-Kredit) as B03,
0 as B04,0 as B05,0 as B06,0 as B07,0 as B08,0 as B09,0 as B10,0 as B11,0 as B12
from kartu 
where MONTH(Tanggal)=3 and YEAR(Tanggal)=YEAR(@tanggal) and Norek LIKE '4%' AND NOT SUBSTRING(Norek,1,3)='490' group by KodeUnit
union all
select kodeunit,0 as B01,0 as B02,0 as B03,
SUM(Debet-Kredit) as B04,0 as B05,0 as B06,0 as B07,0 as B08,0 as B09,0 as B10,0 as B11,0 as B12 
from kartu 
where MONTH(Tanggal)=4 and YEAR(Tanggal)=YEAR(@tanggal) and Norek LIKE '4%' AND NOT SUBSTRING(Norek,1,3)='490' group by KodeUnit
union all
select kodeunit,0 as B01,0 as B02,0 as B03,
0 as B04,SUM(Debet-Kredit) as B05,0 as B06,0 as B07,0 as B08,0 as B09,0 as B10,0 as B11,0 as B12 
from kartu 
where MONTH(Tanggal)=5 and YEAR(Tanggal)=YEAR(@tanggal) and Norek LIKE '4%' AND NOT SUBSTRING(Norek,1,3)='490' group by KodeUnit
union all
select kodeunit,0 as B01,0 as B02,0 as B03,
0 as B04,0 as B05,SUM(Debet-Kredit) as B06,0 as B07,0 as B08,0 as B09,0 as B10,0 as B11,0 as B12 
from kartu 
where MONTH(Tanggal)=6 and YEAR(Tanggal)=YEAR(@tanggal) and Norek LIKE '4%' AND NOT SUBSTRING(Norek,1,3)='490' group by KodeUnit
union all
select kodeunit,0 as B01,0 as B02,0 as B03,
0 as B04,0 as B05,0 as B06,SUM(Debet-Kredit) as B07,0 as B08,0 as B09,0 as B10,0 as B11,0 as B12 
from kartu 
where MONTH(Tanggal)=7 and YEAR(Tanggal)=YEAR(@tanggal) and Norek LIKE '4%' AND NOT SUBSTRING(Norek,1,3)='490' group by KodeUnit
union all
select kodeunit,0 as B01,0 as B02,0 as B03,
0 as B04,0 as B05,0 as B06,0 as B07,SUM(Debet-Kredit) as B08,0 as B09,0 as B10,0 as B11,0 as B12 
from kartu 
where MONTH(Tanggal)=8 and YEAR(Tanggal)=YEAR(@tanggal) and Norek LIKE '4%' AND NOT SUBSTRING(Norek,1,3)='490' group by KodeUnit
union all
select kodeunit,0 as B01,0 as B02,0 as B03,
0 as B04,0 as B05,0 as B06,0 as B07,0 as B08,SUM(Debet-Kredit) as B09,0 as B10,0 as B11,0 as B12 
from kartu 
where MONTH(Tanggal)=9 and YEAR(Tanggal)=YEAR(@tanggal) and Norek LIKE '4%' AND NOT SUBSTRING(Norek,1,3)='490' group by KodeUnit
union all
select kodeunit,0 as B01,0 as B02,0 as B03,
0 as B04,0 as B05,0 as B06,0 as B07,0 as B08,0 as B09,SUM(Debet-Kredit) as B10,0 as B11,0 as B12 
from kartu 
where MONTH(Tanggal)=10 and YEAR(Tanggal)=YEAR(@tanggal) and Norek LIKE '4%' AND NOT SUBSTRING(Norek,1,3)='490' group by KodeUnit
union all
select kodeunit,0 as B01,0 as B02,0 as B03,
0 as B04,0 as B05,0 as B06,0 as B07,0 as B08,0 as B09,0 as B10,SUM(Debet-Kredit) as B11,0 as B12 
from kartu 
where MONTH(Tanggal)=11 and YEAR(Tanggal)=YEAR(@tanggal) and Norek LIKE '4%' AND NOT SUBSTRING(Norek,1,3)='490' group by KodeUnit
union all
select kodeunit,0 as B01,0 as B02,0 as B03,
0 as B04,0 as B05,0 as B06,0 as B07,0 as B08,0 as B09,0 as B10,0 as B11,SUM(Debet-Kredit) as B12 
from kartu 
where MONTH(Tanggal)=12 and YEAR(Tanggal)=YEAR(@tanggal) and Norek LIKE '4%' AND NOT SUBSTRING(Norek,1,3)='490' group by KodeUnit

select a.KodeUnit,b.NamaKebun,
SUM(a.B01) as B01,SUM(a.B02) as B02,SUM(a.B03) as B03,
SUM(a.B04) as B04,SUM(a.B05) as B05,SUM(a.B06) as B06,
SUM(a.B07) as B07,SUM(a.B08) as B08,SUM(a.B09) as B09,  
SUM(a.B10) as B10,SUM(a.B11) as B11,SUM(a.B12) as B12
from #t1 a 
inner join SPDK_KBN_MASTER_REF..Ref_Kebun b on a.KodeUnit=b.KodeKebun
group by a.KodeUnit,b.NamaKebun
order by KodeUnit

--set dateformat dmy exec TIMK_AnalisiBiayaUmum '01-06-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[TIMK_AnalisiDataIndukKaryawan]
@tanggal datetime
as
set dateformat dmy
select TANGGAL, REG, NAMA, NM_PGL, GLR_DPN, GLR_BLK, TPT_LAHIR, TGL_LAHIR, KELAMIN, GOL_DARAH, AGAMA, ALAMAT, KOTA, TINGGAL, SIPIL, STAT_IS, TGL_NIKAH, TGL_CERAI, 
                      KANDUNG, ANGKAT, TANGGUNG, TGG_PPH, KD_PEND, TGL_SK, NO_SK, KD_KELAS, KLS_TMT, KLS_SK, GOL, MK, GOL_TMT, GOL_SK, GPO, KD_KBN, KD_AFD, KD_JAB, NAMA_JAB, KD_BUD, 
                      JAB_TMT, JAB_SK, ASTEK, TASPEN, SANSOS, STAT_DAP, MBT from ref_dik
where MONTH(TANGGAL)=6 and YEAR(TANGGAL)=2017
order by KD_KBN,REG

--set dateformat dmy exec TIMK_AnalisiDataIndukKaryawan '01-06-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[x]
@tanggal datetime,
@kdunit varchar(50)
as
set dateformat dmy
declare @kbn varchar(2)
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime
declare @TglLalu datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@TglAwal)), DATEADD(m,1,@TglAwal))
set @TglLalu=@TglAwal-1

select 'Awal',@TglAwal
union all
select 'Akhir',@TglAkhir
union all
select 'Lalu',@TglLalu


--set dateformat dmy exec x '30-09-2018','10'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create proc [dbo].[x051]
@tanggal datetime
as
begin
set dateformat dmy 
set nocount on
declare @NamaKebun varchar(50)
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
--set @NamaKebun=(select top 1 NamaKebun from Ref_Kebun where KodeKebun=@kdunit)

select * into #Ref_Rekening from Ref_Rekening 
select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@TglAkhir and Norek like '051%'

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D' and norek like '051%'
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K' and norek like '051%'
union all
select KodeUnit,Norek,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where Tanggal>=@TglAwal and Tanggal<=@tglakhir and norek like '051%'
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select @tanggal as tgl,a.kodeunit,a.norek,b.namarekening,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
from #t4 a
full outer join #Ref_Rekening b on a.norek=b.norek and a.KodeUnit=b.KodeUnit
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null 
group by a.kodeunit,a.norek,b.namarekening
order by KodeUnit,norek

end

--set dateformat dmy exec x051 '01-10-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create proc [dbo].[x0800209]
@tanggal datetime
as
begin
set dateformat dmy 
set nocount on
declare @NamaKebun varchar(50)
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
--set @NamaKebun=(select top 1 NamaKebun from Ref_Kebun where KodeKebun=@kdunit)

select * into #Ref_Rekening from Ref_Rekening 
select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@TglAkhir and Norek like '0800209%'

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D' and norek like '0800209%'
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K' and norek like '0800209%'
union all
select KodeUnit,Norek,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where Tanggal>=@TglAwal and Tanggal<=@tglakhir and norek like '0800209%'
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select @tanggal as tgl,a.kodeunit,a.norek,b.namarekening,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
from #t4 a
full outer join #Ref_Rekening b on a.norek=b.norek and a.KodeUnit=b.KodeUnit
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null 
group by a.kodeunit,a.norek,b.namarekening
order by KodeUnit,norek

end

--set dateformat dmy exec x0800209 '01-10-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[x143]
@tanggal datetime
as
begin
set dateformat dmy 
set nocount on
declare @NamaKebun varchar(50)
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
--set @NamaKebun=(select top 1 NamaKebun from Ref_Kebun where KodeKebun=@kdunit)

select * into #Ref_Rekening from Ref_Rekening 
select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@TglAkhir and Norek like '143%'

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D' and norek like '143%'
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K' and norek like '143%'
union all
select KodeUnit,Norek,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where Tanggal>=@TglAwal and Tanggal<=@tglakhir and norek like '143%'
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select @tanggal as tgl,a.kodeunit,a.norek,b.namarekening,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
from #t4 a
full outer join #Ref_Rekening b on a.norek=b.norek and a.KodeUnit=b.KodeUnit
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null 
group by a.kodeunit,a.norek,b.namarekening
order by KodeUnit,norek

end

--set dateformat dmy exec x143 '01-10-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create proc [dbo].[x144]
@tanggal datetime
as
begin
set dateformat dmy 
set nocount on
declare @NamaKebun varchar(50)
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
--set @NamaKebun=(select top 1 NamaKebun from Ref_Kebun where KodeKebun=@kdunit)

select * into #Ref_Rekening from Ref_Rekening 
select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@TglAkhir and Norek like '144%'

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D' and norek like '144%'
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K' and norek like '144%'
union all
select KodeUnit,Norek,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where Tanggal>=@TglAwal and Tanggal<=@tglakhir and norek like '144%'
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select @tanggal as tgl,a.kodeunit,a.norek,b.namarekening,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
from #t4 a
full outer join #Ref_Rekening b on a.norek=b.norek and a.KodeUnit=b.KodeUnit
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null 
group by a.kodeunit,a.norek,b.namarekening
order by KodeUnit,norek

end

--set dateformat dmy exec x144 '01-10-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create proc [dbo].[x145]
@tanggal datetime
as
begin
set dateformat dmy 
set nocount on
declare @NamaKebun varchar(50)
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
--set @NamaKebun=(select top 1 NamaKebun from Ref_Kebun where KodeKebun=@kdunit)

select * into #Ref_Rekening from Ref_Rekening 
select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@TglAkhir and Norek like '145%'

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D' and norek like '145%'
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K' and norek like '145%'
union all
select KodeUnit,Norek,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where Tanggal>=@TglAwal and Tanggal<=@tglakhir and norek like '145%'
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select @tanggal as tgl,a.kodeunit,a.norek,b.namarekening,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
from #t4 a
full outer join #Ref_Rekening b on a.norek=b.norek and a.KodeUnit=b.KodeUnit
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null 
group by a.kodeunit,a.norek,b.namarekening
order by KodeUnit,norek

end

--set dateformat dmy exec x145 '01-10-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE proc [dbo].[x150]
@tanggal datetime
as
begin
set dateformat dmy 
set nocount on
declare @NamaKebun varchar(50)
declare @TglAwal datetime
declare @tglakhir datetime
declare @AwalTahun datetime

set @AwalTahun='01-01-'+cast(YEAR(@tanggal) as varchar(4))
set @TglAwal=DATEADD(dd,-(DAY(DATEADD(mm,1,@tanggal))-1),DATEADD(mm,0,@tanggal))
set @TglAkhir= DATEADD(dd, -DAY(DATEADD(m,1,@tanggal)), DATEADD(m,1,@tanggal))
--set @NamaKebun=(select top 1 NamaKebun from Ref_Kebun where KodeKebun=@kdunit)

select * into #Ref_Rekening from Ref_Rekening 
select * into #Kartu from kartu where Tanggal>=@AwalTahun and Tanggal<=@TglAkhir and Norek like '150%'

select kodeunit,norek,nilai as nilai
into #Sawal 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='D' and norek like '150%'
union all
select kodeunit,norek,-1*nilai as nilai 
from akunmemorial 
where month(tanggal)=1 and year(tanggal)=year(@tanggal) and noinput in ('SALDO AWAL') and dk='K' and norek like '150%'
union all
select KodeUnit,Norek,Debet-Kredit as nilai 
from #kartu
where Tanggal>=@AwalTahun and Tanggal<@TglAwal

select kodeunit,norek,sum(nilai) as nilai into #t1 from #Sawal group by kodeunit,norek

select kodeunit,norek,sum(nilai) as sawDebet,cast(0 as float) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
into #t2
from #t1
where nilai>0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,sum(abs(nilai)) as sawKredit,cast(0 as float) as Debet,cast(0 as float) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #t1
where nilai<0
group by kodeunit,norek
union all
select kodeunit,norek,cast(0 as float) as sawDebet,cast(0 as float) as sawKredit,sum(debet) as Debet,sum(Kredit) as Kredit,cast(0 as float) as sakDebet,cast(0 as float) as sakKredit
from #kartu
where Tanggal>=@TglAwal and Tanggal<=@tglakhir and norek like '150%'
group by kodeunit,norek

select kodeunit,norek,
sum(sawDebet) as sawDebet,sum(sawKredit) as sawKredit,
sum(Debet) as Debet,sum(Kredit) as Kredit,
sum(sawDebet+debet-sawKredit-Kredit) as Saldo
into #t3
from #t2
group by kodeunit,norek

select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,Saldo as sakDebet,cast(0 as float) as SakKredit
into #t4
from #t3
where saldo>=0
union all
select kodeunit,norek,sawDebet,SawKredit,Debet,Kredit,cast(0 as float) as sakDebet,abs(Saldo) as sakKredit
from #t3
where saldo<0

select @tanggal as tgl,a.kodeunit,a.norek,b.namarekening,sum(a.sawDebet) as sawDebet,sum(a.SawKredit) as SawKredit,sum(a.Debet) as Debet,sum(a.Kredit) as Kredit,sum(a.sakDebet) as sakDebet,sum(a.sakKredit) as sakKredit
from #t4 a
full outer join #Ref_Rekening b on a.norek=b.norek and a.KodeUnit=b.KodeUnit
where sawDebet+sawKredit+debet+kredit+sakDebet+sakKredit is not null 
group by a.kodeunit,a.norek,b.namarekening
order by KodeUnit,norek

end

--set dateformat dmy exec x150 '01-10-2017'

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
Create Proc [dbo].[xsp_configure]
as
--GO
--CONFIGURING SQL INSTANCE TO ACCEPT ADVANCED OPTIONS
EXEC sp_configure 'show advanced options', 1
RECONFIGURE
--GO
--ENABLING USE OF DISTRIBUTED QUERIES
EXEC sp_configure 'Ad Hoc Distributed Queries', 1
RECONFIGURE
--GO

GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE Proc [dbo].[xxBprod]
@tanggal datetime
as
begin
set nocount on

-- TEH Kebun 10
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,SUM(debet-kredit) as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
into #xx
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='10' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
SUM(debet-kredit) as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='11' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,SUM(debet-kredit) as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='12' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek


union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,SUM(debet-kredit) as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='13' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,SUM(debet-kredit) as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='14' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,SUM(debet-kredit) as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='15' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,SUM(debet-kredit) as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='16' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek


union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,SUM(debet-kredit) as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='17' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,SUM(debet-kredit) as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='18' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek


union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,SUM(debet-kredit) as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='23' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,SUM(debet-kredit) as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='24' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,SUM(debet-kredit) as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='33' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,SUM(debet-kredit) as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='34' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
SUM(debet-kredit) as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='35' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,SUM(debet-kredit) as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='36' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,SUM(debet-kredit) as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='37' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,SUM(debet-kredit) as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='39' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,SUM(debet-kredit) as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='40' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,SUM(debet-kredit) as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='41' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,SUM(debet-kredit) as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='42' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,SUM(debet-kredit) as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='43' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,SUM(debet-kredit) as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='44' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,SUM(debet-kredit) as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='45' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,SUM(debet-kredit) as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='68' 
and KodeBudidaya='02'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
SUM(debet-kredit) as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='19' 
and KodeBudidaya='00'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,SUM(debet-kredit) as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='20' 
and KodeBudidaya='00'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,SUM(debet-kredit) as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='21' 
and KodeBudidaya='00'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,SUM(debet-kredit) AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='22' 
and KodeBudidaya='00'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,SUM(debet-kredit) as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='25' 
and KodeBudidaya='00'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,SUM(debet-kredit) as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='28' 
and KodeBudidaya='00'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,SUM(debet-kredit) as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='37' 
and KodeBudidaya='00'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,SUM(debet-kredit) as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='46'
and KodeBudidaya='00'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,SUM(debet-kredit) as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='47'
and KodeBudidaya='00'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,SUM(debet-kredit) as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='49'
and KodeBudidaya='00'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,SUM(debet-kredit) as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='50'
and KodeBudidaya='00'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,SUM(debet-kredit) as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='69'
and KodeBudidaya='00'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
SUM(debet-kredit) as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='71'
and KodeBudidaya='00'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,SUM(debet-kredit) as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='72'
and KodeBudidaya='00'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
SUM(debet-kredit) as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='24'
and KodeBudidaya='01'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,SUM(debet-kredit) as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='37'
and KodeBudidaya='01'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,SUM(debet-kredit) as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='43'
and KodeBudidaya='01'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,SUM(debet-kredit) as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='62'
and KodeBudidaya='01'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,SUM(debet-kredit) as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='64'
and KodeBudidaya='01'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,SUM(debet-kredit) as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='68'
and KodeBudidaya='01'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,SUM(debet-kredit) as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='69'
and KodeBudidaya='01'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,SUM(debet-kredit) as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='74'
and KodeBudidaya='01'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
SUM(debet-kredit) as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='65'
and KodeBudidaya='01'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,SUM(debet-kredit) as p11,0 as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='11'
and KodeBudidaya='36'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,SUM(debet-kredit) as p13,0 as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='13'
and KodeBudidaya='36'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,SUM(debet-kredit) as p18,0 as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='18'
and KodeBudidaya='36'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,SUM(debet-kredit) as p34,0 as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='34'
and KodeBudidaya='36'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,SUM(debet-kredit) as p35,0 as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='35'
and KodeBudidaya='36'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek

union all
select MONTH(tanggal) as tgl,kodeunit as unit,kodebudidaya as kdbud,norek as norek,0 as T10,
0 as T11,0 as T12,0 as T13,0 as T14,0 as T15,0 as T16,0 as T17,0 as T18,0 as T23,0 as T24,0 as T33,0 as T34,
0 as T35,0 as T36,0 as T37,0 as T39,0 as T40,0 as T41,0 as T42,0 as T43,0 as T44,0 as T45,0 as T68,
0 as K19,0 as k20,0 as k21,0 AS k22,0 as K25,0 as K28,0 as K37,0 as K46,0 as K47,0 as K49,0 as K50,0 as K69,
0 as K71,0 as K72,
0 as S24,0 as S37,0 as S43,0 as S62,0 as S64,0 as S68,0 as S69,0 as S74,
0 as s65,0 as p11,0 as p13,0 as p18,0 as p34,0 as p35,SUM(debet-kredit) as p44
from kartu
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal) and (SUBSTRING(norek,1,1)=6 or SUBSTRING(norek,1,3)='490') and KodeUnit='44'
and KodeBudidaya='36'
group by MONTH(tanggal),KodeUnit,kodebudidaya,norek


select tgl as tgl,norek as norek,sum(T10) as T10,
sum(T11) as T11,sum(T12) as T12,sum(T13) as T13,sum(t14) as T14,sum(t15) as T15,sum(t16) as T16,sum(t17) as T17,sum(t18) as T18,
sum(t23) as T23,sum(t24) as T24,sum(t33) as T33,sum(t34) as T34,sum(t35) as T35,SUM(t36) as T36,sum(t37) as T37,sum(t39) as T39,
sum(t40) as T40,sum(t41) as T41,sum(t42) as T42,sum(t43) as T43,sum(t44) as T44,sum(t45) as T45,sum(t68) as T68,
sum(k19) as K19,sum(k20)  as k20,sum(k21) as k21,sum(k22) AS k22,sum(k25) as K25,sum(k28) as K28,sum(k37) as K37,sum(k46) as K46,
sum(k47) as K47,sum(k49) as K49,sum(k49) as K50,sum(k69) as K69,sum(k71) as K71,sum(k72) as K72,
sum(s24) as S24,sum(s37) as S37,sum(s43) as S43,sum(s62) as S62,sum(s64) as S64,sum(s65) as S65,sum(s68) as S68,sum(s69) as S69,sum(s74) as S74,
SUM(p11) as p11,SUM(p13) as p13,SUM(p18) as p18,SUM(p34) as p34,SUM(p35) as p35,SUM(p44) as p44
from #xx
group by tgl,norek


Select MONTH(tanggal) as tgl,kodeunit as kebun,kodebud as kdbud,norek as norek,kodevar as kdvar,kodekbn as unit,SUM(bi) as nilai
from AkunProduksiHP
where month(Tanggal)=MONTH(@tanggal) and YEAR(tanggal)=YEAR(@tanggal)
group by MONTH(tanggal),kodeunit,kodebud,norek,kodevar,kodekbn


set nocount off
end

--set dateformat dmy exec xxBprod '01-01-2018'

GO
