@using Ptpn8.Areas.Areal.Models

@{
    ViewBag.Title = "Benchmark Produktivitas Teh";
}
<img id="progress" src="~/Content/Images/ajax-loader.gif" style="position: absolute; left: 50%; top: 5%; " />
<table width="100%;">
    <tr><td style="text-align: center; font-weight:600; font-size: large; background: lightgray;vertical-align:middle;">Benchmark Produktivitas Teh</td></tr>
    <tr><td style="text-align: center; font-weight:600;  background: gray; color: white;vertical-align:middle;" class="LayerKebun">Layer Kebun</td></tr>
    <tr><td style="text-align: center; font-weight:600;  background: gray; color: white;vertical-align:middle;" class="LayerAfdeling">Layer Afdeling</td></tr>
    <tr><td style="text-align: center; font-weight:600;  background: gray; color: white;vertical-align:middle;" class="LayerBlok">Layer Blok</td></tr>
</table>
@(Html.Kendo().Splitter()
          .Name("vertical")
          .Orientation(SplitterOrientation.Vertical)
          .Panes(verticalPanes =>
          {
          verticalPanes.Add()
                .HtmlAttributes(new { id = "top-pane" })
                .Scrollable(false)
                .Size("600px")
                .Collapsible(false)
                .Content(Html.Kendo().Splitter()
                            .Name("horizontal")
                            .HtmlAttributes(new { style = "height: 600px;" })
                            .Panes(horizontalPanes =>
                            {
                            horizontalPanes.Add()
                                .HtmlAttributes(new { id = "left-pane" })
                                .Size("200px")
                                .Collapsible(true)
                                .Content(@<div class="pane-content">
                                    <table style="width: inherit;">
                                        <tr><td>@Html.Kendo().CheckBox().Name("chkKebun").Label("Kebun").Checked(true).HtmlAttributes(new { @onchange = "chkKebunOnChange()" })</td></tr>
                                        <tr><td>@Html.Kendo().CheckBox().Name("chkStreetMap").Label("Street Map").Checked(true).HtmlAttributes(new { @onchange = "chkStreetMapOnChange()" })</td></tr>
                                        <tr><td>@Html.Kendo().CheckBox().Name("chkCitra").Label("Citra").Checked(false).HtmlAttributes(new { @onchange = "chkCitraOnChange()" })</td></tr>
                                        <tr><td>@Html.Kendo().CheckBox().Name("chkKontur").Label("Peta Kontur").Checked(false).HtmlAttributes(new { @onchange = "chkKonturOnChange()" })</td></tr>
                                        <tr><td><br /></td></tr>
                                        <tr><td>@Html.Kendo().Button().Name("btnMapExport").Content("Ekspor Peta").Events(e => e.Click("btnMapExportOnClick"))</td></tr>
                                        <tr><td><h4>Bulan-Tahun</h4></td></tr>
                                        <tr>
                                            <td>
                                                @(Html.Kendo().DropDownList()
                                                    .Name("ddlBulan")
                                                    .AutoBind(true)
                                                    .OptionLabel("Pilih Bulan...")
                                                    .DataTextField("Text")
                                                    .DataValueField("Value")
                                                    .HtmlAttributes(new { style = "width: 100px;" })
                                                    .Events(e => { e.Change("ddlBulanChange"); e.Select("ddlBulanSelect"); })
                                                    .Value((HttpContext.Current.Session["BulanView"]).ToString())
                                                    .BindTo(new List<SelectListItem>()
                                                    {
                                                        new SelectListItem() {Text = "Januari",Value = "1"},
                                                        new SelectListItem() {Text = "Februari",Value = "2"},
                                                        new SelectListItem() {Text = "Maret",Value = "3"},
                                                        new SelectListItem() {Text = "April",Value = "4"},
                                                        new SelectListItem() {Text = "Mei",Value = "5"},
                                                        new SelectListItem() {Text = "Juni",Value = "6"},
                                                        new SelectListItem() {Text = "Juli",Value = "7"},
                                                        new SelectListItem() {Text = "Agustus",Value = "8"},
                                                        new SelectListItem() {Text = "September",Value = "9"},
                                                        new SelectListItem() {Text = "Oktober",Value = "10"},
                                                        new SelectListItem() {Text = "November",Value = "11"},
                                                        new SelectListItem() {Text = "Desember",Value = "12"},
                                                    })
                                                )
                                                -
                                                @(Html.Kendo().IntegerTextBox()
                                                    .Name("txtTahun")
                                                    .Value(Convert.ToInt32(HttpContext.Current.Session["TahunView"]))
                                                    .HtmlAttributes(new { style = "width: 60px;" })
                                                    .Events(e => { e.Change("txtTahunChange"); })
                                                    .Format("{0:0000}")
                                                )

                                            </td>
                                        </tr>

                                    </table>
                                </div>);

                                horizontalPanes.Add()
                                .HtmlAttributes(new { id = "center-pane" })
                                .Content(
                                    @<div id="map" style="width:100%;height:100%;">
                                        <table>
                                            <tr>
                                                <td></td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    @(Html.Kendo().Map()
                                                .Name("map")
                                                .HtmlAttributes(new { style = "height: 100%;" })
                                                .Center(-6, 108) //(-6.878055, 107.596070)
                                                .Zoom(9)
                                                .Layers(layers =>
                                                    {
                                                        layers.Add()
                                                            .Type(MapLayerType.Tile)
                                                            .Key("streetmap")
                                                            .UrlTemplate("https://#= subdomain #.tile.openstreetmap.org/#= zoom #/#= x #/#= y #.png")
                                                            .Subdomains("a", "b", "c")
                                                            .Attribution("&copy; <a href='http://osm.org/copyright'>OpenStreetMap contributors</a>");
                                                    })
                                                .Layers(layers =>
                                                {
                                                    layers.Add()
                                                    .Style(style => style.Fill(fill => fill.Opacity(1)))
                                                    .Type(MapLayerType.Tile)
                                                    .UrlTemplate("https://tile.thunderforest.com/cycle/#= zoom #/#= x #/#= y #.png")
                                                    .Key("kontur");
                                                })
                                                .Layers(layers =>
                                                {
                                                    layers.Add()
                                                    .Style(style => style.Fill(fill => fill.Opacity(1)))
                                                    .Key("citra")
                                                    .Type(MapLayerType.Bing)
                                                    .ImagerySet(MapLayersImagerySet.AerialWithLabels)
                                                    .Key("AqaPuZWytKRUA8Nm5nqvXHWGL8BDCXvK8onCl2PkC581Zp3T_fYAQBiwIphJbRAK");
                                                })
                                                .Layers(layers =>
                                                {
                                                    layers.Add()
                                                        .Style(style => style.Fill(fill => fill.Opacity(1)))
                                                        .Key("Kebun") // Index : 3
                                                        .Type(MapLayerType.Shape)
                                                        .AutoBind(true)
                                                        .DataSource(dataSource => dataSource
                                                            .GeoJson()
                                                            .Read(read => read.Action("KebunGeoJson", "ProduktivitasTehPerTahun").Data("KebunGeoJsonData"))
                                                        );

                                                    layers.Add()
                                                        .Style(style => style.Fill(fill => fill.Opacity(1)))
                                                        .Key("Afdeling") // Index : 4
                                                        .AutoBind(false)
                                                        .Type(MapLayerType.Shape)
                                                        .DataSource(dataSource => dataSource
                                                            .GeoJson()
                                                            .Read(read => read.Action("AfdelingGeoJson", "ProduktivitasTehPerTahun").Data("AfdelingGeoJsonData"))
                                                        );

                                                    layers.Add()
                                                        .Style(style => style.Fill(fill => fill.Opacity(1)))
                                                        .Key("Blok") // Index : 5
                                                        .AutoBind(false)
                                                        .Type(MapLayerType.Shape)
                                                        .DataSource(dataSource => dataSource
                                                            .GeoJson()
                                                            .Read(read => read.Action("BlokGeoJson", "ProduktivitasTehPerTahun").Data("BlokGeoJsonData"))
                                                        );

                                                })

                                            .Events(events => events
                                                .ShapeCreated("onShapeCreated")
                                                .ShapeMouseEnter("onShapeMouseEnter")
                                                .ShapeMouseLeave("onShapeMouseLeave")
                                                .ShapeClick("onShapeClick")
                                                .MarkerClick("onMarkerClick")
                                                .Click("onMapClick")
                                            )
                                                    )
                                                </td>
                                            </tr>
                                        </table>
                                    </div>);

                                    horizontalPanes.Add()
                                    .HtmlAttributes(new { id = "right-pane" })
                                    .Collapsible(true)
                                    .Scrollable(true)
                                    .Size("300px")
                                    .Content(@<div class="pane-content">
                                        <div>
                                            <h2 style="text-align: center;">Legend</h2>
                                            <table id="tblLegend">
                                                <tr style="height: 50px;">
                                                    <td width="70px" style="text-align:center; font-weight: 500;">MA Time</td>
                                                    <td width="50px"></td>
                                                    <td width="50px"></td>
                                                    <td width="50px"></td>
                                                    <td width="70px"></td>
                                                </tr>
                                                <tr style="height: 30px;">
                                                    <td width="50px" style="text-align:center; border-right: 1px solid gray;border-bottom: 1px solid gray; ">6x</td>
                                                    <td width="50px" style="background-color:yellow;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="50px" style="background-color:orange;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="50px" style="background-color:red;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="70px"></td>
                                                </tr>
                                                <tr style="height: 30px;">
                                                    <td width="50px" style="text-align:center;border-right: 1px solid gray;border-bottom: 1px solid gray; ">5x</td>
                                                    <td width="50px" style="background-color:yellow;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="50px" style="background-color:orange;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="50px" style="background-color:red;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="70px"></td>
                                                </tr>
                                                <tr style="height: 30px;">
                                                    <td width="50px" style="text-align:center;border-right: 1px solid gray;border-bottom: 1px solid gray; ">4x</td>
                                                    <td width="50px" style="background-color:yellow;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="50px" style="background-color:orange;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="50px" style="background-color:red;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="70px"></td>
                                                </tr>
                                                <tr style="height: 30px;">
                                                    <td width="50px" style="text-align:center;border-right: 1px solid gray;border-bottom: 1px solid gray; ">3x</td>
                                                    <td width="50px" style="background-color:green;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="50px" style="background-color:yellow;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="50px" style="background-color:orange;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="70px"></td>
                                                </tr>
                                                <tr style="height: 30px;">
                                                    <td width="50px" style="text-align:center;border-right: 1px solid gray;border-bottom: 1px solid gray; ">2x</td>
                                                    <td width="50px" style="background-color:green;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="50px" style="background-color:yellow;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="50px" style="background-color:orange;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="70px"></td>
                                                </tr>
                                                <tr style="height: 30px;">
                                                    <td width="50px" style="text-align:center;border-right: 1px solid gray;border-bottom: 1px solid gray; ">1x</td>
                                                    <td width="50px" style="background-color:green;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="50px" style="background-color:yellow;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="50px" style="background-color:orange;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="70px"></td>
                                                </tr>
                                                <tr style="height: 30px;">
                                                    <td width="50px" style="text-align:center;border-right: 1px solid gray;border-bottom: 1px solid gray; ">0x</td>
                                                    <td width="50px" style="background-color:green;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="50px" style="background-color:yellow;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="50px" style="background-color:orange;border-right: 1px solid gray;border-bottom: 1px solid gray; "></td>
                                                    <td width="70px"></td>
                                                </tr>
                                                <tr style="height: 50px;">
                                                    <td width="50px" style="text-align:center;border-right: 1px solid gray;"></td>
                                                    <td width="50px" style="text-align:center;border-right: 1px solid gray;">0%-10%</td>
                                                    <td width="50px" style="text-align:center;border-right: 1px solid gray;">10%-30%</td>
                                                    <td width="50px" style="text-align:center;border-right: 1px solid gray;">>30%</td>
                                                    <td width="70px" style="text-align:center; font-weight: 500;">MA-Below</td>
                                                </tr>
                                            </table>
                                            <table>
                                                <tr><td><h3>Keterangan</h3></td></tr>
                                                <tr><td><h4>Moving Average Time (MA Time) : frekwensi protas dibawah protas benchmark selama 6 bulan</h4></td></tr>
                                                <tr><td><h4>Moving Average Below (MA Below) : % selisih yield per Ha dengan benchmark selama 6 bulan</h4></td></tr>
                                            </table>
                                        </div>

                                    </div>);

                            }).ToHtmlString()
                                    );
          })
)

@(Html.Kendo().TabStrip().Name("tabstrib").Animation(animation => animation.Open(effect => effect.Fade(FadeDirection.In)))
                                .HtmlAttributes(new { style = "height: 600px" })
                                .Items(items =>
                                {
                                items.Add().Text("Grafik").Selected(false).Content(@<text>
        <div class="LayerKebun">
            <table width="100%" height="100%">
                <tr>
                    <td class="tblChart" width="50%">
                        @(Html.Kendo().Chart<ProduktivitasPerKebun>()
                                                        .Name("ChartProtasTehKebunBI")
                                                        .Title("Protas Teh Semester I")
                                                        .HtmlAttributes(new { style = "height: 600px" })
                                                        .AutoBind(false)
                                                        .Legend(legend => legend
                                                            .Position(ChartLegendPosition.Right)
                                                        )
                                                        .DataSource(ds => ds
                                                            .Read(read => read.Action("ChartProtasPerKebun", "ProduktivitasTehPerTahun").Data("getKebunData"))
                                                        )
                                                        .SeriesDefaults(seriesDefaults =>
                                                                    seriesDefaults.Bar().Stack(true)
                                                        )
                                                        .Series(series =>
                                                        {
                                                            series.Bar(model => model.Januari_Real).Name("Protas Kebun Bulan Januari").Stack("ProtasKebun").Color("green");
                                                            series.Bar(model => model.Februari_Real).Name("Protas Kebun Bulan Februari").Stack("ProtasKebun").Color("red");
                                                            series.Bar(model => model.Maret_Real).Name("Protas Kebun Bulan Maret").Stack("ProtasKebun").Color("orange");
                                                            series.Bar(model => model.April_Real).Name("Protas Kebun Bulan April").Stack("ProtasKebun").Color("yellow");
                                                            series.Bar(model => model.Mei_Real).Name("Protas Kebun Bulan Mei").Stack("ProtasKebun").Color("gray");
                                                            series.Bar(model => model.Juni_Real).Name("Protas Kebun Bulan Juni").Stack("ProtasKebun").Color("orange");

                                                            series.Bar(model => model.Januari_PTPN8).Name("Protas PTPN VIII Bulan Januari").Stack("ProtasPTPN8").Color("lightgreen");
                                                            series.Bar(model => model.Februari_PTPN8).Name("Protas PTPN VIII Bulan Februari").Stack("ProtasPTPN8").Color("cyan");
                                                            series.Bar(model => model.Maret_PTPN8).Name("Protas PTPN VIII Bulan Maret").Stack("ProtasPTPN8").Color("lightorange");
                                                            series.Bar(model => model.April_PTPN8).Name("Protas PTPN VIII Bulan April").Stack("ProtasPTPN8").Color("gold");
                                                            series.Bar(model => model.Mei_PTPN8).Name("Protas PTPN VIII Bulan Mei").Stack("ProtasPTPN8").Color("lightgray");
                                                            series.Bar(model => model.Juni_PTPN8).Name("Protas PTPN VIII Bulan Juni").Stack("ProtasPTPN8").Color("brown");

                                                        })
                                                        .CategoryAxis(axis => axis
                                                            .Categories(model => model.Kebun)
                                                            .Labels(labels => labels.Rotation("auto"))
                                                            .MajorGridLines(lines => lines.Visible(false)))
                                                        .ValueAxis(axis => axis.Numeric()
                                                            .Labels(labels => labels.Format("{0:N0}"))
                                                            .MajorUnit(500)
                                                            .Line(line => line.Visible(false)))
                                                        .Tooltip(tooltip => tooltip
                                                            .Visible(true)
                                                            .Template("#= series.name# : #= kendo.toString(value,'n2') # Kg/Ha")
                                                        )
                        )
                    </td>
                    <td class="tblChart" width="50%">
                        @(Html.Kendo().Chart<ProduktivitasPerKebun>()
                                                        .Name("ChartProtasTehKebunSBI")
                                                        .Title("Protas Teh Semester II")
                                                        .HtmlAttributes(new { style = "height: 600px" })
                                                        .AutoBind(false)
                                                        .Legend(legend => legend
                                                            .Position(ChartLegendPosition.Right)
                                                        )
                                                        .DataSource(ds => ds
                                                            .Read(read => read.Action("ChartProtasPerKebun", "ProduktivitasTehPerTahun").Data("getKebunData"))
                                                        )
                                                        .SeriesDefaults(seriesDefaults =>
                                                                    seriesDefaults.Bar().Stack(true)
                                                                )
                                                        .Series(series =>
                                                        {
                                                            series.Bar(model => model.Juli_Real).Name("Protas Kebun Bulan Juli").Stack("ProtasKebun").Color("green");
                                                            series.Bar(model => model.Agustus_Real).Name("Protas Kebun Bulan Agustus").Stack("ProtasKebun").Color("red");
                                                            series.Bar(model => model.September_Real).Name("Protas Kebun Bulan September").Stack("ProtasKebun").Color("orange");
                                                            series.Bar(model => model.Oktober_Real).Name("Protas Kebun Bulan Oktober").Stack("ProtasKebun").Color("yellow");
                                                            series.Bar(model => model.November_Real).Name("Protas Kebun Bulan November").Stack("ProtasKebun").Color("gray");
                                                            series.Bar(model => model.Desember_Real).Name("Protas Kebun Bulan Desember").Stack("ProtasKebun").Color("orange");

                                                            series.Bar(model => model.Juli_PTPN8).Name("Protas PTPN VIII Bulan Juli").Stack("ProtasPTPN8").Color("lightgreen");
                                                            series.Bar(model => model.Agustus_PTPN8).Name("Protas PTPN VIII Bulan Agustus").Stack("ProtasPTPN8").Color("cyan");
                                                            series.Bar(model => model.September_PTPN8).Name("Protas PTPN VIII Bulan September").Stack("ProtasPTPN8").Color("lightorange");
                                                            series.Bar(model => model.Oktober_PTPN8).Name("Protas PTPN VIII Bulan Oktober").Stack("ProtasPTPN8").Color("gold");
                                                            series.Bar(model => model.November_PTPN8).Name("Protas PTPN VIII Bulan November").Stack("ProtasPTPN8").Color("lightgray");
                                                            series.Bar(model => model.Desember_PTPN8).Name("Protas PTPN VIII Bulan Desember").Stack("ProtasPTPN8").Color("brown");

                                                        })
                                                        .CategoryAxis(axis => axis
                                                            .Categories(model => model.Kebun)
                                                            .Labels(labels => labels.Rotation("auto"))
                                                            .MajorGridLines(lines => lines.Visible(false)))
                                                        .ValueAxis(axis => axis.Numeric()
                                                            .Labels(labels => labels.Format("{0:N0}"))
                                                            .MajorUnit(1000)
                                                            .Line(line => line.Visible(false)))
                                                        .Tooltip(tooltip => tooltip
                                                            .Visible(true)
                                                            .Template("#= series.name# : #= kendo.toString(value,'n2') # Kg/Ha")
                                                        )

                        )
                    </td>
                </tr>
            </table>
        </div>
        <div class="LayerAfdeling">
            <table width="100%" height="100%">
                <tr>
                    <td class="tblChart" width="50%">
                        @(Html.Kendo().Chart<ProduktivitasPerAfdeling>()
                                                        .Name("ChartProtasTehAfdelingBI")
                                                        .Title("Protas Teh Semester I")
                                                        .HtmlAttributes(new { style = "height: 600px" })
                                                        .AutoBind(false)
                                                        .Legend(legend => legend
                                                            .Position(ChartLegendPosition.Right)
                                                        )
                                                        .DataSource(ds => ds
                                                            .Read(read => read.Action("ChartProtasPerAfdeling", "ProduktivitasTehPerTahun").Data("getAfdelingData"))
                                                        )
                                                        .SeriesDefaults(seriesDefaults =>
                                                                    seriesDefaults.Bar().Stack(true)
                                                        )
                                                        .Series(series =>
                                                        {
                                                            series.Bar(model => model.Januari_Real).Name("Protas Afdeling Bulan Januari").Stack("ProtasAfdeling").Color("green");
                                                            series.Bar(model => model.Februari_Real).Name("Protas Afdeling Bulan Februari").Stack("ProtasAfdeling").Color("red");
                                                            series.Bar(model => model.Maret_Real).Name("Protas Afdeling Bulan Maret").Stack("ProtasAfdeling").Color("orange");
                                                            series.Bar(model => model.April_Real).Name("Protas Afdeling Bulan April").Stack("ProtasAfdeling").Color("yellow");
                                                            series.Bar(model => model.Mei_Real).Name("Protas Afdeling Bulan Mei").Stack("ProtasAfdeling").Color("gray");
                                                            series.Bar(model => model.Juni_Real).Name("Protas Afdeling Bulan Juni").Stack("ProtasAfdeling").Color("orange");

                                                            series.Bar(model => model.Januari_PTPN8).Name("Protas Kebun Bulan Januari").Stack("ProtasKebun").Color("lightgreen");
                                                            series.Bar(model => model.Februari_PTPN8).Name("Protas Kebun Bulan Februari").Stack("ProtasKebun").Color("cyan");
                                                            series.Bar(model => model.Maret_PTPN8).Name("Protas Kebun Bulan Maret").Stack("ProtasKebun").Color("lightorange");
                                                            series.Bar(model => model.April_PTPN8).Name("Protas Kebun Bulan April").Stack("ProtasKebun").Color("gold");
                                                            series.Bar(model => model.Mei_PTPN8).Name("Protas Kebun Bulan Mei").Stack("ProtasKebun").Color("lightgray");
                                                            series.Bar(model => model.Juni_PTPN8).Name("Protas Kebun Bulan Juni").Stack("ProtasKebun").Color("brown");

                                                        })
                                                        .CategoryAxis(axis => axis
                                                            .Categories(model => model.Afdeling)
                                                            .Labels(labels => labels.Rotation("auto"))
                                                            .MajorGridLines(lines => lines.Visible(false)))
                                                        .ValueAxis(axis => axis.Numeric()
                                                            .Labels(labels => labels.Format("{0:N0}"))
                                                            .MajorUnit(500)
                                                            .Line(line => line.Visible(false)))
                                                        .Tooltip(tooltip => tooltip
                                                            .Visible(true)
                                                            .Template("#= series.name# : #= kendo.toString(value,'n2') # Kg/Ha")
                                                        )
                        )
                    </td>
                    <td class="tblChart" width="50%">
                        @(Html.Kendo().Chart<ProduktivitasPerAfdeling>()
                                                        .Name("ChartProtasTehAfdelingSBI")
                                                        .Title("Protas Teh Semester II")
                                                        .HtmlAttributes(new { style = "height: 600px" })
                                                        .AutoBind(false)
                                                        .Legend(legend => legend
                                                            .Position(ChartLegendPosition.Right)
                                                        )
                                                        .DataSource(ds => ds
                                                            .Read(read => read.Action("ChartProtasPerAfdeling", "ProduktivitasTehPerTahun").Data("getAfdelingData"))
                                                        )
                                                        .SeriesDefaults(seriesDefaults =>
                                                                    seriesDefaults.Bar().Stack(true)
                                                        )
                                                        .Series(series =>
                                                        {
                                                            series.Bar(model => model.Juli_Real).Name("Protas Afdeling Bulan Juli").Stack("ProtasAfdeling").Color("green");
                                                            series.Bar(model => model.Agustus_Real).Name("Protas Afdeling Bulan Agustus").Stack("ProtasAfdeling").Color("red");
                                                            series.Bar(model => model.September_Real).Name("Protas Afdeling Bulan September").Stack("ProtasAfdeling").Color("orange");
                                                            series.Bar(model => model.Oktober_Real).Name("Protas Afdeling Bulan Oktober").Stack("ProtasAfdeling").Color("yellow");
                                                            series.Bar(model => model.November_Real).Name("Protas Afdeling Bulan November").Stack("ProtasAfdeling").Color("gray");
                                                            series.Bar(model => model.Desember_Real).Name("Protas Afdeling Bulan Desember").Stack("ProtasAfdeling").Color("orange");

                                                            series.Bar(model => model.Juli_PTPN8).Name("Protas Kebun Bulan Juli").Stack("ProtasKebun").Color("lightgreen");
                                                            series.Bar(model => model.Agustus_PTPN8).Name("Protas Kebun Bulan Agustus").Stack("ProtasKebun").Color("cyan");
                                                            series.Bar(model => model.September_PTPN8).Name("Protas Kebun Bulan September").Stack("ProtasKebun").Color("lightorange");
                                                            series.Bar(model => model.Oktober_PTPN8).Name("Protas Kebun Bulan Oktober").Stack("ProtasKebun").Color("gold");
                                                            series.Bar(model => model.November_PTPN8).Name("Protas Kebun Bulan November").Stack("ProtasKebun").Color("lightgray");
                                                            series.Bar(model => model.Desember_PTPN8).Name("Protas Kebun Bulan Desember").Stack("ProtasKebun").Color("brown");

                                                        })
                                                        .CategoryAxis(axis => axis
                                                            .Categories(model => model.Afdeling)
                                                            .Labels(labels => labels.Rotation("auto"))
                                                            .MajorGridLines(lines => lines.Visible(false)))
                                                        .ValueAxis(axis => axis.Numeric()
                                                            .Labels(labels => labels.Format("{0:N0}"))
                                                            .MajorUnit(500)
                                                            .Line(line => line.Visible(false)))
                                                        .Tooltip(tooltip => tooltip
                                                            .Visible(true)
                                                            .Template("#= series.name# : #= kendo.toString(value,'n2') # Kg/Ha")
                                                        )
                        )
                    </td>
                </tr>

            </table>
        </div>
        <div class="LayerBlok">
            <table width="100%" height="100%">
                <tr>
                    <td class="tblChart" width="50%">
                        @(Html.Kendo().Chart<ProduktivitasPerBlok>()
                                                        .Name("ChartProtasTehBlokBI")
                                                        .Title("Protas Teh Semester I")
                                                        .AutoBind(false)
                                                        .HtmlAttributes(new { style = "height: 600px" })
                                                        .Legend(legend => legend
                                                            .Position(ChartLegendPosition.Right)
                                                        )
                                                        .DataSource(ds => ds
                                                            .Read(read => read.Action("ChartProtasPerBlok", "ProduktivitasTehPerTahun").Data("getBlokData"))
                                                        )
                                                        .SeriesDefaults(seriesDefaults =>
                                                                    seriesDefaults.Bar().Stack(true)
                                                        )
                                                        .Series(series =>
                                                        {
                                                            series.Bar(model => model.Januari_Real).Name("Protas Blok Bulan Januari").Stack("ProtasBlok").Color("green");
                                                            series.Bar(model => model.Februari_Real).Name("Protas Blok Bulan Februari").Stack("ProtasBlok").Color("red");
                                                            series.Bar(model => model.Maret_Real).Name("Protas Blok Bulan Maret").Stack("ProtasBlok").Color("orange");
                                                            series.Bar(model => model.April_Real).Name("Protas Blok Bulan April").Stack("ProtasBlok").Color("yellow");
                                                            series.Bar(model => model.Mei_Real).Name("Protas Blok Bulan Mei").Stack("ProtasBlok").Color("gray");
                                                            series.Bar(model => model.Juni_Real).Name("Protas Blok Bulan Juni").Stack("ProtasBlok").Color("orange");

                                                            series.Bar(model => model.Januari_PTPN8).Name("Protas Afdeling Bulan Januari").Stack("ProtasAfdeling").Color("lightgreen");
                                                            series.Bar(model => model.Februari_PTPN8).Name("Protas Afdeling Bulan Februari").Stack("ProtasAfdeling").Color("cyan");
                                                            series.Bar(model => model.Maret_PTPN8).Name("Protas Kebun Afdeling Maret").Stack("ProtasAfdeling").Color("lightorange");
                                                            series.Bar(model => model.April_PTPN8).Name("Protas Kebun Afdeling April").Stack("ProtasAfdeling").Color("gold");
                                                            series.Bar(model => model.Mei_PTPN8).Name("Protas Kebun Afdeling Mei").Stack("ProtasAfdeling").Color("lightgray");
                                                            series.Bar(model => model.Juni_PTPN8).Name("Protas Kebun Afdeling Juni").Stack("ProtasAfdeling").Color("brown");

                                                        })
                                                        .CategoryAxis(axis => axis
                                                            .Categories(model => model.Blok)
                                                            .Labels(labels => labels.Rotation("auto"))
                                                            .MajorGridLines(lines => lines.Visible(false)))
                                                        .ValueAxis(axis => axis.Numeric()
                                                            .Labels(labels => labels.Format("{0:N0}"))
                                                            .MajorUnit(500)
                                                            .Line(line => line.Visible(false)))
                                                        .Tooltip(tooltip => tooltip
                                                            .Visible(true)
                                                            .Template("#= series.name# : #= kendo.toString(value,'n2') # Kg/Ha")
                                                        )
                        )
                    </td>
                    <td class="tblChart" width="50%">
                        @(Html.Kendo().Chart<ProduktivitasPerBlok>()
                                                        .Name("ChartProtasTehBlokSBI")
                                                        .Title("Protas Teh Semester II")
                                                        .HtmlAttributes(new { style = "height: 600px" })
                                                        .AutoBind(false)
                                                        .Legend(legend => legend
                                                            .Position(ChartLegendPosition.Right)
                                                        )
                                                        .DataSource(ds => ds
                                                            .Read(read => read.Action("ChartProtasPerBlok", "ProduktivitasTehPerTahun").Data("getBlokData"))
                                                        )
                                                        .SeriesDefaults(seriesDefaults =>
                                                                    seriesDefaults.Bar().Stack(true)
                                                        )
                                                        .Series(series =>
                                                        {
                                                            series.Bar(model => model.Juli_Real).Name("Protas Blok Bulan Juli").Stack("ProtasBlok").Color("green");
                                                            series.Bar(model => model.Agustus_Real).Name("Protas Blok Bulan Agustus").Stack("ProtasBlok").Color("red");
                                                            series.Bar(model => model.September_Real).Name("Protas Blok Bulan September").Stack("ProtasBlok").Color("orange");
                                                            series.Bar(model => model.Oktober_Real).Name("Protas Blok Bulan Oktober").Stack("ProtasBlok").Color("yellow");
                                                            series.Bar(model => model.November_Real).Name("Protas Blok Bulan November").Stack("ProtasBlok").Color("gray");
                                                            series.Bar(model => model.Desember_Real).Name("Protas Blok Bulan Desember").Stack("ProtasBlok").Color("orange");

                                                            series.Bar(model => model.Juli_PTPN8).Name("Protas Afdeling Bulan Juli").Stack("ProtasAfdeling").Color("lightgreen");
                                                            series.Bar(model => model.Agustus_PTPN8).Name("Protas Afdeling Bulan Agustus").Stack("ProtasAfdeling").Color("cyan");
                                                            series.Bar(model => model.September_PTPN8).Name("Protas Kebun Afdeling September").Stack("ProtasAfdeling").Color("lightorange");
                                                            series.Bar(model => model.Oktober_PTPN8).Name("Protas Kebun Afdeling Oktober").Stack("ProtasAfdeling").Color("gold");
                                                            series.Bar(model => model.November_PTPN8).Name("Protas Kebun Afdeling November").Stack("ProtasAfdeling").Color("lightgray");
                                                            series.Bar(model => model.Desember_PTPN8).Name("Protas Kebun Afdeling Desember").Stack("ProtasAfdeling").Color("brown");

                                                        })
                                                        .CategoryAxis(axis => axis
                                                            .Categories(model => model.Blok)
                                                            .Labels(labels => labels.Rotation("auto"))
                                                            .MajorGridLines(lines => lines.Visible(false)))
                                                        .ValueAxis(axis => axis.Numeric()
                                                            .Labels(labels => labels.Format("{0:N0}"))
                                                            .MajorUnit(500)
                                                            .Line(line => line.Visible(false)))
                                                        .Tooltip(tooltip => tooltip
                                                            .Visible(true)
                                                            .Template("#= series.name# : #= kendo.toString(value,'n2') # Kg/Ha")
                                                        )
                        )
                    </td>
                </tr>

            </table>

        </div>


                                </text>);
                                    items.Add().Text("Data").Selected(true).Content(@<text>
                                    <div><h3>Benchmark Produktivitas, Bulan : <input type="text" id="lblBulan" readonly="readonly" style="font-weight: 600; background: none; " /></h3></div>

                                    <div class="LayerKebun">
                                        @(Html.Kendo().Grid<Ptpn8.Areas.Areal.Models.ProduktivitasPerKebun>().Name("grdDataKebun")
                                                .Sortable()
                                                .Scrollable()
                                                .Groupable()
                                                .Selectable()
                                                .Resizable(resizeable => resizeable.Columns(true))
                                                .Events(e =>
                                                {
                                                    e.DataBound("grdDataKebunOnDataBound"); e.Change("grdDataKebunOnChange");
                                                })
                                                .HtmlAttributes(new { style = "height: 600px;" })
                                                .ToolBar(tools => tools.Excel())
                                                .AutoBind(false)
                                                .Excel(excel => excel
                                                    .FileName("ProtasKebun.xlsx")
                                                    .Filterable(true)
                                                    .AllPages(true)
                                                    .ProxyURL(Url.Action("Excel_Export_Save", "Home"))
                                                )
                                                .Columns(c =>
                                                {
                                                    c.Bound(o => o.Id).Hidden();
                                                    c.Bound(o => o.Wilayah).HeaderTemplate("Wilayah").Width(100).Groupable(true).Hidden();
                                                    c.Bound(o => o.Kebun).HeaderTemplate("Kebun").Locked(true).Width(150);
                                                    c.Bound(o => o.TahunTanam).HeaderTemplate("Tahun Tanam").Locked(false).Width(50).Groupable(true).HtmlAttributes(new { style = "text-align: center;" });
                                                    c.Bound(o => o.LuasAreal).HeaderTemplate("Luas (Ha)").Width(50).Format("{0:n2}").HtmlAttributes(new { style = "text-align: right;" })
                                                      .ClientGroupFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                      .ClientFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                      .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black; font-size: medium; background: silver;" });
                                                    c.Bound(o => o.LuasArealInduk).Locked(false).HeaderTemplate("Luas (Ha)").Width(80).Format("{0:n2}")
                                                        .Hidden()
                                                      .HtmlAttributes(new { style = "text-align: right;" })
                                                      .Width(120)
                                                      .ClientGroupFooterTemplate("#= kendo.toString(sum,'n0') #")
                                                      .ClientFooterTemplate("#= kendo.toString(sum,'n0') #")
                                                      .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black;  background: silver;" });

                                                    if (HttpContext.Current.Session["BulanView"] != null)
                                                    {
                                                        string bln = Convert.ToString(HttpContext.Current.Session["BulanView"]);
                                                        string thn = Convert.ToString(HttpContext.Current.Session["TahunView"]);
                                                        string blnAwal;
                                                        string thnAwal;
                                                        if (int.Parse(bln) - 5 > 0)
                                                        {
                                                            blnAwal = (int.Parse(bln) - 5).ToString();
                                                            thnAwal = thn;
                                                        }
                                                        else
                                                        {
                                                            blnAwal = (12 + (int.Parse(bln) - 5)).ToString();
                                                            thnAwal = (int.Parse(thn) - 1).ToString();
                                                        }

                                                        for (int i = 1; i <= 6; i++)
                                                        {
                                                            c.Bound(DateTime.Parse("01/" + blnAwal.ToString() + "/2016").ToString("MMMM").Replace("Nopember", "November") + "_Real")
                                                                .HeaderTemplate("<div>" + DateTime.Parse("01/" + blnAwal.ToString() + "/2016").ToString("MMMM") + "</div><div>" + thnAwal.ToString() + "</div>").Format("{0:n2}")
                                                                .ClientTemplate("<div>#= kendo.toString(" + DateTime.Parse("01/" + blnAwal.ToString() + "/2016").ToString("MMMM").Replace("Nopember", "November") + "_Real/LuasAreal,'n2') #</div><div>#= kendo.toString(" + DateTime.Parse("01/" + blnAwal.ToString() + "/2016").ToString("MMMM").Replace("Nopember", "November") + "_PTPN8/LuasArealInduk,'n2') #</div>")
                                                                .Width(80)
                                                                .HtmlAttributes(new { style = "text-align: right;" })
                                                                .ClientGroupFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                                .ClientFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                                .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black;  background: silver;" });

                                                            blnAwal = (int.Parse(blnAwal) + 1).ToString();
                                                            if (int.Parse(blnAwal) > 12)
                                                            {
                                                                blnAwal = "1";
                                                                thnAwal = (int.Parse(thnAwal) + 1).ToString();
                                                            }
                                                        }
                                                    }

                                                    c.Bound(q => q.MATime_Sem1).HeaderTemplate("MA Time").Format("{0:n0}")
                                                        .Width(50)
                                                        .HtmlAttributes(new { style = "text-align: right;" })
                                                        .ClientGroupFooterTemplate("#= kendo.toString(average,'n0') #")
                                                        .ClientFooterTemplate("#= kendo.toString(average,'n0') #")
                                                        .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black;  background: silver;" });

                                                    c.Bound(q => q.MABelow_Sem1).HeaderTemplate("MA Below").Format("{0:p0}")
                                                        .Width(50)
                                                        .HtmlAttributes(new { style = "text-align: right;" })
                                                        .ClientGroupFooterTemplate("#= kendo.toString(average,'n0') #")
                                                        .ClientFooterTemplate("#= kendo.toString(average,'n0') #")
                                                        .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black;  background: silver;" });

                                                    if (HttpContext.Current.Session["BulanView"] != null)
                                                    {
                                                        string bln = Convert.ToString(HttpContext.Current.Session["BulanView"]);
                                                        string thn = Convert.ToString(HttpContext.Current.Session["TahunView"]);
                                                        string blnAwal;
                                                        string thnAwal;
                                                        if (int.Parse(bln) - 5 > 0)
                                                        {
                                                            blnAwal = (int.Parse(bln) - 5).ToString();
                                                            thnAwal = thn;
                                                        }
                                                        else
                                                        {
                                                            blnAwal = (12 + (int.Parse(bln) - 5)).ToString();
                                                            thnAwal = (int.Parse(thn) - 1).ToString();
                                                        }

                                                        for (int i = 1; i <= 6; i++)
                                                        {
                                                            c.Bound(DateTime.Parse("01/" + blnAwal.ToString() + "/2016").ToString("MMMM").Replace("Nopember", "November") + "_PTPN8").Hidden()
                                                                .Width(80)
                                                                .HtmlAttributes(new { style = "text-align: right;" })
                                                                .ClientGroupFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                                .ClientFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                                .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black;  background: silver;" });

                                                            blnAwal = (int.Parse(blnAwal) + 1).ToString();
                                                            if (int.Parse(blnAwal) > 12)
                                                            {
                                                                blnAwal = "1";
                                                                thnAwal = (int.Parse(thnAwal) + 1).ToString();
                                                            }
                                                        }
                                                    }
                                                })

                                              .DataSource(d => d
                                                  .Ajax()
                                                  .Read(r => r.Action("ProtasPerKebun", "ProduktivitasTehPerTahun").Data("getKebunData"))
                                                  .Group(g => g.Add(p => p.Wilayah))
                                                  .Model(m => m.Id(p => p.Id))
                                                  .Aggregates(ag =>
                                                  {
                                                      ag.Add(o => o.LuasAreal).Sum();
                                                      ag.Add(o => o.LuasArealInduk).Sum();
                                                      ag.Add(o => o.Januari_Real).Sum();
                                                      ag.Add(o => o.Februari_Real).Sum();
                                                      ag.Add(o => o.Maret_Real).Sum();
                                                      ag.Add(o => o.April_Real).Sum();
                                                      ag.Add(o => o.Mei_Real).Sum();
                                                      ag.Add(o => o.Juni_Real).Sum();
                                                      ag.Add(o => o.Juli_Real).Sum();
                                                      ag.Add(o => o.Agustus_Real).Sum();
                                                      ag.Add(o => o.September_Real).Sum();
                                                      ag.Add(o => o.Oktober_Real).Sum();
                                                      ag.Add(o => o.November_Real).Sum();
                                                      ag.Add(o => o.Desember_Real).Sum();
                                                      ag.Add(o => o.Januari_PTPN8).Sum();
                                                      ag.Add(o => o.Februari_PTPN8).Sum();
                                                      ag.Add(o => o.Maret_PTPN8).Sum();
                                                      ag.Add(o => o.April_PTPN8).Sum();
                                                      ag.Add(o => o.Mei_PTPN8).Sum();
                                                      ag.Add(o => o.Juni_PTPN8).Sum();
                                                      ag.Add(o => o.Juli_PTPN8).Sum();
                                                      ag.Add(o => o.Agustus_PTPN8).Sum();
                                                      ag.Add(o => o.September_PTPN8).Sum();
                                                      ag.Add(o => o.Oktober_PTPN8).Sum();
                                                      ag.Add(o => o.November_PTPN8).Sum();
                                                      ag.Add(o => o.Desember_PTPN8).Sum();
                                                      ag.Add(o => o.MABelow_Sem1).Average();
                                                      ag.Add(o => o.MABelow_Sem2).Average();
                                                      ag.Add(o => o.MATime_Sem1).Average();
                                                      ag.Add(o => o.MATime_Sem2).Average();
                                                  })
                                          ))

                                    </div>
                                    <div class="LayerAfdeling">
                                        @(Html.Kendo().Grid<Ptpn8.Areas.Areal.Models.ProduktivitasPerAfdeling>().Name("grdDataAfdeling")
                                                .Sortable()
                                                .Scrollable()
                                                .Groupable()
                                                .Selectable()
                                                .Resizable(resizeable => resizeable.Columns(true))
                                                .Events(e =>
                                                {
                                                    e.DataBound("grdDataAfdelingOnDataBound"); e.Change("grdDataAfdelingOnChange");
                                                })
                                                .HtmlAttributes(new { style = "height: 600px;" })
                                                .ToolBar(tools => tools.Excel())
                                                .AutoBind(false)
                                                .Excel(excel => excel
                                                    .FileName("ProtasAfdeling.xlsx")
                                                    .Filterable(true)
                                                    .AllPages(true)
                                                    .ProxyURL(Url.Action("Excel_Export_Save", "Home"))
                                                )
                                                .Columns(c =>
                                                {
                                                    c.Bound(o => o.Id).Hidden();
                                                    c.Bound(o => o.Kebun).HeaderTemplate("Kebun").Width(100).Groupable(true).Hidden();
                                                    c.Bound(o => o.Afdeling).HeaderTemplate("Afdeling").Locked(true).Width(150);
                                                    c.Bound(o => o.TahunTanam).HeaderTemplate("Tahun Tanam").Locked(false).Width(50).Groupable(true).HtmlAttributes(new { style = "text-align: center;" });
                                                    c.Bound(o => o.LuasAreal).HeaderTemplate("Luas (Ha)").Width(50).Format("{0:n2}").HtmlAttributes(new { style = "text-align: right;" })
                                                      .ClientGroupFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                      .ClientFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                      .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black; font-size: medium; background: silver;" });
                                                    c.Bound(o => o.LuasArealInduk).Locked(false).HeaderTemplate("Luas (Ha)").Width(80).Format("{0:n2}").HtmlAttributes(new { style = "text-align: right;" })
                                                        .Hidden()
                                                      .Width(120)
                                                      .ClientGroupFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                      .ClientFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                      .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black;  background: silver;" });

                                                    if (HttpContext.Current.Session["BulanView"] != null)
                                                    {
                                                        string bln = Convert.ToString(HttpContext.Current.Session["BulanView"]);
                                                        string thn = Convert.ToString(HttpContext.Current.Session["TahunView"]);
                                                        string blnAwal;
                                                        string thnAwal;
                                                        if (int.Parse(bln) - 5 > 0)
                                                        {
                                                            blnAwal = (int.Parse(bln) - 5).ToString();
                                                            thnAwal = thn;
                                                        }
                                                        else
                                                        {
                                                            blnAwal = (12 + (int.Parse(bln) - 5)).ToString();
                                                            thnAwal = (int.Parse(thn) - 1).ToString();
                                                        }

                                                        for (int i = 1; i <= 6; i++)
                                                        {
                                                            c.Bound(DateTime.Parse("01/" + blnAwal.ToString() + "/2016").ToString("MMMM").Replace("Nopember", "November") + "_Real")
                                                                .HeaderTemplate("<div>" + DateTime.Parse("01/" + blnAwal.ToString() + "/2016").ToString("MMMM") + "</div><div>" + thnAwal.ToString() + "</div>").Format("{0:n2}")
                                                                .ClientTemplate("<div>#= kendo.toString(" + DateTime.Parse("01/" + blnAwal.ToString() + "/2016").ToString("MMMM").Replace("Nopember", "November") + "_Real/LuasAreal,'n2') #</div><div>#= kendo.toString(" + DateTime.Parse("01/" + blnAwal.ToString() + "/2016").ToString("MMMM").Replace("Nopember", "November") + "_PTPN8/LuasArealInduk,'n2') #</div>")
                                                                .Width(80)
                                                                .HtmlAttributes(new { style = "text-align: right;" })
                                                                .ClientGroupFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                                .ClientFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                                .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black;  background: silver;" });

                                                            blnAwal = (int.Parse(blnAwal) + 1).ToString();
                                                            if (int.Parse(blnAwal) > 12)
                                                            {
                                                                blnAwal = "1";
                                                                thnAwal = (int.Parse(thnAwal) + 1).ToString();
                                                            }
                                                        }
                                                    }
                                                    c.Bound(q => q.MATime_Sem1).HeaderTemplate("MA Time").Format("{0:n0}")
                                                           .Width(50)
                                                           .HtmlAttributes(new { style = "text-align: right;" })
                                                           .ClientGroupFooterTemplate("#= kendo.toString(average,'n0') #")
                                                           .ClientFooterTemplate("#= kendo.toString(average,'n0') #")
                                                           .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black;  background: silver;" });
                                                    c.Bound(q => q.MABelow_Sem1).HeaderTemplate("MA Below").Format("{0:p0}")
                                                           .Width(50)
                                                           .HtmlAttributes(new { style = "text-align: right;" })
                                                           .ClientGroupFooterTemplate("#= kendo.toString(average,'n0') #")
                                                           .ClientFooterTemplate("#= kendo.toString(average,'n0') #")
                                                           .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black;  background: silver;" });

                                                    if (HttpContext.Current.Session["BulanView"] != null)
                                                    {
                                                        string bln = Convert.ToString(HttpContext.Current.Session["BulanView"]);
                                                        string thn = Convert.ToString(HttpContext.Current.Session["TahunView"]);
                                                        string blnAwal;
                                                        string thnAwal;
                                                        if (int.Parse(bln) - 5 > 0)
                                                        {
                                                            blnAwal = (int.Parse(bln) - 5).ToString();
                                                            thnAwal = thn;
                                                        }
                                                        else
                                                        {
                                                            blnAwal = (12 + (int.Parse(bln) - 5)).ToString();
                                                            thnAwal = (int.Parse(thn) - 1).ToString();
                                                        }

                                                        for (int i = 1; i <= 6; i++)
                                                        {
                                                            c.Bound(DateTime.Parse("01/" + blnAwal.ToString() + "/2016").ToString("MMMM").Replace("Nopember", "November") + "_PTPN8").Hidden()
                                                                .Width(80)
                                                                .HtmlAttributes(new { style = "text-align: right;" })
                                                                .ClientGroupFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                                .ClientFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                                .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black;  background: silver;" });

                                                            blnAwal = (int.Parse(blnAwal) + 1).ToString();
                                                            if (int.Parse(blnAwal) > 12)
                                                            {
                                                                blnAwal = "1";
                                                                thnAwal = (int.Parse(thnAwal) + 1).ToString();
                                                            }
                                                        }
                                                    }

                                                })
                                              .DataSource(d => d
                                                  .Ajax()
                                                  .Read(r => r.Action("ProtasPerAfdeling", "ProduktivitasTehPerTahun").Data("getAfdelingData"))
                                                  .Group(g => g.Add(p => p.Kebun))
                                                  .Model(m => m.Id(p => p.Id))
                                                  .Aggregates(ag =>
                                                  {
                                                      ag.Add(o => o.LuasAreal).Sum();
                                                      ag.Add(o => o.LuasArealInduk).Sum();
                                                      ag.Add(o => o.Januari_Real).Sum();
                                                      ag.Add(o => o.Februari_Real).Sum();
                                                      ag.Add(o => o.Maret_Real).Sum();
                                                      ag.Add(o => o.April_Real).Sum();
                                                      ag.Add(o => o.Mei_Real).Sum();
                                                      ag.Add(o => o.Juni_Real).Sum();
                                                      ag.Add(o => o.Juli_Real).Sum();
                                                      ag.Add(o => o.Agustus_Real).Sum();
                                                      ag.Add(o => o.September_Real).Sum();
                                                      ag.Add(o => o.Oktober_Real).Sum();
                                                      ag.Add(o => o.November_Real).Sum();
                                                      ag.Add(o => o.Desember_Real).Sum();
                                                      ag.Add(o => o.Januari_PTPN8).Sum();
                                                      ag.Add(o => o.Februari_PTPN8).Sum();
                                                      ag.Add(o => o.Maret_PTPN8).Sum();
                                                      ag.Add(o => o.April_PTPN8).Sum();
                                                      ag.Add(o => o.Mei_PTPN8).Sum();
                                                      ag.Add(o => o.Juni_PTPN8).Sum();
                                                      ag.Add(o => o.Juli_PTPN8).Sum();
                                                      ag.Add(o => o.Agustus_PTPN8).Sum();
                                                      ag.Add(o => o.September_PTPN8).Sum();
                                                      ag.Add(o => o.Oktober_PTPN8).Sum();
                                                      ag.Add(o => o.November_PTPN8).Sum();
                                                      ag.Add(o => o.Desember_PTPN8).Sum();
                                                      ag.Add(o => o.MABelow_Sem1).Average();
                                                      ag.Add(o => o.MABelow_Sem2).Average();
                                                      ag.Add(o => o.MATime_Sem1).Average();
                                                      ag.Add(o => o.MATime_Sem2).Average();

                                                  })
                                          ))


                                    </div>
                                    <div class="LayerBlok">
                                        @(Html.Kendo().Grid<Ptpn8.Areas.Areal.Models.ProduktivitasPerBlok>().Name("grdDataBlok")
                                                .Sortable()
                                                .Scrollable()
                                                .Groupable()
                                                .Selectable()
                                                .Resizable(resizeable => resizeable.Columns(true))
                                                .Events(e =>
                                                {
                                                    e.DataBound("grdDataBlokOnDataBound"); e.Change("grdDataBlokOnChange");
                                                })
                                                .HtmlAttributes(new { style = "height: 600px;" })
                                                .ToolBar(tools => tools.Excel())
                                                .AutoBind(false)
                                                .Excel(excel => excel
                                                    .FileName("ProtasBlok.xlsx")
                                                    .Filterable(true)
                                                    .AllPages(true)
                                                    .ProxyURL(Url.Action("Excel_Export_Save", "Home"))
                                                )
                                                .Columns(c =>
                                                {
                                                    c.Bound(o => o.Id).Hidden();
                                                    c.Bound(o => o.Afdeling).HeaderTemplate("Afdeling").Width(100).Groupable(true).Hidden();
                                                    c.Bound(o => o.Blok).HeaderTemplate("Blok").Locked(true).Width(150);
                                                    c.Bound(o => o.TahunTanam).HeaderTemplate("Tahun Tanam").Locked(false).Width(50).Groupable(true).HtmlAttributes(new { style = "text-align: center;" });
                                                    c.Bound(o => o.LuasAreal).HeaderTemplate("Luas (Ha)").Width(50).Format("{0:n2}").HtmlAttributes(new { style = "text-align: right;" })
                                                      .ClientGroupFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                      .ClientFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                      .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black; font-size: medium; background: silver;" });
                                                    c.Bound(o => o.LuasArealInduk).Locked(false).HeaderTemplate("Luas (Ha)").Width(80).Format("{0:n2}").HtmlAttributes(new { style = "text-align: right;" })
                                                      .Width(120)
                                                      .Hidden()
                                                      .ClientGroupFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                      .ClientFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                      .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black;  background: silver;" });
                                                    if (HttpContext.Current.Session["BulanView"] != null)
                                                    {
                                                        string bln = Convert.ToString(HttpContext.Current.Session["BulanView"]);
                                                        string thn = Convert.ToString(HttpContext.Current.Session["TahunView"]);
                                                        string blnAwal;
                                                        string thnAwal;
                                                        if (int.Parse(bln) - 5 > 0)
                                                        {
                                                            blnAwal = (int.Parse(bln) - 5).ToString();
                                                            thnAwal = thn;
                                                        }
                                                        else
                                                        {
                                                            blnAwal = (12 + (int.Parse(bln) - 5)).ToString();
                                                            thnAwal = (int.Parse(thn) - 1).ToString();
                                                        }

                                                        for (int i = 1; i <= 6; i++)
                                                        {
                                                            c.Bound(DateTime.Parse("01/" + blnAwal.ToString() + "/2016").ToString("MMMM").Replace("Nopember", "November") + "_Real")
                                                                .HeaderTemplate("<div>" + DateTime.Parse("01/" + blnAwal.ToString() + "/2016").ToString("MMMM") + "</div><div>" + thnAwal.ToString() + "</div>").Format("{0:n2}")
                                                                .ClientTemplate("<div>#= kendo.toString(" + DateTime.Parse("01/" + blnAwal.ToString() + "/2016").ToString("MMMM").Replace("Nopember", "November") + "_Real/LuasAreal,'n2') #</div><div>#= kendo.toString(" + DateTime.Parse("01/" + blnAwal.ToString() + "/2016").ToString("MMMM").Replace("Nopember", "November") + "_PTPN8/LuasArealInduk,'n2') #</div>")
                                                                .Width(80)
                                                                .HtmlAttributes(new { style = "text-align: right;" })
                                                                .ClientGroupFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                                .ClientFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                                .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black;  background: silver;" });

                                                            blnAwal = (int.Parse(blnAwal) + 1).ToString();
                                                            if (int.Parse(blnAwal) > 12)
                                                            {
                                                                blnAwal = "1";
                                                                thnAwal = (int.Parse(thnAwal) + 1).ToString();
                                                            }
                                                        }
                                                    }
                                                    c.Bound(q => q.MATime_Sem1).HeaderTemplate("MA Time").Format("{0:n0}")
                                                           .Width(50)
                                                           .HtmlAttributes(new { style = "text-align: right;" })
                                                           .ClientGroupFooterTemplate("#= kendo.toString(average,'n0') #")
                                                           .ClientFooterTemplate("#= kendo.toString(average,'n0') #")
                                                           .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black;  background: silver;" });
                                                    c.Bound(q => q.MABelow_Sem1).HeaderTemplate("MA Below").Format("{0:p0}")
                                                           .Width(50)
                                                           .HtmlAttributes(new { style = "text-align: right;" })
                                                           .ClientGroupFooterTemplate("#= kendo.toString(average,'p0') #")
                                                           .ClientFooterTemplate("#= kendo.toString(average,'n0') #")
                                                           .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black;  background: silver;" });
                                                    if (HttpContext.Current.Session["BulanView"] != null)
                                                    {
                                                        string bln = Convert.ToString(HttpContext.Current.Session["BulanView"]);
                                                        string thn = Convert.ToString(HttpContext.Current.Session["TahunView"]);
                                                        string blnAwal;
                                                        string thnAwal;
                                                        if (int.Parse(bln) - 5 > 0)
                                                        {
                                                            blnAwal = (int.Parse(bln) - 5).ToString();
                                                            thnAwal = thn;
                                                        }
                                                        else
                                                        {
                                                            blnAwal = (12 + (int.Parse(bln) - 5)).ToString();
                                                            thnAwal = (int.Parse(thn) - 1).ToString();
                                                        }

                                                        for (int i = 1; i <= 6; i++)
                                                        {
                                                            c.Bound(DateTime.Parse("01/" + blnAwal.ToString() + "/2016").ToString("MMMM").Replace("Nopember", "November") + "_PTPN8").Hidden()
                                                                .Width(80)
                                                                .HtmlAttributes(new { style = "text-align: right;" })
                                                                .ClientGroupFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                                .ClientFooterTemplate("#= kendo.toString(sum,'n2') #")
                                                                .FooterHtmlAttributes(new { style = "text-align: right; font-weight: 500; color: black;  background: silver;" });

                                                            blnAwal = (int.Parse(blnAwal) + 1).ToString();
                                                            if (int.Parse(blnAwal) > 12)
                                                            {
                                                                blnAwal = "1";
                                                                thnAwal = (int.Parse(thnAwal) + 1).ToString();
                                                            }
                                                        }
                                                    }
                                                })

                                              .DataSource(d => d
                                                  .Ajax()
                                                  .Read(r => r.Action("ProtasPerBlok", "ProduktivitasTehPerTahun").Data("getBlokData"))
                                                  .Group(g => g.Add(p => p.Afdeling))
                                                  .Model(m => m.Id(p => p.Id))
                                                  .Aggregates(ag =>
                                                  {
                                                      ag.Add(o => o.LuasAreal).Sum();
                                                      ag.Add(o => o.LuasArealInduk).Sum();
                                                      ag.Add(o => o.Januari_Real).Sum();
                                                      ag.Add(o => o.Februari_Real).Sum();
                                                      ag.Add(o => o.Maret_Real).Sum();
                                                      ag.Add(o => o.April_Real).Sum();
                                                      ag.Add(o => o.Mei_Real).Sum();
                                                      ag.Add(o => o.Juni_Real).Sum();
                                                      ag.Add(o => o.Juli_Real).Sum();
                                                      ag.Add(o => o.Agustus_Real).Sum();
                                                      ag.Add(o => o.September_Real).Sum();
                                                      ag.Add(o => o.Oktober_Real).Sum();
                                                      ag.Add(o => o.November_Real).Sum();
                                                      ag.Add(o => o.Desember_Real).Sum();
                                                      ag.Add(o => o.Januari_PTPN8).Sum();
                                                      ag.Add(o => o.Februari_PTPN8).Sum();
                                                      ag.Add(o => o.Maret_PTPN8).Sum();
                                                      ag.Add(o => o.April_PTPN8).Sum();
                                                      ag.Add(o => o.Mei_PTPN8).Sum();
                                                      ag.Add(o => o.Juni_PTPN8).Sum();
                                                      ag.Add(o => o.Juli_PTPN8).Sum();
                                                      ag.Add(o => o.Agustus_PTPN8).Sum();
                                                      ag.Add(o => o.September_PTPN8).Sum();
                                                      ag.Add(o => o.Oktober_PTPN8).Sum();
                                                      ag.Add(o => o.November_PTPN8).Sum();
                                                      ag.Add(o => o.Desember_PTPN8).Sum();
                                                      ag.Add(o => o.MABelow_Sem1).Average();
                                                      ag.Add(o => o.MABelow_Sem2).Average();
                                                      ag.Add(o => o.MATime_Sem1).Average();
                                                      ag.Add(o => o.MATime_Sem2).Average();

                                                  })
                                          ))


                                    </div>

                                    </text>);
                                })
)

<script type="text/javascript">
var chkPopUp, chkKebun, chkStreetMap, chkCitra, chkKontur;
var tahun, bulan;
var map, activeLayer;
var shapeKlik;
var statusAreal, kebunID, budidaya, masaBerlakuHGU, textSearch, loadDataKebun;
var lokasiID, lokasiKebunID, lokasiAfdelingID, lokasiBlokID;
var indexStreetMap = 0;
var indexKontur = 1;
var indexCitra = 2;
var indexKebun = 3;
var indexAfdeling = 4;
var indexBlok = 5;
var mapExtent;
var inputProject;
var warnaKebun, warnaAfdeling, warnaBlok;

var popup = $("<div>Foo</div>")
    .appendTo(document.body)
    .kendoPopup()
    .data("kendoPopup");

$(document).ajaxStart(function () {
    $("#progress").show();
}).ajaxStop(function () {
    $("#progress").hide();
});

$(document).ready(function () {
    bulan = $('#ddlBulan').data('kendoDropDownList').value();
    tahun = $('#txtTahun').val();
    $('#lblBulan').val($('#ddlBulan').data('kendoDropDownList').text() + '-' + $('#txtTahun').val());

    chkPopUp = false;
    chkKebun = true;
    chkStreetMap = true;
    chkCitra = false;
    chkKontur = false;
    warnaKebun = "";
    warnaAfdeling = "";
    warnaBlok = "";
    lokasiID = "";

    statusAreal = "0";
    budidaya = '';
    textSearch = "";
    masaBerlakuHGU = "0"
    shapeKlik = false;

    activeLayer = '@HttpContext.Current.Session["ActiveLayer"]';

    inputProject = false;
    map = $('#map').data('kendoMap');

    for (var i = 0; i < map.layers.length; i++) {
        var lyr = map.layers[i];
        if (i == 0 || i == 3) {
            //if (i == 3) lyr.dataSource.read();
            lyr.show();
        } else lyr.hide();
    }

    if (activeLayer == "Kebun") {
        warnaKebun = "";
        //map.layers[indexKebun].dataSource.read();
        map.layers[indexBlok].hide();
        map.layers[indexAfdeling].hide();
        map.layers[indexKebun].show();
    }
    else if (activeLayer == "Afdeling") {
        warnaKebun = "lightgray";
        lokasiKebunID = '@HttpContext.Current.Session["KebunId"]';
        _cariLokasi(lokasiKebunID, 'Kebun').done(function (result) {
            if (result[0] != '') {
                var loc1 = new kendo.dataviz.map.Location(result[2], result[1]);
                var loc2 = new kendo.dataviz.map.Location(result[4], result[3]);
                var extent = new kendo.dataviz.map.Extent(loc1, loc2);
                activeLayer = "Afdeling";
                warnaAfdeling = "";
                map.layers[indexAfdeling].show();
                mapExtent = extent;
                map.extent(extent);
                map.zoom(12);
            }
        });
    }
    else if (activeLayer == "Blok") {
        warnaKebun = "lightgray";
        lokasiKebunID = '@HttpContext.Current.Session["KebunId"]';
        map.layers[indexKebun].show();
        warnaAfdeling = "lightgray";
        map.layers[indexAfdeling].show();
        lokasiAfdelingID = '@HttpContext.Current.Session["AfdelingId"]';
        _cariLokasi(lokasiAfdelingID, 'Afdeling').done(function (result) {
            if (result[0] != '') {
                var loc1 = new kendo.dataviz.map.Location(result[2], result[1]);
                var loc2 = new kendo.dataviz.map.Location(result[4], result[3]);
                var extent = new kendo.dataviz.map.Extent(loc1, loc2);
                activeLayer = "Blok";
                warnaBlok = "";
                map.layers[indexBlok].show();
                mapExtent = extent;
                map.extent(extent);
                map.zoom(14);
            }
        });
    }
    loadDataKebun = true;
    resetGridData();
});

function _cariLokasi(_id,_key)
{
    var url = '../Areal/Home/cariLokasi';
    return $.ajax({
        url: url,
        data: {
            id: _id,
            key: _key
        }, //parameters go here in object literal form
        type: 'GET',
        datatype: 'json'
    });
}

function onShapeCreated(e) {
    var shape = e.shape;
    shape.options.fill.set("color", shape.dataItem.properties.COLOR);
}

function onShapeMouseEnter(e) {
    e.shape.options.set("fill.opacity", 0.7);
    var oe = e.originalEvent;
    var x = oe.pageX || oi.clientX;
    var y = oe.pageY || oi.clientY;
    var name = e.shape.dataItem.properties.NAMA_KEBUN;
    $('#NamaLokasi').val(name);

    popup.element.html("<h4>" + name + "</h4>" +
                "<table>" +
                "<tr>" +
                    "<td width='100px' style='font-weight: 500;'>MA Time</td>" +
                    "<td width='50px' style='text-align: right; font-weight: 500;'>" + kendo.toString(e.shape.dataItem.properties.VALUE1, 'n0') + " X</td>" +
                "</tr>" +
                "<tr>" +
                    "<td style='font-weight: 500;'>MA Below</td>" +
                    "<td style='text-align: right; font-weight: 500;'>" + kendo.toString(e.shape.dataItem.properties.VALUE2, 'p0') + " </td>" +
                "</tr>" +
                "</table>"
                );
    popup.open(x, y);
}

function onShapeMouseLeave(e) {
    e.shape.options.set("fill.opacity", 1);
    if (!$(e.originalEvent.relatedTarget).is(".k-popup, .k-animation-container")) {
        if (!chkPopUp) {
            popup.close();
            popup.element.kendoStop(true, true);
        }
    }
}

function onMarkerClick(e) {

}

function onMapClick(e) {
    var map = $('#map').data('kendoMap');
    if (activeLayer == "Kebun") {
    }
    else if (activeLayer == "Afdeling" && !shapeKlik) {
        activeLayer = "Kebun";
        warnaKebun = "";
        //map.layers[indexKebun].dataSource.read();
        map.layers[indexAfdeling].hide();
        map.extent(mapExtent);
        map.zoom(12);
        resetGridData();
    }
    else if (activeLayer == "Blok" && !shapeKlik) {
        activeLayer = "Afdeling";
        warnaAfdeling = "";
        //map.layers[indexAfdeling].dataSource.read();
        map.layers[indexBlok].hide();
        map.extent(mapExtent);
        map.zoom(14);
        resetGridData();
    }
    shapeKlik = false;
}

function onShapeClick(e) {
    var map = $('#map').data('kendoMap');
    var loc1 = new kendo.dataviz.map.Location(e.shape.dataItem.properties.TOPLEFT_Y, e.shape.dataItem.properties.TOPLEFT_X);
    var loc2 = new kendo.dataviz.map.Location(e.shape.dataItem.properties.BOTTOMRIGHT_Y, e.shape.dataItem.properties.BOTTOMRIGHT_X);
    var extent = new kendo.dataviz.map.Extent(loc1, loc2);
    shapeKlik = true;

    if (activeLayer == "Kebun") {
        activeLayer = "Afdeling";
        warnaKebun = "lightgray";
        lokasiKebunID = e.shape.dataItem.properties.ID;
        //map.layers[indexKebun].dataSource.read();
        var lyr = map.layers[indexAfdeling];
        //lyr.dataSource.data([]);
        //lyr.dataSource.read();
        map.extent(extent);
        mapExtent = extent;
        lyr.show();
        resetGridData();
    }
    else if (activeLayer == "Afdeling") {
        activeLayer = "Blok";
        warnaAfdeling = "lightgray";
        lokasiAfdelingID = e.shape.dataItem.properties.ID;
        //map.layers[indexAfdeling].dataSource.read();
        var lyr = map.layers[indexBlok];
        //lyr.dataSource.data([]);
        //lyr.dataSource.read();
        map.extent(extent);
        mapExtent = extent;
        lyr.show();
        resetGridData();
    } else if (activeLayer == "Blok") {
        lokasiBlokID = e.shape.dataItem.properties.ID;
    }
}

function chkPopUpOnChange(e) {
    if (chkPopUp) chkPopUp = false; else chkPopUp = true;
}

function chkKebunOnChange(e) {
    var map = $('#map').data('kendoMap');
    if (chkKebun) {
        chkKebun = false;
        map.layers[indexKebun].hide();
        map.layers[indexAfdeling].hide();
        map.layers[indexBlok].hide();
    }
    else {
        chkKebun = true;
        if (activeLayer == "Kebun") {
            map.layers[indexKebun].show();
            map.layers[indexAfdeling].hide();
            map.layers[indexBlok].hide();
        }
        else if (activeLayer == "Afdeling") {
            map.layers[indexKebun].hide();
            map.layers[indexAfdeling].show();
            map.layers[indexBlok].hide();
        }
        else if (activeLayer == "Blok") {
            map.layers[indexKebun].hide();
            map.layers[indexAfdeling].show();
            map.layers[indexBlok].show();
        }
    }
}

function chkStreetMapOnChange(e) {
    var map = $('#map').data('kendoMap');
    if (chkStreetMap) {
        chkStreetMap = false;
        map.layers[indexStreetMap].hide();
    }
    else {
        chkStreetMap = true;
        map.layers[indexStreetMap].show();
    }
}

function chkKonturOnChange(e) {
    var map = $('#map').data('kendoMap');
    if (chkKontur) {
        chkKontur = false;
        map.layers[indexKontur].hide();
    }
    else {
        chkKontur = true;
        map.layers[indexKontur].show();
    }
}

function chkCitraOnChange(e) {
    var map = $('#map').data('kendoMap');
    if (chkCitra) {
        chkCitra = false;
        map.layers[indexCitra].hide();
    }
    else {
        chkCitra = true;
        map.layers[indexCitra].show();
    }
}

function perbandinganOnChange(e) {
    var map = $('#map').data('kendoMap');

    if (typeof map != 'undefined') {
        if (activeLayer == 'Kebun') {
            map.layers[indexKebun].dataSource.read().done(function () {
                $('#ChartProtasTehKebunBI').data('kendoChart').dataSource.read().done(function () {
                    $('#ChartProtasTehKebunSBI').data('kendoChart').dataSource.read().done(function () {
                        refreshgrdDataKebun();
                        if ($("input[name=perbandingan]:checked").val() == "Induk") {
                            $('.lblPerbandingan').text('Protas Rata-Rata PTPN-VIII');
                        }
                        else if ($("input[name=perbandingan]:checked").val() == "RKAP") {
                            $('.lblPerbandingan').text('Protas RKAP Kebun');
                        }
                        else if ($("input[name=perbandingan]:checked").val() == "PKB") {
                            $('.lblPerbandingan').text('Protas PKB Kebun');
                        }
                        else {
                            $('.lblPerbandingan').text('Protas Rata-Rata Standar Balai');
                        }
                    });
                });
            });
        }
        else if (activeLayer == 'Afdeling') {
            map.layers[indexAfdeling].dataSource.read().done(function () {
                $('#ChartProtasTehAfdelingBI').data('kendoChart').dataSource.read().done(function () {
                    $('#ChartProtasTehAfdelingSBI').data('kendoChart').dataSource.read().done(function () {
                        refreshgrdDataAfdeling();
                        if ($("input[name=perbandingan]:checked").val() == "Induk") {
                            $('.lblPerbandingan').text('Protas Rata-Rata Kebun');
                        }
                        else if ($("input[name=perbandingan]:checked").val() == "RKAP") {
                            $('.lblPerbandingan').text('Protas RKAP Afdeling');
                        }
                        else if ($("input[name=perbandingan]:checked").val() == "PKB") {
                            $('.lblPerbandingan').text('Protas PKB Afdeling');
                        }
                        else {
                            $('.lblPerbandingan').text('Protas Rata-Rata Standar Balai');
                        }
                    });
                });
            });

        }
        else {
            map.layers[indexBlok].dataSource.read().done(function () {
                $('#ChartProtasTehBlokBI').data('kendoChart').dataSource.read().done(function () {
                    $('#ChartProtasTehBlokSBI').data('kendoChart').dataSource.read().done(function () { 
                        refreshgrdDataBlok();
                        if ($("input[name=perbandingan]:checked").val() == "Induk") {
                            $('.lblPerbandingan').text('Protas Rata-Rata Afdeling');
                        }
                        else if ($("input[name=perbandingan]:checked").val() == "RKAP") {
                            $('.lblPerbandingan').text('Protas RKAP Blok');
                        }
                        else if ($("input[name=perbandingan]:checked").val() == "PKB") {
                            $('.lblPerbandingan').text('Protas PKB Blok');
                        }
                        else {
                            $('.lblPerbandingan').text('Protas Rata-Rata Standar Balai');
                        }
                    });
                });
            });

        }
    }
}

function grdLegendKebunOnDataBound(e) {}

function grdLegendKebunOnChange(e) {
    var data = this.dataItem(this.select());
    var id = data.KebunId;
    cariLokasi(id, "Kebun");
}

function grdLegendAfdelingOnDataBound(e) { }

function grdLegendAfdelingOnChange(e) {
    var data = this.dataItem(this.select());
    var id = data.Id;
    cariLokasi(id, "Afdeling");
}

function grdLegendBlokOnDataBound(e) { }

function grdLegendBlokOnChange(e) {
    var data = this.dataItem(this.select());
    var id = data.Id;
    cariLokasi(id, "Blok");
}

function grdLegendCariOnDataBound(e) {}

function grdLegendCariOnChange(e) {
    var data = this.dataItem(this.select());
    var id = data.Id;
    var lyrKey = data.Warna;
    lokasiID = data.IdInduk;
    cariLokasi(id, lyrKey);
}

function grdDataKebunOnDataBound(e) {
    refreshgrdDataKebun();
    $('#ChartProtasTehKebunBI').data('kendoChart').dataSource.read().done(function () { 
        $('#ChartProtasTehKebunSBI').data('kendoChart').dataSource.read();
    });
}

function grdDataKebunOnChange(e) {
    var data = this.dataItem(this.select());
    var id = data.Id;
    cariLokasi(id, "Kebun");
}

function refreshgrdDataKebun() {
    var grd = $('#grdDataKebun').data('kendoGrid');
    var rows = grd.tbody.children();
    var RealProduksiBI = 0;
    var RealProduksiSBI = 0;
    var RKAPProduksiBI = 0;
    var RKAPProduksiSBI = 0;
    var semester = 0;

    if (parseInt(bulan) <= 6) semester = 1; else semester = 2;

    for (var j = 0; j < rows.length; j++) {
        var row = $(rows[j]);
        var dataItem = grd.dataItem(row);
        var warna = "";
        warna = dataItem.Warna_Sem1;

        row.removeClass("WarnaHijau");
        row.removeClass("WarnaBiru");
        row.removeClass("WarnaMerah");
        row.removeClass("WarnaKuning");

        if (warna == "green") {
            row.addClass("WarnaHijau");
        }
        else if (warna == "yellow") {
            row.addClass("WarnaKuning");
        }
        else if (warna == "orange") {
            row.addClass("WarnaBiru");
        }
        else {
            row.addClass("WarnaMerah");
        }
        DisplayJumlah(row);
    }

    var row = grd.footer.find(".k-grid-footer-wrap .k-footer-template");
    DisplayJumlah(row);

}

function DisplayJumlah(row)
{
    if (row.hasClass("k-group-footer") || row.hasClass("k-footer-template")) {
        var luasAreal = parseFloat(row.find("td:nth-child(3)").text().replaceAll(".", "").replaceAll(",", "."));       // luas areal ybs
        var luasArealInduk = parseFloat(row.find("td:nth-child(4)").text().replaceAll(".", "").replaceAll(",", "."));       // luas areal induk
        var kgJan = parseFloat(row.find("td:nth-child(5)").text().replaceAll(".", "").replaceAll(",", "."));       // hasil panen ybs Jan
        var kgFeb = parseFloat(row.find("td:nth-child(6)").text().replaceAll(".", "").replaceAll(",", "."));       // hasil panen ybs Feb
        var kgMar = parseFloat(row.find("td:nth-child(7)").text().replaceAll(".", "").replaceAll(",", "."));       // hasil panen ybs Mar
        var kgApr = parseFloat(row.find("td:nth-child(8)").text().replaceAll(".", "").replaceAll(",", "."));       // hasil panen ybs Apr
        var kgMei = parseFloat(row.find("td:nth-child(9)").text().replaceAll(".", "").replaceAll(",", "."));       // hasil panen ybs Mei
        var kgJun = parseFloat(row.find("td:nth-child(10)").text().replaceAll(".", "").replaceAll(",", "."));       // hasil panen ybs Jun

        var kgJanInduk = parseFloat(row.find("td:nth-child(13)").text().replaceAll(".", "").replaceAll(",", "."));       // hasil panen ybs Jan
        var kgFebInduk = parseFloat(row.find("td:nth-child(14)").text().replaceAll(".", "").replaceAll(",", "."));       // hasil panen ybs Feb
        var kgMarInduk = parseFloat(row.find("td:nth-child(15)").text().replaceAll(".", "").replaceAll(",", "."));       // hasil panen ybs Mar
        var kgAprInduk = parseFloat(row.find("td:nth-child(16)").text().replaceAll(".", "").replaceAll(",", "."));       // hasil panen ybs Apr
        var kgMeiInduk = parseFloat(row.find("td:nth-child(17)").text().replaceAll(".", "").replaceAll(",", "."));       // hasil panen ybs Mei
        var kgJunInduk = parseFloat(row.find("td:nth-child(18)").text().replaceAll(".", "").replaceAll(",", "."));       // hasil panen ybs Jun

        var result = 0;
        result = kgJan / luasAreal;
        row.find("td:nth-child(5)").html('<div>' + kendo.toString(result, 'n2') + '</div><div>' + kendo.toString(kgJanInduk / luasArealInduk, 'n2') + '</div>');
        result = kgFeb / luasAreal;
        row.find("td:nth-child(6)").html('<div>' + kendo.toString(result, 'n2') + '</div><div>' + kendo.toString(kgFebInduk / luasArealInduk, 'n2') + '</div>');
        result = kgMar / luasAreal;
        row.find("td:nth-child(7)").html('<div>' + kendo.toString(result, 'n2') + '</div><div>' + kendo.toString(kgMarInduk / luasArealInduk, 'n2') + '</div>');
        result = kgApr / luasAreal;
        row.find("td:nth-child(8)").html('<div>' + kendo.toString(result, 'n2') + '</div><div>' + kendo.toString(kgAprInduk / luasArealInduk, 'n2') + '</div>');
        result = kgMei / luasAreal;
        row.find("td:nth-child(9)").html('<div>' + kendo.toString(result, 'n2') + '</div><div>' + kendo.toString(kgMeiInduk / luasArealInduk, 'n2') + '</div>');
        result = kgJun / luasAreal;
        row.find("td:nth-child(10)").html('<div>' + kendo.toString(result, 'n2') + '</div><div>' + kendo.toString(kgJunInduk / luasArealInduk, 'n2') + '</div>');

        var matime = 0;
        if ((kgJan / luasAreal) - (kgJanInduk / luasArealInduk) < 0) matime = matime + 1;
        if ((kgFeb / luasAreal) - (kgFebInduk / luasArealInduk) < 0) matime = matime + 1;
        if ((kgMar / luasAreal) - (kgMarInduk / luasArealInduk) < 0) matime = matime + 1;
        if ((kgApr / luasAreal) - (kgAprInduk / luasArealInduk) < 0) matime = matime + 1;
        if ((kgMei / luasAreal) - (kgMeiInduk / luasArealInduk) < 0) matime = matime + 1;
        if ((kgJun / luasAreal) - (kgJunInduk / luasArealInduk) < 0) matime = matime + 1;
        row.find("td:nth-child(11)").html('<div>' + kendo.toString(matime, 'n0') + '</div>');

        var mabelow1 = 0;
        var mabelow2 = 0;
        if ((kgJan / luasAreal) - (kgJanInduk / luasArealInduk) < 0) mabelow1 = mabelow1 + (((kgJan / luasAreal) - (kgJanInduk / luasArealInduk)) * -1);
        if ((kgFeb / luasAreal) - (kgFebInduk / luasArealInduk) < 0) mabelow1 = mabelow1 + (((kgFeb / luasAreal) - (kgFebInduk / luasArealInduk)) * -1);
        if ((kgMar / luasAreal) - (kgMarInduk / luasArealInduk) < 0) mabelow1 = mabelow1 + (((kgMar / luasAreal) - (kgMarInduk / luasArealInduk)) * -1);
        if ((kgApr / luasAreal) - (kgAprInduk / luasArealInduk) < 0) mabelow1 = mabelow1 + (((kgApr / luasAreal) - (kgAprInduk / luasArealInduk)) * -1);
        if ((kgMei / luasAreal) - (kgMeiInduk / luasArealInduk) < 0) mabelow1 = mabelow1 + (((kgMei / luasAreal) - (kgMeiInduk / luasArealInduk)) * -1);
        if ((kgJun / luasAreal) - (kgJunInduk / luasArealInduk) < 0) mabelow1 = mabelow1 + (((kgJun / luasAreal) - (kgJunInduk / luasArealInduk)) * -1);

        mabelow2 = (kgJanInduk / luasArealInduk) + (kgFebInduk / luasArealInduk) + (kgMarInduk / luasArealInduk) + (kgAprInduk / luasArealInduk) + (kgMeiInduk / luasArealInduk) + (kgJunInduk / luasArealInduk);
        if (mabelow2 > 0) {
            var mabelow = mabelow1 / mabelow2;
            row.find("td:nth-child(12)").html('<div>' + kendo.toString(mabelow, 'p0') + '</div>');
        }
    }
}


function grdDataAfdelingOnDataBound(e) {
    refreshgrdDataAfdeling();
    $('#ChartProtasTehAfdelingBI').data('kendoChart').dataSource.read().done(function(){
        $('#ChartProtasTehAfdelingSBI').data('kendoChart').dataSource.read();
    });
}

function refreshgrdDataAfdeling() {
    var grd = $('#grdDataAfdeling').data('kendoGrid');
    var rows = grd.tbody.children();
    var semester = 0;
    if (parseInt(bulan) <= 6) semester = 1; else semester = 2;

    for (var j = 0; j < rows.length; j++) {
        var row = $(rows[j]);
        var dataItem = grd.dataItem(row);
        var warna = "";
        warna = dataItem.Warna_Sem1;

        row.removeClass("WarnaHijau");
        row.removeClass("WarnaBiru");
        row.removeClass("WarnaMerah");
        row.removeClass("WarnaKuning");

        if (warna == "green") {
            row.addClass("WarnaHijau");
        }
        else if (warna == "yellow") {
            row.addClass("WarnaKuning");
        }
        else if (warna == "orange") {
            row.addClass("WarnaBiru");
        }
        else {
            row.addClass("WarnaMerah");
        }
        DisplayJumlah(row);
    }
    var row = grd.footer.find(".k-grid-footer-wrap .k-footer-template");
    DisplayJumlah(row);

}

function grdDataAfdelingOnChange(e) {
    var data = this.dataItem(this.select());
    var id = data.Id;
    cariLokasi(id, "Afdeling");
}

function refreshgrdDataBlok()
{
    var grd = $('#grdDataBlok').data('kendoGrid');
    var rows = grd.tbody.children();
    var semester = 0;
    if (parseInt(bulan) <= 6) semester = 1; else semester = 2;

    for (var j = 0; j < rows.length; j++) {
        var row = $(rows[j]);
        var dataItem = grd.dataItem(row);
        var warna = "";
        warna = dataItem.Warna_Sem1;

        row.removeClass("WarnaHijau");
        row.removeClass("WarnaBiru");
        row.removeClass("WarnaMerah");
        row.removeClass("WarnaKuning");

        if (warna == "green") {
            row.addClass("WarnaHijau");
        }
        else if (warna == "yellow") {
            row.addClass("WarnaKuning");
        }
        else if (warna == "orange") {
            row.addClass("WarnaBiru");
        }
        else {
            row.addClass("WarnaMerah");
        }
        DisplayJumlah(row);
    }
    var row = grd.footer.find(".k-grid-footer-wrap .k-footer-template");
    DisplayJumlah(row);

}

function grdDataBlokOnDataBound(e) {
    refreshgrdDataBlok();
    $('#ChartProtasTehBlokBI').data('kendoChart').dataSource.read().done(function () {
        $('#ChartProtasTehBlokSBI').data('kendoChart').dataSource.read();
    });
}

function grdDataBlokOnChange(e) {
    var data = this.dataItem(this.select());
    var id = data.Id;
    cariLokasi(id, "Blok");
}

function cariLokasi(id, lyrKey) {
    var map = $('#map').data('kendoMap');
    {
        _cariLokasi(id, lyrKey).done(function (result) {
            if (result[0] != '') {
                var loc1 = new kendo.dataviz.map.Location(result[2], result[1]);
                var loc2 = new kendo.dataviz.map.Location(result[4], result[3]);
                var extent = new kendo.dataviz.map.Extent(loc1, loc2);
                if (lyrKey == "Kebun") {
                    if (lyrKey != activeLayer) {
                        activeLayer = "Kebun";
                        warnaKebun = "";
                        resetGridData();
                    }
                    mapExtent = extent;
                    map.extent(extent);
                    map.zoom(14);
                }
                else if (lyrKey == "Afdeling") {
                    if (lyrKey != activeLayer) {
                        activeLayer = "Afdeling";
                        warnaAfdeling = "";
                        resetGridData();
                    }
                    mapExtent = extent;
                    map.extent(extent);
                    map.zoom(15);

                }
                else if (lyrKey == "Blok") {
                    if (lyrKey != activeLayer) {
                        activeLayer = "Blok";
                        warnaBlok = "";
                        resetGridData();
                    }
                    mapExtent = extent;
                    map.extent(extent);
                    map.zoom(17);
                }
            }
        });
    }
}

function getKebunData() {
    return { Id: "", budidaya: budidaya, tahun: tahun, bulan: bulan}
}

function getAfdelingData() {
    return { Id: lokasiKebunID, budidaya: budidaya, tahun: tahun, bulan: bulan, perbandingan: $("input[name=perbandingan]:checked").val(), pctBalai: $('#txtBalai').val() }
}

function getBlokData() {
    return { Id: lokasiAfdelingID, budidaya: budidaya, tahun: tahun, bulan: bulan, perbandingan: $("input[name=perbandingan]:checked").val(), pctBalai: $('#txtBalai').val() }
}

function legendData() {
    return { Id: lokasiID, statusAreal: '1.1', budidaya: budidaya, tahun: tahun, bulan: bulan }
}

function legendCari() {
    return { cariText: $('#txtCari').val() }
}

function KebunGeoJsonData() {
    return { Id: lokasiID, budidaya: budidaya, tahun: tahun, bulan: bulan, warna: warnaKebun, perbandingan: $("input[name=perbandingan]:checked").val(), pctBalai: $('#txtBalai').val() }
}

function AfdelingGeoJsonData() {
    return { Id: lokasiKebunID, budidaya: budidaya, tahun: tahun, bulan: bulan, warna: warnaAfdeling, perbandingan: $("input[name=perbandingan]:checked").val(), pctBalai: $('#txtBalai').val() }
}

function BlokGeoJsonData() {
    return { Id: lokasiAfdelingID, budidaya: budidaya, tahun: tahun, bulan: bulan, warna: warnaBlok, perbandingan: $("input[name=perbandingan]:checked").val(), pctBalai: $('#txtBalai').val() }
}

function ddlBudidayaOnSelect(e) {
    //budidaya = $('#ddlBudidaya').data('kendoDropDownList').value();
    //loadDataKebun = true;
    //resetGridData();
}

function ddlBudidayaOnChange(e) {
    budidaya = $('#ddlBudidaya').data('kendoDropDownList').value();
    loadDataKebun = true;
    resetGridData();
}

function resetGridData() {

    var map = $('#map').data('kendoMap');

    if (activeLayer == "Kebun") {
        $('#grdDataKebun').data('kendoGrid').dataSource.read().done(function () {
            map.layers[indexKebun].dataSource.read().done(function () { 
                $('.LayerKebun').css('display', 'block');
                $('.LayerAfdeling').css('display', 'none');
                $('.LayerBlok').css('display', 'none');
            });
        });
    }
    else if (activeLayer == "Afdeling") {
        $('#grdDataAfdeling').data('kendoGrid').dataSource.read().done(function () { 
            warnaKebun = "lightgray";
            map.layers[indexKebun].dataSource.read().done(function () {
                map.layers[indexAfdeling].dataSource.read().done(function () {
                    $('.LayerKebun').css('display', 'none');
                    $('.LayerAfdeling').css('display', 'block');
                    $('.LayerBlok').css('display', 'none');
                });
            });
        });
    }
    else {
        $('#grdDataBlok').data('kendoGrid').dataSource.read().done(function () { 
            warnaKebun = "lightgray";
            map.layers[indexKebun].dataSource.read().done(function () { 
                warnaAfdeling = 'lightgray';
                map.layers[indexAfdeling].dataSource.read().done(function () {
                    map.layers[indexBlok].dataSource.read().done(function () {
                        $('.LayerKebun').css('display', 'none');
                        $('.LayerAfdeling').css('display', 'none');
                        $('.LayerBlok').css('display', 'block');
                    });
                });
            });
        });
    }
}

function btnSearchOnClick(e) {
    activeLayer = "Kebun";
    $('#grdLegendCari').data('kendoGrid').dataSource.read({ cariText: $('#txtCari').val() }).done(function () { 
        $('.legendKebun').css('display', 'none');
        $('.legendAfdeling').css('display', 'none');
        $('.legendBlok').css('display', 'none');
        $('.legendCari').css('display', 'block');
    });
}

function btnMapExportOnClick(e) {
    // Convert the DOM element to a drawing using kendo.drawing.drawDOM
    kendo.drawing.drawDOM($("#map"))
    .then(function (group) {
        // Render the result as a PNG image
        return kendo.drawing.exportImage(group);
    })
    .done(function (data) {
        // Save the image file
        kendo.saveAs({
            dataURI: data,
            fileName: "Map.png",
            proxyURL: "@Url.Action("Export_Save", "Home")"
        });
    });
}

function StringJSonDecode(value) {
    return value.replace(/"/g, '').replace("[", '').replace("]", '').replace(/,/g, ", ");
}

function ddlBulanChange(e) {
    e.preventDefault();
    bulan = $('#ddlBulan').data('kendoDropDownList').value();
    loadDataKebun = true;
    $('#lblBulan').val($('#ddlBulan').data('kendoDropDownList').text() + '-' + $('#txtTahun').val());
    _SetSessionValue().done(function () {
        location.reload();
    });
}

function _SetSessionValue()
{
    var url = '../Areal/ProduktivitasTehPerTahun/SetSessionValue';
    return $.ajax({
        url: url,
        data: {
            bulan: bulan,
            tahun: tahun,
            layer: activeLayer,
            lokasiKebun: getlokasiKebun(),
            lokasiAfdeling: getlokasiAfdeling()
        }, //parameters go here in object literal form
        type: 'POST',
        datatype: 'json'
    });
}
function getlokasiKebun()
{
    if(typeof lokasiKebunID != 'undefined')
    {
        return lokasiKebunID;
    }
    else
    {
        return "";
    }
}

function getlokasiAfdeling()
{
    if (typeof lokasiAfdelingID != 'undefined') {
        return lokasiAfdelingID;
    }
    else {
        return "";
    }

}

function ddlBulanSelect(e) {
    //bulan = $('#ddlBulan').data('kendoDropDownList').value();
    //loadDataKebun = true;
    //resetGridData();
}

function txtTahunChange(e) {
    tahun = $('#txtTahun').val();
    loadDataKebun = true;
    $('#lblBulan').val($('#ddlBulan').data('kendoDropDownList').text() + '-' + $('#txtTahun').val());
    _SetSessionValue().done(function () {
        location.reload();
    });
}

String.prototype.replaceAll = function (str1, str2, ignore) {
    return this.replace(new RegExp(str1.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g, "\\$&"), (ignore ? "gi" : "g")), (typeof (str2) == "string") ? str2.replace(/\$/g, "$$$$") : str2);
}

String.prototype.bulanIni =  function()
{
    return parseInt(bulan);
}
</script>


<style>
    #vertical {
        height: 600px;
        margin: 0 auto;
    }

    #middle-pane {
        background-color: rgba(60, 70, 80, 0.10);
    }

    #bottom-pane {
        background-color: rgba(60, 70, 80, 0.15);
    }

    #left-pane, #center-pane, #right-pane {
        background-color: rgba(60, 70, 80, 0.05);
    }

    .pane-content {
        padding: 0 10px;
    }
    /*.k-grid .k-header {
    display: none;
    }*/

    .WarnaMerah {
        color: white;
        background-color: red;
    }

    .WarnaHijau {
        color: white;
        background-color: green;
    }

    .WarnaKuning {
        color: black;
        background-color: yellow;
    }

    .WarnaBiru {
        color: white;
        background-color: orange;
    }

    .DataPembandingKosong {
        color: white;
        background-color: black;
    }

    .fieldlist {
        margin: 0 0 -1em;
        padding: 0;
    }

        .fieldlist li {
            list-style: none;
            padding-bottom: 1em;
        }
</style>
