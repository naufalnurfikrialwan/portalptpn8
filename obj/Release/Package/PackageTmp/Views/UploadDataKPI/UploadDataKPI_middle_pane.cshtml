<!--Script references. -->
<!--Reference the jQuery library. -->
@*<script src="@Url.Content("~/Scripts/jquery-2.2.3.min.js")"></script>*@
<!--Reference the SignalR library. -->
<script src="@Url.Content("~/Scripts/jquery.signalR-2.2.1.min.js")"></script>
<!--Reference the autogenerated SignalR hub script. -->
<script src="@Url.Content("~/signalr/hubs")"></script>
<!--Add script to update the page and send messages.-->

<div id="grdDetail">
    @*@(Html.Kendo().Grid<Ptpn8.Models.UploadDataHarian.HDR_EvaluasiUploadDataHarian>()
        .Name("grdDetail")
        .Columns(g =>
        {
            g.Bound(i => i.HDR_EvaluasiUploadDataHarianId).Title("Id").ClientTemplate("-");
            g.Bound(i => i.KebunId).Title("Kebun Id").Width(0);
            g.Bound(i => i.Tanggal_Transaksi).Title("Tanggal Transaksi").Width(0);
            g.Bound(i => i.Tanggal_Upload).Title("Tanggal Upload").Width(0);
            g.Bound(i => i.UserName).Title("Nama User").Width(0);
            g.Bound(i => i.DTL_EvaluasiUploadDataHarian).Title("Trans Id").Width(10);
        })
        .AutoBind(true)
        .Navigatable()
        .Resizable(resizeable => resizeable.Columns(true))
        .Scrollable()
        //.ClientDetailTemplateId("detailUpload")
        .Sortable()
        .Selectable(selectable => selectable.Mode(GridSelectionMode.Single))
        .HtmlAttributes(new { style = "Height: 600px" })
        .DataSource(o => o
            .Ajax()
            .Model(model =>
            {
                model.Id(p => p.HDR_EvaluasiUploadDataHarianId);
            })
        )
    )*@
</div>

<script id="detailUpload" type="text/kendo-tmpl">
    @*@(Html.Kendo().Grid<Ptpn8.Models.UploadDataHarian.DTL_EvaluasiUploadDataHarian>()
        .Name("grdDetailUpload_#=HDR_EvaluasiUploadDataHarianId#")
        .Columns(column =>
        {
            column.Bound(o => o.DTL_EvaluasiUploadDataHarianId).Hidden();
            column.Bound(o => o.HDR_EvaluasiUploadDataHarianId).Hidden();
            column.Bound(o => o.DataTransaksi).Width(100).Title("Data");
            column.Bound(o => o.JumlahRecord).Title("Jumlah Record").Width(50);
        })
        .DataSource(datasource => datasource
        .Ajax()
        .Model(model =>
        {
            model.Id(p => p.DTL_EvaluasiUploadDataHarianId);
        })
        )
        .ToClientTemplate()
    )*@
    <div class="grdSubDetail">

    </div>
</script>

<script>

    var dataSub;

    $(function () {
        var progress = $.connection.progressHub;

        progress.client.setDataSource1 = function (data) {
            var grid = $("#grdDetail").kendoGrid({
                dataSource: {
                    data: JSON.parse(data),
                    pageSize: 20,
                    serverPaging: true,
                    serverSorting: true
                },
                height: 550,
                sortable: true,
                pageable: false,
                detailTemplate: kendo.template($("#detailUpload").html()),
                detailInit: detailInit,
                dataBound: function () {
                    this.expandRow(this.tbody.find("tr.k-master-row").first());
                },
                columns: [
                    //{ field: "HDR_EvaluasiUploadDataHarianId", title: "Id" },
                    { field: "Tanggal_Transaksi", title:"Tgl Transaksi" },
                    { field: "Tanggal_Upload", title: "Tgl Upload" },
                    { field: "UserName", title: "Nama User" }
                ]
            });
        };

        progress.client.setDataSource2 = function (data) {
            dataSub = data;
        };

        $.connection.hub.start().done(function () {
            //getting the connection ID in case you want to display progress to the specific user
            //that started the process in the first place.
            var connectionId = $.connection.hub.id;
        });

    });

    function detailInit(e) {
        var detailRow = e.detailRow;

        var data = find_in_object(JSON.parse(dataSub), { HDR_EvaluasiUploadDataHarianId: e.data.HDR_EvaluasiUploadDataHarianId });

        detailRow.find(".grdSubDetail").kendoGrid({
            dataSource: {
                data: data,
                serverPaging: true,
                serverSorting: true,
                serverFiltering: true,
                pageSize: 7,
                filter: { field: "HDR_EvaluasiUploadDataHarianId", operator: "eq", value: e.data.HDR_EvaluasiUploadDataHarianId }
            },
            scrollable: false,
            sortable: true,
            pageable: true,
            columns: [
                //{ field: "HDR_EvaluasiUploadDataHarianId", title: "Id", width: "150px" },
                { field: "DataTransaksi", title: "Transaksi", width: "150px" },
                { field: "JumlahRecord", title: "Jml Record", width: "100px" }
            ]
        });
    }

    function find_in_object(my_object, my_criteria) {
        return my_object.filter(function (obj) {
            return Object.keys(my_criteria).every(function (c) {
                return obj[c] == my_criteria[c];
            });
        });
    }
</script>